"use strict";(self.webpackChunk_grammarly_denali_app=self.webpackChunk_grammarly_denali_app||[]).push([[2032],{34681:(e,t,i)=>{i.d(t,{n:()=>u,r:()=>p});var s=i(83531),n=i(23988),r=i(38886),o=i(65011),a=i(84647),l=i(92891),d=i(1224),c=i(93712);class u{get withoutAccessToken(){return{csrfToken:this.csrfToken,containerId:this.containerId,clientName:this.clientName,clientVersion:this.clientVersion}}constructor(e,t,i,r){(0,n._)(this,"_gnarClient",void 0),(0,n._)(this,"_config",void 0),(0,n._)(this,"_env",void 0),(0,n._)(this,"_getAccessToken",void 0),(0,n._)(this,"_cookieStorage",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"csrfToken",void 0),(0,n._)(this,"containerId",void 0),(0,n._)(this,"clientName",void 0),(0,n._)(this,"clientVersion",void 0),(0,n._)(this,"accessToken",void 0),this._gnarClient=e,this._config=t,this._env=i,this._getAccessToken=r,this._cookieStorage=new l.W6(this._config.domains.cookie),this._log=d.Bx.Logging.root.getLogger("base.fingerprints"),this.csrfToken=()=>this._cookieStorage.safeGetValue("csrf-token").then((e=>(Boolean(e)||this._log.warn("Missing CSRF token: token is empty"),e))).catch((e=>{throw this._log.warn("Missing CSRF token: error",e),e})),this.containerId=this._gnarClient.getContainerId(),this.clientName=this._env.names.auth,this.clientVersion=this._env.buildVersion;var o,a=this;this.accessToken=(o=this._env.platform)===c.OH.Platform.MACEDITOR||o===c.OH.Platform.IPAD||o===c.OH.Platform.WEB||o===c.OH.Platform.AISTUDIO||o===c.OH.Platform.DEMOEDITOR?void 0:(0,s._)((function*(){try{return yield a._getAccessToken(a.withoutAccessToken)}catch(e){return}}))}}const h=(0,a.flow)(r.yU(["X-CSRF-Token","X-Container-Id","X-Client-Version","X-Client-Type","Authorization"]),r.pb((e=>void 0!==e[0])),r.Tj(o.wg),r.TS({},((e,[t,i])=>(e[t]=i,e))));function p(e){return()=>Promise.all([e.csrfToken(),e.containerId.catch(a.constUndefined),e.clientVersion.toString(),e.clientName,Promise.resolve("function"==typeof e.accessToken?e.accessToken():e.accessToken).then((e=>void 0===e?e:`Bearer ${e}`))]).then(h)}},19436:(e,t,i)=>{i.d(t,{Mu:()=>x,NO:()=>M,Qd:()=>E,RQ:()=>T,S1:()=>P,T3:()=>N,Vw:()=>R,cI:()=>U,ce:()=>j,ie:()=>D,jv:()=>F,lB:()=>B,mH:()=>H,mj:()=>L,pG:()=>A,wM:()=>I,z$:()=>C});var s=i(85886),n=i(21182),r=i(686),o=i(56062),a=i(24934),l=i(13490),d=i(2038),c=i(64924),u=i(92824),h=i(77205),p=i(79343),_=i(19813),g=i(71428),m=i(69107),f=i(57879),v=i(80843),y=i(84712),b=i(48779),S=i(58655),w=i(99010),k=i(19772);(0,v.yY)(n.a);const P=(0,v.yY)(r.s),x=(0,v.yY)(o.E),C=(0,v.yY)(a.D),D=(0,v.yY)(l.K),E=((0,v.yY)(d.S),(0,v.yY)(c.y)),T=(0,v.yY)(u.$),A=((0,v.yY)(h.I),(0,v.yY)(p.d)),O=(0,v.yY)(_.aF),U=e=>{const t=s.useRef(U._overlayIndex++);return k.R.useSubscriptionTo(b.br(e.isOpen).pipe(S.F(),w.M((e=>U._activeModals.modify((i=>{const s=new Set(i);return e?s.add(t.current):s.delete(t.current),s})))))),s.createElement(O,e)};U._overlayIndex=0,U._activeModals=y.s.create(new Set),U.activeCount=U._activeModals.view((e=>e.size));const I=(0,v.yY)(_.cw),M=(0,v.yY)(_.jl),B=(0,v.yY)(g.T),N=(0,v.yY)(m.j),F=(0,v.yY)(m.j.Heading),L=(0,v.yY)(m.j.Text),R=(0,v.yY)(m.j.Circle),H=(0,v.yY)(m.j.Rectangle),j=(0,v.yY)(f.A)},22409:(e,t,i)=>{i.d(t,{y:()=>u});var s=i(10334),n=i(85886),r=i(80843),o=i(86922),a=i(11864);const l=a.Ks.keyframes({"0%, 80%, 100%":{transform:"scale(0)"},"40%":{transform:"scale(1)"}}),d={display:"inline-block",margin:"0 1px",borderRadius:a.Ks.percent(50),animation:`${l} 1.4s infinite ease-in-out`,animationFillMode:"both",$nest:{"&:nth-child(1)":{animationDelay:"-.32s"},"&:nth-child(2)":{animationDelay:"-.16s"}}},c=a.Ks.stylesheet({spinner:[{textAlign:"center"}],item:[d]}),u=({className:e,size:t=18,color:i="#666"})=>{const a={width:`${t}px`,height:`${t}px`,backgroundColor:i},l=n.useContext(o.S.Context);return n.createElement("div",(0,s._)({role:"status","aria-busy":"true","aria-live":"assertive","aria-label":l.contentIsLoading},(0,r.Ly)(c.spinner,e)),n.createElement("div",{style:a,className:c.item}),n.createElement("div",{style:a,className:c.item}),n.createElement("div",{style:a,className:c.item}))}},67034:(e,t,i)=>{i.d(t,{Aj:()=>u,Df:()=>l,PX:()=>n,Y_:()=>c,cP:()=>a,s3:()=>d,tM:()=>o,zS:()=>r});var s=i(1224);const n="px",r="aW5fc2Vzc2lvbg",o=e=>{const t=s.Bx.Logging.getLogger(e);return{info:(e,i)=>t.info(e,i),warn:(e,i)=>t.warn(e,i),error:(e,i)=>t.error(e,i)}},a=e=>s.Bx.TimeSeries.rootFemetrics.getMetric(e),l=e=>{"performance"in window&&performance.mark&&performance.mark(e)},d=e=>(null==e.name||""===e.name?"My":`${e.name}'s`)+" Team",c=e=>{const t=(e=>{if("performance"in window&&performance.getEntriesByName){const t=performance.getEntriesByName(e);if(t.length>0)return t[0]}})(e);return t?t.startTime:void 0};function u(e,t={}){return new Proxy(e,{get:(e,i,s)=>t.hasOwnProperty(i)?t[i]:Reflect.get(e,i,s)})}},98969:(e,t,i)=>{i.d(t,{b:()=>s});var s,n=i(65390),r=i(84647),o=i(95934),a=i(41233),l=i(37326),d=i(51770);!function(e){var t;e.codec=o.YO(o.E$([o.NW({featureReference:a.IO.Type.createStringEnum(l.t.Feature,"PassportFeature")}),o.OH({entitlement:o.OH({stringValue:o.Yj,numberValue:o.ai,boolValue:o.zM})})])),e.fromPassport=e=>{var i;return null!==(t=null===(i=e.passport.featureVisa)||void 0===i?void 0:i.map((({featureReference:e,entitlement:t})=>({featureReference:e,entitlement:t}))))&&void 0!==t?t:[]},e.has=e=>t=>t.some((({featureReference:t,entitlement:i})=>{var s,n,r;const o=Boolean(null===(s=i)||void 0===s?void 0:s.boolValue)||Boolean(null===(n=i)||void 0===n?void 0:n.stringValue)||Boolean(null===(r=i)||void 0===r?void 0:r.numberValue);return t===e&&o}));const i=(e,t)=>i=>(0,r.pipe)(i.find((({featureReference:t})=>t===e)),n.fromNullable,n.chain((0,r.flow)((0,d.Up)("entitlement"),n.fromNullable)),n.chain((0,r.flow)((0,d.Up)(t),n.fromNullable)));e.getString=e=>i(e,"stringValue"),e.getNumber=e=>i(e,"numberValue"),e.getBoolean=e=>i(e,"boolValue"),e.getBrandingSet=(0,r.unsafeCoerce)(s.getString(l.t.Feature.BrandingSet))}(s||(s={}))},18286:(e,t,i)=>{i.d(t,{J:()=>s});var s,n=i(24819),r=i(1224),o=i(704);!function(e){const t=(e,t)=>({pageId:i,placement:s,bannerType:r,advancedAlerts:o=[],inline:a=!1,numberOfAdvancedAlerts:l,numberOfCriticalAlerts:d,sessionUuid:c,upgradeHookName:u,upgradeHookSlot:h,upgradeHookVariant:p})=>{const _=o.reduce(((e,t)=>{const i=t.lensType;return e[i]=e[i]?e[i]+1:1,e}),{}),g=t[(e=>{switch(e){case"show":return"getPremiumButtonShow";case"click":return"getPremiumButtonClick";case"dismiss":return"dismissUpHookButtonClick";default:return(0,n.AS)(e)}})(e)].bind(t);return g(i,r,_.clarity,_.correctness,_.delivery,_.engagement,a,(null!=l?l:o.length>0)?o.length:void 0,d,s,c,u,h,p)},i=e=>({pageId:t,upgradeHookName:i,upgradeHookSlot:s,upgradeHookVariant:a})=>r.Bx.TimeSeries.rootFemetrics.getMetric(o.PP.Metrics.GetPremiumButton).getCounter("show"===e?o.PP.MetricsActions.Show:"click"===e?o.PP.MetricsActions.Click:(0,n.AS)(e)).setContext({pageId:t,upgradeHookName:i,upgradeHookSlot:s,upgradeHookVariant:a}).increment();e.create=e=>({trackShow:t("show",e),trackClick:t("click",e),trackDismiss:t("dismiss",e),countShow:i("show"),countClick:i("click")})}(s||(s={}))},92622:(e,t,i)=>{i.d(t,{gG:()=>n,j1:()=>r,kz:()=>x,ut:()=>s,x:()=>P});var s,n,r,o=i(65390),a=i(84647),l=i(95934),d=i(61845),c=i(88607),u=i(94530),h=i(26278),p=i(5692),_=i(21538),g=i(40464),m=i(8094),f=i(98969),v=i(37107);!function(e){e.free="free",e.premium="premium"}(s||(s={})),function(e){e.work="work",e.school="school",e.otherProjects="other projects"}(n||(n={})),function(e){e.student="student"}(r||(r={}));const y=l.NW({id:l.Yj,email:l.Yj,fullName:l.Yj}),b=l.E$([y,l.NW({institutionInfo:h.ZU.option(d.KJ.InstitutionInfo.codec),confirmed:l.zM,anonymous:l.zM,type:h.ZU.createStringEnum(s,"UserType"),role:h.ZU.option(l.Yj),roles:l.YO(d.KJ.Role.codec),isTest:l.zM,canUseEditor:l.zM,groups:h.ZU.set(l.Yj),loginType:h.ZU.createStringEnum(d.Gb,"LoginType"),registrationDate:h.ZU.option(h.ZU.date()),editorFeatures:d.KJ.EditorFeatures.codec,isPaymentSandbox:l.zM}),l.OH({newEmail:l.Yj})]),S=l.g1(h.ZU.literalUnion("specialOfferName",m.uJ),l.zM),w=l.KC([l.qO({isEligible:l.eu(!1)}),l.qO({isEligible:l.eu(!0),name:h.ZU.literalUnion("specialOfferName",m.uJ),plans:l.YO(c.yB.codec)})]),k=l.g1(h.ZU.literalUnion("specialOfferName",m.uJ),w);var P,x;!function(e){var t=e.sharedCodec=l.NW({userProfile:b,subscription:p.j.valueCodec(g.E2,l.L5,l.L5),experiments:h.ZU.set(l.Yj),entitlements:h.ZU.option(f.b.codec),specialOffersEligibilityWithPlans:k,specialOffersEligibility:S});e.codec=l.E$([t,l.NW({settings:v.tl.dapiPropsCodec})])}(P||(P={})),function(e){e.codec=h.ZU.option(l.E$([_.O.codec,l.OH(u.k.ReadConfigIOType.props)]))}(x||(x={})),function(e){e.getDLPConfig=(0,a.flow)((e=>e.clientControls),o.map((e=>e.dlpConfiguration)))}(x||(x={}))},4155:(e,t,i)=>{i.d(t,{$t:()=>l,nS:()=>r.nS,ut:()=>o.ut,yD:()=>a});var s=i(23988),n=i(37107),r=i(40884),o=i(92622);const a={DESKTOP_APP_INSTALLED_MAC:"macExtension",DESKTOP_APP_INSTALLED_WINDOWS:"windowsExtension",MOBILE_INSTALLED:["keyboard-installed","mobile-app","mobile-android","mobile-ios"],FREEBIE_USER:"freebie",PREMIUM_CONVERSION:"premium-conversion",MOBILE_IOS_INSTALLED:"mobile-ios",MOBILE_ANDROID_INSTALLED:"mobile-android"};class l{constructor(e,t,i,r,o){(0,s._)(this,"_state",void 0),(0,s._)(this,"_save",void 0),(0,s._)(this,"_experimentClient",void 0),(0,s._)(this,"_router",void 0),(0,s._)(this,"_environment",void 0),(0,s._)(this,"profile",void 0),(0,s._)(this,"settings",void 0),(0,s._)(this,"entitlements",void 0),this._state=e,this._save=t,this._experimentClient=i,this._router=r,this._environment=o,this.profile=this._state.view("userProfile"),this.settings=new n.ZJ(this._state.lens("settings"),((e,t)=>this._save(e,t)),this._state.lens("userProfile").get().id),this.entitlements=this._state.view("entitlements")}}},39781:(e,t,i)=>{i.d(t,{ZP:()=>s,Aj:()=>g,yD:()=>_.yD,ut:()=>_.ut});var s,n=i(23988),r=i(65390),o=i(94855),a=i(84647),l=i(84712),d=i(99010),c=i(5692),u=i(40884),h=i(37107),p=i(40464),_=i(4155);class g extends _.$t{constructor(e,t,i,s,l,h,_,g,m,f,v,y,b,S){super(e,((e,t)=>s.save(e,t)),l,_,m),(0,n._)(this,"_subscriptionApi",void 0),(0,n._)(this,"_authApi",void 0),(0,n._)(this,"_clientControls",void 0),(0,n._)(this,"_config",void 0),(0,n._)(this,"_platformEnvironment",void 0),(0,n._)(this,"_upgradeHook",void 0),(0,n._)(this,"_logoutRD",void 0),(0,n._)(this,"_vitoClient",void 0),(0,n._)(this,"_onLogout",void 0),(0,n._)(this,"logout",void 0),(0,n._)(this,"updateUserRole",void 0),(0,n._)(this,"updateUserNativeLanguage",void 0),(0,n._)(this,"getUserNativeLanguage",void 0),(0,n._)(this,"clientControls",void 0),(0,n._)(this,"subscription",void 0),(0,n._)(this,"features",void 0),this._subscriptionApi=t,this._authApi=i,this._clientControls=h,this._config=g,this._platformEnvironment=f,this._upgradeHook=v,this._logoutRD=y,this._vitoClient=b,this._onLogout=S,this.logout=this._logoutRD.pipe(d.M(this._onLogout)),this.updateUserRole=e=>c.j.modifyRemoteStateOptimistic(this._state.lens("userProfile","role"),(()=>r.some(e)),this._authApi.setUserData({role:e})),this.updateUserNativeLanguage=e=>this._authApi.setUserData({primaryLanguage:e}),this.getUserNativeLanguage=(0,a.pipe)(this._authApi.getUser(),o.Tj((e=>r.fromNullable(e.customFields.frontend_primaryLanguage)))),this.clientControls=this._clientControls,this.subscription=new p.H0(this._state,this._subscriptionApi,this._config,this._platformEnvironment,this._upgradeHook,this._state.lens("userProfile").view("isPaymentSandbox").get(),this._vitoClient),this.features=new u.nS(this._experimentClient,this._state.view("experiments"),r.some(this._state),this.profile,this.settings,this._clientControls,this._environment,this._router)}}!function(e){class t extends h.wq.Mock{constructor(...e){super(...e),(0,n._)(this,"dialect",l.s.create(r.some("american"))),(0,n._)(this,"dialectOrDefault",l.s.create("american")),(0,n._)(this,"setDialect",(()=>Promise.resolve("american"))),(0,n._)(this,"setDialectWeak",(()=>Promise.resolve("american")))}}e.Mock=class{constructor(){(0,n._)(this,"subscription",void 0),(0,n._)(this,"profile",l.s.create({id:"1",fullName:"test",email:"test@test.com"}).view()),(0,n._)(this,"features",new u.ZI.DenaliPageFeaturesMock(!1,new u.ZI.DenaliFeaturesMock)),(0,n._)(this,"settings",new t),(0,n._)(this,"entitlements",l.s.create(r.none)),(0,n._)(this,"getUserNativeLanguage",o.pG(r.none)),(0,n._)(this,"updateUserNativeLanguage",(()=>o.pG(void 0)))}}}(s||(s={}))},82530:(e,t,i)=>{i.d(t,{t2:()=>E,E4:()=>O,ki:()=>U,pq:()=>I,Gd:()=>M});var s,n=i(23988),r=i(10334),o=i(17171),a=i(69384),l=i(84647),d=i(24819),c=i(95133),u=i(90829),h=i(92891),p=i(61845),_=i(60504),g=i(88661),m=i(1224),f=i(48581),v=i(60172),y=i(28208),b=i(74056),S=i(34681),w=i(42279),k=i(99339),P=i(57836),x=i(5406);class C{constructor(){(0,n._)(this,"generalActivity",w.h(k.R(window.document,"mousemove",{capture:!0,passive:!0}).pipe(P.u(void 0)),k.R(window.document,"wheel",{capture:!0,passive:!0}).pipe(P.u(void 0)),k.R(window.document,"keydown",{capture:!0,passive:!0}).pipe(P.u(void 0))))}}!function(e){e.Mock=class{constructor(){(0,n._)(this,"generalActivity",x.w)}}}(s||(s={}));const D=e=>`LazyEmitter received a call to the attribute ${e} which is not a function. LazyEmitter can be used only with functions.`;var E;!function(e){e.create=({appState:e,env:t,platformEnv:i,config:s,router:n,telemetryPageContext:o,productMetricsClient:a,createGnarStorages:l=O})=>{const d=U(s,t,l),c=I(window.location.origin,s.api.tokensUrl),u=M(new S.n(d,s,t,(e=>c(e).getAccessToken({orAnonymous:!0}))),d,s,t,i,n,o,a);return t=>t((0,r._)({appState:e},u))}}(E||(E={}));class T{nextPingDateReadError(e){this._metric.getCounter("nextPingDate.read.failure").increment(),this._logger.warn("nextPingDate.read.failed",e)}nextPingDateWriteError(e){this._metric.getCounter("nextPingDate.write.failure").increment(),this._logger.warn("nextPingDate.write.failed",e)}sendError(){this._metric.getCounter("send.failure").increment()}trackBeforeSetUser(e){this._metric.getCounter("trackBeforeSetUser").increment(),this._logger.debug("trackBeforeSetUser",e)}constructor(e,t){(0,n._)(this,"_logger",void 0),(0,n._)(this,"_metric",void 0),this._logger=e,this._metric=t}}const A={ga:e=>(0,l.constVoid)(),setUserId:e=>(0,l.constVoid)(),getClientId:()=>Promise.resolve("disabled_GA")};function O(e){return{primaryStorage:new h.W6(e.domains.cookie),altStorages:[new h.DT,new h.XG]}}function U(e,t,i=O){if("disabled"!==e.tracking.state){const{primaryStorage:s,altStorages:n}=i(e);return function(e,t,i,s,n){const r=e.api.gnarApi.url,o=new h.q2(i,s,new h.Mj(m.Bx.Logging.root.getLogger("gnar.containerIdManager"),m.Bx.TimeSeries.rootFemetrics.getMetric("gnar.containerIdManager")));return new h.Ob(r,n.names.tracking,n.buildVersion.toString(),t,o,new T(m.Bx.Logging.root.getLogger("gnar"),m.Bx.TimeSeries.rootFemetrics.getMetric("gnar")),!1,A)}(e,f.pM.request({target:"gnar",cache:"default"}),s,n,t)}{const e=new h.Aj;return e.getContainerId=()=>Promise.resolve("dummyContainerId"),e}}const I=(e,t)=>(0,u.Bj)((i=>new g.dN({anonymousTokenClientType:"Web",clientId:i.clientName,redirectUri:e,domain:t,fetch:f.pM.request({target:"oauth",cache:"no-cache"}),httpClientOptions:{getApplicationHeaders:(0,S.r)(i)}})),((...e)=>{const[t]=e;return t.clientName}));function M(e,t,s,n,l,h,g,w){m.Bx.Logging.root.debug(`Constructing model for ${s.env} on the client`),t.getContainerId().then((e=>m.Bx.Logging.root.context.add({containerId:e}))).catch((e=>m.Bx.Logging.root.debug("cant get containerId",e)));const k=new C,P=function(e,t){let s;switch(e){case b.OH.Platform.IPAD:s=()=>i.e(1528).then(i.bind(i,1925)).then((({GnarSpec:e})=>new e(t)));break;case b.OH.Platform.MACEDITOR:s=()=>i.e(844).then(i.bind(i,61064)).then((({GnarSpec:e})=>new e(t)));break;case b.OH.Platform.WEB:case b.OH.Platform.DEMOEDITOR:case b.OH.Platform.AISTUDIO:s=()=>i.e(4741).then(i.bind(i,89236)).then((({GnarSpec:e})=>new e(t)));break;default:return(0,d.xb)(e)}return function(e,t){let i=null,s=[];const n=new Proxy({},{get(e,t){if(i){const e=i[t];if("function"==typeof e)return e.bind(i);throw new Error(D(t))}return(...e)=>{s.push({method:t,args:e})}}});return e().then((e=>{i=e;for(const e of s){const s=i[e.method];"function"==typeof s?s(...e.args):t(new Error(D(e.method)))}s=[]})).catch(t),n}(s,(t=>{m.Bx.Logging.getLogger("BaseModelFactory").error(`Failed to load Gnar spec for ${e}.`,t)}))}(n.platform,function(e){const t=m.Bx.Logging.root.getLogger("gnar.events");return(0,o._)((0,r._)({},e),{track:i=>{const{eventName:s}=i,n=(0,a._)(i,["eventName"]);return t.info(s,n),e.track(i).catch((e=>(t.error("Failed to track gnar event (modern)",{eventName:s,props:i,error:e}),Promise.resolve())))}})}(t)),x=new y.Y(t,k,s.pingMaybeGnarDelay,n);(0,u.hJ)("getEnv",(()=>n));const E=n.has(b.OH.Flag.useForceNoCacheOption)?"no-cache":"default",T=[f.pM.request({target:"manakin",cache:E}),{getApplicationHeaders:(0,S.r)(e)},s.env===v.OH.fb||s.env===v.OH.dev?"prod":s.env];return{authApi:new p.Nj(s.api.authUrl,_.j.createTE(f.pM.request({target:p.Nj.targetTag,cache:E})),e.withoutAccessToken),treatmentService:new c.eb(...T),gateService:new c.mP(...T),telemetry:(0,o._)((0,r._)({gnarSpec:P},g),{bootstrap:x,getContainerId:t.getContainerId.bind(t)}),gnarClient:t,userActivity:k,env:n,platformEnv:l,router:h,config:s,fingerprints:e,cache:E,productMetricsClient:w}}},50794:(e,t,i)=>{i.d(t,{G:()=>r});var s=i(23988),n=i(14650);class r{getAppsItems(){return this._clientsState.supportedApps}onInstallClicked(e){this._handleInstallClick(e,"install")}onReInstallClicked(e){this._handleInstallClick(e,"reInstall")}onMoreClicked(e){this._telemetry.learnMoreClicked(this._appToTracking(e))}_handleInstallClick(e,t){n.X.App.isExtension(e)&&this._extension.install(),this._telemetry.installAppClicked(this._appToTracking(e),t)}_appToTracking(e){return e===n.X.App.extensionEdgeChromium?n.X.App.extensionEdge:e}constructor(e,t,i){(0,s._)(this,"_clientsState",void 0),(0,s._)(this,"_extension",void 0),(0,s._)(this,"_telemetry",void 0),this._clientsState=e,this._extension=t,this._telemetry=i}}},97015:(e,t,i)=>{i.d(t,{Ah:()=>n,DJ:()=>o,Ps:()=>j,RO:()=>r,S:()=>a,VF:()=>Z,Wq:()=>s,Wy:()=>l,fN:()=>H,q8:()=>R});var s,n,r,o,a,l,d=i(23988),c=i(10334),u=i(17171),h=i(66202),p=i(44869),_=i(65390),g=i(68823),m=i(84647),f=i(84906),v=i(99002),y=i(71301),b=i(24819),S=i(84712),w=i(90829),k=i(31023),P=i(3016),x=i(1224),C=i(92832),D=i(58277),E=i(99010),T=i(79937),A=i(42279),O=i(60191),U=i(57836),I=i(74056),M=i(40884),B=i(14650),N=i(37107);!function(e){e.is=e=>N.tl.extensionBanners.some((t=>t===e))}(s||(s={})),function(e){e.is=e=>r.is(e)||o.isPopup(e)}(n||(n={})),function(e){e.popups=N.tl.extensionAppPopups,e.is=e=>N.tl.extensionAppPopups.some((t=>t===e))}(r||(r={})),function(e){e.popups=N.tl.extensionAutoCitationsPopups,e.isBanner=e=>N.tl.extensionAutoCitationsBanners.some((t=>t===e)),e.isPopup=e=>N.tl.extensionAutoCitationsPopups.some((t=>t===e))}(o||(o={})),function(e){e.is=e=>N.tl.llamaBanners.some((t=>t===e)),e.isMac=e=>"llama-mac-download-banner"===e}(a||(a={})),function(e){e.is=e=>N.tl.llamaPopups.some((t=>t===e)),e.isMac=e=>"llama-mac-download-popup"===e}(l||(l={}));const F={active:null};function L(e){switch(e){case B.X.App.extensionChrome:return"chrome-popup";case B.X.App.extensionFirefox:return"firefox-popup";case B.X.App.extensionSafari:return"safari-popup";case B.X.App.extensionEdge:return"edge-popup";case B.X.App.extensionEdgeChromium:return"edge-chromium-popup";case B.X.App.desktopMac:return"llama-mac-download-popup";case B.X.App.desktopWindows:return"llama-windows-download-popup";default:return(0,b.xb)(e)}}function R(e){switch(e){case"llama-mac-download-popup":return B.X.App.desktopMac;case"llama-windows-download-popup":return B.X.App.desktopWindows;default:return(0,b.xb)(e)}}function H(e){switch(e){case"chrome-popup":return B.X.App.extensionChrome;case"safari-popup":return B.X.App.extensionSafari;case"firefox-popup":return B.X.App.extensionFirefox;case"edge-popup":case"edge-chromium-popup":return B.X.App.extensionEdge;case"chrome-autoCitations-popup":return"chrome-autoCitations-popup";case"safari-autoCitations-popup":case"firefox-autoCitations-popup":return"safari-autoCitations-popup";case"edge-chromium-autoCitations-popup":return"edge-chromium-autoCitations-popup";default:return(0,b.xb)(e)}}function j(e){switch(e){case"true-up":return"gbTrueUpReminder";case"llama-mac-download-banner":return B.X.App.desktopMac;case"llama-windows-download-banner":return B.X.App.desktopWindows;case"chrome-extension":return B.X.App.extensionChrome;case"firefox-extension":return B.X.App.extensionFirefox;case"safari-extension":return B.X.App.extensionSafari;case"edge-extension":case"edge-chromium-extension":return B.X.App.extensionEdge;case"mobile-keyboard":return B.X.App.mobileKeyboard;case"campaign-end":return"campaignEnd";case"proofit-cancelled":return"proofitCancel";case"proofit-completed":return"proofitComplete";case"invite-members":case"invite-members-pro":return"inviteMembers";case"style-guide":case"style-guide-pro":return"styleGuide";case"chrome-autoCitations":return"chrome-autoCitations";case"edge-chromium-autoCitations":return"edge-chromium-autoCitations";case"safari-autoCitations":return"safari-autoCitations";case"firefox-autoCitations":return"firefox-autoCitations";case"de-deprecation-banner":return"deDeprecationBanner";case"de-deprecation-popup":return"deDeprecationPopup";case"desktop-mac":return"desktopMac";case"desktop-windows":return"desktopWindows";default:return(0,b.xb)(e)}}var G,W,q,V;(W=G||(G={})).eq=p.OW({type:v.Eq,expire:f.Eq}),W.has=e=>t=>Array.from(t.values()).some((t=>G.eq.equals(t,e))),function(e){e.empty=()=>({dismiss:new Set,shown:new Set,later:new Set,cancelled:new Set}),e.show={show:e=>{const t=JSON.stringify({dismiss:Array.from(e.dismiss),shown:Array.from(e.shown),later:Array.from(e.later),cancelled:Array.from(e.cancelled)});return`length: ${t.length}\n${t}`}}}(q||(q={})),function(e){function t(e){return(0,m.pipe)(e.llamaDiscoverabilityType,_.toUndefined)}function i(e){return B.X.isNotInstalled(e)?function(e){switch(e){case B.X.App.extensionChrome:return"chrome-extension";case B.X.App.extensionFirefox:return"firefox-extension";case B.X.App.extensionSafari:return"safari-extension";case B.X.App.extensionEdge:return"edge-extension";case B.X.App.extensionEdgeChromium:return"edge-chromium-extension";case B.X.App.mobileKeyboard:return"mobile-keyboard";case B.X.App.iOS:case B.X.App.android:case B.X.App.desktopMac:case B.X.App.desktopWindows:return null;default:return(0,b.xb)(e)}}(e.name):null}function s(e){return t=>null===t||e.dismiss.has(t)||(0,m.pipe)(e.later,g.zN((e=>e.type===t)))?null:t}function n(e){return t=>{switch(t){case"chrome-extension":case"chrome-popup":case"chrome-autoCitations":case"chrome-autoCitations-popup":return e.includes(B.X.App.extensionChrome)?null:t;case"safari-extension":case"safari-popup":case"safari-autoCitations":case"safari-autoCitations-popup":return e.includes(B.X.App.extensionSafari)?null:t;case"edge-chromium-extension":case"edge-chromium-popup":case"edge-chromium-autoCitations":case"edge-chromium-autoCitations-popup":return e.includes(B.X.App.extensionEdgeChromium)?null:t;case"edge-extension":case"edge-popup":return e.includes(B.X.App.extensionEdge)?null:t;case"firefox-extension":case"firefox-popup":case"firefox-autoCitations":case"firefox-autoCitations-popup":return e.includes(B.X.App.extensionFirefox)?null:t;case"mobile-keyboard":return e.includes(B.X.App.iOS)||e.includes(B.X.App.android)?null:t;default:return t}}}e.getActiveBanner=function(e,r,o,a){const l=r.desktopApp.state===I.OH.ClientState.INSTALLED&&o.showAutoCitationsBannerPromotion&&(v=r.extension,B.X.isNotInstalled(v)?function(e){switch(e){case B.X.App.extensionChrome:return"chrome-autoCitations";case B.X.App.extensionFirefox:return"firefox-autoCitations";case B.X.App.extensionSafari:return"safari-autoCitations";case B.X.App.extensionEdgeChromium:return"edge-chromium-autoCitations";case B.X.App.extensionEdge:default:return null}}(v.name):null),d=B.X.isSupported(r.desktopApp)&&B.X.App.isLlama(r.desktopApp.name)&&t(o)===M.d6.Banner&&(r.desktopApp.name===B.X.App.desktopWindows?"llama-windows-download-banner":"llama-mac-download-banner"),c=_.isNone(o.llamaDiscoverabilityType)&&o.showAppBanners&&(0,m.pipe)(i(r.extension),s(e),n(r.blockedApps)),u=o.showAppBanners&&(0,m.pipe)(i(r.desktopApp),s(e),n(r.blockedApps)),h=o.showInviteMembersBanner&&(0,m.pipe)(a,_.fold((()=>(0,m.pipe)("invite-members",s(e))),(t=>(0,m.pipe)("PRO"===t?"invite-members-pro":"invite-members",s(e))))),p=o.showStyleGuideBanner&&(0,m.pipe)(a,_.fold((()=>(0,m.pipe)("style-guide",s(e))),(t=>(0,m.pipe)("PRO"===t?"style-guide-pro":"style-guide",s(e))))),g=o.showAppBanners&&(0,m.pipe)(i(r.iOS),s(e),n(r.blockedApps))&&(0,m.pipe)(i(r.android),s(e),n(r.blockedApps)),f=o.showTrueUpBanner&&(0,m.pipe)("true-up",s(e));var v;return h||p||d||l||c||u||g||f||null},e.getActivePopup=function(e,i,r){return(0,m.pipe)(function(e,i){const{extension:s,desktopApp:n}=e;return B.X.isSupported(n)&&B.X.App.isLlama(n.name)&&t(i)===M.d6.Modal?L(n.name):i.extensionInstallPromotion&&i.showAppBanners&&B.X.isNotInstalled(s)&&B.X.App.isExtension(s.name)?L(s.name):Boolean(i.showAutoCitationsPopupPromotion)&&s.state===I.OH.ClientState.INSTALLED&&B.X.App.isExtension(s.name)?function(e){switch(e){case B.X.App.extensionChrome:return"chrome-autoCitations-popup";case B.X.App.extensionFirefox:return"firefox-autoCitations-popup";case B.X.App.extensionSafari:return"safari-autoCitations-popup";case B.X.App.extensionEdgeChromium:return"edge-chromium-autoCitations-popup";case B.X.App.extensionEdge:return null;default:return(0,b.xb)(e)}}(s.name):null}(i,r),function(e){return t=>null===t||e.shown.has(t)?null:t}(e),s(e),n(i.blockedApps))}}(V||(V={}));class Z{get bannerFeatures(){return(0,m.pipe)(this._features,_.getOrElse((()=>M.LU.empty)))}_updateLaterBanners(e){const{later:t}=e,i=Date.now(),s=(0,m.pipe)(t,g.pb((e=>i<=e.expire)));s.size!==t.size&&(e=(0,u._)((0,c._)({},e),{later:s}));const n=(0,c._)({},q.empty(),e);if(N.tl.bannersType.is(n))return this._banners.set(n),n;{this._log.error("Initialized with corrupt banner type, resetting banners",{parsedBanners:n,banners:k.OA.of(n)});const e=q.empty();return this._updateBanners(e),e}}_getActiveBanner(){return V.getActiveBanner(this._banners.get(),this._clientsState,this.bannerFeatures,this._brandingSet)}_getActivePopup(){return V.getActivePopup(this._banners.get(),this._clientsState,this.bannerFeatures)}_getAppsPopupsToMarkAsShown(){return N.tl.extensionAppPopups.filter((e=>!this.getBannerState(e).includes("shown")))}_markPopupsShown(e,t){e.length>0&&this._updateBanners({shown:new Set([...Array.from(t.shown),...e])})}_getAutoCitationsPopupsToMarkShown(){const e=this.state.get().active;return e&&N.tl.isExtensionAutoCitationsPopup(e)?N.tl.extensionAutoCitationsPopups.filter((e=>!this.getBannerState(e).includes("shown"))):[]}remind(e){this.getBannerState(e).includes("cancelled")?this.dismiss(e):(this._cancel(e),this._remind(e,y.ei))}cancel(e){this.remind(e)}install(e){s.is(e)||n.is(e)?this._extension.install().then((e=>e&&this.state.set(F))):this.state.set(F)}dispose(){this._subs.dispose()}_resetState(){this.state.set(F)}_updateBanners(e){this._banners.modify((t=>(0,c._)({},t,e)))}constructor(e,t,i,s,n){(0,d._)(this,"_clientsState",void 0),(0,d._)(this,"_extension",void 0),(0,d._)(this,"_features",void 0),(0,d._)(this,"_brandingSet",void 0),(0,d._)(this,"state",void 0),(0,d._)(this,"_log",void 0),(0,d._)(this,"_subs",void 0),(0,d._)(this,"initialize",void 0),(0,d._)(this,"_banners",void 0),(0,d._)(this,"dismiss",void 0),(0,d._)(this,"shown",void 0),(0,d._)(this,"getBannerState",void 0),(0,d._)(this,"_cancel",void 0),(0,d._)(this,"_remind",void 0),(0,d._)(this,"_addBanner",void 0),this._clientsState=e,this._extension=t,this._features=i,this._brandingSet=n,this.state=S.s.create(F),this._log=x.Bx.Logging.getLogger("BannersModel"),this._subs=new P.y.Keeper,this.initialize=e=>{const t=this._updateLaterBanners(e);var i;this.state.set({active:null!==(i=this._getActivePopup())&&void 0!==i?i:this._getActiveBanner()}),this._markPopupsShown([...this._getAppsPopupsToMarkAsShown(),...this._getAutoCitationsPopupsToMarkShown()],t)},this._banners=S.s.create(q.empty()),this.dismiss=e=>{this._addBanner({type:"dismiss",banner:e}),this._resetState()},this.shown=e=>{this._addBanner({type:"shown",banner:e})},this.getBannerState=e=>{const t=this._banners.get();return(0,m.pipe)(h.tryCatch((()=>Object.keys(t).filter((i=>"later"===i?(0,m.pipe)(t[i],g.zN((t=>t.type===e))):t[i].has(e)))),h.toError),h.fold((i=>(this._log.error("Failed to get banner state",{name:i.name,message:i.message,banners:k.OA.of(t),parsedBanners:t,banner:e}),[])),m.identity))},this._cancel=e=>{this._addBanner({type:"cancelled",banner:e}),this._resetState()},this._remind=(e,t)=>{this._addBanner({type:"later",lateBanner:{type:e,expire:Date.now()+t}}),this._resetState()},this._addBanner=e=>{const t=this._banners.get();switch(e.type){case"shown":case"cancelled":const i=t[e.type];if(i.has(e.banner))return;this._updateBanners({[e.type]:new Set([...Array.from(i),e.banner])});break;case"later":this._updateBanners({later:new Set([...Array.from(t.later),e.lateBanner])});break;case"dismiss":this._updateBanners({dismiss:new Set([...Array.from(t.dismiss),e.banner])});break;default:(0,b.xb)(e)}},this._banners.pipe(C.i(1),D.Z(100)).subscribe(s),(0,w.hJ)("resetBanners",(()=>{this._updateBanners(q.empty())})),(0,w.hJ)("remindBanner",((e,t)=>{this._remind(e,t)})),(0,w.hJ)("listBanners",(()=>{console.debug(JSON.stringify(this._banners.get(),null,2))})),this._subs.push(this._banners.pipe(E.M((e=>this._log.debug("Banners updated",{banners:q.show.show(e)}))),T.n((e=>A.h(...Array.from(e.later).map((e=>O.O1(e.expire-Date.now()).pipe(U.u(e.type))))).pipe(E.M((t=>{this._log.debug("Showing banner scheduled for later",t),this.state.set({active:t}),this._updateLaterBanners(e)})))))).subscribe())}}},21538:(e,t,i)=>{i.d(t,{O:()=>s,q:()=>d});var s,n=i(10334),r=i(17171),o=i(95934),a=i(10665);!function(e){e.codec=o.NW({dlpEnabled:o.zM,docsDisabled:o.zM,dlpConfiguration:a.fW.codec,clients:o.YO(o.NW({client:o.Yj,blocked:o.zM}))})}(s||(s={}));const l="editor";function d(e){var t;if(!e.clientControls.clientControlsEnabled)return(0,r._)((0,n._)({},e.clientControls),{dlpEnabled:!1,docsDisabled:!1,dlpConfiguration:a.Wm,clients:[]});const i=(null===(t=e.blockedClients)||void 0===t?void 0:t.blockedClients.map((e=>({client:e.client,blocked:e.enabled}))))||[],s=i.some((e=>e.client===l&&e.blocked));return(0,r._)((0,n._)({},e.clientControls),{dlpEnabled:e.clientControls.dlpEnabled,dlpConfiguration:e.clientControls.dlpConfiguration,docsDisabled:s,clients:i})}},14650:(e,t,i)=>{i.d(t,{X:()=>s});var s,n=i(23988),r=i(65390),o=i(84647),a=i(74056),l=i(39781);!function(e){let t;var i;!function(e){e.desktopMac="macDesktop",e.desktopWindows="winDesktop",e.extensionChrome="chromeExt",e.extensionFirefox="firefoxExt",e.extensionSafari="safariExt",e.extensionEdge="edgeExt",e.extensionEdgeChromium="edgeChromiumExt",e.iOS="iOS",e.android="android",e.mobileKeyboard="mobileKeyboard"}(t=e.App||(e.App={})),(i=t=e.App||(e.App={})).isExtension=e=>[t.extensionChrome,t.extensionFirefox,t.extensionSafari,t.extensionEdge,t.extensionEdgeChromium].some((t=>t===e)),i.isLlama=e=>[t.desktopMac,t.desktopWindows].some((t=>t===e)),i.isExternalDownloadSource=e=>[t.iOS,t.android].some((t=>t===e)),e.isSupported=function(e){return e.state!==a.OH.ClientState.NOT_SUPPORTED},e.isNotInstalled=function(e){return e.state===a.OH.ClientState.NOT_INSTALLED};var d=e.unsupported={state:a.OH.ClientState.NOT_SUPPORTED};e.Impl=class{getAsArray(){return this._defaultSupportedArray.filter(s.isSupported).filter((e=>!Boolean(this.blockedApps.includes(e.name))))}_getExtensionName(e){switch(e){case"chrome":return t.extensionChrome;case"firefox":return t.extensionFirefox;case"safari":return t.extensionSafari;case"edge":return Number(this._environment.info.version)>18?t.extensionEdgeChromium:t.extensionEdge;default:throw new Error("unsupported browser "+e)}}constructor(e,i){(0,n._)(this,"_environment",void 0),(0,n._)(this,"_userProfile",void 0),(0,n._)(this,"_isWin",void 0),(0,n._)(this,"_isMac",void 0),(0,n._)(this,"_getDesktopAppMac",void 0),(0,n._)(this,"_getDesktopAppWindows",void 0),(0,n._)(this,"extension",void 0),(0,n._)(this,"desktopApp",void 0),(0,n._)(this,"iOS",void 0),(0,n._)(this,"android",void 0),(0,n._)(this,"_defaultSupportedArray",void 0),(0,n._)(this,"blockedApps",void 0),(0,n._)(this,"supportedApps",void 0),(0,n._)(this,"isEditorBlocked",void 0),this._environment=e,this._userProfile=i,this._isWin="windows"===this._environment.info.os,this._isMac="mac"===this._environment.info.os,this._getDesktopAppMac=()=>({name:t.desktopMac,state:this._userProfile.profile.view((({groups:e})=>e.has(l.yD.DESKTOP_APP_INSTALLED_MAC))).get()?a.OH.ClientState.INSTALLED:a.OH.ClientState.NOT_INSTALLED}),this._getDesktopAppWindows=()=>({name:t.desktopWindows,state:this._userProfile.profile.view((({groups:e})=>e.has(l.yD.DESKTOP_APP_INSTALLED_WINDOWS))).get()?a.OH.ClientState.INSTALLED:a.OH.ClientState.NOT_INSTALLED}),this.extension=this._environment.extension===a.OH.ClientState.NOT_SUPPORTED?d:{name:this._getExtensionName(this._environment.info.browser),state:this._environment.extension},this.desktopApp=this._isWin?this._getDesktopAppWindows():this._isMac?this._getDesktopAppMac():d,this.iOS={name:t.iOS,state:this._userProfile.profile.view((({groups:e})=>e.has(l.yD.MOBILE_IOS_INSTALLED))).get()?a.OH.ClientState.INSTALLED:a.OH.ClientState.NOT_INSTALLED},this.android={name:t.android,state:this._userProfile.profile.view((({groups:e})=>e.has(l.yD.MOBILE_ANDROID_INSTALLED))).get()?a.OH.ClientState.INSTALLED:a.OH.ClientState.NOT_INSTALLED},this._defaultSupportedArray=[this.desktopApp,this.extension,this.iOS,this.android],this.blockedApps=(0,o.pipe)(this._userProfile.clientControls,r.fold((()=>[]),(({clients:e})=>e.filter((e=>e.blocked)).map((e=>{switch(e.client){case"extensionChrome":return s.App.extensionChrome;case"extensionEdge":return s.App.extensionEdgeChromium;case"extensionFirefox":return s.App.extensionFirefox;case"macExtension":return s.App.desktopMac;case"windowsExtension":return s.App.desktopWindows;case"IOS_NATIVE_EDITOR":return s.App.iOS;case"MOBILE_ANDROID":return s.App.android;default:return}})).filter((e=>void 0!==e))))),this.supportedApps=this.getAsArray().map((({name:e,state:t})=>({app:e,installed:t===a.OH.ClientState.INSTALLED}))),this.isEditorBlocked=(0,o.pipe)(this._userProfile.clientControls,r.fold((()=>!1),(({docsDisabled:e})=>e)))}},e.Mock=class{getAsArray(){return[this.desktopApp,this.extension,this.iOS,this.android]}constructor(e={name:t.desktopMac,state:a.OH.ClientState.NOT_INSTALLED},i={name:t.extensionChrome,state:a.OH.ClientState.NOT_INSTALLED},r={name:t.android,state:a.OH.ClientState.NOT_INSTALLED},o={name:t.iOS,state:a.OH.ClientState.NOT_INSTALLED}){(0,n._)(this,"desktopApp",void 0),(0,n._)(this,"extension",void 0),(0,n._)(this,"android",void 0),(0,n._)(this,"iOS",void 0),(0,n._)(this,"supportedApps",void 0),(0,n._)(this,"blockedApps",void 0),(0,n._)(this,"isEditorBlocked",void 0),this.desktopApp=e,this.extension=i,this.android=r,this.iOS=o,this.supportedApps=this.getAsArray().filter(s.isSupported).map((({name:e,state:t})=>({app:e,installed:t===a.OH.ClientState.INSTALLED}))),this.blockedApps=[],this.isEditorBlocked=!1}}}(s||(s={}))},22438:(e,t,i)=>{i.d(t,{k:()=>s});const s="online"},78408:(e,t,i)=>{i.d(t,{H:()=>u});var s=i(23988),n=i(10334),r=i(17171),o=i(24819),a=i(84712),l=i(9079),d=i(7149),c=i(22438);class u{setState({type:e,state:t}){this._wsState.modify((i=>(0,r._)((0,n._)({},i),{[e]:t})))}_wasChanged(e,t,i){return e[i].type!==t[i].type}constructor(e,t){(0,s._)(this,"_connectivity",void 0),(0,s._)(this,"_wsHandlers",void 0),(0,s._)(this,"_wsState",void 0),(0,s._)(this,"_getChangedState",void 0),(0,s._)(this,"_handleStateChange",void 0),this._connectivity=e,this._wsHandlers=t,this._wsState=a.s.create({wsDox:{type:c.k},wsCapi:{type:c.k}}),this._getChangedState=([e,t])=>{const i=Object.keys(e).find((i=>this._wasChanged(e,t,i)));return(0,o.V1)(!!i,"WsState must be changed"),{type:i,state:t[i]}},this._handleStateChange=({type:e,state:t})=>{t.type===c.k?this._connectivity.setState({type:e,state:{type:"online"}}):((0,o.V1)(null!=this._wsHandlers[e],"WsErrorHandler must be defined"),this._wsHandlers[e].handle(t))},this._wsState.pipe(l.J(),d.T(this._getChangedState)).subscribe(this._handleStateChange)}}},53782:(e,t,i)=>{i.d(t,{M:()=>p,j:()=>_});var s=i(23988),n=i(10334),r=i(17171),o=i(94855),a=i(84647),l=i(58508),d=i(32189),c=i(70238),u=i(75336),h=i(1224);const p=e=>e instanceof c.Hl&&403===e.code;class _{createDocument(e,t,i){const s=(0,a.pipe)(o.TX((()=>this._doxApi.createDocument(u.J.Create.textFull((0,r._)((0,n._)({},Boolean(e)?{doc:{ops:[{insert:e}]}}:{},i?{extra_params:i}:{}),{title:t})))),(e=>e)));let c=1;return(0,a.pipe)(s,(0,d.L)([l.Oh(4),l.Ed(1e3)],(e=>!p(e)&&(this._log.error("DOX: createDocument error",e,{attempt:c++}),!0))))}constructor(e){(0,s._)(this,"_doxApi",void 0),(0,s._)(this,"_log",void 0),this._doxApi=e,this._log=h.Bx.Logging.getLogger("model.documents.actions")}}},54179:(e,t,i)=>{i.d(t,{fQ:()=>x});var s,n,r=i(23988),o=i(38886),a=i(65390),l=i(84647),d=i(24819),c=i(84712),u=i(46710),h=i(1224),p=i(94855),_=i(68801),g=i(5692),m=i(3016),f=i(91745),v=i(54641),y=i(99010),b=i(5406),S=i(36644),w=i(53782),k=i(78018);!function(e){e.clientError="clientError",e.serverError="serverError"}(s||(s={})),function(e){e.documentTypeUnsupported="documentTypeUnsupported",e.documentIsEmpty="documentIsEmpty",e.documentSizeExceeded="documentSizeExceeded",e.noFileToUpload="noFileToUpload",e.onlyOneDocumentAllowed="onlyOneDocumentAllowed"}(n||(n={}));const P=()=>g.j.defaultValue();class x{dispose(){this._subs.dispose()}upload(e){this._inBackground=!1;const{files:t,notify:i,allowMultiple:n,isDragNDrop:r}=e,d=this._validateFiles(t,n);return d.length<=0?(this._state.set(P()),Promise.resolve([])):(this._state.modify(g.j.begin),this._uploadingCount.set(d.length),(0,l.pipe)(d.map((e=>(0,l.pipe)(p.TX((()=>{try{return this._upload(e)}catch(e){return Promise.reject(e)}}),(e=>{const t=(e=>({kind:s.serverError,error:e}))(e);return this._state.modify(g.j.fatal(t)),t})),p.Tj((t=>({id:String(t.id),uploadedFileType:e.type||"UNKNOWN_FILE_TYPE",uploadedFileName:e.name||"UNKNOWN_FILE_NAME"})))))),o.Ql.sequence(p.ys),p.Tj((e=>(this._telemetry.gnarSpec.uploadDocumentFormSubmit(r,!0,this._telemetry.pageId),(0,S.Wd)({source:"upload"}),this._state.modify(g.j.success({navigateTo:e.length>1||e.length!==t.length?a.none:(0,o.d5)(e),notify:i})),this._state.set(P()),this._uploadingCount.set(0),e))),_.hq,(e=>e.catch((()=>[])))))}navigated(){this._inBackground=!0}_handleServerError({error:e}){const t=e=>this._telemetry.gnarSpec.uploadDocumentFormSubmit(!1,!1,this._telemetry.pageId,e,"serverError");return e instanceof u.h.FileSizeOutOfRangeError?(t(n.documentSizeExceeded),this._notificationsManager.enqueue("documentSizeExceeded",{os:this._environment.info.os,officeAddinUrl:""})):e instanceof u.h.EmptyFileError?(t(n.documentIsEmpty),this._notificationsManager.enqueue("documentIsEmpty")):e instanceof u.h.UnsupportedFileTypeError?(t(n.documentTypeUnsupported),this._notificationsManager.enqueue("documentTypeUnsupported")):e instanceof u.h.TrackedChangesIsUnsupported?(t(e.message),this._notificationsManager.enqueue("trackedChangesIsUnsupported",{link:this._config.support.documentAcceptTrackedChanges})):e instanceof u.h.TooManyRequestsError?(t(e.message),this._notificationsManager.enqueue("error")):(0,w.M)(e)?this._notificationsManager.enqueue("byokKeyInaccessible"):(t(e.message),h.Bx.Logging.getLogger("document.upload").error("uploadDocument failed",e),this._notificationsManager.enqueue("documentUploadGeneralError"))}_handleClientError({errorType:e}){switch(this._telemetry.gnarSpec.uploadDocumentFormSubmit(!1,!1,this._telemetry.pageId,n[e],s.clientError),e){case n.documentTypeUnsupported:return this._notificationsManager.enqueue("documentTypeUnsupported");case n.documentIsEmpty:return this._notificationsManager.enqueue("documentIsEmpty");case n.documentSizeExceeded:return this._notificationsManager.enqueue("documentSizeExceeded",{os:this._environment.info.os,officeAddinUrl:""});case n.noFileToUpload:return this._notificationsManager.enqueue("noFileToUpload");case n.onlyOneDocumentAllowed:return this._notificationsManager.enqueue("oneDocumentIsAllowed");default:return(0,d.xb)(e)}}_emitClientError(e){this._state.modify(g.j.error((e=>({kind:s.clientError,errorType:e}))(e)))}_validateFiles(e,t){return e.length<=0?(this._emitClientError(n.noFileToUpload),[]):!t&&e.length>1?(this._emitClientError(n.onlyOneDocumentAllowed),[]):(i=e,Array.from(i)).reduce(((e,t)=>{var i;return Boolean((i=t.name)&&k.$G.some((e=>i.toLowerCase().endsWith(e))))?t.size?t.size>4194304?this._emitClientError(n.documentSizeExceeded):e.push(t):this._emitClientError(n.documentIsEmpty):this._emitClientError(n.documentTypeUnsupported),e}),[]);var i}constructor(e,t,i,s,n,o){(0,r._)(this,"_upload",void 0),(0,r._)(this,"_navigateToDocument",void 0),(0,r._)(this,"_telemetry",void 0),(0,r._)(this,"_notificationsManager",void 0),(0,r._)(this,"_environment",void 0),(0,r._)(this,"_config",void 0),(0,r._)(this,"_state",void 0),(0,r._)(this,"_uploadingCount",void 0),(0,r._)(this,"_inBackground",void 0),(0,r._)(this,"_subs",void 0),(0,r._)(this,"state",void 0),(0,r._)(this,"uploadingCount",void 0),this._upload=e,this._navigateToDocument=t,this._telemetry=i,this._notificationsManager=s,this._environment=n,this._config=o,this._state=c.s.create(P()),this._uploadingCount=c.s.create(0),this._inBackground=!1,this._subs=new m.y.Keeper,this.state=this._state.view(),this.uploadingCount=this._uploadingCount.view(),this._subs.push(this._state.pipe(f.p((e=>g.j.isTerminated(e)||g.j.isError(e))),v.Z((e=>{if(g.j.isOk(e)){const{navigateTo:t,notify:i}=e.value,s=(0,l.pipe)(t,a.fold((()=>l.constVoid),(e=>()=>this._navigateToDocument(e.id,{uploadedFileType:e.uploadedFileType,uploadedFileName:e.uploadedFileName,openSidebar:!0,showDocumentUploadedNotification:i}))));if(this._inBackground&&a.isSome(t))return this._notificationsManager.enqueue("documentUploaded").pipe(f.p((e=>"navigateToDocument"===e)),y.M(s));s()}else{if(g.j.isFatal(e))return this._handleServerError(e.error);if(g.j.isError(e))return this._handleClientError(e.error)}return b.w}))).subscribe())}}},78018:(e,t,i)=>{i.d(t,{$G:()=>F,Pm:()=>R,l1:()=>q,n6:()=>j,rv:()=>X});var s=i(83531),n=i(23988),r=i(65390),o=i(84647),a=i(24819),l=i(84712),d=i(70238),c=i(67930),u=i(35427),h=i(75336),p=i(46710),_=i(40086),g=i(1224),m=i(94855),f=i(68801),v=i(5692),y=i(34553),b=i(93208),S=i(91745),w=i(89439),k=i(79937),P=i(5406),x=i(42279),C=i(7149),D=i(82585),E=i(8703),T=i(25093),A=i(48779),O=i(99010),U=i(59592),I=i(39812),M=i(6832),B=i(39982),N=i(53782);const F=["doc","docx","odt","rtf","htm","html","txt"].map((e=>"."+e));var L;!function(e){e.doc="application/msword",e.docx="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.odt="application/vnd.oasis.opendocument.text",e.rtf="text/rtf",e.html="text/html",e.txt="text/plain"}(L||(L={}));const R=[L.doc,L.docx,L.odt,L.rtf,L.html,L.txt];var H;!function(e){e.empty={soft:[],hard:[]}}(H||(H={}));const j={searchText:"",wsConnection:v.j.defaultValue(),proofitResults:{},deletedDocumentIds:H.empty,first100:v.j.defaultValue(),codaFirst100:v.j.defaultValue(),remoteSearch:v.j.defaultValue(),documentKind:B.j.Kind.existing},G=100,W=new Date(15653592e5);var q;!function(e){let t;!function(e){e.compatibility="compatibility",e.on="on",e.off="off"}(t=e.FormattingMode||(e.FormattingMode={})),e.fromDocument=(e,t)=>({id:e.id,rtfMode:i(e.originalFilename,e.createdAt,t)});var i=e.getFormattingMode=(e,t,i)=>i.rtf?"string"==typeof e&&null!==t&&t>W?q.FormattingMode.compatibility:q.FormattingMode.on:q.FormattingMode.off}(q||(q={}));class V{init(){(0,a.V1)(null===this._operation,"Expect operation to be not established"),this._operation=v.j.OperationRetrier.create((()=>this._connect()),this.wsConnection)}reset(){const e=this.wsConnection.get();v.j.isOk(e)?this._terminate(e.value):this._operation&&this._operation.unsubscribe(),this._operation=null,this.wsConnection.set(j.wsConnection)}_connect(){return this._doxApi.openDocumentsList({metadataChangeHandler:(e,t)=>{(0,o.pipe)(t.proofit,r.fold(o.constVoid,(t=>{this.results.modify((i=>Object.assign({},i,{[e]:t}))),t.status===_.c.JobStatus.cancelled&&this.cancelled.next({id:e})})))}}).then((e=>({unsubscribe:e.remoteConnection.close.bind(e.remoteConnection)})))}_terminate(e){var t=this;return(0,s._)((function*(){try{t.results.set(j.proofitResults),t.cancelled.next({id:null}),yield e.unsubscribe()}catch(e){throw t._log.error("Failed to close dox session",e),e}}))()}constructor(e,t){(0,n._)(this,"_doxApi",void 0),(0,n._)(this,"_state",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"_operation",void 0),(0,n._)(this,"results",void 0),(0,n._)(this,"cancelled",void 0),(0,n._)(this,"wsConnection",void 0),this._doxApi=e,this._state=t,this._log=g.Bx.Logging.getLogger("model.documents.proofit"),this._operation=null,this.results=this._state.lens("proofitResults"),this.cancelled=new y.B,this.wsConnection=this._state.lens("wsConnection")}}class Z{_zipAsync(e,t){return v.j.flatMap(e,(e=>v.j.map(t,(t=>[e,t]))))}_combineDocumentLists(e,t){const i=[...e,...t];return i.sort(((e,t)=>e.updatedAt&&t.updatedAt?t.updatedAt.getTime()-e.updatedAt.getTime():e.updatedAt?1:t.updatedAt?-1:0)),i}_reset(){this.searchText.set(j.searchText),this._isLocalSearch.set(!1),this._remoteSearch.set(v.j.defaultValue()),this._first100.set(v.j.defaultValue()),this._codaFirst100.set(v.j.defaultValue()),this.deletedDocumentIds.set(H.empty)}_loadDocuments(e,t){const i=l.s.create(!1);this._documentSubs=[v.j.OperationRetrier.create((()=>this._documentKind.get()===B.j.Kind.existing?this._doxApi.listDocuments(G,u.R.OrderBy.Updated,!this._settings.firstCall.get(),u.R.DocumentFilter.all,e,t):this._doxApi.listDeleted(G,u.R.OrderBy.Updated,e,t)),this._first100,v.j.OperationRetrier.RetryStrategy.conditional(this._retryWhen,v.j.OperationRetrier.RetryStrategy.linear(3,3e3))),v.j.OperationRetrier.create(this._loadCodaDocumentList,this._codaFirst100,v.j.OperationRetrier.RetryStrategy.conditional(this._retryWhen,v.j.OperationRetrier.RetryStrategy.linear(3,3e3))),this._trimmedSearchText.pipe(b.E(this._first100,i),S.p((([e])=>!e)),w.c(1e3),S.p((([e,t,i])=>v.j.isTerminated(t)&&!i))).subscribe((()=>{i.set(!0),(this._documentKind.get()===B.j.Kind.deleted?this._doxApi.listDeleted(G,u.R.OrderBy.Updated,e,t):this._doxApi.listDocuments(G,u.R.OrderBy.Updated,!1,u.R.DocumentFilter.all,e,t)).then((e=>this._first100.set(v.j.ok(e)))).catch((e=>{e instanceof d.Hl&&this._handleHttpDoxError(e,"Failed to refresh document list"),this._log.info("Failed to refresh document list",e)})).then((()=>{i.set(!1)}))})),this._isLocalSearch.pipe(k.n((e=>e?P.w:x.h(this._trimmedSearchText.pipe(C.T((e=>U.u.left(e)))),this._trimmedSearchText.pipe(D.B(500),C.T((e=>U.u.right(e))))).pipe(k.n((e=>(this._remoteSearch.set(v.j.defaultValue()),U.u.isLeft(e)||!e.value?P.w:E.v((()=>v.j.OperationRetrier.create((()=>this._doxApi.searchDocument(h.J.Search.contains(e.value),G,u.R.OrderBy.Any,this._documentKind.get()===B.j.Kind.deleted?u.R.DocumentFilter.trash:u.R.DocumentFilter.all)),this._remoteSearch,v.j.OperationRetrier.RetryStrategy.conditional(this._retryWhen,v.j.OperationRetrier.RetryStrategy.linear(3,3e3)))),(()=>this._remoteSearch.pipe(S.p(v.j.isTerminated),T.$())))))))))).subscribe()]}_localSearch(e,t,i,s){const n=new RegExp(s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i");return t.concat(e.filter((e=>!s||n.test(e.firstContent)||n.test(e.title))).filter((e=>-1===t.findIndex((t=>t.id===e.id))))).filter((e=>!i.includes(e.id)))}constructor(e,t,i,r,o,c,u){(0,n._)(this,"_state",void 0),(0,n._)(this,"_doxApi",void 0),(0,n._)(this,"_settings",void 0),(0,n._)(this,"_features",void 0),(0,n._)(this,"_connectivity",void 0),(0,n._)(this,"_handleHttpDoxError",void 0),(0,n._)(this,"_userEmailProvider",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"_isLocalSearch",void 0),(0,n._)(this,"_first100",void 0),(0,n._)(this,"_codaFirst100",void 0),(0,n._)(this,"_remoteSearch",void 0),(0,n._)(this,"_documentKind",void 0),(0,n._)(this,"deletedDocumentIds",void 0),(0,n._)(this,"load",void 0),(0,n._)(this,"reset",void 0),(0,n._)(this,"searchText",void 0),(0,n._)(this,"_trimmedSearchText",void 0),(0,n._)(this,"isFirstTimeLoaded",void 0),(0,n._)(this,"isSearching",void 0),(0,n._)(this,"searchResults",void 0),(0,n._)(this,"_retryWhen",void 0),(0,n._)(this,"_documentSubs",void 0),(0,n._)(this,"_loadCodaDocumentList",void 0),this._state=e,this._doxApi=t,this._settings=i,this._features=r,this._connectivity=o,this._handleHttpDoxError=c,this._userEmailProvider=u,this._log=g.Bx.Logging.getLogger("model.documents.list"),this._isLocalSearch=l.s.create(!1),this._first100=this._state.lens("first100"),this._codaFirst100=this._state.lens("codaFirst100"),this._remoteSearch=this._state.lens("remoteSearch"),this._documentKind=this._state.lens("documentKind"),this.deletedDocumentIds=this._state.lens("deletedDocumentIds"),this.load=(e,t)=>{this.reset(),this._loadDocuments(e,t)},this.reset=()=>{this._documentSubs.forEach((e=>e.unsubscribe())),this._documentSubs=[],this._reset()},this.searchText=this._state.lens("searchText"),this._trimmedSearchText=this.searchText.view((e=>e.trim())),this.isFirstTimeLoaded=this._first100.view(v.j.isOk),this.isSearching=this._remoteSearch.view((e=>v.j.isInProgress(e)||v.j.isError(e))),this.searchResults=l.s.combine(this._documentKind,this._first100,this._codaFirst100,this._remoteSearch,this.deletedDocumentIds,this._trimmedSearchText,((e,t,i,s,n,r)=>v.j.flatMap(this._zipAsync(t,i),(([t,i])=>{const o=this._features.denali.aiEditorUXR?this._combineDocumentLists(i,t):t,a=e===B.j.Kind.existing?n.soft:n.hard;return v.j.isTerminated(s)?v.j.flatMap(s,(e=>v.j.ok(this._localSearch(o,Boolean(e)?e:[],a,r)))):v.j.ok(this._localSearch(o,[],a,r))})))),this._retryWhen=e=>!(e instanceof d.Hl)||(0,a.z3)(e.code),this._documentSubs=[];var h=this;this._loadCodaDocumentList=(0,s._)((function*(){return h._features.denali.aiEditorUXR&&h._documentKind.get()===B.j.Kind.existing?(0,M.iy)(h._userEmailProvider()):[]})),this._settings.firstCall.get()||this._first100.pipe(S.p(v.j.isOk),T.$()).subscribe((()=>this._settings.firstCallDone())),this._first100.pipe(S.p((e=>v.j.isOk(e)))).subscribe((e=>this._isLocalSearch.set(e.value.length<G))),this.searchResults.pipe(S.p((e=>v.j.isError(e)||v.j.isFatal(e))),k.n(A._F.rafScheduler)).subscribe((e=>{v.j.isFatal(e)?(e.error instanceof d.Hl?this._handleHttpDoxError(e.error,"DOX: Cannot load document list"):this._connectivity.setState({type:"dox",state:{type:(0,a.z3)(e.error.code)?"serverError":"unknownConnectionError"}}),this._log.error("DOX: Cannot load document list",e.error)):v.j.isError(e)&&this._log.warn("DOX: Attempt to load document list failed",e.error,{attempt:e.attempt})}))}}class z extends N.j{createDocumentAndNavigate(e){return(0,o.pipe)(this.createDocument(),m.wu(this.handleCreateDocumentError,(t=>{e.get()?this.navigateToDocument(t.id):this._editorTsNotifications.show(this._editorTsNotifications.create.newDocumentCreated((()=>this.navigateToDocument(t.id))))})),f.hq)}deleteDocument(e){const{request:t,lens:i}=this._state.view("documentKind").get()===B.j.Kind.deleted?{request:this._doxApi.forceDelete(e),lens:this._deletedDocumentIds.lens("hard")}:{request:this._doxApi.deleteDocumentById(e),lens:this._deletedDocumentIds.lens("soft")};return i.modify((t=>t.concat([e]))),t.catch((t=>{throw i.modify((t=>t.filter((t=>t!==e)))),t}))}emptyBin(){return this._doxApi.emptyBin().then(this._reset)}downloadOriginal(e){return this._log.info("downloadOriginal.initiated"),(e.rtfMode===q.FormattingMode.on?this._doxApi.downloadInFormat(e.id,"docx"):this._doxApi.downloadOriginal(e.id)).then(c.F.saveToFS).catch(this.handleDownloadDocumentError)}downloadProofread(e,t,i=!1){var n=this;return(0,s._)((function*(){n._log.info("downloadProofread.initiated");try{yield n._doxApi.downloadProofread(e,i).then(c.F.saveToFS).then((()=>{t&&n._editorTsNotifications.show(t)}))}catch(e){n.handleDownloadDocumentError(e)}}))()}navigateToDocument(e){this._navigateToDocument(`${e}`)}handleDeleteDocumentError(e){this._handleError(e,`Failed to delete ${this._state.view("documentKind").get()} document`)}handleEmptyBinError(e){this._handleError(e,"Failed to empty trash")}handleRestoreError(e){this._handleError(e,"Failed to restore a document")}_handleError(e,t){e instanceof d.Hl&&(this._handleHttpDoxError(e,t),this._log.error(t,e))}constructor(e,t,i,s,r,c){super(t),(0,n._)(this,"_state",void 0),(0,n._)(this,"_navigateToDocument",void 0),(0,n._)(this,"_editorTsNotifications",void 0),(0,n._)(this,"_handleHttpDoxError",void 0),(0,n._)(this,"_reset",void 0),(0,n._)(this,"_deletedDocumentIds",void 0),(0,n._)(this,"restoreDocument",void 0),(0,n._)(this,"documentUploadProgress",void 0),(0,n._)(this,"uploadDocument",void 0),(0,n._)(this,"handleDownloadDocumentError",void 0),(0,n._)(this,"handleCreateDocumentError",void 0),this._state=e,this._navigateToDocument=i,this._editorTsNotifications=s,this._handleHttpDoxError=r,this._reset=c,this._deletedDocumentIds=this._state.lens("deletedDocumentIds"),this.restoreDocument=e=>(this._deletedDocumentIds.lens("soft").modify((t=>t.filter((t=>t!==e)))),this._deletedDocumentIds.lens("hard").modify((t=>t.concat([e]))),(0,o.pipe)(m.TX((()=>this._doxApi.restoreDocumentById(e)),(e=>e)),m.wu((t=>(this._deletedDocumentIds.lens("soft").modify((t=>t.concat([e]))),t instanceof d.Hl&&this._handleHttpDoxError(t,"Failed to restore document"),t)),(()=>e)))),this.documentUploadProgress=l.s.create(null),this.uploadDocument=(e,t)=>this._doxApi.createDocument(h.J.Create.file(e,t)).then((e=>(this._state.lens("first100").modify((t=>v.j.isOk(t)?v.j.ok(new Array(e).concat(t.value)):t)),e))),this.handleDownloadDocumentError=e=>{this._log.error("downloadDocument failed",e);const t=e instanceof p.h.UnauthorizedError,i=e instanceof p.h.DocumentNotFoundError,s=e instanceof p.h.TooManyRequestsError||e instanceof p.h.ConnectionError;t?this._editorTsNotifications.show(this._editorTsNotifications.create.unauthorizedError()):i?this._editorTsNotifications.show(this._editorTsNotifications.create.downloadDocumentNotFoundError()):s?this._editorTsNotifications.show(this._editorTsNotifications.create.isTemporaryDownloadError()):this._editorTsNotifications.show(this._editorTsNotifications.create.error())},this.handleCreateDocumentError=e=>{e instanceof d.Hl?(this._handleHttpDoxError(e,"Failed to create new document"),this._log.warn("Failed to create new document",e)):(0,a.eK)(e)?(this._log.warn("Failed to create new document",e),this._editorTsNotifications.showError(`Failed to create new document: ${Boolean(e)?e.message:e}`)):(this._log.error("Failed to create new document",e),this._editorTsNotifications.showError(`Failed to create new document: ${Boolean(e)?e.message:e}`))}}}class X{constructor(e,t,i,s,r,o,a,l,d,c){(0,n._)(this,"_state",void 0),(0,n._)(this,"_doxApi",void 0),(0,n._)(this,"_doxWSApi",void 0),(0,n._)(this,"_settings",void 0),(0,n._)(this,"_features",void 0),(0,n._)(this,"_connectivity",void 0),(0,n._)(this,"_notifications",void 0),(0,n._)(this,"_navigateToDocument",void 0),(0,n._)(this,"_router",void 0),(0,n._)(this,"_userEmailProvider",void 0),(0,n._)(this,"proofit",void 0),(0,n._)(this,"_doxHttpErrorHandler",void 0),(0,n._)(this,"list",void 0),(0,n._)(this,"actions",void 0),this._state=e,this._doxApi=t,this._doxWSApi=i,this._settings=s,this._features=r,this._connectivity=o,this._notifications=a,this._navigateToDocument=l,this._router=d,this._userEmailProvider=c,this.proofit=new V(this._doxWSApi,this._state),this._doxHttpErrorHandler=e=>{switch(e.code){case p.h.HttpCodes.UNAUTHORIZED:this._connectivity.setState({type:"dox",state:{type:"unauthorized"}});break;case p.h.HttpCodes.BYOK_KEY_UNAVAILABLE:this._notifications.show(this._notifications.create.byokKeyInaccessible());break;case p.h.HttpCodes.TOO_MANY_REQUESTS:this._notifications.show(this._notifications.create.error());break;default:this._notifications.showError(e.message)}},this.list=new Z(this._state,this._doxApi,this._settings,this._features,this._connectivity,this._doxHttpErrorHandler,this._userEmailProvider),this.actions=new z(this._state,this._doxApi,this._navigateToDocument,this._notifications,this._doxHttpErrorHandler,this.list.load),this._router.isActive(I.Lz.routes.documents.href()).pipe(O.M((e=>this._state.lens("documentKind").set(e?B.j.Kind.existing:B.j.Kind.deleted)))).subscribe()}}},18711:(e,t,i)=>{i.r(t),i.d(t,{ChecklistSteps:()=>y,ChecklistUseCase:()=>b,CheetahOggyEditorInternal:()=>x,FeatureAwareness:()=>w,FreeTrial:()=>p,GDocsTour:()=>a,GetStartedChecklist:()=>_,GetStartedPriority:()=>o,InProductIncentives:()=>N,InProductReactivation:()=>A,InProductReactivationYellowUnderlines:()=>M,InSessionCheckout:()=>U,InSessionCheckoutV1:()=>I,InlinePremiumPreviews:()=>r,LlamaAdoption:()=>S,LlamaEntryPointsV3:()=>f,LockedUiNewHighlightColors:()=>E,OnboardingTourA11y:()=>v,PassiveUphookUsingUphookHub:()=>B,PersistentClientEntryPoint:()=>O,PlagiarismUphook:()=>D,PremiumChecklistNoTrial:()=>g,PremiumChecklistTrial:()=>m,RedirectUphookToUpgradePage:()=>P,RemoveWelcomeTour:()=>h,SharedAssistant:()=>C,TopSitesTours:()=>l,TrueUp:()=>k,UphookCard:()=>n,WritingProgress:()=>d,WritingProgressV2:()=>c,WritingProgressV3:()=>u,lockedUI:()=>T});var s=i(95133);const n=new s.aj("denali_uphook_card",["test","control"]),r=new s.aj("inline_premium_previews_denali",["control","experiment"]),o=new s.aj("get_started_priority",["test","control"]),a=new s.aj("gdoc_tour",["test","control"]),l=new s.aj("top_sites_tours",["test","control"]),d=new s.aj("learning_hub_mvp",["control","test"]),c=new s.aj("writing_progress_v2",["control","test"]),u=new s.aj("writing_progress_v3",["control","dashboard","ipm"]),h=new s.aj("remove_welcome_tour",["control","test"]),p=new s.aj("premium_free_trial_v3",["trial","differentiated"]),_=new s.aj("get_started_checklist",["control","test"]),g=new s.aj("premium_checklist_no_trial",["control","test"]),m=new s.aj("premium_checklist_trial",["control","test"]),f=new s.aj("llama_entry_points_v3",["control","one_day_delay","three_day_delay"]),v=new s.aj("editor_onboarding_tour_a11y_v2",["control","test"]),y=new s.aj("checklist_steps",["control","test"]),b=new s.aj("checklist_use_case",["control","test"]),S=new s.aj("checklist_llama_editor",["control","test"]),w=new s.aj("feature_awareness",["control","test"]),k=new s.aj("true_up_billing",["control","test"]),P=new s.aj("editor_redirect_uphook_to_upgrade_page",["control","test"]),x=new s.aj("cheetah_oggy_editor",["control","test"]),C=new s.aj("sharedassistant_editor",["control","mergedSharedAssistant","splitSharedAssistants"]),D=new s.aj("smart_plagiarism_uphook",["control","test"]),E=new s.aj("locked_ui_new_highlight_colors",["control","all_yellow","all_yellow_except_gray_uphook"]),T=new s.aj("locked_ui_editor_2",["control","unlimited_pool"]),A=new s.aj("ren_single_click_reactivation",["control","test"]),O=new s.aj("persistent_client_entry_point_in_editor_v2",["control","persistent","contextual"]),U=new s.aj("in_session_checkout",["control","test"]),I=new s.aj("in_session_checkout_v1",["control","test"]),M=new s.aj("ren_in_product_reactivation",["control","test","underlines"]),B=new s.aj("uphookhub_denali_passive_uphook_v1",["control","test"]),N=new s.aj("in_product_incentives_dc",["fullprice","freetrial","discount15","discount30","discount50"])},16843:(e,t,i)=>{i.r(t),i.d(t,{AiDetectorEnabled:()=>L,AiEditorUXR:()=>V,BackendManagedStorageMacEditor:()=>b,BackendManagedStorageWebEditor:()=>y,CPRA:()=>C,CheckoutEmailReminder:()=>H,CheckoutPurchaseOptimizationMostPopular:()=>j,CheetahProfuseEventsTracking:()=>U,CheetahStudentsOnboarding:()=>S,GDPRInverted:()=>x,GDebugger:()=>F,GetStartedChecklistPermanentDismiss:()=>N,PlaybooksRead:()=>q,RenderedEventsTrackingEnabled:()=>W,RenewalDoubleOptIn:()=>R,SelectionContextUpdatesClient:()=>k,SelectionContextUpdatesServer:()=>P,TrafficThroughGatewayForCapi:()=>I,TrafficThroughInternalCapi:()=>M,UphookHubEnabled:()=>G,VersionHistory:()=>B,WritingExpertFeedback:()=>D,WritingExpertInAssistantExternalNative:()=>O,WritingExpertInAssistantExternalOggy:()=>A,WritingExpertInAssistantInternal:()=>T,WritingExpertPullMode:()=>E,WritingExpertVbarsGlobal:()=>w,cheetahInlineRewrite:()=>_,cheetahMagicRewrite:()=>p,cheetahOnboarding:()=>g,cheetahOrgContext:()=>m,cheetahStudentBTS:()=>f,cheetahStudentPromptsInternal:()=>v,citationBuilder:()=>a,citationBuilderBannersChrome:()=>d,citationBuilderBannersEdge:()=>u,citationBuilderBannersFirefox:()=>h,citationBuilderBannersSafari:()=>c,citationBuilderInternal:()=>l,citationsRollout:()=>n,citationsRolloutInternal:()=>r,proofitNoteToEditor:()=>o});var s=i(95133);const n=new s.iD("citations_rollout","enabled"),r=new s.iD("citations_rollout_internal","enabled"),o=new s.iD("proofit_note_to_editor","enabled"),a=new s.iD("citation_builder","enabled"),l=new s.iD("citation_builder_internal","enabled"),d=new s.iD("citation_builder_banners_chrome","enabled"),c=new s.iD("citation_builder_banners_safari","enabled"),u=new s.iD("citation_builder_banners_edge","enabled"),h=new s.iD("citation_builder_banners_firefox","enabled"),p=new s.iD("cheetah_editor_feature_flag_magic_rewrite"),_=new s.iD("cheetah_editor_feature_flag_inline_rewrite"),g=new s.iD("cheetah_editor_feature_flag_product_onboarding"),m=new s.iD("gbgo_knowledge_share_web"),f=new s.iD("ggo_student_bts"),v=new s.iD("ggo_student_prompts_internal"),y=new s.iD("editor_feature_flag_capi_client_storage"),b=new s.iD("mac_editor_feature_flag_capi_client_storage"),S=new s.iD("ggo_students_onboarding"),w=new s.iD("vbars_global"),k=new s.iD("cheetah_selection_context_updates"),P=new s.iD("cheetah_selection_context_updates_server"),x=new s.iD("gdpr_inverted","enabled"),C=new s.iD("cpra"),D=new s.iD("writing_expert_feedback"),E=new s.iD("editor_writing_expert_pull_mode"),T=new s.iD("writing_expert_in_assistant"),A=new s.iD("writing_expert_in_assistant_oggy"),O=new s.iD("writing_expert_in_assistant_native"),U=new s.iD("cheetah_profuse_events_tracking"),I=new s.iD("capi_traffic_through_cthulhu"),M=new s.iD("capi_traffic_through_internal_capi"),B=new s.iD("editor_version_history"),N=new s.iD("get_started_checklist_permanent_dismiss"),F=new s.iD("g_debugger_enabled"),L=new s.iD("plagiarism_ai_detector_cheetah_web"),R=new s.iD("double_opt_in_funnel","enabled"),H=new s.iD("checkout_email_reminder","below_button"),j=new s.iD("pxo_increase_annual_plan_mix_most_popular","test"),G=new s.iD("denali_uphookhub_v1"),W=new s.iD("rendered_events_tracking"),q=new s.iD("ai_studio_playbooks_read","enabled"),V=new s.iD("ai_editor_uxr","enabled")},71449:(e,t,i)=>{i.d(t,{c:()=>a});var s=i(83531),n=i(23988),r=i(46228),o=i(80029);class a{install(){var e=this;return(0,s._)((function*(){switch(e._environment.info.browser){case"firefox":return(0,r.vL)((0,o.W)().domains.cookie),window.location.href=e._firefoxUrl,!0;case"chrome":case"safari":case"edge":return!0;default:throw new TypeError("Unexpected input in browser variable: "+e._environment.info.browser)}}))()}constructor(e,t){(0,n._)(this,"_environment",void 0),(0,n._)(this,"_firefoxUrl",void 0),this._environment=e,this._firefoxUrl=t}}},40884:(e,t,i)=>{var s,n,r,o;i.d(t,{yK:()=>K,LU:()=>te,Wk:()=>X,fO:()=>Z,DY:()=>o,ZI:()=>ie,nS:()=>he,Vd:()=>$,d6:()=>Q,kH:()=>Y,vI:()=>J,J_:()=>ee,bz:()=>G,Fh:()=>q,fx:()=>V,SA:()=>W}),function(e){e.Business="BUSINESS",e.Edu="EDU",e.Gov="GOV",e.K12="K12",e.Ngo="NGO"}(s||(s={})),function(e){e.Admin="admin",e.Member="member"}(n||(n={})),function(e){e.Free="free",e.Premium="premium",e.Business="business",e.Edu="edu"}(r||(r={})),function(e){e.isFree=e=>e.type===r.Free,e.isPremium=e=>e.type===r.Premium||e.type===r.Business||e.type===r.Edu,e.isPremiumConsumer=e=>e.type===r.Premium,e.isPro=e=>"isPro"in e&&e.isPro;var t=e.isBusiness=e=>e.type===r.Business,i=e.isEdu=e=>e.type===r.Edu,s=e.isInstitutionUser=e=>"institutionType"in e;e.isConsumerUser=e=>!s(e),e.isBusinessAdmin=e=>t(e)&&e.institutionType===n.Admin,e.isEduAdmin=e=>i(e)&&e.institutionType===n.Admin,e.isBusinessTeamMember=e=>t(e)&&e.institutionType===n.Member,e.isEduTeamMember=e=>i(e)&&e.institutionType===n.Member,e.isAdmin=e=>s(e)&&e.institutionType===n.Admin,e.isGrammarlyUser=e=>e.email.indexOf("@grammarly.com")>-1,e.isTestUser=e=>e.isTest}(o||(o={}));var a=i(23988),l=i(84011),d=i(84647),c=i(99002),u=i(71301),h=i(84712),p=i(90829),_=i(84872),g=i(31967),m=i(7149),f=i(60191),v=i(83694),y=i(1224),b=i(65390),S=i(65160),w=i(17314),k=i(51770),P=i(43585),x=i(44781),C=i(39812),D=i(92622),E=i(14650),T=i(18711),A=i(16843),O=i(37107),U=i(8094),I=i(74056);const M=new Date(15259968e5),B=new Date(15488856e5),N=new Date(15995736e5),F=new Date(17320572e5),L={[x.k.BulkAccept]:{releaseDate:new Date(16091064e5),isNewFor:4*u.ks},trashbin:{releaseDate:new Date(1656324189130),isNewFor:5*u.ks},versionHistory:{releaseDate:new Date(17177112e5),isNewFor:3*u.ks}};var R;!function(e){e.is=e=>L.hasOwnProperty(e)}(R||(R={}));const H=new Date(16855776e5),j="llamaDiscoverabilityType";var G,W,q,V,Z,z,X,Y,K,$,Q,J,ee,te,ie;!function(e){let t;!function(e){e.on="on",e.force="force"}(t=e.UserRolePopupMode||(e.UserRolePopupMode={}))}(G||(G={})),function(e){e.layoutGroup="layoutGroup",e.benefits="benefits"}(W||(W={})),function(e){e.enabled="enabled",e.upgradeIsNeeded="upgradeIsNeeded",e.disabled="disabled"}(q||(q={})),function(e){e.plansPage="plansPage",e.upgradePage="upgradePage"}(V||(V={})),function(e){let t;!function(e){e.migration="migration",e.welcome="welcome"}(t=e.TourType||(e.TourType={})),e.isTourType=function(e){return e===t.migration||e===t.welcome}}(Z||(Z={})),function(e){e.withoutDiscount="withoutDiscount"}(z||(z={})),function(e){e.none="none",e.documentSettings="documentSettings"}(X||(X={})),function(e){e.mergedSharedAssistant="mergedSharedAssistant",e.splitSharedAssistants="splitSharedAssistants"}(Y||(Y={})),function(e){e[e.CRITICAL_ADVANCED=0]="CRITICAL_ADVANCED",e[e.FREE_PREMIUM=1]="FREE_PREMIUM"}(K||(K={})),function(e){e.List="List",e.Checklist="Checklist",e.PremiumChecklist="PremiumChecklist"}($||($={})),function(e){e.Banner="Banner",e.Modal="Modal"}(Q||(Q={})),function(e){let t,i;!function(e){e.Full="Full",e.Oggy="Oggy",e.OggySplit="OggySplit",e.WithoutInlineCards="WithoutInlineCards"}(t=e.Content||(e.Content={})),function(e){e.Forced="Forced",e.Standard="Standard",e.Hidden="Hidden"}(i=e.Kind||(e.Kind={})),e.isForced=function(e){return e.kind===i.Forced},e.isHidden=function(e){return e.kind===i.Hidden}}(J||(J={})),function(e){e.Persistent="persistent",e.Contextual="contextual"}(ee||(ee={})),function(e){e.empty={extensionInstallPromotion:!1,showAppBanners:!1,showInviteMembersBanner:!1,showStyleGuideBanner:!1,mockedBannersState:b.none,showAutoCitationsPopupPromotion:!1,showAutoCitationsBannerPromotion:!1,llamaDiscoverabilityType:b.none,showTrueUpBanner:!1},e.BannersFeaturesImpl=class{get showAppBanners(){return!o.isEdu(this.denaliUserType)&&!o.isBusinessAdmin(this.denaliUserType)}get showInviteMembersBanner(){return this._router.query.has("gbInviteMembersBanner")||o.isBusinessAdmin(this.denaliUserType)&&!this._isUserRegisteredBefore(N)&&!this._settings.memberInviteOnboardingPassed.get()}get showStyleGuideBanner(){return this._router.query.has("gbStyleGuideBanner")||o.isAdmin(this.denaliUserType)&&(0,d.pipe)(this._userProfile.get().institutionInfo,b.exists((e=>e.voxEnabled)))&&b.isNone(this.voxInfo)}get showTrueUpBanner(){return this._exp.isQuery("true_up")||this._exp.isManakin(T.TrueUp,"test")&&o.isBusinessAdmin(this.denaliUserType)&&(0,d.pipe)(this._userProfile.get().institutionInfo,b.exists((e=>(0,d.pipe)(e.trueUpSchedule,b.exists((e=>Boolean(e.isTrueUpEligible)&&e.overageSeats>0&&b.isSome(e.nextTrueUpBillingDate)))))))}get mockedBannersState(){return(0,d.pipe)(this._router.query.get("mockedBannersState"),b.chain((0,d.flow)((e=>JSON.parse(e)),O.tl.bannersType.decode,b.fromEither)))}_shouldSeeAutoCitationPromotion(){return Date.now()>16632414e5&&(0,d.pipe)(this._userProfile.get().role,S.Lw((e=>e===D.gG.school||e===D.j1.student)))&&!o.isBusiness(this.denaliUserType)}get showAutoCitationsPopupPromotion(){return!!this._exp.isQuery("autoCitations")||!!this._shouldSeeAutoCitationPromotion()&&(this._exp.isManakin(A.citationBuilderInternal)||this._exp.isManakin(A.citationBuilder))}get showAutoCitationsBannerPromotion(){return!!this._exp.isQuery("autoCitations")||!!this._shouldSeeAutoCitationPromotion()&&("chrome"===this._browser&&this._exp.isManakin(A.citationBuilderBannersChrome)||"safari"===this._browser&&this._exp.isManakin(A.citationBuilderBannersSafari)||"edge"===this._browser&&this._exp.isManakin(A.citationBuilderBannersEdge)||"firefox"===this._browser&&this._exp.isManakin(A.citationBuilderBannersFirefox))}get llamaDiscoverabilityType(){return this._llamaDiscoverabilityType}constructor(e,t,i,s,n,r,o,l,c){(0,a._)(this,"_userProfile",void 0),(0,a._)(this,"_exp",void 0),(0,a._)(this,"_settings",void 0),(0,a._)(this,"_router",void 0),(0,a._)(this,"denaliUserType",void 0),(0,a._)(this,"_isUserRegisteredBefore",void 0),(0,a._)(this,"voxInfo",void 0),(0,a._)(this,"_browser",void 0),(0,a._)(this,"_llamaDiscoverabilityType",void 0),(0,a._)(this,"extensionInstallPromotion",void 0),this._userProfile=e,this._exp=t,this._settings=i,this._router=s,this.denaliUserType=n,this._isUserRegisteredBefore=r,this.voxInfo=o,this._browser=l,this._llamaDiscoverabilityType=c,this.extensionInstallPromotion=!this._isUserRegisteredBefore(B)&&!this._exp.isDapi(...ne.disabled)&&!this._exp.isQuery("disable_ext_promo")&&b.isNone(this._llamaDiscoverabilityType)||(0,d.pipe)(this._router.query.get("ext_promo"),b.exists((e=>"show"===e)))}}}(te||(te={}));class se{get _suppressFeaturesOnboarding(){return(0,d.pipe)(this._router.query.get("featuresOnboarding"),b.exists((e=>"off"===e)))}_withQueryOverrides(e,t){return(0,d.pipe)(this._router.query.get(e),b.fold((()=>this._exp.isQuery(e)||t()),(e=>"on"===e)))}showNewLabel(e){const t=L[e];return!o.isTestUser(this._userProfile.get())&&(new Date).getTime()<t.isNewFor+t.releaseDate.getTime()}get oggyPlagiarismButtonVisible(){return this._withQueryOverrides("oggyPlagiarismButtonVisible",(()=>(0,d.pipe)(this._userProfile.get().role,S.Lw((e=>e===D.gG.school||e===D.j1.student)))))}get isDownloadLogsAvailable(){return this._environment.has(I.OH.Flag.isDownloadLogsAvailable)}get renderedEventsTrackingEnabled(){return this._withQueryOverrides("renderedEventsTrackingEnabled",(()=>this._exp.isManakin(A.RenderedEventsTrackingEnabled)))}get cheetah(){return this._environment.platform===I.OH.Platform.DEMOEDITOR||this._environment.platform===I.OH.Platform.WEB||this._environment.platform===I.OH.Platform.MACEDITOR||this._environment.platform===I.OH.Platform.AISTUDIO}get cheetahMagicRewrite(){return(0,d.pipe)(this._router.query.get("cheetahMagicRewrite"),b.map((e=>"on"===e)),b.getOrElse((()=>this._exp.isManakin(A.cheetahMagicRewrite))))}get cheetahInlineRewrite(){return(0,d.pipe)(this._router.query.get("cheetahInlineRewrite"),b.map((e=>"on"===e)),b.getOrElse((()=>this._exp.isManakin(A.cheetahInlineRewrite))))}get cheetahOnboarding(){return(this._environment.platform===I.OH.Platform.WEB||this._environment.platform===I.OH.Platform.DEMOEDITOR)&&(this._exp.isManakin(A.cheetahOnboarding)||this._exp.isQuery("cheetahOnboarding"))}get cheetahOrgContextEnabled(){return this._exp.isManakin(A.cheetahOrgContext)||this._exp.isQuery("cheetahOrgContext")}get cheetahBTSOnboardingEnabled(){return this._exp.isManakin(A.CheetahStudentsOnboarding)&&(this._exp.isManakin(A.cheetahStudentBTS)||this._exp.isManakin(A.cheetahStudentPromptsInternal))||(0,d.pipe)(this._router.query.get("cheetahBTSOnboarding"),b.isSome)}get writingExpertVbarsEnabled(){return this._exp.isManakin(A.WritingExpertVbarsGlobal)||this._exp.isQuery("writingExpertVbars")}get isEligibleForGtm(){const e=this._userProfile.get().email;return!["fcps.edu","fcpsschools.net","winclusion.org","test.fcpstechlab.org","grammarlian.com"].some((t=>e.endsWith(`@${t}`)))&&this._exp.isManakin(A.GDPRInverted)&&!this._exp.isManakin(A.CPRA)}get cheetahPromptsUsed(){return(0,d.pipe)(this._router.query.get("cheetahPromptsUsed"),b.map((e=>Number.parseInt(e,10))),b.filter((e=>!Number.isNaN(e))))}get backendManagedStorageEnabled(){return!(void 0===window.indexedDB||!((this._environment.platform===I.OH.Platform.WEB||this._environment.platform===I.OH.Platform.DEMOEDITOR)&&this._exp.isManakin(A.BackendManagedStorageWebEditor)||this._environment.platform===I.OH.Platform.MACEDITOR&&this._exp.isManakin(A.BackendManagedStorageMacEditor)||this._exp.isQuery("backendManagedStorage")))}get mutedAlerts(){return!(0,d.pipe)(this._router.query.get("mutedAlerts"),b.exists((e=>"off"===e)))&&((0,d.pipe)(this._router.query.get("mutedAlerts"),b.exists((e=>"on"===e)))||o.isPremium(this._userMeta.denaliUserType))}get safariExtActivationWeb(){return this._exp.isQuery("safariExt")||"safari"===this._environment.info.browser&&!this._settings.seenSafariExtNotification.get()&&this._settings.safariDeactivatedWeb.get()}get getStartedPriority(){return this._exp.isManakin(T.GetStartedPriority,"test")}get gDocsTour(){return this._exp.isManakin(T.GDocsTour,"test")}get topSitesTours(){return this._exp.isQuery("topSitesTours")||this._exp.isManakin(T.TopSitesTours,"test")}get supportUkraineCardAppearanceLimit(){return(0,d.pipe)(this._router.query.get("supportUkraineCardAppearanceLimit"),b.map((e=>parseInt(e,10))),b.getOrElse((()=>4)))}get isStudentsOFE(){return!b.exists((e=>"off"===e))(this._router.query.get("students"))&&(this._exp.isManakin(A.citationsRollout)||this._exp.isManakin(A.citationsRolloutInternal)||(0,d.pipe)(this._router.query.get("students"),b.exists((e=>"on"===e))))}get proofitNoteToEditor(){return this._exp.isManakin(A.proofitNoteToEditor)}get isInternalUser(){return this._userMeta.isInternalUser}get showSignoutSurvey(){return(0,d.pipe)(this._router.query.get("signOutSurvey"),b.exists((e=>"on"===e)))||!this._settings.seenSignOutSurvey.get()}get showSignOutConfirmationPopup(){return!(0,d.pipe)(this._router.query.get("signOutConfirmation"),b.exists((e=>"off"===e)))}get removeWelcomeTour(){return this._exp.isQuery("removeWelcomeTour")||this._exp.isManakin(T.RemoveWelcomeTour,"test")}get showOnboardingTourA11yUpdates(){return this._exp.isQuery("showDemoDocOnboardingA11y")||this._environment.platform===I.OH.Platform.DEMOEDITOR||this._exp.isManakin(T.OnboardingTourA11y,"test")}get removeAccountCreationSection(){return this._exp.isManakin(T.ChecklistSteps,"test")}get tailorTryInWebsitesSection(){return this._exp.isManakin(T.ChecklistUseCase,"test")}get replaceViewAppsSection(){return this._exp.isManakin(T.LlamaAdoption,"test")}get replaceTakeATourSection(){return this._exp.isManakin(T.FeatureAwareness,"test")}get selectionContextUpdatesClient(){return this._exp.isManakin(A.SelectionContextUpdatesClient,"enabled")}get selectionContextUpdatesServer(){return this._exp.isManakin(A.SelectionContextUpdatesServer,"enabled")}get writingExpertPullMode(){return(0,d.pipe)(this._router.query.get("writingExpertPullMode"),b.map((e=>"on"===e)),b.getOrElse((()=>!!this._exp.isManakin(A.WritingExpertPullMode,"enabled")&&(this._exp.isManakin(A.WritingExpertInAssistantExternalOggy,"enabled")||this._exp.isManakin(A.WritingExpertInAssistantExternalNative,"enabled")||this._exp.isManakin(A.WritingExpertInAssistantInternal,"enabled")))))}get oggy(){return(0,d.pipe)(this._router.query.get("oggy"),b.map((e=>"merged"===e?Y.mergedSharedAssistant:Y.splitSharedAssistants)),b.getOrElse((0,d.constant)(Y.splitSharedAssistants)))}get isLockedUIEnabled(){return o.isFree(this._userMeta.denaliUserType)&&this._exp.peekManakinExperiment(T.lockedUI,"unlimited_pool")}get lockedUIHighlightsColor(){return this.isLockedUIEnabled?this._exp.peekManakinExperiment(T.LockedUiNewHighlightColors,"all_yellow")?b.some(P.rh.LockedUIHighlightsColor.allYellow):this._exp.peekManakinExperiment(T.LockedUiNewHighlightColors,"all_yellow_except_gray_uphook")?b.some(P.rh.LockedUIHighlightsColor.allYellowGrayUphook):b.none:b.none}get uphookDestination(){if(this._exp.isQuery("redirectUphookToUpgradePage"))return b.some(V.upgradePage);const e=this._exp.getManakinExperimentTreatment(T.RedirectUphookToUpgradePage);return"test"===e?b.some(V.upgradePage):"control"===e?b.some(V.plansPage):b.none}get writingExpertFeedback(){return this._exp.isQuery("writingExpertFeedback")||o.isGrammarlyUser(this._userProfile.get())&&this._exp.isManakin(A.WritingExpertFeedback)}get isGetStartedChecklistPermanentDismissEnabled(){return this._isGetStartedChecklistPermanentDismissEnabled}get versionHistory(){return this._exp.isQuery("version_history")||this._exp.isManakin(A.VersionHistory,"enabled")}get _isFreeClarityAlertsEnabled(){return this._exp.isQuery("free-clarity-enabled")}get _isFreeClarityAlertsControl(){return this._exp.isQuery("free-clarity-control")}get _isProofitSurvey(){return this._userProfile.get().type===D.ut.premium||this._exp.isQuery("proofit_promo")}get _isPremiumOnboardingSurvey(){return!1}get _isGBSatisfactionSurvey(){const e=this._exp.isQuery("gb_satisfaction_survey_enabled"),t=(0,d.pipe)(this._userProfile.get().institutionInfo,b.fold(d.constFalse,(e=>e.business&&e.admin)));return e&&t}get _isPowerUserSurvey(){return b.isSome(this._router.query.get("powerUser"))}get _isUserTestingFullSentence(){return this._exp.isQuery("ut-fullSentence")}get _isAnnotator(){return this._exp.isQuery("ut-annotator")}get _isUserTestingMutedAlerts(){return this._exp.isQuery("ut-mutedAlerts")}get _isUserTestingListTransform(){return this._exp.isQuery("ut-listTransform")}_dismissedGetStartedChecklist(e){var t,i;const s="premium"===e?null===(t=this._settings.getStartedPremiumChecklistSettings)||void 0===t?void 0:t.get().dismissal:null===(i=this._settings.getStartedChecklistSettings)||void 0===i?void 0:i.get().dismissal;return(0,d.pipe)(s,b.exists((e=>{const{type:t,timestamp:i}=e;return t===O.RM.HardDismiss||t===O.RM.SoftDismiss&&Date.now()-i.getTime()<2*u.ei})))}get _viewedOrDismissedLlamaModal(){const e=this._settings.llamaDiscoverabilitySettings.get().modalDismissalTimestamp;return b.isSome(e)}get _dismissedLlamaBanner(){const e=this._settings.llamaDiscoverabilitySettings.get().bannerDismissalTimestamp;return b.isSome(e)}get _hideGetStarted(){return b.isSome(this._router.query.get("hideGetStarted"))}get _showGetStartedChecklist(){return this._exp.isQuery("getStartedChecklist")||this._userProfile.get().type===D.ut.free&&!this._dismissedGetStartedChecklist("free")&&(0,d.pipe)(this._userProfile.get().registrationDate,b.exists((e=>Date.now()-e.getTime()<u.ks)))}get _isInFreeTrialExperiment(){return this._userMeta.isOnFreeTrial.get()&&this._exp.isManakin(T.PremiumChecklistTrial,"test")}get _isInNonTrialExperiment(){return!this._userMeta.isOnFreeTrial.get()&&this._exp.isManakin(T.PremiumChecklistNoTrial,"test")}get _isInPremiumChecklistExperiment(){return this._isInNonTrialExperiment||this._isInFreeTrialExperiment}get _forceShowPremiumGetStartedChecklist(){return this._exp.isQuery("premiumGetStartedChecklist")}get _isGetStartedChecklistPermanentDismissEnabled(){return this._exp.isManakin(A.GetStartedChecklistPermanentDismiss,"enabled")}get _showPremiumGetStartedChecklist(){const e=(0,d.pipe)(this._userMeta.lastSubscribedDateString.get(),b.exists((e=>{const t=new Date(e);return Date.now()-t.getTime()<u.ks})));return this._forceShowPremiumGetStartedChecklist||this._userProfile.get().type===D.ut.premium&&!o.isInstitutionUser(this._userMeta.denaliUserType)&&e&&!this._dismissedGetStartedChecklist("premium")&&this._isInPremiumChecklistExperiment}get _showGetStartedList(){return this._exp.isQuery("getStartedList")||this._userProfile.get().type===D.ut.premium&&(0,d.pipe)(this._userProfile.get().registrationDate,b.exists((e=>Date.now()-e.getTime()<u.ei)))}get _hasInstalledLlama(){const e=this._userProfile.get().groups;return e.has("windowsExtension")||e.has("macExtension")}get _isFromOnboarding(){return(0,d.pipe)(this._router.query.get("isFromOnboarding"),b.exists((e=>"true"===e)))}get _hasOneWeekPassedSinceRegistration(){const e=new Date;return this._isUserRegisteredBefore(new Date(e.getTime()-u.ks))}get _assignLlamaEntryPointType(){return this._exp.getManakinExperimentTreatment(T.LlamaEntryPointsV3)}get _showLlamaDiscoverabilityModal(){if((0,d.pipe)(this._router.query.get(j),b.exists((e=>"modal"===e))))return!0;if(!this._hasInstalledLlama&&!this._viewedOrDismissedLlamaModal){const e=new Date,t=this._assignLlamaEntryPointType;return"one_day_delay"===t?this._isUserRegisteredBefore(new Date(e.getTime()-u.ei)):"three_day_delay"===t?this._isUserRegisteredBefore(new Date(e.getTime()-3*u.ei)):!this._isFromOnboarding&&this._hasOneWeekPassedSinceRegistration}return!1}get _showLlamaDiscoverabilityBanner(){if((0,d.pipe)(this._router.query.get(j),b.exists((e=>"banner"===e))))return!0;if(!this._hasInstalledLlama&&!this._dismissedLlamaBanner){const e=this._assignLlamaEntryPointType;return"one_day_delay"===e||"three_day_delay"===e||this._hasOneWeekPassedSinceRegistration}return!1}_getAssignedSurveys(){const e=new Array;return this._surveyTypeAssignments.forEach(((t,i)=>{t&&e.push(i)})),e}get requirePaymentCheck(){return b.isSome(this._router.query.get("fraud"))}get documentToolbar(){return this._isIPad||this._isMacEditor?X.none:X.documentSettings}get showUploadInPlaceholderText(){return!this._isMacEditor}get voxInfo(){return(0,d.pipe)(this._userProfile.get().institutionInfo,b.chain((e=>e.vox)),S.NW(b.none))}get instType(){return this._instType.get()}get alertGroupNames(){return this._userMeta.isFree.get()?K.FREE_PREMIUM:K.CRITICAL_ADVANCED}get llamaDiscoverabilityType(){return this._showLlamaDiscoverabilityModal?b.some(Q.Modal):this._showLlamaDiscoverabilityBanner?b.some(Q.Banner):b.none}get isLlamaDiscoverabilityTest(){return(0,d.pipe)(this._settings.llamaDiscoverabilitySettings.get().modalDismissalTimestamp,b.exists((e=>e>H)))||(0,d.pipe)(this._settings.llamaDiscoverabilitySettings.get().bannerDismissalTimestamp,b.exists((e=>e>H)))}get getStartedType(){return this._hideGetStarted?b.none:this._showPremiumGetStartedChecklist?b.some($.PremiumChecklist):this._showGetStartedChecklist?b.some($.Checklist):!this._dismissedGetStartedChecklist("premium")&&this._showGetStartedList?b.some($.List):b.none}get tour(){return this.removeWelcomeTour?b.none:(0,d.pipe)(this._router.query.get("tour"),b.filter(Z.isTourType),b.fold((()=>this._settings.seenDenaliWelcome.get()||this._isIPad||!(0,d.pipe)(this._userProfile.get().registrationDate,b.exists((e=>e>M)))?b.none:b.some(this._settings.seenWelcome.get()?Z.TourType.migration:Z.TourType.welcome)),b.some))}get alertsUpdate(){return(0,d.pipe)(this._router.query.get("alertsUpdate"),b.exists((e=>"true"===e)))}get autoJumpSettings(){return{isDisabledByDefault:this._environment.platform!==I.OH.Platform.DEMOEDITOR}}get sidebarOpenedByDefault(){return this._environment.platform!==I.OH.Platform.AISTUDIO&&!this._exp.isQuery("disableSidebarByDefault")}get globalExperimentDemoText(){return this._isUserTestingFullSentence?b.some("fullSentenceDemoText"):this._isUserTestingMutedAlerts?b.some("mutedAlertsDemoText"):this._isUserTestingListTransform?b.some("listTransformDemoText"):this._isAnnotator?b.some("annotatorEmptyDocument"):b.none}get showcaseNewFeaturesOnStartup(){return b.isNone(this.tour)&&!this._isIPad&&((0,d.pipe)(this._router.query.get("showNews"),b.exists((e=>"true"===e)))||!o.isTestUser(this._userProfile.get())&&(0,k.HP)(this.newsConfig).some((e=>!this._settings.newsSeen.get().has(e)&&this.newsConfig[e].visible()&&this.newsConfig[e].showcaseOnStartup())))}get rtf(){return!this._exp.isQuery("no_rtf")}get toneDetector(){return this._exp.isQuery("toneDetector")}get changePlanHook(){return this._settings.changePlanHook.view((e=>{if((0,p.Ub)(o.isFree,o.isInstitutionUser)(this._userMeta.denaliUserType))return b.none;if(this._exp.isQuery(this._changePlanHook.query.withoutDiscount))return b.some(z.withoutDiscount);const t=u.Yr.daysAgo(u.Yr.now(),3),i=(0,d.pipe)(e.latestDismissAt,b.fold((()=>!0),(e=>e.getTime()<t))),s=e.latestAppearances.filter((e=>t<e.getTime())).length;return i&&s<3?b.some(z.withoutDiscount):b.none}))}get gbBillingMigrationNotification(){return(0,d.pipe)(this._router.query.get("gb_billing_migration"),b.fold((()=>h.s.combine(this._userProfile,this._settings.gbBillingMigrationSettings,((e,t)=>(0,d.pipe)(e.institutionInfo,b.chain((({admin:e,subscriptionInfo:{migrationState:i,expirationDate:s}})=>e&&"BILLING_FLOW_MIGRATION_STARTED"===i?(0,d.pipe)(b.fromEither(u.Yr.parseDate(s)),b.chain((e=>{const i=u.Yr.now(),s=u.Yr.monthsAgo(e,1);if(u.Yr.toTimestamp(i)<s||i>e)return b.none;const n=u.Yr.daysAgo(i,5);return(0,d.pipe)(t.latestDismissAt,b.exists((e=>e.getTime()>n)))?b.none:b.some({expiryDate:e})}))):b.none)))))),(()=>h.s.create(b.some({expiryDate:new Date})))))}get premiumUngatingRenewalNotification(){if(this._userMeta.isFree.get())return h.s.create(b.none);if(this._exp.isQuery("premium_ungating_renewal_notification"))return h.s.create(b.some(u.Yr.now()));const e=u.Yr.toTimestamp(u.Yr.now()),t=u.Yr.Timestamp.add(e,2*u.ei);return h.s.combine(this._settings.ungatedTrialEndDate,this._settings.ungatedRenewalNotificationSettings,((i,s)=>s.wasDismissed||(0,d.pipe)(s.latestAppearance,b.exists((e=>e.getDate()===(new Date).getDate())))?b.none:(0,d.pipe)(i,b.filter((i=>e<i.getTime()&&i.getTime()<t)))))}get recordCapiMessages(){return(0,d.pipe)(this._router.query.get("recordCapiMessages"),b.fold((()=>"off"),(e=>"messages-and-mock"===e?"messages-and-mock":"messages")))}get gDebugger(){return(0,d.pipe)(this._router.query.get("gdebugger"),b.fold((()=>this._exp.isManakin(A.GDebugger,"enabled")),(e=>"on"===e)))}get dlp(){return(0,d.pipe)(this._clientControls,b.exists((({dlpEnabled:e})=>e)))}get uphookFormat(){return this._exp.isDapi(...this._uphookFormat.layoutGroups)||this._exp.isQuery(this._uphookFormat.layoutGroupsQuery)?b.some(W.layoutGroup):this._exp.isDapi(...this._uphookFormat.benefits)||this._exp.isQuery(this._uphookFormat.benefitsQuery)?b.some(W.benefits):b.none}get gbPrompt(){return(0,d.pipe)(this._userProfile.get().institutionInfo,b.exists((e=>e.voxEnabled)))}get sendProfuseGnarEvents(){return this._exp.isManakin(A.CheetahProfuseEventsTracking,"enabled")}get isAiDetectorEnabled(){return this._exp.isManakin(A.AiDetectorEnabled,"enabled")}get isSmartPlagiarismUphookEnabled(){return this._exp.peekManakinExperiment(T.PlagiarismUphook,"test")}get trafficThroughGatewayForCapi(){return this._exp.isManakin(A.TrafficThroughGatewayForCapi,"enabled")}get trafficThroughInternalCapi(){return this._exp.isQuery("internalCapi")||this._exp.isManakin(A.TrafficThroughInternalCapi,"enabled")}get aiEditorUXR(){return this._exp.isManakin(A.AiEditorUXR,"enabled")}constructor(e,t,i,s,n,r,o,v,S,k){(0,a._)(this,"_userProfile",void 0),(0,a._)(this,"_settings",void 0),(0,a._)(this,"_clientControls",void 0),(0,a._)(this,"_router",void 0),(0,a._)(this,"_exp",void 0),(0,a._)(this,"_environment",void 0),(0,a._)(this,"_instType",void 0),(0,a._)(this,"_proofit",void 0),(0,a._)(this,"_userMeta",void 0),(0,a._)(this,"_isUserRegisteredBefore",void 0),(0,a._)(this,"_featureOnboardingStepConfig",void 0),(0,a._)(this,"_isFeaturesOnboardingStepSuppressed",void 0),(0,a._)(this,"onboardingSeen",void 0),(0,a._)(this,"markFeatureOnboarded",void 0),(0,a._)(this,"persistentClientEntryPointTreatment",void 0),(0,a._)(this,"newsConfig",void 0),(0,a._)(this,"_log",void 0),(0,a._)(this,"_changePlanHook",void 0),(0,a._)(this,"_uphookFormat",void 0),(0,a._)(this,"_isIPad",void 0),(0,a._)(this,"_isMacEditor",void 0),(0,a._)(this,"_surveyTypeAssignments",void 0),(0,a._)(this,"surveyType",void 0),(0,a._)(this,"appInitedFromDenaliPage",void 0),(0,a._)(this,"dismissFeedbackFormSuppressed",void 0),this._userProfile=e,this._settings=t,this._clientControls=i,this._router=s,this._exp=n,this._environment=r,this._instType=o,this._proofit=v,this._userMeta=S,this._isUserRegisteredBefore=k,this._featureOnboardingStepConfig={[x.k.SidebarRefreshGoals]:{suppressed:!this._isUserRegisteredBefore(F)},[x.k.SidebarRefreshScore]:{suppressed:!this._isUserRegisteredBefore(F)}},this._isFeaturesOnboardingStepSuppressed=e=>{var t;return this._suppressFeaturesOnboarding||Boolean(null===(t=this._featureOnboardingStepConfig[e])||void 0===t?void 0:t.suppressed)},this.onboardingSeen=e=>this._isFeaturesOnboardingStepSuppressed(e)?h.s.create(!0):this._settings.featuresOnboardingSeen.view((t=>t.has(e))),this.markFeatureOnboarded=e=>{this._settings.markFeatureOnboarded(e)},this.persistentClientEntryPointTreatment=e=>_.z([this._settings.dismissedPersistentClientInstallCardv2,g.sc(window.document.body).pipe(m.T((e=>e.width<1080)))]).pipe(m.T((([t,i])=>{if(i||this._isIPad||t)return b.none;if(this._exp.isQuery("persistentClientInstallCard"))return b.some(ee.Persistent);if(this._exp.isQuery("persistentClientInstallCardContextual"))return b.some(ee.Contextual);if((0,d.pipe)(e,b.exists((e=>(E.X.isSupported(e.extension)||E.X.isSupported(e.desktopApp))&&E.X.isNotInstalled(e.extension)&&E.X.isNotInstalled(e.desktopApp)))))switch(this._exp.getManakinExperimentTreatment(T.PersistentClientEntryPoint)){case"persistent":return b.some(ee.Persistent);case"contextual":return b.some(ee.Contextual);default:return b.none}return b.none})),f.fY(b.getEq(c.Eq))),this.newsConfig={[O.Ks.SidebarRefresh]:{visible:d.constTrue,showcaseOnStartup:d.constTrue},[O.Ks.VersionHistory]:{visible:()=>this.versionHistory,showcaseOnStartup:d.constTrue},[O.Ks.Trash]:{visible:d.constTrue,showcaseOnStartup:()=>this._isUserRegisteredBefore(new Date(L.trashbin.releaseDate.getTime()-u.ks))},[O.Ks.MutedAlerts]:{visible:()=>this.mutedAlerts,showcaseOnStartup:d.constFalse},[O.Ks.RTF]:{visible:()=>this.rtf,showcaseOnStartup:d.constFalse},[O.Ks.PDF]:{visible:d.constTrue,showcaseOnStartup:d.constFalse},[O.Ks.ProofitClarity]:{visible:()=>this._proofit.get()===q.enabled,showcaseOnStartup:d.constFalse}},this._log=y.Bx.Logging.getLogger("DenaliFeaturesImpl",y.y7.$.DEBUG),this._changePlanHook={query:{withoutDiscount:"change-plan-without-discount"}},this._uphookFormat={control:["uphook_formats_control_1","uphook_formats_control_2"],layoutGroups:["uphook_formats_experiment_layout_group_1","uphook_formats_experiment_layout_group_2"],layoutGroupsQuery:"uphook_formats_layout",benefits:["uphook_formats_experiment_benefits_1","uphook_formats_experiment_benefits_2"],benefitsQuery:"uphook_formats_benefits"},this._isIPad=this._environment.platform===I.OH.Platform.IPAD,this._isMacEditor=this._environment.platform===I.OH.Platform.MACEDITOR,this._surveyTypeAssignments=new Map([[O.L0.FreeClarityAlertsControl,this._isFreeClarityAlertsControl],[O.L0.FreeClarityAlertsEnabled,this._isFreeClarityAlertsEnabled],[O.L0.GBSatisfaction,this._isGBSatisfactionSurvey],[O.L0.MostActiveUsers,this._isPowerUserSurvey],[O.L0.PremiumOnboarding,this._isPremiumOnboardingSurvey],[O.L0.ProofitPromo,this._isProofitSurvey]]),this.surveyType=(0,d.pipe)(this._router.query.get("survey"),b.filter((e=>Object.values(O.L0).includes(e))),b.fold((()=>{if(this._userMeta.isInternalUser&&b.isNone(this._router.query.get("exp")))return b.none;const e=this._getAssignedSurveys();return e.length>1&&(2!==e.length||!e.includes(O.L0.ProofitPromo))&&this._log.error("User has been assigned to multiple surveys. Check all finished experiments have been closed",e.join(", ")),b.fromNullable(e[0])}),b.some),b.filter((e=>!this._isIPad))),this.appInitedFromDenaliPage=this._router.isActive(C.Lz.routes.denali_editor.href({docId:"*"})).get(),this.dismissFeedbackFormSuppressed=(0,d.pipe)((()=>this._router.query.get("suppressFeedbackForm")),w.K.map((e=>"true"===e)),l.Tj(b.getOrElse(d.constFalse))),(0,p.hJ)("getSurveyType",(()=>this.surveyType)),(0,p.hJ)("getRecordCapiMessagesMode",(()=>this.recordCapiMessages))}}!function(e){e.BannersFeaturesMock=class{constructor(e=!1){(0,a._)(this,"extensionInstallPromotion",void 0),(0,a._)(this,"showAppBanners",void 0),(0,a._)(this,"showInviteMembersBanner",void 0),(0,a._)(this,"showStyleGuideBanner",void 0),(0,a._)(this,"showAutoCitationsPopupPromotion",void 0),(0,a._)(this,"showAutoCitationsBannerPromotion",void 0),(0,a._)(this,"mockedBannersState",void 0),(0,a._)(this,"llamaDiscoverabilityType",void 0),(0,a._)(this,"showTrueUpBanner",void 0),this.extensionInstallPromotion=e,this.showAppBanners=!0,this.showInviteMembersBanner=!1,this.showStyleGuideBanner=!1,this.showAutoCitationsPopupPromotion=!1,this.showAutoCitationsBannerPromotion=!1,this.mockedBannersState=b.none,this.llamaDiscoverabilityType=b.none,this.showTrueUpBanner=!1}};class t{constructor(){(0,a._)(this,"oggyPlagiarismButtonVisible",!1),(0,a._)(this,"isDownloadLogsAvailable",!0),(0,a._)(this,"newsConfig",void 0),(0,a._)(this,"sidebarOpenedByDefault",!1),(0,a._)(this,"newExtensionBanner",!1),(0,a._)(this,"alertsUpdate",!1),(0,a._)(this,"tour",b.none),(0,a._)(this,"enabled",!0),(0,a._)(this,"showSwitchToDenaliBtn",void 0),(0,a._)(this,"alertGroupNames",K.CRITICAL_ADVANCED),(0,a._)(this,"appInitedFromDenaliPage",!1),(0,a._)(this,"instType",b.none),(0,a._)(this,"surveyType",b.none),(0,a._)(this,"autoJumpSettings",{title:"",isDisabledByDefault:!1}),(0,a._)(this,"getStartedType",b.none),(0,a._)(this,"toneDetector",!1),(0,a._)(this,"premiumOnboardingSurvey",!1),(0,a._)(this,"recordCapiMessages","messages"),(0,a._)(this,"ideas",b.none),(0,a._)(this,"showSignoutSurvey",!1),(0,a._)(this,"showSignOutConfirmationPopup",!1),(0,a._)(this,"proofitNoteToEditor",!1),(0,a._)(this,"isInternalUser",!1),(0,a._)(this,"globalExperimentDemoText",b.none),(0,a._)(this,"showcaseNewFeaturesOnStartup",!1),(0,a._)(this,"rtf",!0),(0,a._)(this,"voxInfo",b.none),(0,a._)(this,"documentToolbar",X.documentSettings),(0,a._)(this,"showUploadInPlaceholderText",!0),(0,a._)(this,"requirePaymentCheck",!1),(0,a._)(this,"iPad",!0),(0,a._)(this,"changePlanHook",h.s.create(b.none)),(0,a._)(this,"gbUpHook",h.s.create(b.none)),(0,a._)(this,"mutedAlerts",!1),(0,a._)(this,"premiumUngatingRenewalNotification",h.s.create(b.none)),(0,a._)(this,"dismissFeedbackFormSuppressed",l.of(!1)),(0,a._)(this,"showNewLabel",d.constFalse),(0,a._)(this,"onboardingSeen",(0,d.constant)(h.s.create(!1))),(0,a._)(this,"markFeatureOnboarded",d.constVoid),(0,a._)(this,"gbBillingMigrationNotification",h.s.create(b.none)),(0,a._)(this,"safariExtActivationWeb",!1),(0,a._)(this,"safariExtActivationNative",!1),(0,a._)(this,"lockedUIUXExperimentTreatment",!1),(0,a._)(this,"lockedUIHighlightsColor",b.none),(0,a._)(this,"isLockedUIEnabled",!1),(0,a._)(this,"dlp",!1),(0,a._)(this,"uphookFormat",b.none),(0,a._)(this,"gbPrompt",!1),(0,a._)(this,"getStartedPriority",!1),(0,a._)(this,"gDocsTour",!1),(0,a._)(this,"topSitesTours",!1),(0,a._)(this,"isStudentsOFE",!1),(0,a._)(this,"supportUkraineCardAppearanceLimit",0),(0,a._)(this,"llamaDiscoverabilityType",b.none),(0,a._)(this,"removeWelcomeTour",!1),(0,a._)(this,"cheetah",!1),(0,a._)(this,"cheetahMagicRewrite",!1),(0,a._)(this,"cheetahInlineRewrite",!1),(0,a._)(this,"cheetahOnboarding",!1),(0,a._)(this,"cheetahPromptsUsed",b.none),(0,a._)(this,"cheetahOrgContextEnabled",!1),(0,a._)(this,"removeAccountCreationSection",!1),(0,a._)(this,"tailorTryInWebsitesSection",!1),(0,a._)(this,"replaceViewAppsSection",!1),(0,a._)(this,"replaceTakeATourSection",!1),(0,a._)(this,"trueUpSchedule",b.none),(0,a._)(this,"backendManagedStorageEnabled",!1),(0,a._)(this,"cheetahBTSOnboardingEnabled",!1),(0,a._)(this,"showDemoDocOnboardingA11yUpdates",!1),(0,a._)(this,"demoDocOnboardingA11yUpdatesTreatment",b.none),(0,a._)(this,"writingExpertVbarsEnabled",!1),(0,a._)(this,"writingExpertPullMode",!1),(0,a._)(this,"isEligibleForGtm",!1),(0,a._)(this,"showOnboardingTourA11yUpdates",!1),(0,a._)(this,"selectionContextUpdatesClient",!1),(0,a._)(this,"selectionContextUpdatesServer",!1),(0,a._)(this,"oggy",Y.splitSharedAssistants),(0,a._)(this,"uphookDestination",b.none),(0,a._)(this,"writingExpertFeedback",!1),(0,a._)(this,"sendProfuseGnarEvents",!1),(0,a._)(this,"isAiDetectorEnabled",void 0),(0,a._)(this,"isSmartPlagiarismUphookEnabled",!1),(0,a._)(this,"trafficThroughGatewayForCapi",!1),(0,a._)(this,"trafficThroughInternalCapi",!1),(0,a._)(this,"versionHistory",!1),(0,a._)(this,"isGetStartedChecklistPermanentDismissEnabled",!0),(0,a._)(this,"gDebugger",!1),(0,a._)(this,"persistentClientEntryPointTreatment",(()=>v.of(b.none))),(0,a._)(this,"renderedEventsTrackingEnabled",!1),(0,a._)(this,"aiEditorUXR",!1)}}e.DenaliFeaturesMock=t,e.SDUIDenaliFeaturesMock=class extends t{constructor(...e){super(...e),(0,a._)(this,"sdui",!0),(0,a._)(this,"aiEditorUXR",!0)}},e.DenaliPageFeaturesMock=class{get isFree(){return"boolean"==typeof this._isFree?h.s.create(this._isFree):this._isFree}get isPremium(){return"boolean"==typeof this._isFree?h.s.create(!this._isFree):this._isFree.view((e=>!e))}get denaliUserType(){return{type:("boolean"==typeof this._isFree?this._isFree:this._isFree.get())?r.Free:r.Premium}}constructor(e,t,i=!1){(0,a._)(this,"_isFree",void 0),(0,a._)(this,"denali",void 0),(0,a._)(this,"hideOnboarding",void 0),(0,a._)(this,"disableAppsPromotion",void 0),(0,a._)(this,"enableTrackingOnDownload",void 0),(0,a._)(this,"onboardingMode",void 0),(0,a._)(this,"plagiarism",void 0),(0,a._)(this,"proofit",void 0),(0,a._)(this,"demoMode",void 0),(0,a._)(this,"proofitTest",void 0),(0,a._)(this,"proofitLastJob",void 0),(0,a._)(this,"preventAnimation",void 0),(0,a._)(this,"voxInfo",void 0),(0,a._)(this,"track3rdPartyExtensionsInjection",void 0),(0,a._)(this,"subscriptionCampaign",void 0),(0,a._)(this,"lastSubscribedDateString",void 0),(0,a._)(this,"isOnFreeTrial",void 0),(0,a._)(this,"isMacEditor",void 0),(0,a._)(this,"freeTrialSpecialOffer",void 0),(0,a._)(this,"inProductDiscount",void 0),(0,a._)(this,"isSmartPlagiarismUphookEnabled",void 0),(0,a._)(this,"assignSmartPlagiarismUphookExperiment",void 0),(0,a._)(this,"persistentClientEntryPointTreatment",void 0),(0,a._)(this,"isAiStudio",void 0),this._isFree=e,this.denali=t,this.hideOnboarding=i,this.disableAppsPromotion=!1,this.enableTrackingOnDownload=h.s.create(!1),this.plagiarism=h.s.create(q.disabled),this.proofit=h.s.create(q.disabled),this.proofitTest=b.none,this.proofitLastJob=b.none,this.voxInfo=b.none,this.track3rdPartyExtensionsInjection=!1,this.subscriptionCampaign=h.s.create(b.none),this.lastSubscribedDateString=h.s.create(b.none),this.isOnFreeTrial=h.s.create(!1),this.freeTrialSpecialOffer=h.s.create(U.DI),this.inProductDiscount=h.s.create({isEligible:!1}),this.isSmartPlagiarismUphookEnabled=!1,this.assignSmartPlagiarismUphookExperiment=d.constVoid,this.persistentClientEntryPointTreatment=()=>v.of(b.none),this.isAiStudio=!1}}}(ie||(ie={}));const ne={disabled:["disable_extension_installation_disabled"]};var re=i(10334),oe=i(17171),ae=i(66202),le=i(40086),de=i(5692),ce=i(95133);class ue{isDapi(...e){return e.some((e=>this._experiments.has(e)))}isQuery(e){return(0,d.pipe)(this._router.query.get("exp"),b.exists((t=>t.split(",").includes(e))))}isManakin(e,...t){if(e instanceof ce.iD){const t=this._experimentClient.isGateEnabled(e);return t&&this.storeKnown(e.name,e.experience),t}{const i=this._experimentClient.getTreatment(e);if(null===i||i===ce.rM)return!1;{const s=t.includes(i);return this.storeKnown(e.name,i),s}}}getManakinExperimentTreatment(e){const t=this._experimentClient.getTreatment(e),i=t===ce.rM?null:t;return null!==i&&this.storeKnown(e.name,i),i}peekManakinExperiment(e,...t){const i=this._experimentClient.peekTreatment(e);if(null===i||i===ce.rM)return!1;{const s=t.includes(i);return this.storeKnown(e.name,i),s}}constructor(e,t,i){(0,a._)(this,"_experimentClient",void 0),(0,a._)(this,"_experiments",void 0),(0,a._)(this,"_router",void 0),(0,a._)(this,"storeKnown",void 0),(0,a._)(this,"_knownExperiments",void 0),this._experimentClient=e,this._experiments=t,this._router=i,this.storeKnown=(e,t)=>{this._knownExperiments[e]||(this._knownExperiments[e]=t)},this._knownExperiments={},y.Bx.Logging.root.context.add({manakinExperiments:this._knownExperiments})}}class he{get _forceEligibleForFreeTrial(){return this._exp.isQuery("forceEligibleForFreeTrial")}get freeTrialSpecialOffer(){const e=this._exp.getManakinExperimentTreatment(T.InProductIncentives),t=null===e||"freetrial"===e;return this.specialOfferEligibility.view((e=>e.isEligible&&"pro_free_trial"===e.name?(0,oe._)((0,re._)({},e),{isEligible:e.isEligible&&t}):U.DI))}get specialOfferEligibility(){return b.isNone(this._state)?h.s.create({isEligible:!1}):this._forceEligibleForFreeTrial?h.s.create({isEligible:!0,name:"pro_free_trial",plans:[]}):this.inProductDiscount.get().isEligible?this._state.value.view("specialOffersEligibilityWithPlans").view("in_product_discount_pro"):this._state.value.view("specialOffersEligibilityWithPlans").view("pro_free_trial")}get isOnFreeTrial(){return b.isNone(this._state)?h.s.create(!1):this._state.value.view("subscription").view((e=>de.j.isOk(e)&&Boolean(e.value.isOnTrial)))}get isOnProPlan(){return b.isNone(this._state)?h.s.create(!1):this._state.value.view("subscription").view((e=>de.j.isOk(e)&&!!e.value.proPlans&&!!e.value.currentPlan&&e.value.proPlans.some((t=>t.id===e.value.currentPlan.id))))}get showBusinessBanner(){return!this._institution.view(b.isSome).get()&&(this._router.query.has("gbBannerTesting")||!this.isInternalUser)}get isInternalUser(){return o.isGrammarlyUser(this._userProfile.get())||o.isTestUser(this._userProfile.get())}get trueUpSchedule(){return(0,d.pipe)(this._userProfile.get().institutionInfo,b.chain((e=>e.trueUpSchedule)))}get isAiStudio(){return this._environment.platform===I.OH.Platform.AISTUDIO}get subscriptionIsLoaded(){return b.isNone(this._state)?h.s.create(!1):this._state.value.view((e=>de.j.isOk(e.subscription)))}get denaliUserType(){return this.isFree.get()?{type:r.Free}:this.isPremium.get()?this._instType.view(b.toNullable).view((e=>e===s.Business)).get()?this.isOnProPlan.get()?{type:r.Business,isPro:!0,institutionType:S.$v(this._instUserType.get())}:{type:r.Business,institutionType:S.$v(this._instUserType.get())}:this._instType.view(b.toNullable).view((e=>e===s.Edu)).get()?{type:r.Edu,institutionType:S.$v(this._instUserType.get())}:{type:r.Premium}:{type:r.Free}}onboardingMode(){const e=this._router.query.get("onboarding"),t=(0,d.pipe)(e,S.gR("show")),i=(0,d.pipe)(e,S.gR("hide")),s=this.denali.showOnboardingTourA11yUpdates,n=J.Content.Oggy;return t?{kind:J.Kind.Forced,content:this.denali.oggy===Y.mergedSharedAssistant?J.Content.Oggy:J.Content.OggySplit}:i||o.isTestUser(this._userProfile.get())||this._isIPad?{kind:J.Kind.Hidden}:s?{kind:J.Kind.Standard,content:J.Content.WithoutInlineCards}:{kind:J.Kind.Standard,content:n}}get proofit(){return h.s.create(q.disabled)}get preventAnimation(){return(0,d.pipe)(this._router.query.get("preventAnimation"),b.exists((e=>"true"===e)))}get demoMode(){return b.isSome(this.denali.globalExperimentDemoText)}get track3rdPartyExtensionsInjection(){const e=this._router.query.get("3rdPartyExtensionsInjections"),t=b.exists((e=>"false"===e)),i=b.exists((e=>"true"===e));return!t(e)&&(Math.random()<.1||i(e))&&!o.isTestUser(this._userProfile.get())}get disableAppsPromotion(){return(0,d.pipe)(this._router.query.get("disableAppsPromotion"),b.exists((e=>"true"===e)))}get isSmartPlagiarismUphookEnabled(){return this._exp.peekManakinExperiment(T.PlagiarismUphook,"test")}get banners(){return this.disableAppsPromotion||!b.isNone(this._institution.get())&&!o.isBusiness(this.denaliUserType)?b.none:b.some(new te.BannersFeaturesImpl(this._userProfile,this._exp,this._settings,this._router,this.denaliUserType,this._isUserRegisteredBefore,this.denali.voxInfo,this._environment.info.browser,this.denali.llamaDiscoverabilityType))}get userRolePopup(){const e=new Date;e.setFullYear(e.getFullYear()-1);const t=this._userProfile.get().role,i=b.isNone(this._institution.get());return this._exp.isQuery("user_role_popup")?b.some(G.UserRolePopupMode.force):"msie"!==this._environment.info.browser&&i&&(b.isNone(t)||this._isUserRegisteredBefore(e)&&(0,d.pipe)(t,b.exists((e=>e===D.gG.school||e===D.j1.student))))?b.some(G.UserRolePopupMode.on):b.none}get lastSubscribedDateString(){return b.isNone(this._state)?h.s.create(b.none):this._state.value.view("subscription").view((e=>de.j.isOk(e)&&void 0!==e.value.lastSubscribedDate?b.some(e.value.lastSubscribedDate):b.none))}get subscriptionExpirationDateUTCTimestamp(){return b.isNone(this._state)?h.s.create(b.none):this._state.value.view("subscription").view((e=>de.j.isOk(e)&&void 0!==e.value.expirationDate?b.some((0,d.pipe)(u.Yr.parseDate(e.value.expirationDate),ae.map((e=>e.getTime()-this._timezoneOffset)))):b.none))}get subscriptionCampaign(){return b.isNone(this._state)?h.s.create(b.none):this._state.value.view("subscription").view((e=>de.j.isOk(e)&&void 0!==e.value.campaign?b.some(e.value.campaign):b.none))}get writingProgress(){return{enabled:this._exp.isQuery("learning_hub_mvp")||this._exp.isQuery("writing_progress_v2")||this._exp.isQuery("writing_progress_v3")||this._exp.isManakin(T.WritingProgress,"test")||this._exp.isManakin(T.WritingProgressV2,"test")||this._exp.isManakin(T.WritingProgressV3,"dashboard")||this._exp.isManakin(T.WritingProgressV3,"ipm")||o.isGrammarlyUser(this._userProfile.get())}}get goPremium(){return{enabled:this.isFree.get()}}get premiumBadge(){return{enabled:this.isPremium.get()}}get premiumCounter(){return{enabled:!this.isFree.get()}}get upgradeButton(){return{enabled:this.isFree.get()}}get trackWebVitals(){const e=this._router.query.get("webVitals");return this._environment.has(I.OH.Flag.supportsWebVitals)&&(0,d.pipe)(e,b.fold((()=>Math.random()<.01),(e=>"true"===e)))}get inProductDiscount(){return this.hasInProductDiscountSpecialOffer.view((e=>({isEligible:e})))}get hasInProductDiscountSpecialOffer(){return(0,d.pipe)(this._state,b.fold((()=>h.s.create(!1)),(e=>e.view("specialOffersEligibility").view("in_product_discount_pro"))))}get inSessionCheckoutExperiment(){if(this._exp.isQuery("in_session_checkout_v1"))return"in_session_checkout_v1";const e=this._exp.getManakinExperimentTreatment(T.InSessionCheckoutV1);return"test"===e?"in_session_checkout_v1":e}get isUphookHubEnabled(){return this._exp.peekManakinExperiment(T.PassiveUphookUsingUphookHub,"test")||this._exp.peekManakinExperiment(T.PassiveUphookUsingUphookHub,"control")}get hasUphookHubTestTreatment(){return this._exp.peekManakinExperiment(T.PassiveUphookUsingUphookHub,"test")}assignSmartPlagiarismUphookExperiment(){this._exp.getManakinExperimentTreatment(T.PlagiarismUphook)}constructor(e,t,i,r,o,l,c,p){(0,a._)(this,"_experimentClient",void 0),(0,a._)(this,"_experiments",void 0),(0,a._)(this,"_state",void 0),(0,a._)(this,"_userProfile",void 0),(0,a._)(this,"_settings",void 0),(0,a._)(this,"_clientControls",void 0),(0,a._)(this,"_environment",void 0),(0,a._)(this,"_router",void 0),(0,a._)(this,"_exp",void 0),(0,a._)(this,"_institution",void 0),(0,a._)(this,"_instUserFeature",void 0),(0,a._)(this,"_isUserRegisteredBefore",void 0),(0,a._)(this,"_nonInstUserFeature",void 0),(0,a._)(this,"isFree",void 0),(0,a._)(this,"isPremium",void 0),(0,a._)(this,"_isIPad",void 0),(0,a._)(this,"isMacEditor",void 0),(0,a._)(this,"instUserFeature",void 0),(0,a._)(this,"_instType",void 0),(0,a._)(this,"_instUserType",void 0),(0,a._)(this,"denali",void 0),(0,a._)(this,"proofitTest",void 0),(0,a._)(this,"proofitLastJob",void 0),(0,a._)(this,"plagiarism",void 0),(0,a._)(this,"_timezoneOffset",void 0),(0,a._)(this,"tour",void 0),(0,a._)(this,"showChangeEmail",void 0),(0,a._)(this,"eduAdminPanelLink",void 0),(0,a._)(this,"appsSection",void 0),(0,a._)(this,"score",void 0),(0,a._)(this,"copyPasteMenuItems",void 0),(0,a._)(this,"quickReplacementsInCard",void 0),(0,a._)(this,"hideTitleInInstCard",void 0),(0,a._)(this,"showFullCards",void 0),(0,a._)(this,"defaultAcademicGenre",void 0),(0,a._)(this,"enableTrackingOnDownload",void 0),this._experimentClient=e,this._experiments=t,this._state=i,this._userProfile=r,this._settings=o,this._clientControls=l,this._environment=c,this._router=p,this._exp=new ue(this._experimentClient,this._experiments.get(),this._router),this._institution=this._userProfile.view("institutionInfo"),this._instUserFeature=this._institution.view((e=>({enabled:this._router.query.has("instType")||b.isSome(e)}))),this._isUserRegisteredBefore=e=>(0,d.pipe)(this._userProfile.get().registrationDate,b.exists((t=>t<e))),this._nonInstUserFeature=this._instUserFeature.view((e=>({enabled:!e.enabled}))),this.isFree=this._userProfile.view((e=>e.type===D.ut.free||this._router.query.has("isFree"))),this.isPremium=this._userProfile.view((e=>e.type===D.ut.premium&&!this._router.query.has("isFree"))),this._isIPad=this._environment.platform===I.OH.Platform.IPAD,this.isMacEditor=this._environment.platform===I.OH.Platform.MACEDITOR,this.instUserFeature=this._instUserFeature,this._instType=this._institution.view((e=>(0,d.pipe)(this._router.query.get("instType"),b.filter((e=>Object.values(s).indexOf(e)>=0)),b.fold((()=>(0,d.pipe)(e,b.map((e=>["BUSINESS","NGO","GOV"].includes(e.organizationType)?s.Business:s.Edu)))),b.some)))),this._instUserType=this._institution.view(b.map((e=>e.admin?n.Admin:n.Member))),this.denali=new se(this._userProfile,this._settings,this._clientControls,this._router,this._exp,this._environment,this._instType,this.proofit,this,this._isUserRegisteredBefore),this.proofitTest=(0,d.pipe)(this._router.query.get("proofit"),b.map(le.c.stringToJobStatus)),this.proofitLastJob=(0,d.pipe)(this._router.query.get("proofitLastJob"),b.map(u.Yr.create)),this.plagiarism=h.s.combine(this._userProfile,this.isFree,((e,t)=>this.demoMode?q.disabled:e.editorFeatures.plagiarismDisabled?t?this.isSmartPlagiarismUphookEnabled?q.enabled:q.upgradeIsNeeded:q.disabled:q.enabled)),this._timezoneOffset=(new Date).getTimezoneOffset()*u.mZ,this.tour=this._nonInstUserFeature,this.showChangeEmail=this._nonInstUserFeature,this.eduAdminPanelLink=this._institution.view((e=>({enabled:(0,d.pipe)(e,b.map((e=>e.admin)),b.getOrElse(d.constFalse))}))),this.appsSection=h.s.create({enabled:!this.disableAppsPromotion}),this.score=this._userProfile.view((e=>({enabled:!e.editorFeatures.scoreDisabled}))),this.copyPasteMenuItems={enabled:!0},this.quickReplacementsInCard=this._userProfile.view((e=>({enabled:e.editorFeatures.quickReplacement}))),this.hideTitleInInstCard=h.s.combine(this._institution,this._userProfile,((e,t)=>({enabled:!b.isSome(e)||!t.editorFeatures.quickReplacement}))),this.showFullCards=this._userProfile.view((e=>({enabled:e.editorFeatures.fullCards}))),this.defaultAcademicGenre=h.s.create({enabled:!1}),this.enableTrackingOnDownload=h.s.create(!1)}}},98719:(e,t,i)=>{i.d(t,{uJ:()=>s,DJ:()=>b,jj:()=>S,ru:()=>n,YT:()=>D.Y,Sy:()=>y});var s={};i.r(s),i.d(s,{$:()=>v});var n={};i.r(n),i.d(n,{mV:()=>C}),i(39781),i(50794),i(97015);var r=i(23988),o=i(10334),a=i(17171),l=i(24819),d=i(84712),c=i(34553),u=i(9079),h=i(7149),p=i(91745),_=i(79937),g=i(5406),m=i(53458),f=i(22438);class v{setState({type:e,state:t}){this.onlineState.modify((i=>(0,a._)((0,o._)({},i),{[e]:t})))}_getNextOfflineKey(e){if("offline"===e.network.type)return"network";if(e.wsProtocol.type!==f.k)return"wsProtocol";if(e.dox.type!==f.k)return"dox";if(e.wsDox.type!==f.k)return"wsDox";if(e.wsCapi.type!==f.k)return"wsCapi";if("slow"===e.network.type)return"network";const t=Object.keys(e).find((t=>"online"!==e[t].type));if(Boolean(t))throw new l.zU(`Expected that state is online but got '${t}' is '${e[t].type}'`);return null}constructor(e){(0,r._)(this,"_handlers",void 0),(0,r._)(this,"_subscription",void 0),(0,r._)(this,"_dispose",void 0),(0,r._)(this,"onlineState",void 0),(0,r._)(this,"networkOnline",void 0),this._handlers=e,this._dispose=new c.B,this.onlineState=d.s.create({network:{type:f.k},dox:{type:f.k},wsProtocol:{type:f.k},wsDox:{type:f.k},wsCapi:{type:f.k}}),this.networkOnline=this.onlineState.view((e=>"offline"!==e.network.type)),(0,l.V1)(!this._subscription,"ConnectivityModel already subscribed"),this.onlineState.pipe(u.J(),h.T((([e,t])=>{const i=this._getNextOfflineKey(e),s=this._getNextOfflineKey(t);return{prevKey:i,prevState:Boolean(i)?e[i]:{type:f.k},nextKey:s,nextState:Boolean(s)?t[s]:{type:f.k}}})),p.p((({prevKey:e,prevState:t,nextKey:i,nextState:s})=>e!==i||t.type!==s.type||null===i)),_.n((({nextKey:e,nextState:t})=>(this._dispose.next(),null===e||t.type===f.k?g.w:this._handlers[e].handle(t).pipe(m.Q(this._dispose)))))).subscribe()}}var y=i(78408),b=i(54179),S=i(78018),w=(i(71449),i(76901),i(99334),i(89096),i(99010)),k=i(79),P=i(58655);i(57836);class x{dismiss(){this._cancel()}remind(){this._cancel()}cancel(){this._cancel()}_cancel(){this._dismissStream.next(!1)}shown(){}constructor(){(0,r._)(this,"_dismissStream",new c.B),(0,r._)(this,"getBannerState",void 0)}}class C extends x{install(){this.cancel(),Boolean(this._id)&&this._goToDocument(this._id)}constructor(e,t){super(),(0,r._)(this,"_proofit",void 0),(0,r._)(this,"_goToDocument",void 0),(0,r._)(this,"_id",void 0),(0,r._)(this,"_proofitStream",void 0),(0,r._)(this,"state",void 0),this._proofit=e,this._goToDocument=t,this._proofitStream=this._proofit.pipe(w.M((({id:e})=>this._id=e)),h.T((({id:e})=>null!==e))),this.state=this._dismissStream.pipe(k.h(this._proofitStream),P.F())}}i(37107),i(40464);var D=i(1424)},76901:(e,t,i)=>{i.d(t,{LF:()=>o,Rs:()=>r,n6:()=>n});var s=i(23988);const n={visible:!1,opts:{type:null}};class r{show(e){this._state.set({visible:!0,opts:e})}hide(){this._state.set(n)}constructor(e){(0,s._)(this,"_state",void 0),(0,s._)(this,"state",void 0),this._state=e,this.state=this._state.view()}}class o{show(){this._state.set({visible:!0})}hide(){this._state.set({visible:!1})}constructor(e){(0,s._)(this,"_state",void 0),(0,s._)(this,"state",void 0),this._state=e,this.state=this._state.view()}}},16432:(e,t,i)=>{i.d(t,{QN:()=>r,QS:()=>n,XH:()=>m,q3:()=>s});var s,n,r,o=i(23988),a=i(10334),l=i(17171),d=i(24819),c=i(84712),u=i(90829),h=i(51770),p=i(92832),_=i(58277);function g(e,t,i){return t.filter((t=>e(t)!==i))}!function(e){e.UserRole="userRole",e.SignOut="signOut",e.PremiumTopFeatures="premiumTopFeatures",e.ClientsComparison="clientsComparison",e.GrammarlyGoOnboarding="grammarlyGoOnboarding",e.EmptyBin="emptyBin"}(s||(s={})),function(e){e.empty={dismiss:[],later:[],shown:[]}}(n||(n={})),function(e){e.Shown="shown",e.Dismiss="dismiss",e.Later="later"}(r||(r={}));class m{initialize(e){this._modals.set(e)}notHidden(e){return function(e,t){return!Boolean(e.dismiss.find((e=>e===t)))&&!e.later.find((e=>e.type===t&&e.expire>Date.now()))}(this._modals.get(),e)}notLater(e){return function(e,t){return!e.later.find((e=>e.type===t))}(this._modals.get(),e)}dispatch(e,t){switch(t.type){case r.Dismiss:return this._updateState({later:g((e=>e.type),this._modals.get().later,e),dismiss:[...g((e=>e),this._modals.get().dismiss,e),e]});case r.Shown:return this._updateState({shown:[...g((e=>e),this._modals.get().shown,e),e]});case r.Later:return this._updateState({later:[...g((e=>e.type),this._modals.get().later,e),{type:e,expire:Date.now()+t.expire}]});default:(0,d.xb)(t)}}_updateState(e){this._modals.modify((t=>(0,h.yo)(t,e)))}constructor(e){(0,o._)(this,"_settings",void 0),(0,o._)(this,"_modals",void 0),this._settings=e,this._modals=c.s.create(n.empty),(0,u.hJ)("resetModals",(()=>{this._settings.updateModals({shown:[],later:[],dismiss:[]})})),(0,u.hJ)("remindModal",(e=>{const t=this._settings.modals.get();this._settings.updateModals((0,l._)((0,a._)({},t),{later:[...t.later.filter((t=>t.type!==e)),{type:e,expire:Date.now()}]}))})),this._modals.pipe(p.i(1),_.Z(100)).subscribe((e=>{Boolean(this._settings)&&this._settings.updateModals(e)}))}}},99334:(e,t,i)=>{i.d(t,{d:()=>r});var s=i(23988),n=i(14650);class r{getNotInstalledAppsCount(){return this._clientsState.getAsArray().filter(n.X.isNotInstalled).length}isAppsVisible(){return this._appsSection&&this._getSupportedAppsCount()>0}isMyGrammarlyVisible(){return!this._clientsState.isEditorBlocked}_getSupportedAppsCount(){return this._clientsState.getAsArray().filter(n.X.isSupported).length}constructor(e,t,i){(0,s._)(this,"features",void 0),(0,s._)(this,"_clientsState",void 0),(0,s._)(this,"brandingSet",void 0),(0,s._)(this,"_appsSection",void 0),this.features=e,this._clientsState=t,this.brandingSet=i,this._appsSection=this.features.appsSection.get().enabled}}},37107:(e,t,i)=>{i.d(t,{$u:()=>J,CH:()=>K,Jf:()=>Z,Ks:()=>Y,L0:()=>R,RM:()=>W,Z4:()=>z,ZJ:()=>ie,Zb:()=>ne,pK:()=>X,tl:()=>Q,uD:()=>G,wq:()=>re,xR:()=>j});var s=i(83531),n=i(23988),r=i(10334),o=i(17171),a=i(69384),l=i(93267),d=i(44869),c=i(82094),u=i(84647),h=i(95934),p=i(88041),_=i(77303),g=i(71301),m=i(24819),f=i(84712),v=i(90829),y=i(31023),b=i(26278),S=i(1224),w=i(65390),k=i(66202),P=i(73328),x=i(68801),C=i(65160),D=i(94855),E=i(51770),T=i(44781),A=i(89011),O=i(75363),U=i(5692),I=i(27156),M=i(83194),B=i(80029),N=i(31373),F=i(16432);const L=(0,B.W)();var R,H,j,G,W,q,V,Z,z,X,Y,K,$,Q,J,ee,te;!function(e){e.ProofitPromo="proofit_promo",e.FreeClarityAlertsEnabled="free_clarity_alerts",e.FreeClarityAlertsControl="free_clarity_alerts_control",e.PremiumOnboarding="premium_onboarding",e.GBSatisfaction="gb_satisfaction",e.MostActiveUsers="most_active_users"}(R||(R={})),function(e){e.SuperScrollWithAutoJump="super_scroll_with_auto_jump",e.SuperScrollWithoutAutoJump="super_scroll_without_auto_jump"}(H||(H={})),function(e){e.AccountCreation="accountCreation",e.Tour="tour",e.TryWebsite="tryWebsite",e.ViewApps="viewApps",e.CustomizeSettings="customizeSettings"}(j||(j={})),function(e){e.UnlockPremium="unlockPremium",e.TopFeatures="topFeatures",e.ExploreAllProducts="exploreAllProducts"}(G||(G={})),function(e){e.HardDismiss="hardDismiss",e.SoftDismiss="softDismiss"}(W||(W={})),function(e){e.mapBySurveyType=function(e,t,i,s,n){switch(e){case R.ProofitPromo:return t(e);case R.FreeClarityAlertsEnabled:case R.FreeClarityAlertsControl:case R.MostActiveUsers:return i(e);case R.PremiumOnboarding:return s(e);case R.GBSatisfaction:return n(e);default:return(0,m.xb)(e)}}}(q||(q={})),function(e){e.Work="work",e.StrongTeams="strongTeams",e.StepUp="stepUp",e.FreeStyleGuide="freeStyleGuide",e.EveryTeammate="everyTeammate",e.Expensing="expensing",e.ViewPerformance="viewPerformance",e.ForWorkTrial="forWorkTrial",e.PremiumStyleGuide="premiumStyleGuide"}(V||(V={})),function(e){e.wordsCount="wordsCount",e.charsCount="charsCount",e.readingTime="readingTime",e.speakingTime="speakingTime",e.readabilityScore="readabilityScore"}(Z||(Z={})),function(e){e.Normal="Normal",e.Large="Large"}(z||(z={})),(z||(z={})).match=(e,t)=>i=>{switch(i){case z.Normal:return e;case z.Large:return t;default:return(0,m.xb)(i)}},function(e){e.Default="Default",e.Accessible="Accessible"}(X||(X={})),function(e){e.RTF="rtf",e.PDF="pdf",e.ProofitClarity="proofitClarity",e.MutedAlerts="mutedAlerts",e.Trash="trash",e.VersionHistory="versionHistory",e.SidebarRefresh="sidebarRefresh"}(Y||(Y={})),function(e){e.smbSpecificProfessionalism="smbSpecificProfessionalism",e.styleGuides="styleGuides"}(K||(K={})),function(e){e.prefix="cheetah",e.propertyName="onboardingState:editor"}($||($={})),function(e){var t=e.empty={firstCall:!1,seenWelcome:!1,suppressedWelcome:!1,dialectStrong:w.none,dialectWeak:w.none,banners:{dismiss:new Set,shown:new Set,later:new Set,cancelled:new Set},modals:F.QS.empty,businessBanner:{latestCloseTime:w.none,closed:[]},denaliLens:{},onboardingPassed:new Set,[$.propertyName]:_.V.State.empty,showExitNotification:!0,showSetGoalsLoader:!0,seenDenaliWelcome:!1,seenSignOutSurvey:!1,footerCounterType:Z.wordsCount,editorPreferences:{autoScrollToNextAlert:w.none,fontSize:z.Normal,suggestionsVisualMode:X.Default},survey:{},news:new Set,changePlanHook:{latestDismissAt:w.none,latestAppearances:[]},gbBannersUpHook:{[K.smbSpecificProfessionalism]:{latestAppearances:[],latestDismissAt:w.none,dismissesCount:0},[K.styleGuides]:{latestAppearances:[],latestDismissAt:w.none,dismissesCount:0}},dunningSettings:{dunningDismissCount:0,latestDismissAt:w.none},gbBillingMigrationSettings:{latestDismissAt:w.none},dunning_billing_status:w.none,featuresOnboardingSeen:new Set,ungated_trial_end_date:w.none,ungatedRenewalNotificationSettings:{latestAppearance:w.none,wasDismissed:!1},memberInviteOnboardingPassed:!1,safariDeactivatedWeb:!1,safariDeactivatedNative:!1,seenSafariExtNotification:!1,supportUkraineCardAppearanceCount:0,dismissedPersistentClientInstallCardv2:!1,getStartedChecklistSettings:{dismissal:w.none,completedItems:new Set([j.AccountCreation])},getStartedPremiumChecklistSettings:{dismissal:w.none,completedItems:new Set([G.UnlockPremium])},llamaDiscoverabilitySettings:{modalDismissalTimestamp:w.none,bannerDismissalTimestamp:w.none}},i=e.extensionAutoCitationsBanners=b.ZU.literalArray(["chrome-autoCitations","edge-chromium-autoCitations","safari-autoCitations","firefox-autoCitations"]),s=e.llamaBanners=b.ZU.literalArray(["llama-mac-download-banner","llama-windows-download-banner"]),n=e.llamaPopups=b.ZU.literalArray(["llama-mac-download-popup","llama-windows-download-popup"]),r=e.extensionBanners=b.ZU.literalArray(["safari-extension","firefox-extension","chrome-extension","edge-extension","edge-chromium-extension",...i]),o=e.extensionAutoCitationsPopups=b.ZU.literalArray(["chrome-autoCitations-popup","edge-chromium-autoCitations-popup","safari-autoCitations-popup","firefox-autoCitations-popup"]),a=e.extensionAppPopups=b.ZU.literalArray(["chrome-popup","safari-popup","firefox-popup","edge-popup","edge-chromium-popup"]);e.isExtensionAutoCitationsPopup=function(e){return o.some((t=>t===e))};var l=e.extensionPopups=b.ZU.literalArray([...a,...o]),d=e.gbBanners=b.ZU.literalArray(["invite-members","invite-members-pro","style-guide","style-guide-pro","true-up"]),c=e.deDeprecationPopup="de-deprecation-popup",g=e.deDeprecationBanner="de-deprecation-banner";const m=b.ZU.literalArray(["desktop-windows","desktop-mac",c,g]);var f=e.banners=b.ZU.literalArray(["campaign-end","proofit-cancelled","proofit-completed","mobile-keyboard",...d,...r,...l,...s,...n,...m]);const v=b.ZU.literalUnion("banner",f);var y=e.bannersType=h.qO({dismiss:b.ZU.set(v),shown:b.ZU.set(v),later:b.ZU.fallback(b.ZU.set(h.qO({type:v,expire:h.ai})),new Set),cancelled:b.ZU.fallback(b.ZU.set(v),new Set)});const x=h.zz(h.Yj,h.OH({dismissAllCounter:h.ai,important:h.zM})),C=b.ZU.properties({firstCall:b.ZU.withDefault(h.zM,t.firstCall),seenWelcome:b.ZU.withDefault(h.zM,t.seenWelcome),suppressedWelcome:b.ZU.withDefault(h.zM,t.suppressedWelcome),dialectStrong:b.ZU.option(O.p.dialectType),dialectWeak:b.ZU.option(O.p.dialectType),banners:b.ZU.withDefault(y,t.banners),denaliLens:b.ZU.fallback(x,t.denaliLens),onboardingPassed:b.ZU.fallback(b.ZU.set(b.ZU.createStringEnum(A.E.StepId,"Onboarding")),t.onboardingPassed),showExitNotification:b.ZU.withDefault(h.zM,t.showExitNotification)},"","legacyProps"),D=b.ZU.properties({dunning_billing_status:b.ZU.fallback(b.ZU.option(h.Yj),t.dunning_billing_status),ungated_trial_end_date:b.ZU.option(b.ZU.date()),memberInviteOnboardingPassed:b.ZU.fallback(h.zM,t.memberInviteOnboardingPassed),safariDeactivatedWeb:b.ZU.fallback(h.zM,t.safariDeactivatedWeb),safariDeactivatedNative:b.ZU.fallback(h.zM,t.safariDeactivatedNative)},"","sharedProps"),E=h.qO({counter:h.ai,actual:h.zM,wasClosedAt:b.ZU.option(b.ZU.date())}),U=b.ZU.properties({businessBanner:b.ZU.withDefault(h.NW({latestCloseTime:b.ZU.fallback(b.ZU.option(h.ai),t.businessBanner.latestCloseTime),closed:b.ZU.fallback(h.QZ(b.ZU.createStringEnum(V,"string")),t.businessBanner.closed)}),t.businessBanner),modals:b.ZU.withDefault(h.qO({dismiss:h.YO(b.ZU.createStringEnum(F.q3,"string")),shown:h.YO(b.ZU.createStringEnum(F.q3,"string")),later:h.YO(h.qO({expire:h.ai,type:b.ZU.createStringEnum(F.q3,"string")}))}),t.modals),seenDenaliWelcome:b.ZU.withDefault(h.zM,t.seenDenaliWelcome),seenSignOutSurvey:b.ZU.withDefault(h.zM,t.seenSignOutSurvey),showSetGoalsLoader:b.ZU.withDefault(h.zM,t.showSetGoalsLoader),footerCounterType:b.ZU.fallback(b.ZU.createStringEnum(Z,"string"),Z.wordsCount),editorPreferences:b.ZU.fallback(h.NW({autoScrollToNextAlert:b.ZU.fallback(b.ZU.option(h.zM),t.editorPreferences.autoScrollToNextAlert),fontSize:b.ZU.fallback(b.ZU.createStringEnum(z,"FontSize"),t.editorPreferences.fontSize),suggestionsVisualMode:b.ZU.fallback(b.ZU.createStringEnum(X,"SuggestionsVisualMode"),t.editorPreferences.suggestionsVisualMode)}),t.editorPreferences),survey:b.ZU.fallback(h.OH({[R.FreeClarityAlertsEnabled]:E,[R.FreeClarityAlertsControl]:E,[R.ProofitPromo]:h.qO({actual:h.zM})}),t.survey),news:b.ZU.fallback(b.ZU.set(b.ZU.createStringEnum(Y,"NewsItemId")),t.news),changePlanHook:b.ZU.fallback(h.qO({latestAppearances:h.YO(b.ZU.date()),latestDismissAt:b.ZU.option(b.ZU.date())}),t.changePlanHook),gbBannersUpHook:b.ZU.fallback(h.NW({[K.smbSpecificProfessionalism]:h.qO({latestAppearances:h.YO(b.ZU.date()),latestDismissAt:b.ZU.option(b.ZU.date()),dismissesCount:h.ai}),[K.styleGuides]:h.qO({latestAppearances:h.YO(b.ZU.date()),latestDismissAt:b.ZU.option(b.ZU.date()),dismissesCount:h.ai})}),t.gbBannersUpHook),dunningSettings:b.ZU.fallback(h.qO({dunningDismissCount:h.ai,latestDismissAt:b.ZU.option(b.ZU.date())}),t.dunningSettings),gbBillingMigrationSettings:b.ZU.fallback(h.qO({latestDismissAt:b.ZU.option(b.ZU.date())}),t.gbBillingMigrationSettings),featuresOnboardingSeen:b.ZU.fallback(b.ZU.set(b.ZU.createStringEnum(T.k,"FeatureOnboardingItemId")),t.featuresOnboardingSeen),ungatedRenewalNotificationSettings:b.ZU.fallback(h.qO({latestAppearance:b.ZU.option(b.ZU.date()),wasDismissed:h.zM}),t.ungatedRenewalNotificationSettings),seenSafariExtNotification:b.ZU.fallback(h.zM,t.seenSafariExtNotification),supportUkraineCardAppearanceCount:b.ZU.fallback(h.ai,t.supportUkraineCardAppearanceCount),dismissedPersistentClientInstallCardv2:b.ZU.fallback(h.zM,t.dismissedPersistentClientInstallCardv2),llamaDiscoverabilitySettings:b.ZU.fallback(h.qO({modalDismissalTimestamp:b.ZU.option(b.ZU.date()),bannerDismissalTimestamp:b.ZU.option(b.ZU.date())}),t.llamaDiscoverabilitySettings),getStartedChecklistSettings:b.ZU.fallback(h.qO({dismissal:b.ZU.option(h.qO({type:b.ZU.createStringEnum(W,"GetStartedChecklistDismissalType"),timestamp:b.ZU.date()})),completedItems:b.ZU.set(b.ZU.createStringEnum(j,"GetStartedItemType"))}),t.getStartedChecklistSettings),getStartedPremiumChecklistSettings:b.ZU.fallback(h.qO({dismissal:b.ZU.option(h.qO({type:b.ZU.createStringEnum(W,"GetStartedChecklistDismissalType"),timestamp:b.ZU.date()})),completedItems:b.ZU.set(b.ZU.createStringEnum(G,"GetStartedPremiumItemType"))}),t.getStartedPremiumChecklistSettings)},"DN","namespacedProps"),I=b.ZU.fallback(_.V.codec,_.V.State.empty),M=b.ZU.properties({[$.propertyName]:I},$.prefix,"cheetahProps");var B=e.dapiPropsCodec=b.ZU.combineProperties([C,D,U,M]);e.parse=function(...e){try{return(0,u.pipe)(B.decode(e),k.mapLeft(p.V2),k.mapLeft((e=>(S.Bx.Logging.getLogger("model.settings.parse").warn("fail",e),e))),k.getOrElse((()=>t)))}catch(e){return S.Bx.Logging.getLogger("model.settings.parse").error("fail",e),t}},e.serialize=function(e){return P.zb((()=>B.encode(e)))}}(Q||(Q={})),function(e){e.eq=d.OW({fontSize:d.w_,suggestionsVisualMode:d.w_,autoScrollToNextAlert:w.getEq(l.Eq)})}(J||(J={})),function(e){e.pruneDapiProperties=function(e){return(0,o._)((0,r._)({},e),{survey:e.survey&&(t=e.survey,c.LV((e=>Object.values(R).includes(e)))(t))});var t}}(ee||(ee={})),function(e){e.create=(e,t,i={})=>s=>({error:s,currentSettings:t,newSettings:i,source:e})}(te||(te={}));class ie{markFeatureOnboarded(e){return this.featuresOnboardingSeen.modify((t=>{const i=new Set(t);return i.add(e),i})),this._setProperty({featuresOnboardingSeen:this.featuresOnboardingSeen.get()},!1).catch((t=>{this._log.warn(`Cannot mark onboarding as complete for feature ${e}`,t)}))}getSurveyModel(e){return this._userSettings.view("survey",e).view(w.fromNullable)}setSurveyModel(e,t){return this._userSettings.lens("survey").lens(e).set(t),this._setProperty({survey:this._userSettings.lens("survey").get()},!1).catch((e=>{this._log.warn("Cannot update survey",e)}))}markNewsItemsAsSeen(e){const t=new Set(this.newsSeen.get());return e.forEach((e=>t.add(e))),this._setProperty({news:t},!1)}incrementDunningDismissCount(){return this._setProperty({dunningSettings:{dunningDismissCount:(0,N.J)(this.dunningSettings.get())?1:this.dunningSettings.view("dunningDismissCount").get()+1,latestDismissAt:w.some(g.Yr.now())}},!1)}supportUkraineCardSeen(){const e=this._userSettings.lens("supportUkraineCardAppearanceCount").get();return this._setProperty({supportUkraineCardAppearanceCount:e+1},!1)}_setProperty(e,t=!0,i){return U.j.modifyRemoteStateOptimistic(this._userSettings,(0,E.JP)(e),(()=>x.hq(this._sync(e,i)).catch((e=>{const{error:t}=e,i=(0,a._)(e,["error"]);throw this._log.handler("dapiError: save failed",i).warn(t),e}))),t)}firstCallDone(){return this._setProperty({firstCall:!0},!1).catch((e=>{e instanceof I.M?this._log.warn("Cannot set first call as done",e):this._log.error("Cannot set first call as done",e)}))}setDialect(e){return this._setProperty({dialectStrong:w.some(e)}).then((t=>e))}setDialectWeak(e){return this._setProperty({dialectWeak:w.some(e)}).then((t=>e))}updateFooterCounterType(e){return this._setProperty({footerCounterType:e},!1).catch((e=>this._log.warn("Cannot update footer counter type",e)))}welcomeTourSeen(){return this._setProperty({seenWelcome:!0},!1).catch((e=>this._log.warn("Cannot mark welcome tour as looked",e)))}denaliWelcomeTourSeen(){return this._setProperty({seenDenaliWelcome:!0},!1).catch((e=>this._log.warn("Cannot mark denali welcome tour as seen",e)))}markSignOutSurveySeen(){return this._setProperty({seenSignOutSurvey:!0},!1).catch((e=>this._log.warn("Cannot mark signOut survey as seen",e)))}updateBusinessBanner(e){return this._setProperty({businessBanner:e}).catch((e=>{e instanceof I.M?this._log.warn("Cannot update business banner state",e):this._log.error("Cannot update business banner state",e)}))}updateBanners(e){return this._setProperty({banners:e}).catch((t=>{t instanceof I.M?this._log.warn("Cannot update banners state",t,e):this._log.error("Cannot update banners state",t,e)}))}updateModals(e){return this._setProperty({modals:e}).catch((t=>{t instanceof I.M?this._log.warn("Cannot update modals state",t,e):this._log.error("Cannot update modals state",t,e)}))}toggleMarkAsImportant(e,t){const i=Object.assign({},this.denaliLens.get());return i[e]=Object.assign({},i[e],{important:t}),this._setProperty({denaliLens:Object.assign({},i)},!1)}dismissAll(e){var t,i;const s=Object.assign({},this.denaliLens.get());var n;return s[e]=Object.assign({},s[e],{dissmissAllCounter:Math.sqrt((n=Boolean(null===(t=s[e])||void 0===t?void 0:t.dismissAllCounter)?null===(i=s[e])||void 0===i?void 0:i.dismissAllCounter:0,1+(Boolean(n)?n*n:1)))}),this._setProperty({denaliLens:Object.assign({},s)},!1)}updateOnboardingPassed(e){const t=new Set(this._userSettings.get().onboardingPassed),i=t.size;return e.forEach((e=>t.add(e))),i===t.size?Promise.resolve():this._setProperty({onboardingPassed:t},!1)}updateCheetahOnboardingState(e){var t=this;return(0,s._)((function*(){const i=t._userSettings.get()[$.propertyName],s=(0,r._)({},_.V.State.toClientState(i,"editor"),e),n=_.V.State.patch(s,"editor")(i);return t._setProperty({[$.propertyName]:n},!1,{keepalive:!0}).catch((e=>{const{error:i}=e,s=(0,a._)(e,["error"]);t._log.handler("Cannot set remote Cheetah onboardingState",s).warn(i)}))}))()}updateExitNotification(e){return this._setProperty({showExitNotification:e},!1).catch((e=>{this._log.warn("Cannot set showExitNotification",e)}))}updateSetGoalsLoader(e){return this._setProperty({showSetGoalsLoader:e},!1).catch((e=>{this._log.warn("Cannot set showSetGoalsLoader",e)}))}updateEditorPreferences(e){return this._setProperty({editorPreferences:e},!1).catch((e=>{this._log.warn("Cannot update Editor Preferences",e)}))}changePlanHookSeen(){const{latestAppearances:e,latestDismissAt:t}=Object.assign({},this.changePlanHook.get());return e.push(g.Yr.now()),this._setProperty({changePlanHook:{latestDismissAt:t,latestAppearances:e.slice(-3)}},!1).catch((e=>this._log.warn("Cannot add appearance of change plan hook",e)))}dismissChangePlanHook(){const{latestAppearances:e}=Object.assign({},this.changePlanHook.get());return this._setProperty({changePlanHook:{latestDismissAt:w.some(g.Yr.now()),latestAppearances:e}},!1).catch((e=>this._log.warn("Cannot set latest dismiss time of change plan hook",e)))}gbUpHookSeen(e){const t=this.gbBannersUpHook.get(),{[e]:i}=t,{latestAppearances:s}=i;return this._setProperty({gbBannersUpHook:(0,o._)((0,r._)({},t),{[e]:(0,o._)((0,r._)({},i),{latestAppearances:[...s,g.Yr.now()].slice(-3)})})},!1).catch((e=>this._log.warn("Cannot set latest dismiss time of change plan hook",e)))}dismissGBUpHook(e){const t=this.gbBannersUpHook.get(),{[e]:i}=t;return this._setProperty({gbBannersUpHook:(0,o._)((0,r._)({},t),{[e]:(0,o._)((0,r._)({},i),{latestDismissAt:w.some(g.Yr.now()),dismissesCount:i.dismissesCount+1})})},!1).catch((e=>this._log.warn("Cannot set latest dismiss time of change plan hook",e)))}ungatedRenewalNotificationDismissed(){return this._setProperty({ungatedRenewalNotificationSettings:{latestAppearance:w.some(g.Yr.now()),wasDismissed:!0}},!1).catch((e=>this._log.warn("Cannot set ungated notification dismiss status",e)))}ungatedRenewalNotificationSeen(){return this._setProperty({ungatedRenewalNotificationSettings:{latestAppearance:w.some(g.Yr.now()),wasDismissed:!1}},!1).catch((e=>this._log.warn("Cannot set ungated notification seen time",e)))}dismissGBBillingMigrationNotification(){return this._setProperty({gbBillingMigrationSettings:{latestDismissAt:w.some(g.Yr.now())}},!1).catch((e=>this._log.warn("Cannot update gb billing migration notification dismiss time",e)))}markSafariExtNotificationSeen(){return this._userSettings.get().seenSafariExtNotification?(this._log.error("Tried to mark SafariExtNotification as seen repeatedly."),Promise.resolve()):this._setProperty({seenSafariExtNotification:!0},!1).catch((e=>this._log.warn("Cannot set seenSafariExtNotification",e)))}updateGetStartedChecklistSettings(e){const t=this._userSettings.get().getStartedChecklistSettings,i=(0,r._)({},t,e);return this._setProperty({getStartedChecklistSettings:i},!1).catch((e=>this._log.warn("Unable to update getStartedChecklistSettings",e)))}updateGetStartedPremiumChecklistSettings(e){const t=this._userSettings.get().getStartedPremiumChecklistSettings,i=(0,r._)({},t,e);return this._setProperty({getStartedPremiumChecklistSettings:i},!1).catch((e=>this._log.warn("Unable to update getStartedPremiumChecklistSettings",e)))}updateLlamaDiscoverabilitySettings(e){const t=this._userSettings.get().llamaDiscoverabilitySettings,i=(0,r._)({},t,e);return this._setProperty({llamaDiscoverabilitySettings:i},!1).catch((e=>this._log.warn("Unable to update llamaDiscoverabilitySettings",e)))}constructor(e,t,i){(0,n._)(this,"_userSettings",void 0),(0,n._)(this,"_save",void 0),(0,n._)(this,"_userId",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"firstCall",void 0),(0,n._)(this,"dialect",void 0),(0,n._)(this,"dialectOrDefault",void 0),(0,n._)(this,"seenWelcome",void 0),(0,n._)(this,"seenDenaliWelcome",void 0),(0,n._)(this,"seenSignOutSurvey",void 0),(0,n._)(this,"suppressedWelcome",void 0),(0,n._)(this,"banners",void 0),(0,n._)(this,"modals",void 0),(0,n._)(this,"businessBanner",void 0),(0,n._)(this,"denaliLens",void 0),(0,n._)(this,"onboardingPassed",void 0),(0,n._)(this,"showExitNotification",void 0),(0,n._)(this,"enableSetGoalsLoader",void 0),(0,n._)(this,"footerCounterType",void 0),(0,n._)(this,"editorPreferences",void 0),(0,n._)(this,"newsSeen",void 0),(0,n._)(this,"dunningSettings",void 0),(0,n._)(this,"dunningStatus",void 0),(0,n._)(this,"gbBillingMigrationSettings",void 0),(0,n._)(this,"changePlanHook",void 0),(0,n._)(this,"gbBannersUpHook",void 0),(0,n._)(this,"featuresOnboardingSeen",void 0),(0,n._)(this,"ungatedTrialEndDate",void 0),(0,n._)(this,"ungatedRenewalNotificationSettings",void 0),(0,n._)(this,"memberInviteOnboardingPassed",void 0),(0,n._)(this,"safariDeactivatedWeb",void 0),(0,n._)(this,"safariDeactivatedNative",void 0),(0,n._)(this,"seenSafariExtNotification",void 0),(0,n._)(this,"supportUkraineCardAppearanceCount",void 0),(0,n._)(this,"getStartedChecklistSettings",void 0),(0,n._)(this,"getStartedPremiumChecklistSettings",void 0),(0,n._)(this,"llamaDiscoverabilitySettings",void 0),(0,n._)(this,"cheetahOnboardingState",void 0),(0,n._)(this,"dismissedPersistentClientInstallCardv2",void 0),(0,n._)(this,"_saveToRemote",void 0),(0,n._)(this,"_syncRemote",void 0),(0,n._)(this,"_syncLocal",void 0),(0,n._)(this,"_sync",void 0),(0,n._)(this,"markPersistentClientInstallCardAsDismissed",void 0),this._userSettings=e,this._save=t,this._userId=i,this._log=S.Bx.Logging.getLogger("model.settings"),this.firstCall=this._userSettings.lens("firstCall"),this.dialect=this._userSettings.view((e=>(0,u.pipe)(e.dialectStrong,C.NW(e.dialectWeak)))),this.dialectOrDefault=this.dialect.view(w.fold((()=>L.defaultDialect),(e=>e))),this.seenWelcome=this._userSettings.lens("seenWelcome"),this.seenDenaliWelcome=this._userSettings.lens("seenDenaliWelcome"),this.seenSignOutSurvey=this._userSettings.lens("seenSignOutSurvey"),this.suppressedWelcome=this._userSettings.lens("suppressedWelcome"),this.banners=this._userSettings.lens("banners"),this.modals=this._userSettings.lens("modals"),this.businessBanner=this._userSettings.lens("businessBanner"),this.denaliLens=this._userSettings.lens("denaliLens"),this.onboardingPassed=this._userSettings.lens("onboardingPassed"),this.showExitNotification=this._userSettings.lens("showExitNotification"),this.enableSetGoalsLoader=this._userSettings.lens("showSetGoalsLoader"),this.footerCounterType=this._userSettings.lens("footerCounterType"),this.editorPreferences=this._userSettings.lens("editorPreferences"),this.newsSeen=this._userSettings.lens("news"),this.dunningSettings=this._userSettings.lens("dunningSettings"),this.dunningStatus=this._userSettings.lens("dunning_billing_status"),this.gbBillingMigrationSettings=this._userSettings.lens("gbBillingMigrationSettings"),this.changePlanHook=this._userSettings.lens("changePlanHook"),this.gbBannersUpHook=this._userSettings.lens("gbBannersUpHook"),this.featuresOnboardingSeen=this._userSettings.lens("featuresOnboardingSeen"),this.ungatedTrialEndDate=this._userSettings.lens("ungated_trial_end_date"),this.ungatedRenewalNotificationSettings=this._userSettings.lens("ungatedRenewalNotificationSettings"),this.memberInviteOnboardingPassed=this._userSettings.lens("memberInviteOnboardingPassed"),this.safariDeactivatedWeb=this._userSettings.view("safariDeactivatedWeb"),this.safariDeactivatedNative=this._userSettings.view("safariDeactivatedNative"),this.seenSafariExtNotification=this._userSettings.view("seenSafariExtNotification"),this.supportUkraineCardAppearanceCount=this._userSettings.view("supportUkraineCardAppearanceCount"),this.getStartedChecklistSettings=this._userSettings.lens("getStartedChecklistSettings"),this.getStartedPremiumChecklistSettings=this._userSettings.lens("getStartedPremiumChecklistSettings"),this.llamaDiscoverabilitySettings=this._userSettings.lens("llamaDiscoverabilitySettings"),this.cheetahOnboardingState=this._userSettings.lens($.propertyName),this.dismissedPersistentClientInstallCardv2=this._userSettings.view("dismissedPersistentClientInstallCardv2"),this._saveToRemote=(e,t)=>(0,u.pipe)(Q.serialize(e),D.Mr,D.cy((e=>this._save(e,t)))),this._syncRemote=(e,t)=>(0,u.pipe)(this._saveToRemote(e),D.NW((i=>i instanceof y._d?(this._log.warn("Failed to serialize DAPI props",i),this._saveToRemote(ee.pruneDapiProperties(e),t)):D.kb(i))),D.qE(te.create("_syncRemote",this._userSettings.get(),e))),this._syncLocal=()=>(0,u.pipe)(Q.serialize(this._userSettings.get()),k.bimap(te.create("_syncLocal",this._userSettings.get()),(e=>ne.write(this._userId,e)))),this._sync=(0,u.flow)(this._syncRemote,D.Q5(this._syncLocal)),this.markPersistentClientInstallCardAsDismissed=()=>this._userSettings.get().dismissedPersistentClientInstallCardv2?(this._log.error("Tried to set dismissedPersistentClientInstallCardv2 as dismissed repeatedly."),Promise.resolve()):this._setProperty({dismissedPersistentClientInstallCardv2:!0},!1).catch((e=>{this._log.warn("Cannot set dismissedPersistentClientInstallCardv2",e)})),(0,v.hJ)("clearFeaturesOnboarding",(()=>this._setProperty({featuresOnboardingSeen:new Set}))),(0,v.hJ)("clearNews",(()=>this._setProperty({news:new Set}))),(0,v.hJ)("clearSeenSafariExt",(()=>this._setProperty({seenSafariExtNotification:!1}))),(0,v.hJ)("clearCheetahOnboarding",(()=>this._setProperty({[$.propertyName]:_.V.State.empty}))),(0,v.hJ)("clearGetStarted",(()=>{const e={dismissal:w.none,completedItems:new Set};this._setProperty({getStartedChecklistSettings:e}),this._setProperty({getStartedPremiumChecklistSettings:e})})),(0,v.hJ)("clearDismissedPersistentClientInstallCardv2",(()=>this._setProperty({dismissedPersistentClientInstallCardv2:!1})))}}const se=`${L.userSettingsPrefix}${L.userSettingsVersion}-`;class ne{static read(e){try{const t=`${se}${e}`;return b.OA.of(JSON.parse(String(M.Qh(t)[t])))}catch(e){return b.OA.of({})}}static write(e,t){M.V_(b.OA.of({[`${se}${e}`]:JSON.stringify(t)}))}}var re;!function(e){e.Mock=class{markFeatureOnboarded(e){throw new Error("Method not implemented.")}markNewsItemsAsSeen(e){return Promise.resolve()}getSurveyModel(){throw new Error("Method not implemented.")}setSurveyModel(){throw new Error("Method not implemented.")}updateSetGoalsLoader(e){return Promise.resolve()}ungatedRenewalNotificationSeen(){return Promise.resolve()}ungatedRenewalNotificationDismissed(){return Promise.resolve()}toggleMarkAsImportant(e,t){return Promise.resolve()}dismissAll(e){return Promise.resolve()}updateOnboardingPassed(e){return Promise.resolve()}incrementDunningDismissCount(){return Promise.resolve()}updateExitNotification(e){return Promise.resolve()}denaliWelcomeTourSeen(){return Promise.resolve()}markSignOutSurveySeen(){return Promise.resolve()}updateFooterCounterType(e){return Promise.resolve()}updateEditorPreferences(e){return Promise.resolve()}changePlanHookSeen(){return Promise.resolve()}markSafariExtNotificationSeen(){return Promise.resolve()}dismissChangePlanHook(){return Promise.resolve()}gbUpHookSeen(e){return Promise.resolve()}dismissGBUpHook(e){return Promise.resolve()}premiumPreviewUnderlinesSeen(){return Promise.resolve()}dismissGBBillingMigrationNotification(){return Promise.resolve()}supportUkraineCardSeen(){return Promise.resolve()}updateGetStartedChecklistSettings(e){return Promise.resolve()}updateGetStartedPremiumChecklistSettings(e){return Promise.resolve()}markPersistentClientInstallCardAsDismissed(){return Promise.resolve()}updateLlamaDiscoverabilitySettings(e){return Promise.resolve()}updateCheetahOnboardingState(){return Promise.resolve()}constructor(){(0,n._)(this,"footerCounterType",f.s.create(Z.wordsCount)),(0,n._)(this,"seenDenaliWelcome",f.s.create(!1)),(0,n._)(this,"seenSignOutSurvey",f.s.create(!1)),(0,n._)(this,"enableSetGoalsLoader",f.s.create(!0)),(0,n._)(this,"denaliLens",f.s.create({})),(0,n._)(this,"onboardingPassed",f.s.create(new Set)),(0,n._)(this,"cheetahOnboardingState",f.s.create(_.V.State.empty)),(0,n._)(this,"newsSeen",f.s.create(new Set)),(0,n._)(this,"showExitNotification",f.s.create(!0)),(0,n._)(this,"editorPreferences",f.s.create({autoScrollToNextAlert:w.none,fontSize:z.Normal,suggestionsVisualMode:X.Default})),(0,n._)(this,"changePlanHook",f.s.create({latestAppearances:[],latestDismissAt:w.none})),(0,n._)(this,"gbBannersUpHook",f.s.create({[K.smbSpecificProfessionalism]:{latestAppearances:[],latestDismissAt:w.none,dismissesCount:0},[K.styleGuides]:{latestAppearances:[],latestDismissAt:w.none,dismissesCount:0}})),(0,n._)(this,"dunningSettings",f.s.create({dunningDismissCount:0,latestDismissAt:w.none})),(0,n._)(this,"dunningStatus",f.s.create(C.Ie())),(0,n._)(this,"gbBillingMigrationSettings",f.s.create({latestDismissAt:w.none})),(0,n._)(this,"featuresOnboardingSeen",f.s.create(new Set)),(0,n._)(this,"ungatedRenewalNotificationSettings",f.s.create({wasDismissed:!1,latestAppearance:w.none})),(0,n._)(this,"ungatedTrialEndDate",f.s.create(w.none)),(0,n._)(this,"seenSafariExtNotification",f.s.create(!1)),(0,n._)(this,"supportUkraineCardAppearanceCount",f.s.create(0)),(0,n._)(this,"getStartedChecklistSettings",f.s.create({dismissal:w.none,completedItems:new Set})),(0,n._)(this,"getStartedPremiumChecklistSettings",f.s.create({dismissal:w.none,completedItems:new Set})),(0,n._)(this,"llamaDiscoverabilitySettings",f.s.create({modalDismissalTimestamp:w.none,bannerDismissalTimestamp:w.none})),(0,n._)(this,"dismissedPersistentClientInstallCardv2",f.s.create(!1))}}}(re||(re={}))},92676:(e,t,i)=>{i.d(t,{U:()=>m,d:()=>s});var s,n=i(83531),r=i(23988),o=i(24819),a=i(84712),l=i(1224),d=i(79937),c=i(48779),u=i(60080);!function(e){e.UNMOUNTED="UNMOUNTED",e.MOUNTED="MOUNTED",e.MOUNTING="MOUNTING",e.READY="READY",e.LOADING="LOADING",e.CANCEL="CANCEL",e.AUTHORIZED="AUTHORIZED",e.ERROR="ERROR"}(s||(s={}));const h=(e,t)=>new Promise(((i,s)=>e(t,((e,t)=>{if(Boolean(e))return s(e);i(t)}))));var p;!function(e){e.isBlockedPopupWarn=e=>/Can not open popup window - blocked/.test(e.message)}(p||(p={}));class _{constructor(e){(0,r._)(this,"_isPaymentSandbox",void 0),(0,r._)(this,"_log",void 0),(0,r._)(this,"_checkoutInstance",void 0),(0,r._)(this,"_state",void 0),(0,r._)(this,"state",void 0),(0,r._)(this,"_isUnmounted",void 0),(0,r._)(this,"teardown",void 0),(0,r._)(this,"_shouldBlockPayPal",void 0),(0,r._)(this,"init",void 0),this._isPaymentSandbox=e,this._log=l.Bx.Logging.getLogger("model.subscription.braintree.paypal"),this._state=a.s.create({kind:s.UNMOUNTED}),this.state=this._state,this._isUnmounted=()=>this._state.view((({kind:e})=>e===s.UNMOUNTED)).get(),this.teardown=()=>{Boolean(this._checkoutInstance)&&this._checkoutInstance.teardown(),this._state.set({kind:s.UNMOUNTED})},this._shouldBlockPayPal=()=>window.name.includes("xcomponent");var t,u=this;this.init=(t=(0,n._)((function*(e,t){if(u._state.set({kind:s.MOUNTING}),u._shouldBlockPayPal())return void u._state.set({kind:s.ERROR,error:"PayPal exploit detected",recoverable:!1});const{Paypal:n}=yield Promise.all([i.e(2074),i.e(5874)]).then(i.bind(i,68606));try{if(!u._isPaymentSandbox){const t=yield Promise.all([i.e(2074),i.e(5874)]).then(i.t.bind(i,76296,23));u._checkoutInstance=yield t.create({client:e})}}catch(e){u._state.set({kind:s.ERROR,error:e,recoverable:!1})}return n.Button.render({env:u._isPaymentSandbox?"sandbox":"production",style:{label:"paypal",size:"medium",shape:"pill",color:"gold"},validate:e=>{u._isPaymentSandbox?e.disable():e.enable(),u._state.set({kind:s.READY})},onClick:()=>{u._state.set({kind:s.LOADING}),u._isPaymentSandbox&&u._state.set({kind:s.AUTHORIZED,nonce:"fake-paypal-billing-agreement-nonce"})},payment:()=>u._checkoutInstance.createPayment({flow:"vault"}),onAuthorize:e=>(u._state.set({kind:s.LOADING}),u._checkoutInstance.tokenizePayment(e).then((e=>u._state.set({kind:s.AUTHORIZED,nonce:e.nonce}))).catch((e=>u._state.set({kind:s.ERROR,error:e,recoverable:!0})))),onCancel:()=>u._state.set({kind:s.CANCEL}),onError:e=>{u._isUnmounted()||(p.isBlockedPopupWarn(e)?u._log.error("Cannot open popup",e):u._state.set({kind:s.ERROR,error:e,recoverable:!0}))}},t).then((()=>{u._state.set({kind:s.MOUNTED})})).catch((e=>{u._isUnmounted()||u._state.set({kind:s.ERROR,error:e,recoverable:!1})}))})),function(e,i){return t.apply(this,arguments)}),this._state.pipe(d.n(c._F.rafScheduler)).subscribe((e=>{switch(this._log.debug("Paypal state changed",e),e.kind){case s.UNMOUNTED:case s.MOUNTING:case s.MOUNTED:break;case s.LOADING:this._log.info("Paypal button clicked");break;case s.AUTHORIZED:this._log.info("Paypal authorized"),this._state.set({kind:s.READY});break;case s.CANCEL:this._log.info("Paypal cancel"),this._state.set({kind:s.READY});break;case s.READY:break;case s.ERROR:e.recoverable?(this._log.warn("Paypal integration error, recoverable",e.error),this._state.set({kind:s.READY})):(this._log.error("Paypal integration error, fatal",e.error),this.teardown());break;default:(0,o.xb)(e)}}))}}class g{constructor(e){(0,r._)(this,"_notificationModel",void 0),(0,r._)(this,"_log",void 0),(0,r._)(this,"_teardownInProgress",void 0),(0,r._)(this,"_state",void 0),(0,r._)(this,"state",void 0),(0,r._)(this,"_hostedFields",void 0),(0,r._)(this,"updateCreditCard",void 0),(0,r._)(this,"init",void 0),(0,r._)(this,"teardown",void 0),this._notificationModel=e,this._log=l.Bx.Logging.getLogger("model.subscription.braintree.creditCard"),this._teardownInProgress=!1,this._state=a.s.create(s.UNMOUNTED),this.state=this._state,this.updateCreditCard=()=>new Promise(((e,t)=>{this._hostedFields.tokenize(((i,s)=>{if(Boolean(i)){const{fields:e}=this._hostedFields.getState();return Object.keys(e).forEach((t=>{e[t].isValid||e[t].container.classList.add("braintree-hosted-fields-invalid")})),void t(i)}return Boolean(s)||t(i),Object.keys(this._hostedFields.getState().fields).forEach((e=>this._hostedFields.clear(e))),e(s)}))})).then((e=>(this._log.info("CreditCard updated"),e))).catch((e=>{throw this._log.error("CreditCard error",e),e}));var t,o=this;this.init=(t=(0,n._)((function*(e,{styles:t,fields:n}){try{const r={client:e,styles:t,fields:n},a=yield Promise.all([i.e(2074),i.e(5874)]).then(i.t.bind(i,77697,23));o._hostedFields=yield h(a.create,r),o._state.set(s.MOUNTED),o._log.info("CreditCard fields initialized")}catch(e){if(Boolean(e)&&"HOSTED_FIELDS_INVALID_FIELD_SELECTOR"!==e.code)return;o._notificationModel.setNotification(u.d.unknownError)}})),function(e,i){return t.apply(this,arguments)}),this.teardown=()=>{try{if(this._notificationModel.clearNotification(),this._teardownInProgress)return;return this._teardownInProgress=!0,Boolean(this._hostedFields)?this._hostedFields.teardown((e=>{this._teardownInProgress=!1,Boolean(e)?this._log.error("Could not tear down Hosted Fields!",e):this._state.set(s.UNMOUNTED)})):this._hostedFields}catch(e){this._log.warn("Braintree teardown error",e)}}}}class m{_generateToken(){var e=this;return(0,n._)((function*(){const{token:t}=yield e._subscriptionApi.generateClientToken();return t}))()}constructor(e,t,s){(0,r._)(this,"_notificationModel",void 0),(0,r._)(this,"_subscriptionApi",void 0),(0,r._)(this,"_isPaymentSandbox",void 0),(0,r._)(this,"_creditCard",void 0),(0,r._)(this,"_paypal",void 0),(0,r._)(this,"_braintreeClient",void 0),(0,r._)(this,"updateCreditCard",void 0),(0,r._)(this,"creditCardState",void 0),(0,r._)(this,"paypalState",void 0),(0,r._)(this,"init",void 0),(0,r._)(this,"teardown",void 0),(0,r._)(this,"_getBraintreeClient",void 0),this._notificationModel=e,this._subscriptionApi=t,this._isPaymentSandbox=s,this._creditCard=new g(this._notificationModel),this._paypal=new _(this._isPaymentSandbox),this.updateCreditCard=this._creditCard.updateCreditCard,this.creditCardState=this._creditCard.state,this.paypalState=this._paypal.state;var o,a=this;this.init=(o=(0,n._)((function*(e,t){a._notificationModel.clearNotification();const i=yield a._getBraintreeClient();a._creditCard.init(i,t),a._paypal.init(i,e)})),function(e,t){return o.apply(this,arguments)}),this.teardown=()=>{this._paypal.teardown(),this._creditCard.teardown()};var l=this;this._getBraintreeClient=(0,n._)((function*(){const e=yield Promise.all([i.e(2074),i.e(5874)]).then(i.t.bind(i,10871,23));if(Boolean(l._braintreeClient))return l._braintreeClient;const t=yield l._generateToken(),s=yield h(e.create,{authorization:t});return l._braintreeClient=s,s}))}}},40464:(e,t,i)=>{i.d(t,{E2:()=>I,H0:()=>M,n6:()=>U});var s=i(83531),n=i(23988),r=i(10334),o=i(17171),a=i(65390),l=i(94855),d=i(84647),c=i(95934),u=i(58508),h=i(84712),p=i(88607),_=i(1224),g=i(18810),m=i(73328),f=i(66202),v=i(5500),y=i(5692),b=i(79937),S=i(48779),w=i(91745),k=i(25093),P=i(7149),x=i(3016),C=i(28243),D=i(34553),E=i(75248),T=i(8094),A=i(92676),O=i(60080);const U=y.j.defaultValue(),I=c.E$([p.it.codec,c.NW({plans:c.YO(p.yB.codec),proPlans:c.YO(p.yB.codec),referralInfo:p.SK.codec}),c.OH({nextPayDate:c.Yj,currentPlan:p.yB.codec,expirationDate:c.Yj})]);class M{dispose(){this._subs.dispose()}clearNotification(){this._notification.set(null)}navigateToSubscribeUrl(){document.location.href=this._config.funnel.subscribe}navigateToUpgradeUrl(e,t,i){(0,d.pipe)(i,a.fold((()=>m.zb((()=>this._upgradeHook.fromHome(e,t)))),(e=>f.right(new g.U(e)))),f.chain(this._platformEnvironment.actions.openUrl),f.getOrElse((e=>this._log.fatal("unexpected error on open upgrade page",e))))}renew(){var e=this;return(0,s._)((function*(){yield e._subscriptionApi.renewSubscription(),e._reloadSubscription()}))()}changePlan(e){var t=this;return(0,s._)((function*(){yield t._subscriptionApi.changePlan(e),t._reloadSubscription()}))()}getPlans(){var e=this;return(0,s._)((function*(){return e._reloadSubscription(),e.state.pipe(b.n(S._F.rafScheduler),w.p(y.j.isOk),k.$(),P.T((e=>e.value)),P.T((e=>e.plans||[]))).toPromise()}))()}_reloadSubscription(){this._subscriptionTrigger.next()}_loadVitoPlans(e){this._vitoClient.getPlans(e).then(this._vitoPlansToSpecialOffersEligibility).then(S.H9(this._specialOffersEligibilityWithPlans)).catch((()=>S.H9(this._specialOffersEligibilityWithPlans)(this._defaultSpecialOffersEligibilityWithPlans)))}_vitoPlansToSpecialOffersEligibility(e){return T.uJ.reduce(((t,i)=>{var s,n,r;return t[i]=(null===(r=e)||void 0===r||null===(n=r.plansBySpecialOffer)||void 0===n||null===(s=n[i])||void 0===s?void 0:s.length)?{name:`${i}`,isEligible:!0,plans:e.plansBySpecialOffer[i]}:{isEligible:!1},t}),Object.assign({}))}get _defaultSpecialOffersEligibilityWithPlans(){return this._vitoPlansToSpecialOffersEligibility(void 0)}constructor(e,t,i,s,a,c,p){var g,m;(0,n._)(this,"_state",void 0),(0,n._)(this,"_subscriptionApi",void 0),(0,n._)(this,"_config",void 0),(0,n._)(this,"_platformEnvironment",void 0),(0,n._)(this,"_upgradeHook",void 0),(0,n._)(this,"_isPaymentSandbox",void 0),(0,n._)(this,"_vitoClient",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"_subs",void 0),(0,n._)(this,"_notification",void 0),(0,n._)(this,"_getSubscription",void 0),(0,n._)(this,"_subscriptionTrigger",void 0),(0,n._)(this,"_specialOffersEligibilityWithPlans",void 0),(0,n._)(this,"state",void 0),(0,n._)(this,"braintreeApi",void 0),(0,n._)(this,"setNotification",void 0),this._state=e,this._subscriptionApi=t,this._config=i,this._platformEnvironment=s,this._upgradeHook=a,this._isPaymentSandbox=c,this._vitoClient=p,this._log=_.Bx.Logging.getLogger("model.subscription"),this._subs=new x.y.Keeper,this._notification=h.s.create(null),this._getSubscription=C.l((0,l.TX)((()=>Promise.all([this._subscriptionApi.getStatus(),this._subscriptionApi.getReferralInfo()]).then((([e,t])=>(0,o._)((0,r._)({},e),{plans:null!==(g=e.plans)&&void 0!==g?g:[],proPlans:null!==(m=e.proPlans)&&void 0!==m?m:[],referralInfo:t}))).then((e=>{var t;return this._loadVitoPlans(null!==(t=e.countryCode)&&void 0!==t?t:"US"),e}))),d.unsafeCoerce),[(0,u.Oh)(3),B(1e3)],(e=>!("code"in e)||401!==e.code)),this._subscriptionTrigger=new D.B,this._specialOffersEligibilityWithPlans=this._state.lens("specialOffersEligibilityWithPlans"),this.state=this._state.lens("subscription"),this.braintreeApi=new A.U(this,this._subscriptionApi,this._isPaymentSandbox),this.setNotification=(e,t)=>{requestAnimationFrame((()=>this._notification.set({type:e,planName:t})))},this._subs.push(this._subscriptionTrigger.pipe(E.K(this._getSubscription),w.p((e=>!(v.LT(e)&&y.j.isError(this.state.get())))),P.T(y.j.fromRD)).subscribe(S.H9(this.state)),this.state.subscribe((e=>{y.j.isError(e)&&1===e.attempt?this._log.warn("cant get user subscription",e.error):y.j.isFatal(e)&&(this._log.error("cant get user subscription",e.error),this.setNotification(O.d.unknownError))}))),y.j.isOk(this.state.get())||this._reloadSubscription()}}const B=e=>t=>a.some(t.iterNumber*e)},60080:(e,t,i)=>{var s;i.d(t,{d:()=>s}),function(e){e[e.updateBilling=0]="updateBilling",e[e.paymentError=1]="paymentError",e[e.subscriptionUpdated=2]="subscriptionUpdated",e[e.subscriptionCancelled=3]="subscriptionCancelled",e[e.cantUpgradeSubscription=4]="cantUpgradeSubscription",e[e.resumedSubscription=5]="resumedSubscription",e[e.cantResumeSubscription=6]="cantResumeSubscription",e[e.unknownError=7]="unknownError",e[e.unknownOrigin=8]="unknownOrigin",e[e.blobDownloadUnsupported=9]="blobDownloadUnsupported",e[e.mobileCancel=10]="mobileCancel",e[e.paypalSuccess=11]="paypalSuccess",e[e.paypalError=12]="paypalError"}(s||(s={}))},1424:(e,t,i)=>{i.d(t,{Y:()=>s});var s,n=i(23988),r=i(65390),o=i(84647),a=i(52839),l=i(96509),d=i(24819),c=i(30595),u=i(1224),h=i(18810),p=i(73328),_=i(66202),g=i(32102),m=i(74056),f=i(67034),v=i(92622),y=i(37107);!function(e){let t;!function(e){let i,s,n;!function(e){e.editorMenu="editorMyGrammarly",e.editorReferrals="editorReferrals",e.editorMenuBusiness="editorBusinessHomePageMenu"}(i=e.Home||(e.Home={})),e.isHome=function(e){return Object.values(t.Home).some((t=>t===e))},function(e){e.editorDenaliAdvanced="editorAdvancedIssues",e.editorDenaliDelivery="editorDeliveryTooltip",e.editorDenaliEngagement="editorEngagementTooltip",e.editorDenaliPlagiarism="editorPlagiarismTooltip",e.editorDenaliProofit="editorProofreadingTooltip",e.editorDenaliOverview="editorDenaliOverview",e.editorDenaliGoals="editorDenaliGoals",e.editorDenaliDocumentSettings="editorDenaliDocumentSettings",e.editorDenaliUpgradeInline="editorDenaliUpgradeInline",e.editorDenaliChecksFeed="editorDenaliChecksFeed",e.oggyPlagiarismUphook="oggyPlagiarismUphook",e.oggyBlurredSuggestion="oggyBlurredSuggestion"}(s=e.DenaliDocument||(e.DenaliDocument={})),function(e){e.gdocsSidebarCardList="gdocsSidebarCardList",e.gdocsSidebarSuccessView="gdocsSidebarSuccessView",e.gdocsGoals="gdocsGoals",e.assistantCardList="assistantCardList",e.extensionSettingsAssistant="extensionSettingsAssistant"}(n=e.Extension||(e.Extension={}))}(t=e.Place||(e.Place={}));class i{fromHome(e,t,i,n){return e===s.Place.Home.editorMenuBusiness?this._businessHook(i,n):this._from(e,t).addParams({upgradeFrom:this._env.names.funnel})}fromDenaliDocumentToPlans(e,t,s,n,r,a){const l=this._from(e,s).addParams({doc_id:t,upgradeFrom:this._env.names.funnel});return(0,o.pipe)(p.zb((()=>{const e=r?g.Q.prism.reverseGet(r.get()):0;return e>5?l.addParams({plagiarism:e.toString()}):l})),_.mapLeft((e=>this._log.error("can not append plagiarismPercent",e))),_.chain((e=>(0,o.pipe)(p.zb((()=>e.addParams(i._encodeLensedAlerts(n)))),_.mapLeft((e=>this._log.error("can not append encoded alertsByLenses",e)))))),_.chain((e=>(0,o.pipe)(p.zb((()=>a?e.addParams({[f.PX]:f.zS}):e)),_.mapLeft((e=>this._log.error("can not append encoded px param",e)))))),_.getOrElse((()=>l)))}fromDenaliDocumentToUpgrade(e,t,i){return this._from(e,i).addParams({doc_id:t,redirectUphookToUpgradePageExp:"1",upgrade:"1"})}fromDenaliDocumentToUpgradeTry(e,t,i){const s=this._from(e,i).addParams({doc_id:t,redirectUphookToUpgradePageExp:"1"});return new h.U(this._config.funnel.upgradeTry,s.params)}fromGbUpHookNotification(e){return new h.U(e===y.CH.styleGuides?this._config.funnel.businessStyleguideLanding:this._config.funnel.businessLanding).addParams(i._hookMeta).addParams({utm_campaign:"webEditorDocumentPopupGBp",utm_content:e})}fromGrammarlyGO(){return new h.U(this._config.funnel.plans).addParams(i._hookMeta).addParams({utm_campaign:"webEditorGrammarlyGoPrompts"})}fromGbVoxUpHookLens(){return new h.U(this._config.funnel.businessStyleguideLanding).addParams(i._hookMeta).addParams({utm_campaign:"gbDenaliVoxLens"})}_businessHook(e,t){const s=this._userType.get(),{plans:n,businessUpgradeLanding:r}=this._config.funnel,o=!0===t?r:n;return new h.U(o).addParams(i._hookMeta).addParams(i._encodeBusinessPlatform(s,this._env.platform)).addParams({utm_content:e})}_from(e,t){const s=new h.U(this._config.api.redirect).addParams({page:"free",hash:a(this._userId.get()),app_type:i._getAppType(this._env.platform)}).addParams(i._hookMeta).addParams((0,o.pipe)(t,r.filter((e=>"discountPro"===e)),r.fold((()=>i._encodePlace(e,this._env.platform)),(()=>({utm_campaign:`editor_${(0,c.PT)(e)}_discountPro`})))));return(0,o.pipe)(t,r.map((e=>s.addParams(i._variant(e)))),r.getOrElse((()=>s)))}static _getAppType(e){switch(e){case m.OH.Platform.DEMOEDITOR:case m.OH.Platform.WEB:case m.OH.Platform.IPAD:case m.OH.Platform.MACEDITOR:case m.OH.Platform.AISTUDIO:return"app";default:return(0,d.xb)(e)}}static _encodePlace(e,i){return e===t.DenaliDocument.oggyPlagiarismUphook?{utm_campaign:`${i}Editor_plagiarism_plagiarismView_premium`}:{utm_campaign:`${i}${(0,c.PT)(e)}`}}static _variant(e){return{utm_variant:e}}static _encodeBusinessPlatform(e,t){return{utm_campaign:`${t}EditorMyGrammarlyGB${e===v.ut.free?"f":"p"}`}}static _encodeLensedAlerts(e){return e.forEach((e=>{(0,d.V1)(3===Object.keys(e).length,"alert group should have exactly 3 keys",(()=>JSON.stringify(e)))})),{lensedAlerts:this._compress(e)}}static _compress(e){const t=l.compressToEncodedURIComponent(JSON.stringify(e));return(0,d.V1)(t.length<1500,"serialized data exceeded allowed size",(()=>JSON.stringify({size:t.length,data:e}))),t}constructor(e,t,i,s){(0,n._)(this,"_config",void 0),(0,n._)(this,"_env",void 0),(0,n._)(this,"_userId",void 0),(0,n._)(this,"_userType",void 0),(0,n._)(this,"_log",void 0),this._config=e,this._env=t,this._userId=i,this._userType=s,this._log=u.Bx.Logging.getLogger("model.UpgradeHook")}}(0,n._)(i,"_hookMeta",{utm_medium:"internal",utm_source:"upHook"}),e.Impl=i,e.Mock=class{fromHome(e){throw new Error("Method not implemented.")}fromDenaliDocumentToPlans(){throw new Error("Method not implemented.")}fromDenaliDocumentToUpgrade(e,t){throw new Error("Method not implemented.")}fromDenaliDocumentToUpgradeTry(e,t){throw new Error("Method not implemented.")}fromGbUpHookNotification(e){throw new Error("Method not implemented.")}fromGbVoxUpHookLens(){throw new Error("Method not implemented.")}fromGrammarlyGO(){throw new Error("Method not implemented.")}}}(s||(s={}))},8094:(e,t,i)=>{i.d(t,{DI:()=>p,Jd:()=>_,WG:()=>m,nm:()=>g,uJ:()=>h,y9:()=>f});var s=i(83531),n=i(23988),r=i(70238),o=i(1224),a=i(72094),l=i(48581),d=i(704),c=i(34681),u=i(80029);const h=["pro_free_trial","in_product_discount_pro"],p={isEligible:!1},_={in_product_discount_pro:!1,pro_free_trial:!1},g={in_product_discount_pro:{isEligible:!1},pro_free_trial:{isEligible:!1}};class m{_vitoResponseToSpecialOffersEligibility(e){return h.reduce(((t,i)=>{var s,n,r;return t[i]=null!==(r=null===(n=e)||void 0===n||null===(s=n[i])||void 0===s?void 0:s.eligibility)&&void 0!==r&&r,t}),Object.assign({}))}getProFreeTrialEligibility(){var e,t,i;return this._eligibilitySpecialOffers&&this._eligibilitySpecialOffers.pro_free_trial&&this._eligibilitySpecialOffers.pro_free_trial.eligibility?{name:"pro_free_trial",isEligible:!0,plans:null!==(i=null===(t=this._plansBySpecialOffers)||void 0===t||null===(e=t.plansBySpecialOffer)||void 0===e?void 0:e.pro_free_trial)&&void 0!==i?i:[]}:{isEligible:!1}}_parseHTTPError(e){return(0,s._)((function*(){if("response"in e&&e.response instanceof Response){const{response:t}=e;return new r.Hl({code:t.status,status:t.statusText,url:t.url,body:yield t.text()})}}))()}constructor(e){(0,n._)(this,"_fingerprints",void 0),(0,n._)(this,"_vitoClient",void 0),(0,n._)(this,"_eligibilitySpecialOffers",void 0),(0,n._)(this,"_plansBySpecialOffers",void 0),(0,n._)(this,"_initVitoClient",void 0),(0,n._)(this,"getPlans",void 0),(0,n._)(this,"requestSpecialOffersEligibility",void 0),this._fingerprints=e;var t=this;this._initVitoClient=(0,s._)((function*(){const e=yield(0,c.r)(t._fingerprints)(),i=new a.Configuration({basePath:(0,u.W)().api.vito,fetchApi:l.pM.request({target:"vito",cache:"default"}),headers:{"X-CSRF-Token":e["X-CSRF-Token"],"X-Container-Id":e["X-Container-Id"],"X-Client-Version":e["X-Client-Version"],"X-Client-Type":e["X-Client-Type"]},credentials:"include"});t._vitoClient=new a.VitoApi(i)}));var i,r=this;this.getPlans=(i=(0,s._)((function*(e){r._vitoClient||(yield r._initVitoClient());try{return o.Bx.TimeSeries.rootFemetrics.getMetric(d.bV.Metrics.PlansBySpecialOffer).getCounter(d.bV.MetricsActions.RequestAttemptsTotal).increment(),r._plansBySpecialOffers=yield r._vitoClient.plansGet({countryCode:e,specialOffers:[...h]}),o.Bx.TimeSeries.rootFemetrics.getMetric(d.bV.Metrics.PlansBySpecialOffer).getCounter(d.bV.MetricsActions.RequestSuccessTotal).increment(),r._plansBySpecialOffers}catch(t){o.Bx.Logging.getLogger("VitoService").error(`Plans by Special offer request failed: country code: ${e}, special offers: ${h.join(", ")}`,t),o.Bx.TimeSeries.rootFemetrics.getMetric(d.bV.Metrics.PlansBySpecialOffer).getCounter(d.bV.MetricsActions.RequestFailuresTotal).increment();const i=yield r._parseHTTPError(t);throw null!=i?i:t}})),function(e){return i.apply(this,arguments)});var p=this;this.requestSpecialOffersEligibility=function(){var e=(0,s._)((function*(e){p._vitoClient||(yield p._initVitoClient());try{return o.Bx.TimeSeries.rootFemetrics.getMetric(d.bV.Metrics.SpecialOfferEligibility).getCounter(d.bV.MetricsActions.RequestAttemptsTotal).increment(),p._eligibilitySpecialOffers=yield p._vitoClient.specialOffersGet({names:e}),o.Bx.TimeSeries.rootFemetrics.getMetric(d.bV.Metrics.SpecialOfferEligibility).getCounter(d.bV.MetricsActions.RequestSuccessTotal).increment(),p._vitoResponseToSpecialOffersEligibility(p._eligibilitySpecialOffers)}catch(t){throw o.Bx.Logging.getLogger("VitoService").error(`Special offer eligibility request failed: ${e}`,t),o.Bx.TimeSeries.rootFemetrics.getMetric(d.bV.Metrics.SpecialOfferEligibility).getCounter(d.bV.MetricsActions.RequestFailuresTotal).increment(),t}}));return function(t){return e.apply(this,arguments)}}(),this._initVitoClient()}}var f;!function(e){e.toIndividualPaymentPlan=e=>({id:e.id,title:e.title,periodMonths:e.periodMonths,price:e.priceMoney,trialDays:e.trialDays,regularPlanId:e.regularPlanId,regularPrice:e.regularPriceMoney,renewalPlanId:e.renewalPlanId,renewalPrice:e.renewalPriceMoney}),e.toInstitutionalPaymentPlan=e=>({id:e.id,title:e.title,description:e.description,periodMonths:e.periodMonths,price:e.price,priceMoney:e.priceMoney,regularPlanId:e.regularPlanId,regularPrice:e.regularPrice,regularPriceMoney:e.regularPriceMoney,hasTrial:e.hasTrial,trialDays:e.trialDays}),e.Mock=class{constructor(){(0,n._)(this,"requestSpecialOffersEligibility",Promise.resolve),(0,n._)(this,"getPlans",Promise.resolve),(0,n._)(this,"getProFreeTrialEligibility",(()=>p))}}}(f||(f={}))},70932:(e,t,i)=>{i.d(t,{l:()=>d});var s=i(85886),n=i(1224),r=i(20408),o=i(74056),a=i(93712),l=i(22068);const d=()=>{const e=(0,o.W$)(new a.Qt).base.error500page,t=s.useContext(r._.Context),i=e.description(t.support.troubleshooting.diagnosticTestPath,t.support.troubleshooting.somethingWentWrong);return n.Bx.TimeSeries.rootFemetrics.getMetric("error").getCounter("500").increment(),s.createElement(l.M,{title:e.title,description:i})}},6832:(e,t,i)=>{i.d(t,{RV:()=>l,fe:()=>r,iy:()=>d});var s=i(83531),n=i(52839);function r(e){return"isAiEditorDocument"in e&&!0===e.isAiEditorDocument}function o(){if("string"==typeof window.location.hostname){if(window.location.hostname.endsWith(".grammarly.com"))return"https://docs-uxr.grammarly.com";if(window.location.hostname.endsWith(".ppgr.io"))return"https://docs-uxr.ppgr.io";if(window.location.hostname.endsWith(".qagr.io"))return"https://docs-uxr.qagr.io"}return"https://docs-uxr.grammarly.com"}function a(){const e=document.cookie.split(";");for(let t=0;t<e.length;t++){const i=e[t].trim();if(i.startsWith("csrf_token="))return i.substring(11)}return""}function l(e){const t=`aie-pf-${n(e)}`,i=`${o()}/newdoc/Untitled%20doc?folderId=${t}&schemaVersion=10000`;window.location.href=i}function d(e){return c.apply(this,arguments)}function c(){return(c=(0,s._)((function*(e){try{const t=`aie-pf-${n(e)}`,i=`${o()}/internalAppApi/doclist/recent?pageToken=0&limit=100&folderId=${t}&numMemberWorkspaces=2&sortOrder=modified&viewType=FOLDER`,s=yield fetch(i,{headers:{"x-csrf-token":a()},credentials:"include"});return(yield s.json()).items.map((e=>({isAiEditorDocument:!0,id:e.docId,title:e.title,firstContent:"",updatedAt:new Date(e.lastActivityTimestamp),size:42,openDocumentLink:`${o()}/d/_d${e.docId}`})))}catch(e){return[]}}))).apply(this,arguments)}},39982:(e,t,i)=>{i.d(t,{j:()=>s});var s,n=i(10334),r=i(17171),o=i(65390),a=i(84647),l=i(40086),d=i(39812);!function(e){let t,i,s,c,u,h,p,_;function g(e){return e.status===l.c.JobStatus.building||e.status===l.c.JobStatus.newJob}!function(e){e.new="new",e.loading="loading",e.existing="existing",e.deleted="deleted",e.group="group"}(t=e.Kind||(e.Kind={})),function(e){e.todayDocs="todayDocs",e.yesterdayDocs="yesterdayDocs",e.earlierDocs="earlierDocs"}(i=e.Group||(e.Group={})),function(e){e.create=()=>({kind:t.new})}(s=e.New||(e.New={})),function(e){e.create=()=>({kind:t.loading})}(c=e.Loading||(e.Loading={})),function(e){e.create=e=>({kind:t.group,group:e})}(u=e.GroupItem||(e.GroupItem={})),function(e){e.create=(e,i=o.none)=>_.create(t.existing)(e,i)}(h=e.Existing||(e.Existing={})),function(e){e.create=(e,i=o.none)=>_.create(t.deleted)(e,i)}(p=e.Deleted||(e.Deleted={})),function(e){e.create=e=>(t,i=o.none)=>{const s=o.fromNullable(t.proofit);return{kind:e,document:t,groupStarter:i,proofit:{result:s,inProgress:(0,a.pipe)(s,o.exists(g))}}},e.updateProofit=e=>t=>{const i=(0,a.pipe)(t,o.alt((()=>e.proofit.result)));return(0,r._)((0,n._)({},e),{proofit:{result:i,inProgress:(0,a.pipe)(i,o.exists(g))}})},e.getDestination=e=>d.Lz.routes.denali_editor.href({docId:e.document.id.toString()})}(_=e.WithDocument||(e.WithDocument={})),e.isNew=e=>e.kind===t.new,e.isLoading=e=>e.kind===t.loading,e.isExisting=e=>e.kind===t.existing,e.isDeleted=e=>e.kind===t.deleted,e.isGroup=e=>e.kind===t.group,e.isProofitInProgress=g,e.isProofitCompleted=function(e){return e.status===l.c.JobStatus.completed},e.isProofitCancelled=function(e){return e.status===l.c.JobStatus.cancelled}}(s||(s={}))},704:(e,t,i)=>{var s,n,r;i.d(t,{PP:()=>s,bV:()=>n,cA:()=>r}),function(e){let t,i,s,n,r;!function(e){e.GetPremiumButton="get_premium_button",e.DryRunUphook="dry_run_uphook"}(t=e.Metrics||(e.Metrics={})),function(e){e.Click="clicks",e.Show="shows",e.Dismiss="dismisses"}(i=e.MetricsActions||(e.MetricsActions={})),function(e){e.AdvancedIssues="advancedIssues",e.Tooltip="tooltip",e.Navigation="navigation"}(s=e.UpgradeHookName||(e.UpgradeHookName={})),function(e){e.Assistant="assistant",e.Sidebar="sidebar",e.PlagiarismTooltip="plagiarismTooltip",e.ProofreadingTooltip="proofreadingTooltip"}(n=e.UpgradeHookSlot||(e.UpgradeHookSlot={})),function(e){e.premium="premium",e.premiumTrial="premiumTrial",e.pro="pro",e.discountPro="discountPro",e.discountPremium="discountPremium"}(r=e.UpgradeHookVariant||(e.UpgradeHookVariant={}))}(s||(s={})),function(e){let t,i;!function(e){e.SpecialOfferEligibility="special_offer_eligibility",e.PlansBySpecialOffer="plans_by_special_offer"}(t=e.Metrics||(e.Metrics={})),function(e){e.RequestAttemptsTotal="request_attempts_total",e.RequestSuccessTotal="request_success_total",e.RequestFailuresTotal="request_failures_total"}(i=e.MetricsActions||(e.MetricsActions={}))}(n||(n={})),function(e){let t,i;!function(e){e.InProductReactivation="in_product_reactivation"}(t=e.Metrics||(e.Metrics={})),function(e){e.Hover="hovered",e.Show="shown"}(i=e.MetricsActions||(e.MetricsActions={}))}(r||(r={}))},55559:(e,t,i)=>{i.d(t,{Y:()=>s});var s,n=i(85886),r=i(66202),o=i(84647),a=i(39212),l=i.n(a),d=i(83932),c=i(30595);function u(e=o.constVoid){return new Proxy({},{get:()=>(...t)=>e(t)})}!function(e){var t=e.Context=n.createContext(d.o.invariantContent("Telemetry.Context")),i=e.createPageSessionId=()=>(0,c.G7)(10),s=e.ContextProvider=e=>n.createElement(t.Provider,{value:Object.create({},{gnarSpec:{get:()=>e.gnarSpec},pageId:{get:()=>e.pageId},pageSessionId:{get:()=>e.pageSessionId},docId:{get:()=>{if(null!=e.docId)return e.docId;throw new Error("docId is not specified. Please provide it thru the PageContextProvider")}},isTouchDevice:{get:()=>(0,o.pipe)(r.tryCatch(l(),r.toError),r.getOrElse((()=>!1)))}})},n.Children.only(e.children));e.ContextProviderInherited=e=>n.createElement(t.Consumer,null,(i=>n.createElement(t.Provider,{value:Object.create({},{gnarSpec:{get:()=>i.gnarSpec},pageId:{get:()=>Boolean(e.pageId)?e.pageId:i.pageId},pageSessionId:{get:()=>i.pageSessionId},docId:{get:()=>Boolean(e.docId)?e.docId:i.docId},isTouchDevice:{get:()=>(0,o.pipe)(r.tryCatch(l(),r.toError),r.getOrElse((()=>!1)))}})},n.Children.only(e.children)))),e.ContextProviderMock=e=>n.createElement(s,{gnarSpec:u(),pageId:Boolean(e.pageId)?e.pageId:"mockPageId",pageSessionId:i(),docId:Boolean(e.docId)?e.docId:"mockDocId"},e.children)}(s||(s={}))},31373:(e,t,i)=>{i.d(t,{J:()=>o,m:()=>a});var s=i(65390),n=i(84647),r=i(71301);function o(e){const t=r.Yr.daysAgo(r.Yr.now(),16);return(0,n.pipe)(e.latestDismissAt,s.fold((()=>!0),(e=>e.getTime()<t)))}function a(e){if(o(e))return!0;const t=r.Yr.daysAgo(r.Yr.now(),1);return e.dunningDismissCount<14&&(0,n.pipe)(e.latestDismissAt,s.fold((()=>!0),(e=>e.getTime()<t)))}}}]);