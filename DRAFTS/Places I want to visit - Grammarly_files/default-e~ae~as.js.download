"use strict";(self.webpackChunk_grammarly_denali_app=self.webpackChunk_grammarly_denali_app||[]).push([[4746],{59815:(e,t,i)=>{i.d(t,{_:()=>n,q:()=>s});var n,s,o=i(84647),a=i(65390),r=i(84712),l=i(42902),d=i(5692),c=i(95008);!function(e){e.defaultInitialState={userAccount:null},e.defaultState=e=>({authentication:e.userAccount?d.j.ok(e.userAccount):c.n6,userAccount:e.userAccount,online:!0})}(n||(n={})),function(e){e.create=()=>{const e=r.s.create(n.defaultState(n.defaultInitialState)),t=(0,o.pipe)(location.search,a.fromPredicate((e=>e.startsWith("?"))),a.getOrElse((()=>"")));return{appState:e,query:new l.L(t)}}}(s||(s={}))},86780:(e,t,i)=>{i.d(t,{l:()=>d});var n=i(1224),s=i(10479),o=i(53354),a=i(79937),r=i(47456),l=i(74056);function d(e,t){const i=t.has(l.OH.Flag.useSetDataOnCopy);return(t,l)=>s.H(o.B.copy(t,i)).pipe(a.n((()=>e.enqueue("copySuccess",{copyType:l}))),r.W((t=>(o.B.copyApiAvailable.next(!1),n.Bx.Logging.getLogger("clipboard").warn("Copy to clipboard failed",t),e.enqueue("copyToClipboardFailed"))))).toPromise()}},58251:(e,t,i)=>{i.d(t,{c:()=>A});var n=i(84647),s=i(82498),o=i(63404),a=i(915),r=i(77821),l=i(64345),d=i(21317),c=i(91597),p=i(32112),h=i(83407),u=i(76005),g=i(65873),m=i(78590),_=i(94808),v=i(82874),f=i(40857),y=i(3656),b=i(17559),S=i(74056),w=i(98719),C=i(37107),k=i(80548),M=i(68703),E=i(92444),T=i(19178),x=i(11526),I=i(31486);const A=(e,t,i,A)=>{const F=i.rtfMode===w.jj.l1.FormattingMode.on,V=t.has(S.OH.Flag.pasteAsPlainTextInSafariFromMSWord)?[u.j1.MSWord]:[],L=l.A;L.className=E.x.rtfLink;const O=[d.A,L,a.A,s.A,r.A,c.A,o.A];return new _.W({modules:{history:f.U,clipboard:(0,v.g)(F,V),keyboard:y.TV.getKeyboardWithBindings(F?y.TV.Bindings.rtfBindings:y.TV.Bindings.plainTextBindings),marks:b.O},formats:O},A,F?m.pR.QuillFormatNames.is:p.E.skipAny,p.E.skipAny,{classes:e.settings.editorPreferences.view((({fontSize:e,suggestionsVisualMode:i})=>{const s=(0,T.o)(i),o=t.has(S.OH.Flag.highHighlights)?s.markHeightTall:void 0;return{containerClass:(0,n.pipe)(e,C.Z4.match("",E.x.bigSize),(e=>(0,h.Ly)(e,g.iF.paper,E.x.editorContainer))),markClassesTheme:s,markExtraClass:o,editorContainer:E.x.editorContainer}})),freezeFocusFeature:!0,allowNavigationTo:e=>M.LT.isSearchInput(e)||x.t.isTitleInput(e)||k.k.isInlineCard(e)||I.TL.isInsideCheetahView(e)})}},82971:(e,t,i)=>{i.d(t,{G:()=>n});var n,s=i(10334),o=i(17171),a=i(84647);!function(e){let t;!function(e){e.Dropzone="Dropzone",e.CheckoutSidebar="CheckoutSidebar",e.StartupManager="StartupManager",e.ProofitModals="ProofitModals",e.BlockUnsavedChanges="BlockUnsavedChanges",e.DocumentToolbar="DocumentToolbar",e.EditorFooter="EditorFooter",e.PersistentClientInstallSidebar="PersistentClientInstallSidebar"}(t=e.Slot||(e.Slot={}));var i=e.empty=Object.values(t).reduce(((e,t)=>(0,o._)((0,s._)({},e),{[t]:a.constNull})),{});e.fillSlot=(e,t)=>(n=i)=>(0,o._)((0,s._)({},n),{[e]:t})}(n||(n={}))},72613:(e,t,i)=>{i.d(t,{A:()=>$});var n=i(23988),s=i(85886),o=i(66202),a=i(65390),r=i(84647),l=i(56855),d=i(84712),c=i(1224),p=i(83404),h=i(74393),u=i(38299),g=i(92109),m=i(11864),_=i(19772),v=i(7149),f=i(30343),y=i(79937),b=i(83694),S=i(39812),w=i(99339),C=i(25093),k=i(93432),M=i(99010),E=i(5406),T=i(55559),x=i(74056),I=i(46953),A=i(41432),F=i(82805),V=i(686),L=i(77205),O=i(96702),B=i(24934),R=i(56062),U=i(92824);const N=m.Ks.style({width:m.Ks.rem(10),height:m.Ks.rem(2),position:"absolute",top:m.Ks.rem(1.875),left:m.Ks.rem(2.5)}),P=m.Ks.style({fontSize:m.Ks.important(m.Ks.rem(2.625)),lineHeight:m.Ks.important(m.Ks.rem(3.5))}),D=m.Ks.style({alignSelf:m.Ks.important("center")}),H=({name:e,illustration:t,title:i,description:n,primaryButton:o,secondaryButton:a})=>s.createElement(V.s,{direction:"column",align:"center",justify:"center",paddingBottom:20,"data-name":e,width:"100vw",height:"var(--100vh)",bgColor:"background-base-subdued",gap:8},s.createElement(L.I,{icon:O.e,accessibilityLabel:"Go to My Grammarly",size:"large",className:N}),s.createElement(V.s,null,t),s.createElement(V.s,{direction:"column",align:"center",justify:"center"},s.createElement(B.D,{as:"h1",className:P},i),s.createElement(R.E,{as:"p",color:"base-subdued",variant:"text-large"},n)),s.createElement(U.$,{"data-name":"primary-button",variant:"primary",size:"xlarge",className:D,onClick:o.onClick},o.title),a&&s.createElement(U.$,{variant:"secondary",name:"secondary-button",onClick:a.onClick,className:D},a.title)),K=()=>{const e=s.useContext(S.Lz.Context);return s.createElement(H,{name:"doc-not-found",illustration:s.createElement(W,null),title:"Can’t find this document",description:"It looks like this document was removed or URL is incorrect.",primaryButton:{title:"Go to your documents",onClick:()=>e.navigateAndReload(S.Lz.routes.documents.href())}})},W=({className:e})=>s.createElement("svg",{"aria-hidden":!0,width:"194",height:"128",viewBox:"0 0 194 128",className:e},s.createElement("g",{fill:"none",fillRule:"evenodd"},s.createElement("path",{d:"M44 40h64c2.2 0 4 1.8 4 4v80c0 2.2-1.8 4-4 4H45c-2.76 0-5-2.24-5-5V44c0-2.2 1.8-4 4-4z",fill:"#E4E6F2",opacity:".8"}),s.createElement("rect",{stroke:"#8189A9",strokeWidth:"1.5",fill:"#FFF",strokeLinecap:"round",strokeLinejoin:"round",x:"47",y:"33",width:"72",height:"88",rx:"1"}),s.createElement("path",{d:"M60.28 86h44.67M60.28 96h44.67M60.28 107H73",stroke:"#E4E6F2",strokeWidth:"2",fill:"#FFF",strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("g",{transform:"translate(64 47)"},s.createElement("circle",{fill:"#8189A9",cx:"3",cy:"3",r:"3"}),s.createElement("circle",{fill:"#8189A9",cx:"33",cy:"3",r:"3"}),s.createElement("path",{d:"M29.46 21.54C26.66 18.74 22.78 17 18.5 17c-4.28 0-8.16 1.73-10.96 4.54",stroke:"#8189A9",strokeWidth:"2",strokeLinecap:"round"})),s.createElement("path",{d:"M188.13 106.03c.3.3.3.8-.1 1.1-.1.1-.3.2-.5.2s-.4-.1-.5-.2l-1.8-1.8c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0l1.8 1.8zm3.9 4l1.7 1.8c.3.3.3.8 0 1.1-.1.1-.3.2-.5.2s-.4-.1-.5-.2l-1.8-1.8c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0zm-5 0c.3-.3.8-.3 1 0 .3.3.3.8 0 1.1l-1.8 1.8c-.1.1-.3.2-.5.2s-.4-.1-.5-.2c-.3-.3-.3-.8 0-1.1l1.8-1.8zm6.8-5.7c.3.3.3.8-.1 1.1l-1.8 1.8c-.1.1-.3.2-.5.2s-.4-.1-.5-.2c-.3-.3-.3-.8 0-1.1l1.8-1.8c.3-.3.8-.3 1.1 0zM86.03 3.13l-1.8-1.8c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0l1.7 1.8c.3.3.3.8 0 1.1-.1.1-.3.2-.5.2s-.4-.1-.5-.2zm5.7 5.6l-1.9-1.8c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0l1.8 1.8c.3.3.3.8 0 1.1-.1.1-.3.2-.5.2s-.4-.1-.5-.2zm-6.9.2c-.2 0-.4 0-.5-.1-.3-.3-.3-.8 0-1.1l1.7-1.9c.3-.3.8-.3 1.1 0 .3.3.3.8 0 1.1l-1.8 1.8c-.1.1-.3.2-.5.2zm5.7-5.6c-.2 0-.4-.1-.6-.2-.3-.3-.3-.8 0-1.1l1.8-1.8c.3-.3.8-.3 1.1 0 .3.3.3.8 0 1.1l-1.8 1.8c-.1.1-.3.2-.5.2z",fill:"#F6C2CB",fillRule:"nonzero"}),s.createElement("path",{d:"M4.6 60.2c2.2 0 3.9-1.8 3.9-3.9 0-2.2-1.8-3.9-3.9-3.9-2.2 0-3.9 1.8-3.9 3.9 0 2.1 1.7 3.9 3.9 3.9zm0-6.3C5.9 53.9 7 55 7 56.3c0 1.3-1.1 2.4-2.4 2.4-1.3 0-2.4-1.1-2.4-2.4 0-1.4 1.1-2.4 2.4-2.4z",fill:"#A1E7D7",fillRule:"nonzero"}))),G=e=>{const{userAccount:t,selfUpdate:i,notificationsManager:n,documentLoader:r,environment:d,appStream:m,clientsState:y,slots:b}=e,S=c.Bx.Logging.getLogger("denali.editorContent"),x=s.useContext(T.Y.Context);var V;V=t.features.track3rdPartyExtensionsInjection,_.R.useSubscriptionTo(V?w.R(document.body,"click",{passive:!0,capture:!0}).pipe(C.$(),k.c(1e3),M.M((()=>{const e=[...Array.from(document.documentElement.children),...Array.from(document.body.children)].filter((e=>!e.hasAttribute("data-verified")&&"head"!==e.nodeName.toLowerCase())).map((e=>({nodeName:e.nodeName,src:e.getAttribute("src"),content:e.outerHTML.substr(0,255)})));e.length&&e.forEach((e=>{c.Bx.Logging.getLogger("3rdPartyInjections").info("found unknown element",e)}))}))):E.w);const L=s.createElement(u.W,{key:"platformNotificationsCenter",views:I.wY,manager:n,onNotificationClose:e=>x.gnarSpec.notificationCloseButtonClick(e.type,x.pageId)});return _.R.useEffectOnDidMount((()=>{document.body.classList.remove("editorTs")})),_.R.useEffectOnWillUnmount((()=>{document.body.classList.add("editorTs")})),s.createElement(l.F.div,{className:h.t.wrapper},s.createElement(A.$,null),m.pipe(v.T(a.fold((()=>L),o.fold((e=>e.code===p.C.WsCodes.NOT_FOUND?(S.warn("document not found on init",e),s.createElement(K,{key:"404"})):(e.code===p.C.WsCodes.UNAUTHORIZED?S.warn("unauthorized on init",e):S.warn("engine init error",e),L)),(e=>{const o=b(e);return s.createElement(T.Y.ContextProvider,{gnarSpec:x.gnarSpec,docId:x.docId,pageId:e.engine.sessionModel.isDemoDocument?"demoDocument":"document",pageSessionId:x.pageSessionId},s.createElement(s.Fragment,null,s.createElement(F.Ss,{denaliEditorModel:e.ded,documentModel:e.engine.sessionModel,userAccount:t,selfUpdate:i,denaliViewModels:e.denaliViewModels,notificationsManager:n,documentLoader:r,environment:d,slots:o,clientsState:y},L),s.createElement(o.CheckoutSidebar,null),s.createElement(o.BlockUnsavedChanges,null)))})))),f.Z(L)),s.createElement(g.$,{key:"tooltip"}))};class $ extends s.Component{_renderPageDoc(e){const{userAccount:t,selfUpdate:i,notificationsManager:n,environment:o,appStream:l,documentLoader:d,logoutViewModel:c,clientsState:p}=this.props;return s.createElement(S.vo,{key:`base-page-${e}`,title:l.pipe(y.n((0,r.flow)(a.chain(a.fromEither),a.map((({engine:e})=>e.sessionModel.title)),a.getOrElse((()=>b.of(void 0))))),v.T((e=>Boolean(e)?`${e} - Grammarly`:"Grammarly")))},s.createElement(s.Fragment,null,s.createElement(G,{key:"denali-editor-content",userAccount:t,selfUpdate:i,notificationsManager:n,environment:o,slots:this.props.slots,appStream:l,documentLoader:d,clientsState:p}),o.platform!==x.OH.Platform.AISTUDIO&&s.createElement(F.aH,{key:"loader",logoutViewModel:c,documentLoader:d,userAccount:t})))}shouldComponentUpdate(){return!1}UNSAFE_componentWillReceiveProps(e){const t=Number(e.docId);this._docId.set(a.fromNullable(t))}componentWillUnmount(){this.props.documentLoader.dispose()}render(){return s.createElement(l.F.Fragment,null,this._docId.view((0,r.flow)(a.filter((e=>!isNaN(e))),a.fold((()=>s.createElement(S.vo,{title:"Grammarly"},s.createElement(K,{key:"404"}))),(e=>this._renderPageDoc(`${e}`))))))}constructor(...e){super(...e),(0,n._)(this,"context",void 0),(0,n._)(this,"_docId",d.s.create(a.fromNullable(Number(this.props.docId))))}}(0,n._)($,"contextType",T.Y.Context),m.Ks.setStylesTarget(document.getElementById("typestyleTarget"))},35130:(e,t,i)=>{i.d(t,{I:()=>n});var n,s=i(10334),o=i(17171),a=i(84647),r=i(84712),l=i(3016),d=i(91745),c=i(99010),p=i(58260),h=i(7149),u=i(1224),g=i(80949);!function(e){let t,i;!function(e){e.none="none",e.focusing="focusing",e.focused="focused"}(t=e.Focus||(e.Focus={})),function(e){e.initial={isAvailable:!1,focus:t.none};const i=e=>t=>(0,o._)((0,s._)({},t),{isAvailable:e.available});e.update=e=>n=>(0,a.pipe)(n,n.focus===t.focusing&&(e=>!e.focused)(e)?i(e):(e=>(0,a.flow)(i(e),(e=>i=>(0,o._)((0,s._)({},i),{focus:e.focused?t.focused:t.none}))(e)))(e))}(i=e.State||(e.State={})),e.create=(e,n)=>{const s=r.s.create(i.initial),o=u.Bx.Logging.getLogger(`${e}DeepLinkModel`),m=new l.y.Keeper,_=e=>(o.debug("State updated",e),e);return m.push(n.incomming.pipe(d.p((t=>t.source===e)),c.M((e=>s.modify((0,a.flow)(i.update(e),_))))).subscribe()),{state:s,request:()=>(o.debug("Requesting focus",e),s.lens("focus").set(t.focusing),s.view("isAvailable").pipe(d.p(Boolean),p.s(1),h.T((()=>n.push({kind:g.p.Kind.FocusRequested,source:e}))))),dispose:()=>m.dispose()}}}(n||(n={}))},79666:(e,t,i)=>{i.d(t,{r:()=>ce});var n,s=i(84647),o=i(65390),a=i(58786),r=i(2921),l=i(17503),d=i(84712),c=i(3016),p=i(91745),h=i(7149),u=i(58260),g=i(48779),m=i(10479),_=i(60191),v=i(1224),f=i(34553),y=i(99010),b=i(21644),S=i(80949);!function(e){e.create=e=>{const t=new f.B,i=e.getLogger("OggyDeepLinkEvents"),n=e=>y.M((t=>i.info(`${e} ${t.kind}`,t)));return{push:t.next.bind(t),incomming:t.pipe(p.p(S.p.isIncoming),n("[IN] >>>"),b.u()),outgoing:t.pipe(p.p(S.p.isOutgoing),n("[OUT] <<<"),b.u())}}}(n||(n={}));var w=i(35130),C=i(23988),k=i(7432),M=i(72106),E=i(11864);const T={backgroundColor:i(27199).Q1.CoreBlue20,backgroundRepeat:"no-repeat",contain:"layout style",$nest:{"@media print":{display:"none !important"}}},x={animation:`${E.Ks.keyframes({"0%":{backgroundColor:"rgba(153, 194, 255, 1)"},"50%":{backgroundColor:"rgba(153, 194, 255, 0)"},"100%":{backgroundColor:"rgba(153, 194, 255, 1)"}})} 300ms 2 ease-out forwards !important`,animationIterationCount:"2 !important"},I=E.Ks.stylesheet({mark:[T],attention:[x]});var A;!function(e){const t="selectionContextRange";e.create=(e,i)=>k.vY.create(e,i,{type:t}),e.is=function(e){return e.meta.type===t}}(A||(A={}));class F{constructor(e,t){(0,C._)(this,"_ded",void 0),(0,C._)(this,"_rangeManager",void 0),(0,C._)(this,"_ranges",void 0),(0,C._)(this,"setContextHighlight",void 0),this._ded=e,this._rangeManager=t,this._ranges=new Set,this.setContextHighlight=(e,t)=>{const i=`selection-context-${e.start}|${e.end}`,n=this._ranges.has(i),s=A.create(e.start,e.end),o={range:()=>s,order:0,classes:[I.mark,..."attention"===t?[I.attention]:[]]};"hidden"===t?(n&&(this._ded.changeMarks([M.J.Change.getRemoveAction({range:()=>s})(i)]),this._rangeManager.deregisterRange(i)),this._ranges.delete(i)):n?this._ded.changeMarks([M.J.Change.getUpdateAction(o)(i)]):(this._rangeManager.registerRange(i,s),this._ded.changeMarks([M.J.Change.getCreateAction(o)(i)]),this._ranges.add(i))}}}var V,L=i(70823);!function(e){e.create=e=>{const t=new f.B,i=e.getLogger("OggyLifecycleEvents");return{push:t.next.bind(t),events:t.pipe(y.M((e=>i.info(e.kind,e))),b.u())}}}(V||(V={}));var O,B=i(10334),R=i(17171),U=i(38886),N=i(66202),P=i(65160),D=i(63967),H=i(45653),K=i(87275);!function(e){let t;e.empty=()=>({selectedAlertHighlight:o.none,alertsVisibilityCollection:new Map,blockApply:!1}),e.changeAlertVisibility=(e,t,i)=>n=>{n.alertsVisibilityCollection.set(e,{alertId:t,visibility:i})},function(e){e.create=(e,t)=>{const i=d.s.create(O.empty()),n=t=>(0,s.pipe)(e.getByAlertId(t.alert.id),o.chain((e=>e.rawId))),a=t=>i=>(0,s.pipe)(e.getByRawAlertId(i.alertId),o.map((e=>[e,(0,R._)((0,B._)({},i),{source:t})]))),r=(e,t)=>(0,s.pipe)(e,U.i8((e=>"emphasized"===e.visibility)),o.chain(a(t)),o.map((([e])=>({highlightIndex:0,source:t,alert:H.A.fromModel(e)}))),o.filter((e=>(0,s.pipe)(i.get().selectedAlertHighlight,P.Lw((t=>!H.A.eq.equals(t.alert,e.alert)))))),o.alt((()=>i.get().selectedAlertHighlight))),l=(e,t)=>i=>(0,s.pipe)(e,n,N.fromOption((()=>new Error("cannot get raw alert id from highlight"))),N.map((n=>O.changeAlertVisibility(e.alert.id,n,t)(i))));return{selectedAlertId:i.view("selectedAlertHighlight").pipe(p.p(o.exists((e=>[K.nl.forceText,D.Kz.api].includes(e.source)))),h.T((0,s.flow)(o.chain(n),o.toNullable))),alertVisibilityFilter:i.view("alertsVisibilityCollection").view((e=>t=>(0,s.pipe)(e.get(t.id),o.fromNullable,o.map((e=>"hidden"!==e.visibility)),o.getOrElse(s.constFalse)))),alertHighlightChanges:i.view("selectedAlertHighlight"),blockApply:i.view("blockApply"),setState:e=>{const n=r(e,D.Kz.sidebar);t.debug("setAlertsVisibility",{alertsVisibilityInfo:e,selectedAlertHighlight:n}),i.modify((i=>{t.debug("setAlertsVisibility —> changeAlertsVisibility",{current:i.selectedAlertHighlight,next:n});const o=new Map((0,s.pipe)(e,U.x1(a(D.Kz.sidebar)),U.Tj((([e,t])=>[e.id,t]))));return{selectedAlertHighlight:n,alertsVisibilityCollection:o,blockApply:i.blockApply}}))},updateState:e=>{const n=r(e,K.nl.forceSidebar);t.debug("updateAlertsVisibility",{alertsVisibilityInfo:e,selectedAlertHighlight:n}),i.modify((i=>{t.debug("updateAlertsVisibility —> changeAlertsVisibility",{current:i.selectedAlertHighlight,next:n});const o=(0,s.pipe)(e,U.x1(a(K.nl.forceSidebar)),U.TS(new Map(i.alertsVisibilityCollection),((e,[t,i])=>e.set(t.id,i))));return{selectedAlertHighlight:n,alertsVisibilityCollection:o,blockApply:i.blockApply}}))},updateFromAlerts:(e,t)=>{i.modify((i=>{const n=new Map(i.alertsVisibilityCollection);let a=i.selectedAlertHighlight;return t.forEach((t=>{(0,s.pipe)(n.get(t),o.fromNullable,P.Mi((i=>(0,s.pipe)(e.get(i.alertId),o.fromNullable,o.fold((()=>{n.delete(t),a=(0,s.pipe)(a,o.filter((e=>e.alert.id!==t)))}),(e=>{n.delete(t),n.set(e.id,i),a=(0,s.pipe)(a,o.map((t=>t.alert.id===e.id?{highlightIndex:t.highlightIndex,source:t.source,alert:H.A.fromModel(e)}:t)))}))))))})),{selectedAlertHighlight:a,alertsVisibilityCollection:n,blockApply:(0,s.pipe)(a,o.fold(s.constFalse,(e=>H.A.isSuper(e.alert)&&D.Fc.getCheckingState(e.alert)===D.Fc.CheckingState.CHECKING)))}}))},focusAlertHighlight:e=>{const n=i.get();i.modify((i=>((0,s.pipe)(i,l(e,"emphasized"),N.fold((e=>t.error("Cannot emphasize the alert",e)),s.constVoid)),(0,s.pipe)(n.selectedAlertHighlight,P.Mi((e=>l(e,"visible")(i)))),t.debug("focusAlertHighlight",e),{selectedAlertHighlight:o.some(e),alertsVisibilityCollection:new Map(i.alertsVisibilityCollection),blockApply:i.blockApply})))},unfocusAlertHighlight:()=>{i.modify((e=>(0,s.pipe)(e.selectedAlertHighlight,o.map((t=>(l(t,"visible")(e),{selectedAlertHighlight:o.none,alertsVisibilityCollection:new Map(e.alertsVisibilityCollection),blockApply:e.blockApply}))),o.getOrElse((0,s.constant)(e)))))}}}}(t=e.Holder||(e.Holder={}))}(O||(O={}));var W=i(84011),G=i(46238),$=i(25742),z=i(30343),J=i(9079),j=i(31206),Z=i(50650),q=i(94855),Y=i(68801),Q=i(35679),X=i(22809);const ee=G.of(void 0);var te,ie,ne=i(24819),se=i(60352),oe=i(42299),ae=i(63687),re=i(90829),le=i(39055);!function(e){var t=e.isAssistantSDUIEvent=(0,re.M4)((0,re.Ub)(le.om.is("sdui_add"),le.om.is("sdui_update"),le.om.is("sdui_remove")),(e=>!e.sduiRootId.endsWith("suggestion@Inline"))),i=e.isSessionEvent=(0,re.Ub)(le.om.is("session_started"),le.om.is("finish")),n=e.isResetEvent=le.om.is("connect");e.is=(0,re.Ub)(t,i,n)}(te||(te={})),function(e){let t;function i(e,i){switch(i.kind){case"connect":return t.empty();case"session_started":return i.isNewSession?t.empty():e;case"finish":return e;case"sdui_remove":return e.delete(i.sduiRootId),e;case"sdui_add":case"sdui_update":return e.set(i.sduiRootId,(0,R._)((0,B._)({},i),{kind:"sdui_add"})),e;default:(0,ne.xb)(i)}}e.create=(e,n)=>{const s=n.getLogger("SDUIBuffer"),o=new c.y.Keeper,a=d.s.create([]),r=e.pipe(p.p(te.is)),l=e=>JSON.stringify(te.isAssistantSDUIEvent(e)?{kind:e.kind,sduiRootId:e.sduiRootId}:e);return o.push(r.pipe(y.M((e=>s.trace(`sduiCapiEvent IN ${l(e)}`))),se.S(i,t.empty()),h.T((e=>Array.from(e.values()))),y.M((e=>s.trace(`sduiBuffer OUT:\n ${e.map(l).join("\n")}`))),y.M(g.H9(a))).subscribe()),{capiEvents:oe.x(ae.v((()=>m.H(a.get()))),r),dispose:()=>{a.set([]),o.dispose()}}},function(e){e.empty=()=>new Map}(t||(t={}))}(ie||(ie={}));var de,ce,pe=i(58375),he=i(34940);!function(e){e.create=(e,t,i,n,a,r)=>{const l=r.getLogger("Manager");l.debug("Creating new Oggy manager");const u=d.s.create(!1),g=new f.B,m=O.Holder.create(t,r),_=new c.y.Keeper,b=ie.create(a,l);_.push(b);const S=((e,t,i,n,a)=>{const r=e=>D.Fc.isRemovedByTextChange(e)?"textChange":"other",l=v.Bx.Logging.getLogger("Oggy.AlertService");return{selectedAlertId:n.selectedAlertId,scrollAlertIntoView:({alertId:e})=>(0,s.pipe)(i.getByRawAlertId(e),o.fold((()=>(l.warn(`Move focused mark into viewport: Alert with id ${e} not found`),Promise.resolve())),(e=>{return Promise.resolve((t={alert:H.A.fromModel(e),highlightIndex:0},g.next(t)));var t}))),alertCollectionChanges:e.state.pipe(z.Z(X.A.empty),J.J(),h.T((([e,t])=>X.A.diff(t,e))),h.T(X.A.Diff.toRegistered),h.T(Z.b_.reduce({changes:[],toAdd:new Map,toRemove:new Set},((e,t)=>((0,s.pipe)(t.alert.rawId,P.Mi((i=>{e.changes.push((0,$.BG)(i)),e.toAdd.set(i,t.alert)}))),e)),((e,t,i)=>(e.toRemove.add(t.id),(0,s.pipe)(t.alert.rawId,P.Mi((i=>e.changes.push((0,$.rc)(i,r(t)))))),(0,s.pipe)(i.alert.rawId,P.Mi((t=>{e.changes.push((0,$.BG)(t)),e.toAdd.set(t,i.alert)}))),e)),((e,t)=>(e.toRemove.add(t.id),(0,s.pipe)(t.alert.rawId,P.Mi((i=>e.changes.push((0,$.rc)(i,r(t)))))),e)))),y.M((({toAdd:e,toRemove:t})=>n.updateFromAlerts(e,t))),j.E("changes"),p.p((e=>e.length>0))),applyAlerts:(0,s.flow)(U.x1((e=>(0,s.pipe)(i.getByRawAlertId(e.alertId),o.map((t=>[t.id,{alternativeIndex:e.alternativeIndex,source:D.Kz.sidebar,feedbackSubtype:Q.U3.Sidebar}]))))),q._c((([e,i])=>(0,s.pipe)(t.apply(e,i),q.Mr))),q.Tj(s.constVoid),Y.hq),removeAlerts:(0,s.flow)(U.x1((e=>(0,s.pipe)(i.getByRawAlertId(e.alertId),o.map((t=>({alert:t,reason:e.removalReason})))))),q._c((({alert:e,reason:n})=>"alertApplied"===n?(0,s.pipe)(W.of(i.remove(e)),q.L9):(0,s.pipe)(t.dismissBatch([e.id],Q.U3.Sidebar),q.Mr))),q.Tj(s.constVoid),Y.hq),setAlertsVisibility:(0,s.flow)(n.setState,ee),updateAlertsVisibility:(0,s.flow)(n.updateState,ee)}})(e,i,t,m),w=((e,t)=>({sduiItemCollectionChanges:e,supportedForms:["longForm"],autofocusNextLongFormCardOnApplyOrDismiss:t}))(b.capiEvents.pipe(p.p((0,re.Ub)(te.isAssistantSDUIEvent,te.isResetEvent)),h.T((e=>{switch(e.kind){case"sdui_add":return(0,pe.ws)(e.sduiRootId,e.sdui);case"sdui_update":return(0,pe.wq)(e.sduiRootId,e.sdui);case"sdui_remove":return(0,pe.jw)(e.sduiRootId);case"connect":return(0,pe.hp)();default:return(0,s.absurd)(e)}})),he.w(50),p.p((e=>e.length>0)),h.T((e=>({changes:e,pendingChangesCount:0})))),u);return(0,R._)((0,B._)({},m),{alertService:S,sduiService:w,lifecycleEvents:n,scrollIntoViewChanges:g,toggleAutoScroll:e=>u.set(e),dispose(){l.debug("Disposing Oggy manager"),_.dispose()}})}}(de||(de={})),function(e){e.create=({checkingDomain:e,alertsRepository:t,alertsService:i,observableCapi:f,latestCAPIMessageByActionName:y,telemetry:b,environment:C,platformEnvironment:k,ded:M,positionManager:E,isFreeUser:T})=>{const x=new c.y.Keeper,I=v.Bx.Logging.getLogger("CheetahEngine"),{capiService:A,capiMessages:O}=(0,L.Fi)(f,y,T),B=d.s.create({enabled:!1});x.push(O.pipe(p.p((({action:e})=>"start"===e)),p.p((e=>{var t;return null===(t=e.allowedFeatures)||void 0===t?void 0:t.includes(a.t)})),h.T((0,s.flow)((e=>o.fromNullable(e.cheetahState)),o.fold((()=>({enabled:!1})),(e=>({enabled:!0,userState:e}))))),u.s(1)).subscribe(g.H9(B)));const R=new r.v(A,B);x.push(R);const U=V.create(I),N=n.create(I),P=(0,L.ii)(N),D=m.H(b.getContainerId().catch((()=>(I.warn("Failed to retrieve container ID for Cheetah Web"),"")))).pipe(h.T((e=>(0,L.C)(U,e,C,k))),_.tl({refCount:!0,bufferSize:1})),H=w.I.create(S.p.Source.PremiumSuggestionsUphook,N),K=w.I.create(S.p.Source.Plagiarism,N);x.push(H,K);const W=new F(M,E),G=de.create(e,t,i,U.events,f.events,I.getLogger("OggyManager"));return null!=performance&&"function"==typeof performance.mark&&performance.mark(l.F.preStartServicesReady),{oggyManager:G,oggyUphookModel:H,oggyPlagiarismModel:K,cheetahCapiService:A,genAiAvailabilityService:R,oggyLifecycleService:D,oggyDeepLinkService:P,capiMessages:O,oggyLifecycleEvents:U,selectionContextManager:W,dispose:x.dispose.bind(x)}}}(ce||(ce={}))},14e3:(e,t,i)=>{i.d(t,{A:()=>s,B:()=>n});var n,s,o=i(10334),a=i(17171),r=i(65390),l=i(84647),d=i(86810),c=i(24819),p=i(84712),h=i(66202),u=i(73328),g=i(35679),m=i(39055),_=i(32102),v=i(91745),f=i(7149),y=i(48779);!function(e){let t;!function(e){e.Like="Like",e.Dislike="Dislike"}(t=e.FeedbackType||(e.FeedbackType={}))}(n||(n={})),function(e){function t(e){switch(e){case n.FeedbackType.Like:return g.Zq.EMOTION_LIKE;case n.FeedbackType.Dislike:return g.Zq.EMOTION_DISLIKE;default:return(0,c.xb)(e)}}function i(e){return(0,l.pipe)(_.w.fromNumber(e.confidence),h.map((t=>({emoji:e.emoji,name:e.name,confidence:t,feedback:r.none}))))}function s(e){return e.reduce(((e,t)=>(e[t.name]=t,e)),{})}e.toCapiFeedback=t,e.create=function(e,n,c){const g=p.s.create({}),b=[e.pipe(v.p(m.om.is("emotions")),f.T((e=>(0,l.pipe)(function(e){const[t,n]=(0,d.jB)(e.map(i),h.isRight);return t.length===e.length?h.right(t.map(u.$v)):h.left((0,l.pipe)(n.map(h.swap).map(u.$v).join(";")))}(e.emotions),h.map(s),h.fold((e=>(c.error("Failed to parse emotions from capi",{rejectionReason:e}),{})),l.identity))))).subscribe(y.H9(g))];return{emotions:g.view((e=>Object.values(e).sort(((e,t)=>_.w.ord.compare(t.confidence,e.confidence))))),sendEmotionFeedback:(e,i)=>(0,l.pipe)(function(e,t){return void 0===e[t]?h.left(new Error("Tried to send feedback for non-existing emotion")):(0,l.pipe)(e[t].feedback,r.fold((()=>h.right(void 0)),(()=>h.left(new Error("Tried to send feedback for an emotion which already has one")))))}(g.get(),e),h.map((()=>{n.sendFeedback({emotionName:e,kind:t(i)})(),g.modify((t=>(0,a._)((0,o._)({},t),{[e]:(0,a._)((0,o._)({},t[e]),{feedback:r.some(i)})})))}))),dispose:()=>b.forEach((e=>e.unsubscribe()))}}}(s||(s={}))},52444:(e,t,i)=>{i.d(t,{A:()=>Je,X:()=>je});var n,s=i(83531),o=i(23988),a=i(10334),r=i(17171),l=i(89050),d=i(86598),c=i(77093),p=i(67742),h=i(77416),u=i(84647),g=i(81400),m=i(96812),_=i(84712),v=i(90829),f=i(72123),y=i(40734),b=i(35240),S=i(70174),w=i(1224),C=i(65390),k=i(65160),M=i(35616),E=i(30399),T=i(74962),x=i(39055),I=i(99908),A=i(16742),F=i(35625),V=i(63178),L=i(49851),O=i(35679),B=i(63376),R=i(46013),U=i(99854),N=i(9637),P=i(64014),D=i(89211),H=i(77338),K=i(21138),W=i(11555),G=i(19805),$=i(61606),z=i(3016),J=i(34553),j=i(91745),Z=i(58260),q=i(92832),Y=i(99010),Q=i(2090),X=i(23875),ee=i(60352),te=i(49990),ie=i(60191),ne=i(79937),se=i(83694),oe=i(5406),ae=i(83194),re=i(48779),le=i(21644),de=i(65999),ce=i(36644),pe=i(98719),he=i(92622),ue=i(46443),ge=i(7149),me=i(99339),_e=i(30343),ve=i(42279),fe=i(84872);!function(e){let t,i;!function(e){e.TabClosed="tab closed",e.TabHidden="tab hidden"}(t=e.SessionEndReason||(e.SessionEndReason={})),function(e){let t;!function(e){e.fromValue=e=>(0,u.pipe)(e,ue.v(),ge.T((({timestamp:e,value:t})=>(0,r._)((0,a._)({},t),{timestamp:e}))))}(t=e.WithTimeStamp||(e.WithTimeStamp={}))}(i=e.Event||(e.Event={})),e.create=(e,n=me.R(window,"beforeunload"),s=me.R(window,"visibilitychange").pipe(ge.T((()=>window.document.hidden)),_e.Z(!1)))=>{const o=w.Bx.Logging.getLogger("ClientSession",w.y7.$.INFO,w.y7.I.Manager.getColor("ClientSession")),a=e.pipe(j.p(x.om.is("session_started")),le.u()),r=e.pipe(j.p(x.om.is("disconnect"))),l=a.pipe(ne.n((()=>ve.h(n.pipe(ge.T((()=>({reason:t.TabClosed})))),fe.z([r,s]).pipe(j.p((([e,t])=>t)),Z.s(1),ge.T((()=>({reason:t.TabHidden}))))))),i.WithTimeStamp.fromValue,Y.M((e=>o.info("Session ended",e))),le.u()),d=ve.h(a.pipe(Z.s(1)),l.pipe(ne.n((()=>a.pipe(Z.s(1)))))).pipe(i.WithTimeStamp.fromValue,Y.M((e=>o.info("Session started",e))),le.u()),c=d.pipe(ne.n((({timestamp:e,sessionUuid:t})=>l.pipe(ge.T((({timestamp:i})=>({duration:Math.ceil((i-e)/1e3),sessionUuid:t})))))),Y.M((e=>o.info("Session stats",e))),le.u());return{sessionEnd:l,sessionStart:d,sessionStats:c}}}(n||(n={}));var ye=i(78018),be=i(30595);class Se{_decodeCacheItem(e){const t=e.match(/([^;]+);([^;]+);([^;]+);(.*)/);if(!t)throw new TypeError("unexpected value content");const[i,n,s,o]=t.splice(1,5).map((e=>JSON.parse(e)));if(void 0!==i&&"number"==typeof i&&void 0!==n&&void 0!==s&&"boolean"==typeof s&&void 0!==o&&Array.isArray(o)){const e=(0,v.RZ)((()=>this._deserializeData(o)));return{timeStamp:i,context:n,isFreeUser:s,get data(){return e.value}}}throw new TypeError("unexpected value content")}_encodeCacheItem({timeStamp:e,context:t,isFreeUser:i,data:n}){return[e,t,i,this._serializeData(n)].map((e=>JSON.stringify(e))).join(";")}_getStorageKeyVersionedPrefix(){return this._storageNamePrefix+this._storageDataVersion}_getStorageKeyForDoc(e){return`${this._getStorageKeyVersionedPrefix()}-${e}`}_save(e,t,i,n){const s=this._encodeCacheItem({timeStamp:Date.now(),context:t,isFreeUser:i,data:n});this._storage.setItem(this._getStorageKeyForDoc(e),s)}_loadCache(e,t,i){const n=this._storage.getItem(this._getStorageKeyForDoc(e));if(C.isSome(n)){let s;try{s=this._decodeCacheItem(k.$v(n))}catch(t){try{this._removeCacheItem(e)}catch(e){this._log.debug("could not remove broken cache item",e)}return null}if(s.isFreeUser===i&&s.context===t)return s.data;try{this._removeCacheItem(e)}catch(e){this._log.debug("could not remove cache for a user of different type",e)}return null}return null}_removeCacheItem(e){this._storage.removeItem(this._getStorageKeyForDoc(e))}_pruneOldEditor(){this._storage.getKeys().filter((e=>/matches_\d+/.test(e))).forEach((e=>this._storage.removeItem(e)))}get _cacheKeys(){return this._storage.getKeys().filter(this._isСacheKey)}_pruneOld(){const e=Date.now();this._cacheKeys.forEach((t=>{const i=this._storage.getItem(t);if(C.isSome(i)){let n;try{n=this._decodeCacheItem(k.$v(i))}catch(e){return void this._storage.removeItem(t)}e-n.timeStamp>this._maxCacheAgeMs&&this._storage.removeItem(t)}}))}_pruneAll(){this._cacheKeys.forEach((e=>this._storage.removeItem(e)))}_pruneOldVersions(){this._storage.getKeys().filter(this._isOldCacheKey).forEach((e=>this._storage.removeItem(e)))}load(e,t,i){return this._loadCache(e,t,i)}hasCache(e,t,i){const n=this._getStorageKeyForDoc(e);return(0,u.pipe)(this._storage.getItem(n),C.chain((e=>{try{const t=this._decodeCacheItem(e);return C.some(t)}catch(e){return this._log.error("Error decoding cache"),this._storage.safeRemoveItem(n),C.none}})),C.filter((e=>e.context===t&&e.isFreeUser===i)),C.fold((()=>!1),(()=>!0)))}save(e,t,i,n){try{return s=()=>this._save(e,t,i,n),o=[()=>this._pruneOldEditor(),()=>this._pruneOld(),()=>this._pruneAll()],function e(t){try{return s()}catch(i){if(t<o.length)return o[t](),e(t+1);throw i}}(0)}catch(e){this._log.warn("Cannot write to localStorage",e)}var s,o}remove(e){this._removeCacheItem(e)}constructor(e,t,i,n,s=ae.hQ.fromLocalStorage(ae.ls),a=12096e5){(0,o._)(this,"_deserializeData",void 0),(0,o._)(this,"_serializeData",void 0),(0,o._)(this,"_storageNamePrefix",void 0),(0,o._)(this,"_storageDataVersion",void 0),(0,o._)(this,"_storage",void 0),(0,o._)(this,"_maxCacheAgeMs",void 0),(0,o._)(this,"_log",void 0),(0,o._)(this,"_сacheKeyRe",void 0),(0,o._)(this,"_isСacheKey",void 0),(0,o._)(this,"_isOldCacheKey",void 0),this._deserializeData=e,this._serializeData=t,this._storageNamePrefix=i,this._storageDataVersion=n,this._storage=s,this._maxCacheAgeMs=a,this._log=w.Bx.Logging.getLogger("model.editor.document_cache"),this._сacheKeyRe=new RegExp(`${(0,be.Nt)(this._getStorageKeyVersionedPrefix())}-.+`),this._isСacheKey=e=>this._сacheKeyRe.test(e),this._isOldCacheKey=e=>e.startsWith(this._storageNamePrefix)&&!e.startsWith(this._getStorageKeyVersionedPrefix()),requestAnimationFrame((()=>{try{this._pruneOldVersions()}catch(e){this._log.debug("could not clean old caches",e)}}))}}var we=i(58251);const Ce="mutedCategoriesDocumentId",ke="mutedCategoriesContextId";class Me{getMutedCategories(){const e=this._mutedCategoriesCache.load(Ce,ke,this._isFree);return(0,u.pipe)(C.fromNullable(e),C.map((e=>new Map(e.map((e=>[e.id,e]))))))}dispose(){this._subs.forEach((e=>e.unsubscribe())),this._subs=[]}constructor(e,t,i){(0,o._)(this,"_mutedCategoriesModel",void 0),(0,o._)(this,"_isFree",void 0),(0,o._)(this,"_mutedCategoriesCache",void 0),(0,o._)(this,"_subs",void 0),(0,o._)(this,"_saveMutedCategories",void 0),this._mutedCategoriesModel=e,this._isFree=t,this._mutedCategoriesCache=i,this._saveMutedCategories=e=>{this._mutedCategoriesCache.save(Ce,ke,this._isFree,Array.from(e.values()))},this._subs=[this._mutedCategoriesModel.events.pipe(j.p(G.x.CategoriesModel.Events.isChangedEvent),Y.M((()=>{this._saveMutedCategories(this._mutedCategoriesModel.mutedCategories.get())}))).subscribe()]}}var Ee=i(66202),Te=i(83404),xe=i(85199),Ie=i(82585),Ae=i(58655);function Fe(e,t){const i=(0,xe.U)(e),n=new J.B;return n.pipe(Ie.B(1e3),Ae.F()).subscribe((e=>t.setState({type:"wsCapi",state:{type:e}}))),(0,r._)((0,a._)({},i),{onFinish:e=>{n.next("online"),i.onFinish&&i.onFinish(e)},onDisconnect:e=>{e.reason.code===Te.C.WsCodes.UNAUTHORIZED?n.next("unauthorized"):(e.reconnectCounter>1||Ee.isLeft(e.reconnectResult))&&n.next("offline"),i.onDisconnect&&i.onDisconnect(e)}})}var Ve,Le=i(79666),Oe=i(45181),Be=i(72297),Re=i(56157),Ue=i(73328),Ne=i(76005),Pe=i(7432);!function(e){e.create=e=>{const t=new J.B;function i(e){t.next(Re.lY.flush()),t.next(e)}return{changes:t,insertLink:function(t,n){return Ue.zb((()=>{i(Re.lY.delta((new Be.R).retain(t.start).retain(Pe.vY.size(t),{[Ne.M_.Type.link]:n}),e.getTextLength()))}))},insertLinkWithCaption:function(t,n,s){return(0,u.pipe)(Ue.zb((()=>{i(Re.lY.delta((new Be.R).retain(t).insert(s,{[Ne.M_.Type.link]:n}),e.getTextLength()))})))},removeLink:function(t){return Ue.zb((()=>{i(Re.lY.delta((new Be.R).retain(t.start).retain(Pe.vY.size(t),{[Ne.M_.Type.link]:null}),e.getTextLength()))}))},pushChanges:t.next.bind(t)}}}(Ve||(Ve={}));var De=i(26692),He=i(34096),Ke=i(82094),We=i(31044);const Ge={"":{supportedComponents:(0,u.pipe)({text:!0,clickableText:!0,button:!0,alternativeChoice:!0,count:!0,icon:!0,block:!0,box:!0,row:!0,column:!0,slider:!0,alternativeSlider:!0,transition:!0,openSettings:!0,openToneDetector:!0,openFeedback:!0,openLearnMore:!1,notify:!0,closeCard:!0,nextCard:!0,prevCard:!0,selectAlternative:!0,upgradeToPremium:!0,strongAlertRef:!0,openLink:!0,scroll:!0,list:!0,image:!0,assistantFeed:!0,assistantCard:!0,gButton:!0,"gButton:default":!1,"gButton:tone":!1,"gButton:proofit":!1,"gButton:get-started":!1,nativePerformanceScoreButton:!1,stopApplyingAlerts:!1,alertsCount:!0,applyAlerts:!0,removeAlerts:!0,removeRoot:!0,nativeToneInsightsModal:!1,nativeLearnMoreModal:!1,nativeSettingsModal:!1,nativeFeedbackModal:!1,viewStack:!0,switchView:!0,dropDownMenuButton:!0,radioButtonsGroup:!0,proofitButton:!1,nativeProofitModal:!1,nativeKeyTakeawaysAssistantCard:!1,nativeExperimentalGBConsistencyUpsellFooter:!1,nativeExperimentalGBToneInsightsUpsellFooter:!1,nativeSkillsModal:!1,openCreateSnippetModal:!1,showHighlights:!1,hideHighlights:!1,pushAssistantFeed:!0,popAssistantFeed:!0,focusAssistantCard:!0,lensesSwitchPanel:!0,newRevision:!1,shortFormCard:!1,longFormCard:!0,collapsedCard:!0,inlineCard:!0,nativeSkillsList:!1,nativeSkillsView:!1,nativeGetStartedChecklistModal:!1,nativeInlineCardContent:!1,nativeOpenAssistant:!1,"behavior:strongAlertRef":!0,"behavior:animation:fadeIn":!0,"behavior:animation:fadeOut":!0,"behavior:popoverAnchor":!1,"behavior:lifecycle":!0,progressBar:!0,highlightAlert:!0,horizontalRule:!0,copyToClipboard:!0,popoverStack:!1,closePopover:!1,interactPopover:!1,openGrammarlyGo:!1,tooltip:!0,"gButton:plagiarism":!0,"gButton:writingExpert":!0,enablePlagiarismCheck:!0,disablePlagiarismCheck:!0,enableWritingExpertCheck:!0,disableWritingExpertCheck:!0,selectableDropDownMenu:!0,globalPart:!0,globalPartPlaceholder:!0,openPerformanceScore:!1,nativeOpenUserSatisfactionFeedback:!0,sticker:!0,overlay:!0,"gButton:audienceAdapt":!1,"gButton:aiStudio":!1,enableAudienceAdaptCheck:!1,disableAudienceAdaptCheck:!1,enableAiStudioCheck:!1,disableAiStudioCheck:!1},Ke.pb(u.identity),Ke.Fo(u.identity)),supportedForms:[We.Z.Long,We.Z.Inline],dslParser:De.cK.dslRootParser,dslSchema:He.r}};var $e=i(58538);const ze=12e4;class Je{static createBase(e,t,i,n,s,o,a,r,l,d,c){const p=new z.y.Keeper,h=new J.B;p.push(h.pipe(j.p((e=>"session_inbound"===e.kind)),Z.s(1)).subscribe((()=>(0,ce.TE)("capiSessionInbound"))),Je._createCAPIEventsForAlertsCount(h).subscribe((e=>te.warn("CAPI finish didn't happen within timeout",{suggestionsReceived:e,timeout:ze}))),Je._trackSessionEnd(h,d,i).subscribe());const g=ye.l1.FormattingMode.on,m=this._createCAPIWS({userAccount:o,accessToken:l,createWSInstance:c,capiEvents:h,wsConnectivity:n,environment:a,context:y.T0.unset,rtfMode:g,isDemoDoc:!0,config:t}),_=new U.F(h,m.client,s,m),f=new H._(h,_),b=Je._getBaseDocumentModel("Demo document",e,s,f.requestDocStats,g),{observableCapi:S,latestCAPIMessageByActionName:M,capiWatcher:E,capi:T}=Je._createCAPI(h,f,b,o,i,e.length);let I=C.none;const A=()=>(0,u.pipe)(I,C.fold((()=>e.delta),(e=>e()))),{alertManager:F,alertsService:V,alertsReader:L,alertsRepository:O,positionManager:B,altManager:N}=(0,R.h)(A,u.identity,S,h,b.counters);(0,v.hJ)("alertManager",F);const{changesSources:P,dedSync:D,formattingModel:G,synonymsModel:$}=Je._createModels(B,A,S,s,b,F),Q=C.none;p.push(W.d.init(D,h,K.vr.ignoreTEResult(S),K.vr.ignoreResult(K.vr.pushDeleteThenInsert(B)),N,P).subscribe(Je._getChangesDispatcherFailHandler()));const{cacheManager:X,mutedAlertsModel:ee}=Je._createMutedCategoriesWithCache(h,S,F,V,t,o.features),te=w.Bx.Logging.getLogger("StEngine");try{(0,u.pipe)(X.getMutedCategories(),k.Mi((e=>{te.debug("Loading muted alerts categories from cache..."),ee.loadCachedMutedCategories(e)})))}catch(e){te.warn("Cannot read alerts OR muted categories cache",e)}I=C.some((()=>s.getContents().delta));const{sduiFactory:ie,sduiInlineFactory:ne}=Je._createSDUI(h,F,O),se=Le.r.create({checkingDomain:F,alertsRepository:O,alertsService:V,observableCapi:S,latestCAPIMessageByActionName:M,telemetry:i,environment:a,platformEnvironment:r,ded:s,positionManager:B,isFreeUser:o.features.isFree.get()}),oe=new Je(se,S,M,b,B,N,F,V,L,O,$,G,Q,ee,ie,ne,(()=>p.dispose()),m,E);return p.push(h.pipe(j.p(x.om.is("connect")),q.i(1),Y.M(oe.resetSDUI("CAPI reconnect"))).subscribe()),(0,v.hJ)("engine",oe),(0,v.hJ)("text",(()=>{T.getText().then((e=>{const t=s.getText();t!==e?console.log("Text DIFF",{capiText:e,capiLen:e.length,dedText:t,dedTextLen:t.length}):console.log("Texts are the same, len: "+t.length)})).catch((e=>{throw e}))})),oe}shutdown(){var e=this;return(0,s._)((function*(){w.Bx.Logging.getLogger("StEngine").debug("shutdown"),e._onShutdown(),yield e._capiConnection.close(void 0,"StEngine shutdown"),null!=e._capiConManager&&e._capiConManager.dispose(),e.checkingDomain.dispose(),e._capiWatcher.dispose(),e.sessionModel.dispose(),e.sduiManager.get().dispose(),e.sduiInlineManager.get().dispose(),e.cheetah.dispose(),(0,u.pipe)(e.emotionsModel,C.map((e=>e.dispose())))}))()}static _getBaseDocumentModel(e,t,i,n,s){return new Oe.c(e,t,y.T0.unset,i,n,s)}static _getChangesDispatcherFailHandler(){const e=w.Bx.Logging.getLogger("ChangesDispatcher");return t=>{"UnsubscriptionError"===t.exception.name?e.warn("shutdown error",t):t.details.to===W.d.Receiver.CAPI&&Boolean(f.Xb.isNotConnectedError(t.exception))?e.warn("tried to send change to not connected CAPI",t):t.details.to===W.d.Receiver.CAPI&&Boolean(M.r1.isNotReadyError(t.exception))?e.warn("tried to send delta change to CAPI that expected a reset",t):t.details.to===W.d.Receiver.CAPI?e.warn("failed pushing changes to CAPI",t):e.error("can not dispatch changes",t.exception,t.details)}}static _getCapiWsUrl(e,t){if(e.api.capiWsUrl===e.api.defaultCapiWsUrl){if(t.features.denali.trafficThroughGatewayForCapi&&t.features.denali.trafficThroughInternalCapi)return e.api.internalCapiWsUrl;if(t.features.denali.trafficThroughGatewayForCapi&&!t.features.denali.trafficThroughInternalCapi)return e.api.gatewayCapiWsUrl;if(!t.features.denali.trafficThroughGatewayForCapi&&t.features.denali.trafficThroughInternalCapi)return e.api.k8sCapiWsUrl}return e.api.capiWsUrl}static _getClientSupports(e,t){const i=[I.k9.textInfo,I.k9.freeAdvancedChecks,I.k9.readability,I.k9.sentenceVariety,I.k9.fillerWords,I.k9.alertsUpdate,I.k9.alertsChanges,I.k9.freeClarityChecks,I.k9.superAlerts,I.k9.consistency,I.k9.setGoalsLink,I.k9.voxCheck,I.k9.toneCards,I.k9.plagiarismAlertsUpdate,I.k9.alternativeDeletesCard,I.k9.fullSentenceRewrite,I.k9.listCard,I.k9.muteQuotedAlerts,I.k9.userMutes,I.k9.supportsButtonTransformCards,I.k9.gapTransformCard,I.k9.enclosingHighlight,I.k9.drilldownCard,I.k9.ideasGalleryLink,I.k9.freeOccasionalPremiumAlerts,I.k9.ethicalAI,I.k9.citations,I.k9.citation_detection_card,I.k9.citation_gap,I.k9.toneAI];return e.features.denali.toneDetector&&i.push(I.k9.emogenieCheck),t===ye.l1.FormattingMode.on&&i.push(I.k9.supportsFormatting),e.features.denali.writingExpertVbarsEnabled&&i.push(I.k9.vbarAlerts),e.features.denali.gDebugger&&i.push(I.k9.gDebugger),i}static _getCAPIClientConfigs(e,t){return{sdui:{version:b.r,config:Ge},cheetah:e.features.denali.cheetah?{version:g.r}:void 0,storage:e.features.denali.backendManagedStorageEnabled&&void 0!==t?{version:S.r}:void 0}}static _prepareCAPIWSHandler(e,t,i,n){return new V.G(i.features.denali.dlp?(()=>{const n=new de.G(C.toUndefined(he.kz.getDLPConfig(i)),[m.Js.Message]);return n.sanitizeWSHandler(new A.Mk(n.sanitizeWS(E.WS.create(t),F.z7),e,10))})():new A.Mk(E.WS.create(t).writer(F.z7),e,10),n)}static _prepareCAPI(e,t,i,n){const s=new L.E(i,(e=>e.connect(Je._getCapiWsUrl(n,t))),e,{commands:12e4});return(0,v.hJ)("capi",s.client),s}static _trackSessionEnd(e,t,i){return n.create(e).sessionStats.pipe(Y.M((e=>t.send({kind:"session_end",session_id:e.sessionUuid,integration_id:i.pageSessionId,session_duration:e.duration},{sendSessionInfo:!0,sendUserInfo:!0}))))}static _createCAPIEventsForAlertsCount(e){return Q.O(e.pipe(X.j((e=>"session_inbound"!==e.kind)),ee.S(((e,t)=>"alert_received"===t.kind?e+1:e),0),te.U(ie.O1(ze).pipe(Z.s(1)))),e.pipe(j.p((e=>"finish"===e.kind)))).pipe(ne.n((e=>"number"==typeof e?se.of(e):oe.w)),Z.s(1))}static _createCAPIWS({userAccount:e,accessToken:t,createWSInstance:i,capiEvents:n,environment:s,context:o,rtfMode:a,isDemoDoc:r,config:l,docid:d,wsConnectivity:c,backendManagedStorageManager:p}){const h=new T.C(I.to,0,!1),g=(0,u.pipe)(e.settings.dialect.get(),C.getOrElse((()=>"undefined")));return this._prepareCAPI(Je._prepareCAPIWSHandler(h,i,e,t),e,{client:s.names.capi,clientVersion:s.buildVersion.toString(),context:o,handler:Fe(n,c),docid:d,dialect:g,clientSupports:this._getClientSupports(e,a),clientConfigs:this._getCAPIClientConfigs(e,p),isDemoDoc:r,idGenerator:h,shouldSendFeedback:e=>!0!==$.g.disabledFeedbacks.some((t=>t===e.kind))||e.kind===O.yp.RENDERED||"subtype"in e&&(e.subtype===O.U3.Vbar||e.subtype===O.U3.UnderlineWithTeaser)},l)}static _createMutedCategoriesWithCache(e,t,i,n,s,o){const a=new Se(u.identity,u.identity,s.mutedCategoriesCache.prefix,s.mutedCategoriesCache.version,ae.hQ.fromLocalStorage(ae.ls),12096e5),r=G.x.CategoriesModel.create(e,t,i.state,n,o.demoMode?O.xD.ScopeType.DOCUMENT:O.xD.ScopeType.GLOBAL);return{cacheManager:new Me(r,o.isFree.get(),a),mutedAlertsModel:r}}static _createSDUI(e,t,i){const n=(e=>()=>{const n=new l.c(t.state,e,i.getByRawAlertId.bind(i));return(0,v.hJ)("sduiManager",n),n})((0,u.pipe)(e,j.p((e=>"sdui_add"!==e.kind&&"sdui_update"!==e.kind&&"sdui_remove"!==e.kind||!(!c.Q.isSduiEvent(e)||"sdui_remove"===e.kind||!p.X2.isGlobalPart(e.sdui))||e.sduiRootId.toLowerCase().endsWith("@inline")))));return{sduiFactory:n,sduiInlineFactory:e=>{const t=new d.s(e.state);return(0,v.hJ)("sduiInlineManager",t),t}}}static _createModels(e,t,i,n,s,o){const a=new $e.uL(e,t,i,n),r=(0,u.pipe)(C.fromNullable(s.rtfMode===pe.jj.l1.FormattingMode.on),C.filter(Boolean),C.map((()=>Ve.create(n)))),l=W.d.UserTextChangesSync.create(n);return{changesSources:K.pH.merge((0,u.pipe)(r,C.fold((()=>[o,a]),(e=>[o,a,e])))),dedSync:l,formattingModel:r,synonymsModel:a}}static _createCAPI(e,t,i,n,s,o){const l=new P.$(t,e,i,!1,o),d=new N.u(e,(()=>{const e=new Set;return"off"!==n.features.denali.recordCapiMessages&&e.add("captureCapiMessages"),e})()),c=new D.E(l,e,i,n.settings,s),p=_.s.create({});return c.registerExternalMessageHandler((e=>(p.modify((t=>(0,r._)((0,a._)({},t),{[e.action]:e}))),B.Q.Result.CONTINUE_HANDLING))),{capiWatcher:d,observableCapi:c,latestCAPIMessageByActionName:p,capi:l}}constructor(e,t,i,n,s,a,r,l,d,c,p,g,m,v,f,y,b,S,M,E){(0,o._)(this,"cheetah",void 0),(0,o._)(this,"obsCapiClient",void 0),(0,o._)(this,"latestCAPIMessageByActionName",void 0),(0,o._)(this,"sessionModel",void 0),(0,o._)(this,"positionManager",void 0),(0,o._)(this,"alternativeManager",void 0),(0,o._)(this,"checkingDomain",void 0),(0,o._)(this,"alertsService",void 0),(0,o._)(this,"alertsReader",void 0),(0,o._)(this,"alertsRepository",void 0),(0,o._)(this,"synonymsModel",void 0),(0,o._)(this,"formattingModel",void 0),(0,o._)(this,"emotionsModel",void 0),(0,o._)(this,"mutedAlertsModel",void 0),(0,o._)(this,"_sduiFactory",void 0),(0,o._)(this,"_sduiInlineFactory",void 0),(0,o._)(this,"_onShutdown",void 0),(0,o._)(this,"_capiConnection",void 0),(0,o._)(this,"_capiWatcher",void 0),(0,o._)(this,"_capiConManager",void 0),(0,o._)(this,"hasAlertsCache",void 0),(0,o._)(this,"sduiManager",void 0),(0,o._)(this,"sduiInlineManager",void 0),(0,o._)(this,"sduiService",void 0),(0,o._)(this,"resetSDUI",void 0),this.cheetah=e,this.obsCapiClient=t,this.latestCAPIMessageByActionName=i,this.sessionModel=n,this.positionManager=s,this.alternativeManager=a,this.checkingDomain=r,this.alertsService=l,this.alertsReader=d,this.alertsRepository=c,this.synonymsModel=p,this.formattingModel=g,this.emotionsModel=m,this.mutedAlertsModel=v,this._sduiFactory=f,this._sduiInlineFactory=y,this._onShutdown=b,this._capiConnection=S,this._capiWatcher=M,this._capiConManager=E,this.hasAlertsCache=!1,this.resetSDUI=e=>()=>{w.Bx.Logging.getLogger("StEngine").debug(`resetting SDUI managers, reason: ${e}`),(0,u.pipe)(k.CO(C.fromNullable(this.sduiManager),C.fromNullable(this.sduiInlineManager)),k.jw((()=>{const e=this._sduiFactory();this.sduiManager=_.s.create(e),this.sduiInlineManager=_.s.create(this._sduiInlineFactory(e))})),k.Mi((([e,t])=>{e.get().dispose(),e.set(this._sduiFactory()),t.get().dispose(),t.set(this._sduiInlineFactory(e.get()))})))},this.sduiService=new h.G(t),this.resetSDUI("engine init")()}}const je=(e,t,i,n,s,o)=>re.RF((()=>Promise.resolve().then((()=>{const a=(0,we.c)(t.userAccount,i,{rtfMode:ye.l1.FormattingMode.on},K.MA.noopSync(e));return[a,Je.createBase(e,s,t.telemetry,t.wsConnectivity,a,t.userAccount,i,n,t.fingerprints.accessToken,o)]})))).pipe(le.u())},50248:(e,t,i)=>{i.d(t,{M:()=>ui});var n,s=i(23988),o=i(10334),a=i(17171),r=i(66202),l=i(94855),d=i(84647),c=i(81648),p=i(24819),h=i(84712),u=i(90829),g=i(1224),m=i(65390),_=i(65160),v=i(76005),f=i(61198),y=i(63967),b=i(62597),S=i(53717),w=i(69774),C=i(34553),k=i(3016),M=i(48779),E=i(9079),T=i(7149),x=i(99010),I=i(92832),A=i(84872),F=i(91745),V=i(5406),L=i(42279),O=i(29862),B=i(99339),R=i(58655),U=i(30343),N=i(37839),P=i(60191),D=i(58260),H=i(53458),K=i(79937),W=i(89143),G=i(93208),$=i(4444),z=i(57836),J=i(98514),j=i(22814),Z=i(32260),q=i(26528),Y=i(52267),Q=i(37262),X=i(26251),ee=i(6019),te=i(98719),ie=i(40884);!function(e){e.create=()=>({doubleClickedWord:new C.B})}(n||(n={}));var ne,se=i(5731),oe=i(91956),ae=i(92802),re=i(43696),le=i(45653),de=i(78884),ce=i(87275),pe=i(80949);!function(e){let t;e.focusAlertByClickedMark=e=>t=>({name:"focus alert by clicked mark",source:e.pipe($.oE,F.p((e=>y.Fc.State.isRegistered(e.alert.state)&&!le.A.isPremiumPreviewPlagiarism(e.alert))),x.M((e=>t.focusAlertHighlight((0,a._)((0,o._)({},e),{source:ce.nl.forceText})))),T.T(r.right))}),e.highlightMark=(e,t,i,n,s,o)=>a=>{const l=i.pipe(T.T(m.exists((e=>e.id===se.B.Id.editor))),K.n((e=>L.h(n.pipe(z.u(!0)),s.pipe(F.p((0,ae.AU)(d.identity)),z.u(!1))).pipe(T.T((t=>!t&&e)),R.F(),U.Z(!0)))));return{name:"highlight mark",source:a.alertHighlightChanges.pipe(K.n(M._F.rafScheduler),P.fY(m.getEq(de.z.getEq())),T.T(m.filter((t=>m.isSome(e.getRegistered(t.alert.id))))),G.E(l,o),K.n((([e,i,n])=>(0,d.pipe)(e,m.filter((e=>n||e.source===ce.nl.forceText)),m.fold((()=>V.w),(e=>new re.c((s=>(i&&n&&[ce.nl.forceSidebar,y.Kz.api].includes(e.source)&&!le.A.isPremium(e.alert)&&t.moveCursorToHighlight(e,"start"),(0,d.pipe)(t.focusAlertHighlight(e),r.fold((t=>(s.next(r.left({level:g.y7.$.WARN,message:"Cannot focus mark",error:t,data:{alertId:e.alert.id,highlightIndex:e.highlightIndex}})),d.constVoid)),(t=>(s.next(r.right(e)),()=>t.dispose())))))))))))))}},e.unfocusAlertHighlightOnSidebarClose=e=>t=>({name:"unfocus alert highlight on sidebar close",source:e.pipe(F.p((0,ae.AU)(d.identity)),x.M(t.unfocusAlertHighlight),T.T(r.right))}),e.updateLoaderStateOnReady=e=>t=>({name:"update loader state on ready",source:t.lifecycleEvents.pipe(F.p(pe.f.isVisuallyReady),x.M((()=>e.state.modify((e=>(0,a._)((0,o._)({},e),{lens:m.none}))))),z.u(r.right(void 0)))}),e.scrollAlertIntoView=(e,t)=>i=>({name:"scrollAlertIntoView",source:t.pipe(K.n((t=>t?i.scrollIntoViewChanges.pipe(G.E(i.alertVisibilityFilter),F.p((([e,t])=>t(e.alert))),K.n((([t])=>e.ensureAlertHighlightInViewport(t,200,v.nA.initial).pipe(T.T(r.bimap((e=>({level:g.y7.$.WARN,message:"Move focused mark into viewport: Cannot ensure alertHighlight in viewport",error:e,data:t})),(0,d.constant)(t))))))):V.w)))}),e.toggleAutoScroll=e=>t=>({name:"toggleAutoScroll",source:e.pipe(x.M(t.toggleAutoScroll),T.T(r.right))}),function(e){e.create=(e,...t)=>i=>{const n=new k.y.Keeper,s=e.getLogger("Integration",g.y7.$.DEBUG,g.y7.I.ViewModel.base);return n.push(L.h(...t.map((e=>{const{name:t,source:n}=e(i);return n.pipe(x.M(r.fold((e=>s.log(e.level,`${t}: ${e.message}`,e.error,e.data)),(e=>s.debug(t,e)))))}))).subscribe()),n}}(t=e.Factory||(e.Factory={}))}(ne||(ne={}));var he=i(75248),ue=i(35130);class ge{_listenLensChanges(){return L.h(this._navigationViewModel.activeLensId.pipe(E.J(),x.M((([e,t])=>this._log.debug("Lens switched",{prev:e,next:t}))),K.n((([e,t])=>{switch(t){case b.J.SpecialId.AllAlerts:return[b.J.SpecialId.Premium,b.J.SpecialId.FreePremiumAlerts].includes(e)?V.w:this._lifecycleManager.initAssistant();case b.J.SpecialId.Cheetah:return this._lifecycleManager.initGGO();case b.J.SpecialId.Plagiarism:return[b.J.SpecialId.Closed,b.J.SpecialId.Cheetah].includes(e)?this._lifecycleManager.initAssistant().pipe(he.K(this._waitForVisuallyReady),K.n(this._oggyPlagiarismModel.request)):this._oggyPlagiarismModel.request();case b.J.SpecialId.Premium:case b.J.SpecialId.FreePremiumAlerts:return[b.J.SpecialId.Closed,b.J.SpecialId.Cheetah].includes(e)?this._lifecycleManager.initAssistant().pipe(he.K(this._waitForVisuallyReady),K.n(this._oggyUphookModel.request)):this._oggyUphookModel.request();case b.J.SpecialId.Closed:return this._lifecycleManager.disposeUI(),V.w;default:return V.w}}))),this._lifecycleManager.initAssistant()).subscribe()}_pushLensChangesFromOggy(){return L.h(this._oggyPlagiarismModel.state.view("isAvailable").pipe(K.n((e=>e?this._oggyPlagiarismModel.state.view("focus").view((e=>e===ue.I.Focus.none?b.J.SpecialId.AllAlerts:b.J.SpecialId.Plagiarism)):V.w))),this._oggyUphookModel.state.view("isAvailable").pipe(K.n((e=>e?this._navigationViewModel.activeLensId.pipe(F.p((0,u.Ub)(b.J.isAllAlerts,b.J.isPremiumId,b.J.isFreePremiumId)),K.n((e=>e?this._oggyUphookModel.state.view("focus").view((e=>e===ue.I.Focus.none?b.J.SpecialId.AllAlerts:b.J.SpecialId.Premium)):V.w))):V.w)))).subscribe((e=>{this._log.debug("Switching to lens from Oggy",{currentLens:this._navigationViewModel.activeLensId.get(),nextLens:e}),this._navigationViewModel.events.next({type:"switchToLens",id:e,focusFirst:!1,actionSource:y.Kz.api})}))}_focusCardOnNavigation(){return this._navigationViewModel.alertSwitchChanges.pipe(x.M((e=>{this._oggy.focusAlertHighlight((0,a._)((0,o._)({},e),{source:y.Kz.api}))}))).subscribe()}_openCardFromInlineAlert(){return this._navigationViewModel.state.pipe(K.n((e=>e.isSidebarOpen?V.w:this._inlineAlertChanges.pipe(x.M((e=>{this._oggy.focusAlertHighlight({alert:e.alert,highlightIndex:e.highlightIndex,source:ce.nl.forceText}),this._navigationViewModel.events.next({type:"toggleSidebar",actionSource:y.Kz.text})})))))).subscribe()}dispose(){this._subs.dispose()}constructor(e,t,i,n,o,a){(0,s._)(this,"_navigationViewModel",void 0),(0,s._)(this,"_inlineAlertChanges",void 0),(0,s._)(this,"_oggy",void 0),(0,s._)(this,"_lifecycleManager",void 0),(0,s._)(this,"_oggyUphookModel",void 0),(0,s._)(this,"_oggyPlagiarismModel",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_waitForVisuallyReady",void 0),this._navigationViewModel=e,this._inlineAlertChanges=t,this._oggy=i,this._lifecycleManager=n,this._oggyUphookModel=o,this._oggyPlagiarismModel=a,this._subs=new k.y.Keeper,this._log=g.Bx.Logging.getLogger("OggyNavigationViewModel"),this._waitForVisuallyReady=this._oggy.lifecycleEvents.pipe(F.p(pe.f.isVisuallyReady),D.s(1)),this._subs.push(this._pushLensChangesFromOggy(),this._listenLensChanges(),this._focusCardOnNavigation(),this._openCardFromInlineAlert())}}var me=i(83531),_e=i(46797),ve=i(14553),fe=i(82585),ye=i(48368),be=i(38886),Se=i(89011),we=i(83694),Ce=i(10479),ke=i(25093),Me=i(79),Ee=i(49990);function Te(e,t){return A.z([e,t]).pipe(T.T((([e,t])=>e&&!t)))}function xe(){return we.of(!0)}function Ie(){return we.of(!0)}function Ae(e){const t=e.getText();return(0,d.pipe)(["Grammarly Premium can give you very helpful feedback on your writing. Passive voice can be fixed by Grammarly, and it can handle classical word-choice mistakes.","Grammarly Premium can give you very helpful feedback on your writing.","Passive voice can be fixed by Grammarly, and it can handle classical word-choice mistakes.","You'll find suggestions that can possibly help you revise a wordy sentence in an effortless manner."],be.CX((e=>{const i=t.indexOf(e);return i>-1?m.some({index:i,length:e.length}):m.none})))}const Fe=[ye.f.Popup,ye.f.Popover];function Ve(e,t,i){e.modify((e=>{const n=e.slice(0);return n[t]=i,n}))}class Le{_initSteps(e=new Set){this._stepsSubscriptions.forEach((e=>e.unsubscribe())),this._stepsSubscriptions=[],function(e,t,i,n,s,o,a,r){if(ie.vI.isHidden(s))return[];const l=r.denali.showOnboardingTourA11yUpdates,c=l?function(e){return e.onboardingViewModels.pipe(K.n((e=>(0,d.pipe)(e,m.fold((()=>we.of(m.none)),(e=>e.onboarding.activeStep)))))).pipe(T.T((e=>(0,d.pipe)(e,m.fold((()=>!1),(e=>{var t;return"initial"===e.name||"initialBTS"===(null===(t=e)||void 0===t?void 0:t.name)}))))))}(o):we.of(!1),u={id:Se.E.StepId.Step11,switch:()=>function(e,t){return h.s.combine(t,e,((e,t)=>t&&m.isNone(e))).pipe(ke.$())}(a.state.view("isSidebarOpen"),n),gnarName:"Step 1: Select active card",skipDot:l},g={id:Se.E.StepId.Step4,switch:()=>{const e=function(e,t){return e.view(m.exists((e=>t.isRegistered(e.alert.id)&&le.A.isDefault(e.alert)&&m.isSome(e.alert.getTransform()))))}(n,i);return Te(e,c)},gnarName:"Step 2: Apply alert",skipDot:l},v={id:Se.E.StepId.GrammarlyGORewrite,switch:()=>function(e,t){return e.navigation.isGGOLensActive.pipe(Ee.U(e.isGenAiAvailable.pipe(F.p(d.identity))),T.T((e=>(0,d.pipe)(t,m.fromPredicate((()=>!e)),m.chain(Ae),m.fold(d.constFalse,d.constTrue)))))}(o,e),gnarName:"Step 3: Click GrammarlyGO Rewrite",skipDot:l,prepareStep:()=>(0,d.pipe)(o.navigation,m.fromPredicate((e=>!e.isGGOLensActive.get())),m.chain((()=>Ae(e))),_.Mi((({index:t,length:i})=>{e.setCursor(t,i)})),m.fold(d.constFalse,d.constTrue))},f={id:Se.E.StepId.GrammarlyGOIdeationAssistant,switch:()=>Te(function(e){return e.navigation.isGGOLensActive.pipe(T.T((e=>!e)))}(o),c),gnarName:"Step 4: Open GrammarlyGO Ideation Assistant",skipDot:l},y={id:Se.E.StepId.Step1,switch:()=>Te(we.of(!0),c),gnarName:"Step 5: Open Set Goals",skipDot:l},b={id:Se.E.StepId.Step8,switch:()=>Te(we.of(!0),c),gnarName:"Step 6: Open Performance",skipDot:l},S={id:Se.E.StepId.Step9,switch:()=>{return i=e.contentUpdated.pipe(z.u(M.q6)),n=t.checkingState,Ce.H(n.pipe(F.p((e=>"idle"===e)),ke.$(),z.u(!0))).pipe(Me.h(i.pipe(ke.$(),z.u(!1))));var i,n},gnarName:"Step 7: See synonyms",skipDot:l},w={id:Se.E.StepId.Step10,switch:xe,gnarName:"Step 8: Open left sidebar",skipDot:l},C={id:Se.E.StepId.DocumentTitle,switch:Ie,gnarName:"Step 9: Edit title",skipDot:l};switch(s.content){case ie.vI.Content.Oggy:return[g,y,b,w,C];case ie.vI.Content.OggySplit:case ie.vI.Content.WithoutInlineCards:return[g,v,f,y,b,w,C];case ie.vI.Content.Full:return[u,g,v,f,y,b,S,w,C];default:return(0,p.xb)(s)}}(this._ded,this._sessionChecksModel,this._alertsReader,this._activeAlertHighlight,this._mode,this._cheetahViewModel,this._navigationViewModel,this._features).forEach(((t,i)=>this._addStep(t,i,e)))}isLastStep(e){return Boolean(this._steps[e].isLastStep)}isStepEnabled(e){return void 0!==this._steps[e]}subscribeForStep(e){const{state:t,gnarName:i}=this._steps[e];if(void 0===t)throw new Error("Illegal onboarding step id "+e);return{id:e,state:t,dotShown:()=>{this._telemetry.gnarSpec.onboardingStepDotOnboardingShow(this._telemetry.pageId,i)},dotClicked:()=>{(0,p.V1)(t.get()===ye.f.Dot,"Should be in dot state"),this._log.info("Dot clicked for: "+e),t.set(ye.f.Popup),this._telemetry.gnarSpec.onboardingStepOnboardingPass(this._telemetry.pageId,i)},popupIgnored:()=>{(0,p.V1)(this._isPopup(t.get()),"Should be in popup state"),this._log.info("Popup ignored for: "+e),t.set(ye.f.Hidden),this._updateStates()},popupClosed:()=>{(0,p.V1)(this._isPopup(t.get()),"Should be in popup state"),this._log.info("Popup closed for: "+e),t.set(ye.f.Passed),this._updateStates()},actionTaken:()=>{(0,p.V1)(this._isPopup(t.get())||t.get()===ye.f.Dot,"Should be in popup or dot state"),this._log.info("Action taken for: "+e),t.set(ye.f.Passed),this._updateStates(),this._telemetry.gnarSpec.onboardingStepOnboardingPass(this._telemetry.pageId,i)}}}unsubscribe(){this._subs.forEach((e=>e.unsubscribe())),this._stepsSubscriptions.forEach((e=>e.unsubscribe()))}getStepCompletionCallback(e){return()=>{if(this.isStepEnabled(e)){const t=this.subscribeForStep(e),i=t.state.get();(i===ye.f.Dot||this._isPopup(i))&&t.actionTaken()}}}changeState(e){this._enableState.set(e)}relaunchAllSteps(){this._initSteps()}_updateStates(){var e=this;return(0,me._)((function*(){yield(0,u.yy)(500);const t=e._switches.get();e._log.debug("Onboarding switches updated "+t);const i=e._states.get().slice();t.forEach(((e,t)=>{e||i[t]===ye.f.Hidden||i[t]===ye.f.Passed||(i[t]=ye.f.Hidden)}));const n=i.filter((t=>e._isPopup(t)||t===ye.f.Dot)).length;let s=Math.max(0,1-n);for(let n=0;n<i.length&&!(s<=0);++n)if(i[n]===ye.f.Hidden&&t[n]){var o,a,r;if(null!==(r=null===(o=(a=e._stepsByIdx[n]).prepareStep)||void 0===o?void 0:o.call(a))&&void 0!==r&&!r){i[n]=ye.f.Hidden;continue}e._stepsByIdx[n].skipDot?i[n]=e._features.denali.showOnboardingTourA11yUpdates?ye.f.Popover:ye.f.Popup:i[n]=ye.f.Dot,s--}const l=i.filter((t=>e._isPopup(t)||t===ye.f.Dot)).length;(0,p.V1)(l<=1,`Should be only 1 popups and dots visible, now ${l}`),e._states.set(i)}))()}constructor(e,t,i,n,o,a,r,l,c,p,_){(0,s._)(this,"_settings",void 0),(0,s._)(this,"_ded",void 0),(0,s._)(this,"_sessionChecksModel",void 0),(0,s._)(this,"_alertsReader",void 0),(0,s._)(this,"_mode",void 0),(0,s._)(this,"_telemetry",void 0),(0,s._)(this,"_activeAlertHighlight",void 0),(0,s._)(this,"_getFirstTargetRect",void 0),(0,s._)(this,"_cheetahViewModel",void 0),(0,s._)(this,"_navigationViewModel",void 0),(0,s._)(this,"_features",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_steps",void 0),(0,s._)(this,"_stepsByIdx",void 0),(0,s._)(this,"_switches",void 0),(0,s._)(this,"_states",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"_stepsSubscriptions",void 0),(0,s._)(this,"_enableState",void 0),(0,s._)(this,"getFirstTargetRect",void 0),(0,s._)(this,"completionTrigger",void 0),(0,s._)(this,"_isPopup",void 0),(0,s._)(this,"_addStep",void 0),this._settings=e,this._ded=t,this._sessionChecksModel=i,this._alertsReader=n,this._mode=o,this._telemetry=a,this._activeAlertHighlight=r,this._getFirstTargetRect=l,this._cheetahViewModel=c,this._navigationViewModel=p,this._features=_,this._log=g.Bx.Logging.getLogger("OnboardingViewModelImpl",g.y7.$.TRACE),this._steps={},this._stepsByIdx=new Array,this._switches=h.s.create([]),this._states=h.s.create([]),this._subs=[],this._stepsSubscriptions=[],this._enableState=h.s.create(!0),this.getFirstTargetRect=this._getFirstTargetRect,this.completionTrigger=this._activeAlertHighlight.view(m.isSome),this._isPopup=e=>Fe.includes(e),this._addStep=(e,t,i)=>{Ve(this._switches,t,!1);const n=this._states.lens(_e.Pe(t).compose(_e.IQ("dummy")));Ve(this._states,t,i.has(e.id)?ye.f.Passed:ye.f.Hidden),this._steps[e.id]={state:n,idx:t,gnarName:e.gnarName,isLastStep:e.isLastStep},this._stepsByIdx[t]=e,this._stepsSubscriptions.push(e.switch().pipe(ve.z(this._enableState,((e,t)=>e&&t))).subscribe((e=>Ve(this._switches,t,e)),(e=>{this._log.error("onboarding malfunction",e),Ve(this._states,t,ye.f.Passed)})))};const v=ie.vI.isForced(o)?new Set:new Set(this._settings.onboardingPassed.get());this._initSteps(v),this._subs.push(this._switches.pipe(fe.B(500)).subscribe((e=>this._updateStates()))),this._subs.push(this._states.pipe(I.i(1)).subscribe((e=>this._settings.updateOnboardingPassed(Object.keys(this._steps).filter((t=>e[this._steps[t].idx]===ye.f.Passed)))))),this._log.isEnabled(g.y7.$.TRACE)&&this._subs.push(this._states.subscribe((e=>this._log.debug("Onboarding states updated: "+e.join(", "))))),(0,u.hJ)("fireOnboardingStep",((e,t)=>(0,d.pipe)(m.fromNullable(this._steps[e]),m.fold((()=>console.info("No such step "+e)),(e=>e.state.set(t)))))),(0,u.hJ)("onboardingState",this)}}var Oe=i(7432),Be=i(55340),Re=i(72106),Ue=i(889),Ne=i(40808),Pe=i(58538),De=i(26730);class He{getFirstSynonymRect(){return this.getFirstSynonym().pipe(T.T(m.chain((e=>m.fromEither(e.getRect())))))}getSynonymMarkRect(e){return l.Mr(this._ded.getMarkRect(e))}scrollToMark(e,t,i){return this._ded.scrollToMark(e,{animate:i,paddingTop:t})}onPopupOpen(){(0,d.pipe)(this.viewState.get(),m.map((e=>e.synonymsState)),m.filter((0,u.Ub)(Pe._g.isReady,Pe._g.isEmpty)),m.map((({stats:e,pname:t})=>({stats:e,pname:t}))),m.getOrElse((()=>({stats:Pe.yp.emptySynonymsStats,pname:"unknown"}))),(({pname:e,stats:t})=>{this._trackSynonymPopupOpen(e,t)}))}getFirstSynonym(){return re.c.create((e=>{let t=m.none;const i=Ke(this._ded.getText()),n=i.length?m.some(Oe.vY.create(i[0].start,i[i.length-1].end)):m.none,s=(0,d.pipe)(n,m.fold((()=>[]),(e=>this._positionManager.findRanges((t=>Ue.l.isVisible(t)&&Oe.vY.isOverlap(t,e)))))),o=Ce.H(Promise.all(We(i,s).map(this.query))).pipe(T.T((0,d.flow)((0,be.i8)(Pe._g.isReady),m.chain((e=>{const t=Be.C.SynonymMark.generateSynonymOnboardingId(e.synonyms.id),i=Oe.vY.create(e.query.start,e.query.start+e.query.word.length),n=this._synonymsModel.positionManager.registerRange(t,i);return(0,d.pipe)(this._ded.changeMarks([Re.J.Change.getCreateAction({range:()=>n,order:0,classes:[]})(t)]),(e=>e.created.get(t)),m.fromNullable,m.chain(m.fromEither))})))),ke.$()).subscribe((i=>{t=i,e.next(i)}));return()=>{m.map(this.disposeFirstSynonym)(t),o.unsubscribe()}}))}apply(e){const t=this.viewState.get();(0,d.pipe)(t,m.map((({synonymsState:t,activeWord:i})=>{if(!Pe._g.isReady(t))throw new p.zU("Synonym should exist.");this._trackSynonymAccept(t.pname,(0,o._)({},t.stats,Pe.yp.getSynonymStats(e,t.synonyms.synonymsOrGroups)),Pe.yp.getTimeToClose(t.readyAt));const n=this._synonymsModel.applySynonym({id:t.synonyms.id,dispose:d.constVoid,range:i},e);(0,Ne.M7)((()=>this._notificationsManager.enqueue("alertUndo",{params:(0,Ne.cm)([n])})),this._trackUndoCloseButton,(()=>(this._ded.flushChanges(),this._ded.contentUpdated))).subscribe((e=>"commit"===e?n.commit():n.undo()))}))),this.close("apply")}dispose(){this._subs.forEach((e=>e.unsubscribe())),this._subs=[]}_request(e){return this.query({start:e.start,word:e.meta.value}).then(m.some).catch((e=>(this._log.error("Error querying synonyms",e),m.none)))}_canShowPopup(e){return Pe._g.isReady(e)||Pe._g.isEmpty(e)}_deregisterRange(e){(0,d.pipe)(this._synonymsModel.positionManager.findById(e),m.fold(d.constVoid,(t=>{this._ded.flushChanges(),this._synonymsModel.positionManager.deregisterRange(e)})))}_handleState(){this._subs.push(this._inlineManager.doubleClickedWord.pipe(K.n(this._emitCloseWhen),T.T(m.filter(this._isOnline)),$.cy((e=>(this._ded.flushChanges(),this._withRegisteredWord(e,(0,d.flow)(this._listenQuery,K.n(this._createSynonymsState),T.T(m.some))))))).subscribe(M.H9(this.viewState),(e=>this._log.error("can not change syns state",e))))}constructor(e,t,i,n,o,a,l,c,p,v,f){(0,s._)(this,"_inlineManager",void 0),(0,s._)(this,"_positionManager",void 0),(0,s._)(this,"_synonymsModel",void 0),(0,s._)(this,"_networkState",void 0),(0,s._)(this,"_ded",void 0),(0,s._)(this,"_notificationsManager",void 0),(0,s._)(this,"_activeAlertChanges",void 0),(0,s._)(this,"_trackUndoCloseButton",void 0),(0,s._)(this,"_trackSynonymPopupOpen",void 0),(0,s._)(this,"_trackSynonymPopupDismiss",void 0),(0,s._)(this,"_trackSynonymAccept",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_style",void 0),(0,s._)(this,"viewState",void 0),(0,s._)(this,"popupShown",void 0),(0,s._)(this,"_defaultClassName",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"disposeFirstSynonym",void 0),(0,s._)(this,"query",void 0),(0,s._)(this,"close",void 0),(0,s._)(this,"_withRegisteredWord",void 0),(0,s._)(this,"_listenQuery",void 0),(0,s._)(this,"_createSynonymsState",void 0),(0,s._)(this,"_removeMark",void 0),(0,s._)(this,"_createMark",void 0),(0,s._)(this,"_emitCloseWhen",void 0),(0,s._)(this,"_isOnline",void 0),this._inlineManager=e,this._positionManager=t,this._synonymsModel=i,this._networkState=n,this._ded=o,this._notificationsManager=a,this._activeAlertChanges=l,this._trackUndoCloseButton=c,this._trackSynonymPopupOpen=p,this._trackSynonymPopupDismiss=v,this._trackSynonymAccept=f,this._log=g.Bx.Logging.getLogger("LegacySynonymsViewModel"),this.viewState=h.s.create(m.none),this.popupShown=this.viewState.view(m.fold((()=>!1),(e=>e.popupVisible))),this._defaultClassName="defaultSynonymClass",this._subs=[],this.disposeFirstSynonym=e=>{this._ded.changeMarks([Re.J.Change.getRemoveAction({range:()=>r.getOrElse((e=>e))(e.range())},Re.J.Change.RemoveType.full)(e.id)]),this._deregisterRange(e.id)},this.query=e=>(this._ded.flushChanges(),this._synonymsModel.query(e)),this.close=e=>{"closedByUser"===e&&(0,d.pipe)(this.viewState.get(),m.map((e=>e.synonymsState)),m.filter((0,u.Ub)(Pe._g.isReady,Pe._g.isEmpty)),_.Mi((e=>{this._synonymsModel.ignore(e.synonyms.id),this._trackSynonymPopupDismiss(e.pname,e.stats,Pe.yp.getTimeToClose(e.readyAt))}))),this._inlineManager.closeSynonyms.next()},this._withRegisteredWord=(e,t)=>re.c.create((i=>{const n=this._synonymsModel.positionManager.registerRange(Be.C.SynonymMark.generateActiveWordRandomId(),e),s=t(n).subscribe(i);return()=>{s.unsubscribe(),this._deregisterRange(n.meta.id)}})),this._listenQuery=e=>new re.c((t=>(this._request(e).then((i=>{var n;null!==(n=t.closed)&&void 0!==n&&n||(0,d.pipe)(i,m.fold((()=>this.close("error")),(i=>{var n,s;return null===(n=(s=t).next)||void 0===n?void 0:n.call(s,[e,i])})))})),()=>{this._synonymsModel.abortQuery()}))),this._createSynonymsState=([e,t])=>re.c.create((i=>{const n=this._canShowPopup(t);return(0,d.pipe)(this._createMark(e,n),(s=>(0,d.pipe)(s.range(),r.fold((e=>{this._log.error("Error creating Synonym state",e)}),(o=>{const a=this._synonymsModel.positionManager.registerRange(s.id,o),r={synonymsState:t,activeWord:e,activeMark:a,popupVisible:n};return i.next(r),()=>{this._deregisterRange(r.activeMark.meta.id),setTimeout((()=>this._removeMark(r)),10)}})))))})),this._removeMark=e=>{try{this._ded.flushChanges(),(0,d.pipe)(this._ded.getMarkById(e.activeMark.meta.id),r.map((t=>{this._ded.changeMarks([Re.J.Change.getRemoveAction({range:()=>(0,d.pipe)(t.range(),r.getOrElse((e=>e)))},Re.J.Change.RemoveType.full)(e.activeMark.meta.id)])})))}catch(e){this._log.error("Cannot remove synonym",e)}},this._createMark=(e,t)=>(0,d.pipe)(this._ded.changeMarks([Re.J.Change.getCreateAction({range:()=>e,classes:t?[this._defaultClassName,this._style.synonym,this._style.markSelected]:[this._defaultClassName,this._style.markHidden],order:0})(Be.C.SynonymMark.id)]),(e=>e.created.get(Be.C.SynonymMark.id)),r.fold((()=>null),d.identity)),this._emitCloseWhen=$.MA((()=>L.h(this._ded.contentUpdated,this._activeAlertChanges.pipe(I.i(1)),B.R(document,"keydown")).pipe(z.u(M.q6),x.M((()=>this.close("closedByUser")))))),this._isOnline=()=>"offline"!==this._networkState.getOnlineStatus(),this._style=(0,De.ID)(),this._handleState()}}const Ke=(e,t=10)=>{const i=/( |^)[a-z]{3,}\b/gim,n=[];let s;for(let o=0;(s=i.exec(e))&&o<t;o++){const e=s[0].replace(" ",""),t=i.lastIndex-e.length,o=t+e.length;n.push({start:t,word:e,end:o})}return n},We=(e,t)=>0===t.length||0===e.length?e:(()=>{const i=e[e.length-1].end,n=t.findIndex((e=>e.start>i)),s=n>=0?t.slice(0,n):t;return e.filter((e=>s.every((t=>!(e.start<=t.end&&t.start<=e.end)))))})();var Ge=i(78747),$e=i(86780),ze=i(74056),Je=i(11864);const je="denali-a11y-log-container",Ze="denali-a11y-alert-container",qe="denali-a11y-status-container-",Ye=Je.Ks.style({position:"absolute",width:"1px",height:"1px",padding:0,margin:"-1px",overflow:"hidden",clip:"rect(0,0,0,0)",border:0});function Qe(e){const t=document.getElementById(e);if(t)return t;{const t=document.createElement("div");return t.id=e,document.body.appendChild(t),t}}function Xe(e,t){const i=document.createElement("div");i.textContent=e,t.appendChild(i),setTimeout((()=>{i.remove()}),5e3)}function et(e){e.setAttribute("class",Ye),e.setAttribute("data-verified","true")}class tt{constructor(e){(0,s._)(this,"sessionUuid",h.s.create("")),e.pipe(F.p((({action:e})=>"start"===e)),T.T((({sessionUuid:e})=>e)),D.s(1)).subscribe(M.H9(this.sessionUuid))}}var it,nt=i(52827),st=i(79239);!function(e){const t=/([^\s]+\s+[^\s]+)/;e.create=function(e,i,n,s){const o=n.pipe(T.T((0,ae.AU)(nt.y.isUnavailable))),a=we.of(s.cheetahInlineRewrite||s.cheetahMagicRewrite),r=e.activeLensId.view((e=>e!==b.J.SpecialId.Cheetah)),l=i.pipe(T.T((e=>e.type===st.VV.Collapsed)));return{isAvailable(e){const i=e.pipe(T.T((e=>e.length<=5e3&&t.test(e))));return A.z([o,a,r,l,i]).pipe(T.T(be.Si(d.identity)))}}},e.mock=function(e=we.of(!1)){return{isAvailable:()=>e}}}(it||(it={}));var ot=i(30022),at=i(35031),rt=i(85982),lt=i(72297),dt=i(56157),ct=i(23610);class pt{get selectedRange(){const e=this._ded.getCursor();return{start:e.index,end:e.length+e.index}}replaceCurrentSelectionWith(e){return this.insertContent(e,{onNewLine:!1,replace:!0,preserveSelection:!1})}insertContent(e,t){return(0,d.pipe)(l.L9(this._ded.flushChanges),l.g$((0,d.pipe)(l.L9((()=>{const{start:e,end:i}=this.selectedRange;return{start:e,deleteDelta:t.replace&&i>e?(new lt.R).delete(i-e):new lt.R}})),l.Tj(Boolean(t.onNewLine)?ut:ht),l.ap(this._getContents))),l.W6((0,d.flow)((t=>(new lt.R).retain(t.start).concat(e).concat(t.deleteDelta)),this._pushChanges,l.oF)),l.cy((({start:i})=>()=>new Promise((n=>requestAnimationFrame((()=>n(this._ded.setCursor(i,Boolean(t.preserveSelection)?e.length():0)))))))))}constructor(e){(0,s._)(this,"_ded",void 0),(0,s._)(this,"_pushChanges",void 0),(0,s._)(this,"_getContents",void 0),this._ded=e,this._pushChanges=e=>rt.TX((()=>this._ded.pushChanges(dt.lY.delta(e,this._ded.getTextLength()),"user")),r.toError),this._getContents=(0,d.pipe)(rt.TX(this._ded.getContents,r.toError),l.oF)}}function ht(e){return()=>e}function ut(e){const t=e.start,i=e=>ct.E.isInsertString(e)&&e.insert.includes("\n"),n=ct.E.findInDelta(i,(e=>e.insert.indexOf("\n")));return s=>(0,d.pipe)(s,(({delta:e})=>e.slice(t)),n,m.getOrElse((()=>s.delta.length())),((e,n)=>s=>{const o=n.delta;let a=1;if(0===t)1===o.length()&&(a=0);else if(t>0&&i(o.slice(t-1,t).ops[0])){const e=o.slice(t,t+1).ops[0];Boolean(e)?i(e)&&(a=0):a=0}return e+s+a})(t,s),(t=>(0,a._)((0,o._)({},e),{start:t})))}var gt=i(73328);class mt{constructor(e,t,i){(0,s._)(this,"_ded",void 0),(0,s._)(this,"_features",void 0),(0,s._)(this,"_inlineManager",void 0),(0,s._)(this,"inlineButtonState",void 0),(0,s._)(this,"magicRewriteEnabled",void 0),(0,s._)(this,"inlineRewriteEnabled",void 0),(0,s._)(this,"showOnboardingTourA11yUpdates",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"_inlineButtonState",void 0),(0,s._)(this,"dispose",void 0),this._ded=e,this._features=t,this._inlineManager=i,this.inlineButtonState=h.s.create(m.none),this._subs=new k.y.Keeper,this._inlineButtonState=A.z([this._ded.viewport,this._ded.scrollPosition,this._inlineManager.cheetahInlineButtonState]).pipe(T.T((([e,t,i])=>(0,d.pipe)(i,m.fold((()=>m.none),(()=>{const{text:{left:i}}=e;return(0,d.pipe)(this._ded.getSelectionRect(),gt.qI((e=>e.getRect())),r.map((e=>e.clientRects)),m.fromEither,m.filter(be.J_),m.map((e=>{const n=e[e.length-1],s=e.length>1;return{top:n.bottom+t,left:s?i:n.left}})))})))))),this.dispose=()=>{this._subs.dispose()};const n=this._features.oggy===ie.kH.splitSharedAssistants;this.magicRewriteEnabled=n&&this._features.cheetahMagicRewrite,this.inlineRewriteEnabled=n&&this._features.cheetahInlineRewrite,this.showOnboardingTourA11yUpdates=this._features.showOnboardingTourA11yUpdates,this._subs.push(this._inlineButtonState.subscribe((e=>this.inlineButtonState.set(e))))}}var _t=i(65011),vt=i(17503),ft=i(25358),yt=i(57877),bt=i(40005),St=i(70823);class wt{constructor(e,t,i,n,r,l,c,u,_,v,f,y,b,S,w,E,I,V,L,O,B,R,U){(0,s._)(this,"_oggyManager",void 0),(0,s._)(this,"_lifecycleService",void 0),(0,s._)(this,"_lifecycleEvents",void 0),(0,s._)(this,"_textEditorService",void 0),(0,s._)(this,"_ded",void 0),(0,s._)(this,"_navigation",void 0),(0,s._)(this,"_userService",void 0),(0,s._)(this,"_capiService",void 0),(0,s._)(this,"_availabilityService",void 0),(0,s._)(this,"_uphookService",void 0),(0,s._)(this,"_deepLinkService",void 0),(0,s._)(this,"_feedbackService",void 0),(0,s._)(this,"_onboardingViewModelsFactory",void 0),(0,s._)(this,"_experimentService",void 0),(0,s._)(this,"_telemetry",void 0),(0,s._)(this,"_features",void 0),(0,s._)(this,"_sessionModel",void 0),(0,s._)(this,"_modalManager",void 0),(0,s._)(this,"_selectionRange",void 0),(0,s._)(this,"_usedDuringSession",void 0),(0,s._)(this,"_selectionContextAvailabilityService",void 0),(0,s._)(this,"_capiMessages",void 0),(0,s._)(this,"assistantUI",void 0),(0,s._)(this,"ggoUI",void 0),(0,s._)(this,"onboardingViewModels",void 0),(0,s._)(this,"usedDuringSession",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"_assistantUIActions",void 0),(0,s._)(this,"_selectionOnLensEnter",void 0),(0,s._)(this,"_onboardingUIActions",void 0),(0,s._)(this,"_isInSplitMode",void 0),(0,s._)(this,"_genAISession",void 0),(0,s._)(this,"_commonAssistantDependencies",void 0),(0,s._)(this,"_capiStartMessage",void 0),(0,s._)(this,"_disposed",void 0),(0,s._)(this,"disposeUI",void 0),(0,s._)(this,"dispose",void 0),(0,s._)(this,"initAssistant",void 0),(0,s._)(this,"initGGO",void 0),(0,s._)(this,"_initUI",void 0),(0,s._)(this,"_initOnboarding",void 0),(0,s._)(this,"_disposeAssistant",void 0),(0,s._)(this,"_disposeGgo",void 0),(0,s._)(this,"_getRevisionAssistantDependencies",void 0),(0,s._)(this,"_getGenAIAssistantDependencies",void 0),(0,s._)(this,"_getGenAIAndRevisionAssistantDependencies",void 0),(0,s._)(this,"_createAssistant",void 0),(0,s._)(this,"_createGgo",void 0),this._oggyManager=e,this._lifecycleService=t,this._lifecycleEvents=i,this._textEditorService=n,this._ded=r,this._navigation=l,this._userService=c,this._capiService=u,this._availabilityService=_,this._uphookService=v,this._deepLinkService=f,this._feedbackService=y,this._onboardingViewModelsFactory=b,this._experimentService=S,this._telemetry=w,this._features=E,this._sessionModel=I,this._modalManager=V,this._selectionRange=L,this._usedDuringSession=O,this._selectionContextAvailabilityService=B,this._capiMessages=R,this.assistantUI=h.s.create(m.none),this.ggoUI=h.s.create(m.none),this.onboardingViewModels=h.s.create(m.none),this.usedDuringSession=this._usedDuringSession.view(),this._log=g.Bx.Logging.getLogger("Cheetah.CheetahWebLifecycleManagerImpl"),this._subs=new k.y.Keeper,this._assistantUIActions=new C.B,this._selectionOnLensEnter=this._navigation.isGGOLensActive.pipe(F.p(Boolean),G.E(this._ded.selection),T.T(_t.gp)),this._onboardingUIActions=new C.B,this._isInSplitMode=this._features.oggy===ie.kH.splitSharedAssistants,this._genAISession=h.s.create(m.none),this._capiStartMessage=h.s.create(m.none),this._disposed=new C.B,this.disposeUI=()=>{this._disposeAssistant(),this._disposeGgo()},this.dispose=()=>{this._disposed.next(!0),this._subs.dispose()},this.initAssistant=()=>(this.disposeUI(),this._lifecycleService.pipe(x.M((e=>this._initUI({kind:"oggy",oggyManager:this._oggyManager,lifecycleService:e}))))),this.initGGO=()=>(this.disposeUI(),this._lifecycleService.pipe(x.M((e=>this._initUI({kind:"ggo",lifecycleService:e}))))),this._initUI=({kind:e,oggyManager:t,lifecycleService:i})=>{performance.mark(vt.F.assistantOpenAttempt);const n={mode:this._navigation.mode.get(),metadata:(0,d.pipe)(this._features.cheetahPromptsUsed,m.map((e=>({setPromptsUsed:e}))),m.toUndefined)};switch(this._log.info(`Init UI for ${e}`),e){case"oggy":const s=(0,d.pipe)(n,this._createAssistant(i,t));this.assistantUI.set(m.some(s)),this._log.info("Inited Oggy Assistant UI",s);break;case"ggo":const o=this._createGgo(i)(n);this.ggoUI.set(m.some(o)),this._log.info("Inited GGO Assistant UI",o);break;case"ggoWithRevision":const a=this._createGgo(i,t)(n);this.ggoUI.set(m.some(a)),this._log.info("Inited GGO with Revision Assistant UI",a);break;default:(0,p.xb)(e)}},this._initOnboarding=()=>{const e=this._sessionModel.defaultContext.pipe(T.T(m.chain((e=>e.writingIntent)))),t=this._availabilityService.availability.pipe(F.p(nt.y.isVisible),D.s(1)),i=this._lifecycleEvents.events.pipe(F.p(pe.f.isRevisionInteractionReady),D.s(1)),n=this._modalManager.state.view(m.exists((e=>e.instance.type===Ge.zz.Tour)));!this._sessionModel.isDemoDocument&&this._features.cheetahOnboarding&&A.z([t,e,n,i]).pipe(F.p((([e,t,i])=>nt.y.isVisible(e)&&!i))).subscribe((([e,t])=>{const i=this._onboardingViewModelsFactory({intent:t,disposed:this._disposed,assistantUIActions:this._assistantUIActions,onboardingUIActions:this._onboardingUIActions,cheetahButton:this._navigation.cheetahButton,genAiSession:this._genAISession});this._subs.push((0,d.pipe)(i.onboarding.uiActions,F.p(ft.K.is(ft.K.Kind.tryItOut)),x.M((()=>this._navigation.toCheetahLens(!1,!1)))).subscribe()),this._subs.push(i.onboarding),this.onboardingViewModels.set(m.some(i))}))},this._disposeAssistant=()=>{m.isSome(this.assistantUI.get())&&(this._log.info("Disposing Assistant..."),this.assistantUI.set(m.none))},this._disposeGgo=()=>{m.isSome(this.ggoUI.get())&&(this._log.info("Disposing GGO..."),this.ggoUI.set(m.none))},this._getRevisionAssistantDependencies=(e,t)=>{return i=(0,a._)((0,o._)({},this._commonAssistantDependencies(e)),{alertService:t.alertService,sduiService:t.sduiService,capiStartMessage:this._capiStartMessage}),()=>(0,a._)((0,o._)({kind:"revision"},i),{isPlagiarismEnabled:!0,isAiStudioEnabled:h.s.create(m.none),isAiDetectorEnabled:i.capiStartMessage.view(m.map((({allowedFeatures:e})=>e.includes("AI_DETECTOR")))),isWritingExpertEnabled:i.features.writingExpertPullMode,trackingService:(0,St.H4)(i.telemetry,i.features,i.capiSessionId),toneDetectorService:void 0});var i},this._getGenAIAssistantDependencies=({kind:e,oggyManager:t,lifecycleService:i})=>{return"withOggy"===e?(n=(0,a._)((0,o._)({},this._commonAssistantDependencies(i)),{genAIAvailabilityService:this._availabilityService,selectionContextAvailabilityService:this._selectionContextAvailabilityService,lifecycleService:(0,a._)((0,o._)({},i),{sizeBehavior:bt.w.fitContainer}),notifyGenAISessionStateChanged:e=>this._genAISession.set(e),alertService:t.alertService,sduiService:t.sduiService,capiStartMessage:this._capiStartMessage}),e=>(0,a._)((0,o._)({kind:"genAIAndWritingExpert"},n),{genAIStartSessionOptions:e,isPlagiarismEnabled:!0,isWritingExpertEnabled:n.features.writingExpertPullMode,trackingService:(0,St.H4)(n.telemetry,n.features,n.capiSessionId)})):"withoutOggy"===e?(e=>t=>(0,a._)((0,o._)({kind:"genAI"},e),{genAIStartSessionOptions:t,trackingService:(0,St.H4)(e.telemetry,e.features,e.capiSessionId)}))((0,a._)((0,o._)({},this._commonAssistantDependencies(i)),{genAIAvailabilityService:this._availabilityService,selectionContextAvailabilityService:this._selectionContextAvailabilityService,lifecycleService:(0,a._)((0,o._)({},i),{sizeBehavior:bt.w.fitContainer}),notifyGenAISessionStateChanged:e=>this._genAISession.set(e)})):(0,p.xb)(e);var n},this._getGenAIAndRevisionAssistantDependencies=(e,t)=>{return i=(0,a._)((0,o._)({},this._commonAssistantDependencies(e)),{alertService:t.alertService,sduiService:t.sduiService,genAIAvailabilityService:this._availabilityService,selectionContextAvailabilityService:this._selectionContextAvailabilityService,notifyGenAISessionStateChanged:e=>this._genAISession.set(e),capiStartMessage:this._capiStartMessage}),e=>(0,a._)((0,o._)({kind:"genAIAndRevision"},i),{isAiStudioEnabled:h.s.create(m.none),genAIStartSessionOptions:e,isPlagiarismEnabled:!0,isWritingExpertEnabled:i.features.writingExpertPullMode,trackingService:(0,St.H4)(i.telemetry,i.features,i.capiSessionId)});var i},this._createAssistant=(e,t)=>(0,d.flow)(this._isInSplitMode?this._getRevisionAssistantDependencies(e,t):this._getGenAIAndRevisionAssistantDependencies(e,t),yt.v),this._createGgo=(e,t)=>(0,d.flow)(this._getGenAIAssistantDependencies(void 0===t?{kind:"withoutOggy",lifecycleService:e}:{kind:"withOggy",oggyManager:t,lifecycleService:e}),yt.v),this._commonAssistantDependencies=e=>({lifecycleService:e,userService:this._userService,capiService:this._capiService,textEditorService:this._textEditorService,uphookService:this._uphookService,deepLinkService:this._deepLinkService,feedbackService:this._feedbackService,experimentService:this._experimentService,telemetry:this._telemetry,notifyAssistantUIAction:e=>this._assistantUIActions.next(e),features:this._features,theme:h.s.create({useIframeTextfieldWrapper:!0}),capiSessionId:U}),this._subs.push(this._lifecycleEvents.events.pipe(F.p(pe.f.isClose),x.M((()=>this._navigation.closeCheetahLens()))).subscribe()),this._isInSplitMode?this._subs.push(this._ded.dontFreezeWhen(this._navigation.isGGOLensActive,"cheetah-lens")):this._subs.push(this._assistantUIActions.pipe(F.p((e=>"promptFieldFocusChange"===e.kind&&e.focused)),D.s(1),x.M((()=>this._ded.restoreFocus("promptFieldFocusChange")))).subscribe()),this._subs.push(this._selectionOnLensEnter.pipe(M._F.inRaf).subscribe((e=>this._ded.setCursor(e.index,e.length,"api"))),this._ded.selection.subscribe((e=>{this._selectionRange.set(m.some({start:e.index,end:e.index+e.length,meta:void 0}))}))),this._subs.push(this._capiMessages.pipe(F.p((e=>"start"===e.action)),T.T(m.some)).subscribe(M.H9(this._capiStartMessage))),this._initOnboarding()}}class Ct{constructor(e,t){(0,s._)(this,"_navigationVM",void 0),(0,s._)(this,"_ded",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"cheetahButton",void 0),(0,s._)(this,"isGGOLensActive",void 0),(0,s._)(this,"isSidebarOpened",void 0),(0,s._)(this,"mode",void 0),(0,s._)(this,"toCheetahLens",void 0),(0,s._)(this,"closeCheetahLens",void 0),(0,s._)(this,"handleCheetahButtonClick",void 0),(0,s._)(this,"cheetahButtonRef",void 0),this._navigationVM=e,this._ded=t,this._log=g.Bx.Logging.getLogger("Cheetah.Navigation"),this.cheetahButton=h.s.create(null),this.isGGOLensActive=this._navigationVM.activeLensId.view((e=>e===b.J.SpecialId.Cheetah)),this.isSidebarOpened=this._navigationVM.state.view("isSidebarOpen"),this.mode=h.s.create("rewrite"),this.toCheetahLens=(e=!1,t=!1)=>{this._log.info("Opening lens...",{fromInline:e,withQuickRewrite:t});const i=0===this._ded.selection.getValue().length?"ideation":t?"quickRewrite":"rewrite";this.mode.set(i),this._navigationVM.openOggyLens(b.J.SpecialId.Cheetah,e?y.Kz.text:y.Kz.sidebar)},this.closeCheetahLens=()=>{this._log.info("Closing lens..."),this._navigationVM.events.next({type:"switchToLens",id:b.J.SpecialId.AllAlerts,focusFirst:!1,actionSource:y.Kz.api})},this.handleCheetahButtonClick=()=>{!0===this.isGGOLensActive.get()?this.closeCheetahLens():this.toCheetahLens()},this.cheetahButtonRef=e=>{this.cheetahButton.set(e)}}}var kt,Mt=i(25026),Et=i(77940),Tt=i(55007),xt=i(51770),It=i(39055),At=i(31967),Ft=i(89439);function Vt(e=500){return L.h(At.L5.pipe(Ft.c(e/2),z.u(!0)),At.L5.pipe(fe.B(e),z.u(!1))).pipe(R.F())}!function(e){e.create=({engine:e,denaliEditorModel:t,upgradeVM:i,navigationVM:n,userAccount:s,telemetry:o,inlineManager:a,modalManager:r,experimentClient:l,environment:c,platformEnvironment:p,notificationsManager:u,config:v,capiSessionId:f})=>{const y=g.Bx.Logging.getLogger("Cheetah.CheetahViewModel");y.info("Creating CheetahViewModel");const b=h.s.create(m.none),S=(0,St.F2)(s),w=s.features.denali.showOnboardingTourA11yUpdates,C=(0,St.Nc)(o),k=h.s.create({contextUpdatesClient:s.features.denali.selectionContextUpdatesClient,contextUpdatesServer:s.features.denali.selectionContextUpdatesServer}),M=new ot.w(k),E=new Ct(n,t),x=new pt(t),I=h.s.create(!1),A=(0,St.n$)(t,x,e.cheetah.selectionContextManager,(()=>{I.set(!0)}),b,(0,$e.l)(u,c)),V=(0,St.Ip)(o,p,v,i,f),L=new wt(e.cheetah.oggyManager,e.cheetah.oggyLifecycleService,e.cheetah.oggyLifecycleEvents,A,t,E,S,e.cheetah.cheetahCapiService,e.cheetah.genAiAvailabilityService,V,e.cheetah.oggyDeepLinkService,C,(O={capi:e.obsCapiClient,settings:s.settings,availabilityService:e.cheetah.genAiAvailabilityService,features:s.features.denali,capiService:e.cheetah.cheetahCapiService},e=>{const t=new Set;return O.features.cheetahOrgContextEnabled||t.add(Mt.M.StepName.knowledgeHub),O.features.cheetahBTSOnboardingEnabled&&_.gR("ASSIGNMENT_WRITING")(e.intent)||t.add(Mt.M.StepName.initialBTS),(0,Et.K)({client:"editor",textStats:O.capi.events.pipe(F.p(It.om.is("text_info")),T.T((e=>m.some({wordCount:e.data.wordsCount}))),U.Z(m.none)),capiService:O.capiService,upstreamOnboardingState:O.settings.cheetahOnboardingState,completeOnboardingStep:e=>{O.settings.cheetahOnboardingState.get()[e].editor.completed||O.settings.updateCheetahOnboardingState({[e]:{completed:!0,lastSeen:Date.now()}})},session:e.genAiSession,assistantUIActions:e.assistantUIActions,forceDisabledOnboardingSteps:t,externalElements:e.cheetahButton.pipe(T.T((e=>(0,d.pipe)(e,m.fromNullable,m.fold((()=>({})),(e=>({[Tt.Z.initialPopupAnchor]:{reference:e,placement:"bottom",offset:8,boundaryAreaPadding:10},[Tt.Z.initialBTSPopupAnchor]:{reference:e,placement:"bottom",offset:8,boundaryAreaPadding:10}}))))))),disposed:e.disposed,promptsAllocated:O.availabilityService.availability.view((0,d.flow)(m.fromPredicate(nt.y.isActiveOrPassive),m.map((0,xt.Up)("promptsAllocated")))),hideAssistantOnboardingTooltips:Vt()})}),(0,St.xs)(l),o,s.features.denali,e.sessionModel,r,b,I,M,e.cheetah.capiMessages,f);var O;const B=new mt(t,s.features.denali,a);return{assistantUI:L.assistantUI,ggoUI:L.ggoUI,onboardingViewModels:L.onboardingViewModels,inlineViewModel:B,usedDuringSession:L.usedDuringSession,initAssistant:L.initAssistant,initGGO:L.initGGO,disposeUI:L.disposeUI,navigation:E,isInOnboardingTourA11yExperiment:w,oggyMode:s.features.denali.oggy,isGenAiAvailable:e.cheetah.genAiAvailabilityService.availability.view(nt.y.isVisible),blockApply:e.cheetah.oggyManager.blockApply,dispose:()=>{y.info("Disposing CheetahViewModel"),L.dispose(),B.dispose()},acquireFocusWhen:e=>t.dontFreezeWhen(e,"Cheetah View")}},e.mock=()=>({assistantUI:we.of(m.none),ggoUI:we.of(m.none),onboardingViewModels:h.s.create(m.none),inlineViewModel:{inlineButtonState:h.s.create(m.none),magicRewriteEnabled:!1,inlineRewriteEnabled:!1,showOnboardingTourA11yUpdates:!1,dispose:d.constVoid},navigation:{cheetahButton:h.s.create(null),isGGOLensActive:h.s.create(!1),isSidebarOpened:h.s.create(!1),mode:h.s.create("rewrite"),toCheetahLens:d.constVoid,closeCheetahLens:d.constVoid,handleCheetahButtonClick:d.constVoid,cheetahButtonRef:d.constVoid},usedDuringSession:h.s.create(!1),isInOnboardingTourA11yExperiment:!1,oggyMode:ie.kH.splitSharedAssistants,isGenAiAvailable:h.s.create(!1),blockApply:h.s.create(!1),acquireFocusWhen:()=>at.yU.EMPTY,initAssistant:()=>we.of(void 0),initGGO:()=>we.of(void 0),disposeUI:d.constVoid,dispose:d.constVoid})}(kt||(kt={}));var Lt=i(32112);class Ot{constructor(e,t,i,n,o,a){(0,s._)(this,"_uploadViewModel",void 0),(0,s._)(this,"_denaliEditorModel",void 0),(0,s._)(this,"_userAccount",void 0),(0,s._)(this,"_environment",void 0),(0,s._)(this,"strings",void 0),(0,s._)(this,"uploadSection",void 0),(0,s._)(this,"visible",void 0),(0,s._)(this,"size",void 0),this._uploadViewModel=e,this._denaliEditorModel=t,this._userAccount=i,this._environment=n,this.visible=this._denaliEditorModel.contentUpdated.pipe(U.Z(void 0),T.T((()=>!Bt(this._denaliEditorModel))),R.F()),this.size=this._userAccount.settings.editorPreferences.view("fontSize");const r=this._userAccount.features.denali.showUploadInPlaceholderText&&m.isSome(this._uploadViewModel);this.strings=r?o===te.jj.l1.FormattingMode.on?a.placeholderRTF:a.placeholder:a.placehoderWithoutUpload,this.uploadSection=(0,d.pipe)(this._uploadViewModel,m.map((e=>({uploadInputAccept:this._environment.has(ze.OH.Flag.acceptUploadByMimeTypes)?te.jj.Pm.join(","):te.jj.$G.join(","),label:this.strings.upload,upload:t=>e.uploadModel.upload({files:t,notify:!1,allowMultiple:!1,isDragNDrop:!1})}))))}}const Bt=e=>e.getTextLength()>1||(()=>{const t=e.getContents().delta.ops[0];return Boolean(t)&&m.isSome(Lt.E.getAttrs(t))})();var Rt=i(72404),Ut=i(50983);class Nt{dispose(){this._subs.dispose()}constructor(e,t,i,n){(0,s._)(this,"_config",void 0),(0,s._)(this,"_obsCapiClient",void 0),(0,s._)(this,"_notificationsManager",void 0),(0,s._)(this,"_telemetry",void 0),(0,s._)(this,"_subs",void 0),this._config=e,this._obsCapiClient=t,this._notificationsManager=i,this._telemetry=n,this._subs=new k.y.Keeper,this._subs.push(this._obsCapiClient.events.pipe(F.p(It.om.is("gb_rule_created")),x.M((({categoryTitle:e,descriptionLength:t})=>{"Vox"===e?this._telemetry.gnarSpec.gbPromptCreateVoxRuleSubmit(t,this._telemetry.pageId):this._telemetry.gnarSpec.gbPromptLockWritingStyleSettingSubmit(this._telemetry.pageId)})),K.n((({categoryTitle:e,styleGuideId:t})=>this._notificationsManager.enqueue("gbRuleCreated",{link:"Vox"===e?`${this._config.account.styleGuide}/${t}`:`${this._config.account.writingStyle}?categoryTitle=${e}`})))).subscribe())}}var Pt,Dt=i(55638),Ht=i(80548),Kt=i(53397),Wt=i(21644),Gt=i(60352),$t=i(64791),zt=i(1404),Jt=i(80019);function jt(e){const[t,i]=$t.j(e.pipe(Wt.u()),m.isSome);return[t.pipe(T.T(_.$v)),i.pipe(T.T(d.constVoid))]}!function(e){let t,i;!function(e){e.idle="idle",e.inlineCard="inline-card",e.synonymsCard="synonyms-card",e.formattingLink="formatting-link",e.upgradeHook="upgrade-hook",e.cheetahInlineButton="cheetah-inline-button",e.vbarCard="vbar-card",e.teaserCard="teaser-card"}(t=e.Type||(e.Type={})),e.idle={type:Pt.Type.idle},function(e){e.monoid=Kt.getStructMonoid({[Pt.Type.idle]:be.JI(),[Pt.Type.formattingLink]:be.JI(),[Pt.Type.upgradeHook]:be.JI(),[Pt.Type.synonymsCard]:be.JI(),[Pt.Type.inlineCard]:be.JI(),[Pt.Type.cheetahInlineButton]:be.JI(),[Pt.Type.vbarCard]:be.JI(),[Pt.Type.teaserCard]:be.JI()}),e.forCardState=function(e,t,i){const n=jt(e.alertHovered.pipe(F.p(_.Lw((0,d.not)(le.A.isWritingExpertWithTeaser))),T.T(m.filter((e=>t.isInteractable(e.id)&&le.A.isHoverableInline(e)))))),s=n[0].pipe(T.T(((e,t)=>()=>[`fromDed:markAlertHover:set(${t})`,{type:Pt.Type.inlineCard,alert:e}]))),o=n[1].pipe(T.T(Zt(Pt.Type.inlineCard,"Ded"))),a=i.pipe(T.T(Zt(Pt.Type.inlineCard,"Ext")));return{[Pt.Type.idle]:[s],[Pt.Type.formattingLink]:[],[Pt.Type.upgradeHook]:[],[Pt.Type.synonymsCard]:[],[Pt.Type.inlineCard]:[s,o,a],[Pt.Type.cheetahInlineButton]:[],[Pt.Type.vbarCard]:[],[Pt.Type.teaserCard]:[]}},e.forSynonymsState=function(e,t){const i=e.doubleClickedWord.pipe(T.T(((e,t)=>()=>[`fromDed:synonyms:set(${t})`,{type:Pt.Type.synonymsCard,word:e}]))),n=t.pipe(T.T(Zt(Pt.Type.synonymsCard,"Ext")));return{[Pt.Type.idle]:[i],[Pt.Type.formattingLink]:[i],[Pt.Type.upgradeHook]:[i],[Pt.Type.synonymsCard]:[i,n],[Pt.Type.inlineCard]:[i],[Pt.Type.cheetahInlineButton]:[i],[Pt.Type.vbarCard]:[i],[Pt.Type.teaserCard]:[]}},e.forFormattingLink=function(e,t,i){const n=t.pipe(T.T(((e,t)=>()=>[`fromUI:links:set(${t})`,{type:Pt.Type.formattingLink,link:e}]))),s=jt(Jt.uY.fromDenaliEditor(e.selectedFormatting)),o=s[0].pipe(T.T(((e,t)=>()=>[`fromDed:links:set(${t})`,{type:Pt.Type.formattingLink,link:e}]))),a=s[1].pipe(T.T(Zt(Pt.Type.formattingLink,"Ded"))),r=i.pipe(T.T(Zt(Pt.Type.formattingLink,"Ext")));return{[Pt.Type.idle]:[n,o],[Pt.Type.formattingLink]:[n,o,a,r],[Pt.Type.upgradeHook]:[n,o,a,r],[Pt.Type.synonymsCard]:[n],[Pt.Type.inlineCard]:[n],[Pt.Type.cheetahInlineButton]:[n,o],[Pt.Type.vbarCard]:[n],[Pt.Type.teaserCard]:[n]}},e.forUpgradeHook=function(e,t,i){const[n,s]=jt(e.alertClicked.pipe(T.T(m.filter((({alert:e})=>t.isRegistered(e.id)&&y.Fc.isInPremiumLens(e)&&!le.A.isLockedUIAlert(e)))))),o=n.pipe(T.T(((e,t)=>()=>[`fromDed:markAlertClick:set(${t})`,{type:Pt.Type.upgradeHook,alert:e}]))),a=s.pipe(T.T(Zt(Pt.Type.upgradeHook,"Ded"))),r=i.pipe(T.T(Zt(Pt.Type.upgradeHook,"Ext")));return{[Pt.Type.idle]:[o],[Pt.Type.formattingLink]:[o],[Pt.Type.upgradeHook]:[o,a,r],[Pt.Type.synonymsCard]:[o],[Pt.Type.inlineCard]:[o],[Pt.Type.cheetahInlineButton]:[o],[Pt.Type.vbarCard]:[o],[Pt.Type.teaserCard]:[o]}},e.forCheetahInlineButton=function(e,t,i){const n=e.selection.pipe(R.F(v.LN.eqRange.equals),T.T((t=>e.getText().slice(t.index,t.index+t.length)))),[s,o]=$t.j(t.isAvailable(n),d.identity),a=s.pipe(T.T(((e,t)=>()=>[`fromDed:cheetah:set(${t})`,{type:Pt.Type.cheetahInlineButton}]))),r=o.pipe(T.T(Zt(Pt.Type.cheetahInlineButton,"Ded"))),l=i.pipe(T.T(Zt(Pt.Type.cheetahInlineButton,"Ext")));return{[Pt.Type.idle]:[a],[Pt.Type.formattingLink]:[],[Pt.Type.upgradeHook]:[],[Pt.Type.synonymsCard]:[],[Pt.Type.inlineCard]:[],[Pt.Type.cheetahInlineButton]:[a,r,l],[Pt.Type.vbarCard]:[],[Pt.Type.teaserCard]:[]}},e.forVbarCard=function(e){const[t,i]=jt(e),n=t.pipe(T.T(((e,t)=>()=>[`fromDed:activeVbar:set(${t})`,{type:Pt.Type.vbarCard,vbar:m.some(e)}]))),s=i.pipe(T.T(Zt(Pt.Type.vbarCard,"Ded")));return{[Pt.Type.idle]:[n],[Pt.Type.formattingLink]:[],[Pt.Type.upgradeHook]:[],[Pt.Type.synonymsCard]:[],[Pt.Type.inlineCard]:[],[Pt.Type.cheetahInlineButton]:[],[Pt.Type.vbarCard]:[n,s],[Pt.Type.teaserCard]:[]}},e.forTeaserCard=function(e,t,i,n){const[s,o]=jt(e.alertHovered.pipe(T.T(m.filter((e=>t.isInteractable(e.id)&&le.A.isHoverableInline(e)&&le.A.isWritingExpertWithTeaser(e)))))),a=n.pipe(T.T(m.chain((e=>(0,d.pipe)(t.getById(e),m.map(le.A.fromModel))))),P.fY(m.getEq(le.A.eq)),Wt.u()),r=L.h(s,a.pipe($.oE)).pipe(T.T(((e,t)=>()=>[`fromDed:teaserCardHover:set(${t})`,{type:Pt.Type.teaserCard,alert:e}]))),l=A.z(a,o).pipe(F.p((([e])=>m.isNone(e))),T.T(Zt(Pt.Type.teaserCard,"Ded"))),c=i.pipe(T.T(Zt(Pt.Type.teaserCard,"Ext")));return{[Pt.Type.idle]:[r],[Pt.Type.formattingLink]:[],[Pt.Type.upgradeHook]:[],[Pt.Type.synonymsCard]:[],[Pt.Type.inlineCard]:[],[Pt.Type.cheetahInlineButton]:[],[Pt.Type.vbarCard]:[],[Pt.Type.teaserCard]:[l,c]}}}(i=e.Scheme||(e.Scheme={}))}(Pt||(Pt={}));const Zt=(e,t)=>(i,n)=>i=>i.type===e?[`from${t}:${e}:reset(${n})`,Pt.idle]:[`from${t}:${e}:skipReset(${n})`,i];var qt=i(80993),Yt=i(32102);class Qt{constructor(e,t){(0,s._)(this,"_lensesList",void 0),(0,s._)(this,"_alertsFilterService",void 0),(0,s._)(this,"getLens",void 0),(0,s._)(this,"_getPlagiarismLens",void 0),this._lensesList=e,this._alertsFilterService=t,this.getLens=(0,u.Bj)((function(e){switch(e){case b.J.SpecialId.Plagiarism:return this._lensesList.view(this._getPlagiarismLens);case b.J.SpecialId.Premium:return this._lensesList.view(Xt(b.J.Info.premium,b.J.Meta.group.empty,this._alertsFilterService.getLensesFilter(b.J.SpecialId.Premium)));default:return(0,p.xb)(e)}})),this._getPlagiarismLens=(0,d.flow)(Xt(b.J.Info.plagiarism,(0,a._)((0,o._)({},b.J.Meta.group.empty),{percentile:Yt.w.MAX}),this._alertsFilterService.getLensesFilter(b.J.SpecialId.Plagiarism)),b.J.WithAlerts.modifyMeta((e=>(0,a._)((0,o._)({},e),{percentile:Yt.w.groupSum.concat(Yt.w.MAX,Yt.w.groupSum.inverse(e.percentile))}))))}}function Xt(e,t,i){return n=>{return new b.J.LensImpl(e,(s=e.id,o=t,e=>(0,d.pipe)(qt.$I(b.J.Id.ord)(s,e),m.getOrElse((()=>o))))(n),i);var s,o}}var ei=i(93959),ti=i(94354),ii=i(91796),ni=i(47456);const si=g.Bx.Logging.getLogger("pageTelemetry");class oi{dispose(){this._subs.dispose()}trackSidebarState(e){return e.pipe(I.i(1),K.n((e=>e?Ce.H(this._telemetry.gnarSpec.assistantSidebarShow(this._telemetry.pageId)):Ce.H(this._telemetry.gnarSpec.assistantSidebarClose(this._telemetry.pageId)))))}constructor(e,t){(0,s._)(this,"_isSidebarOpened",void 0),(0,s._)(this,"_telemetry",void 0),(0,s._)(this,"_subs",void 0),this._isSidebarOpened=e,this._telemetry=t,this._subs=new k.y.Keeper,this._subs.push(L.h(this.trackSidebarState(this._isSidebarOpened)).pipe(ni.W((e=>(si.warn("Page telemetry error",e),V.w)))).subscribe())}}var ai=i(68703),ri=i(45032),li=i(38260),di=i(35679),ci=i(22809),pi=i(27004);class hi{applyAlert(e){setTimeout((()=>this.onVbarClose()),0),(0,d.pipe)(this._alertsService.apply(e,{alternativeIndex:0,source:y.Kz.text,feedbackSubtype:di.U3.Inline}),r.fold((e=>this._log.error("error applying alert",e)),d.constVoid))}dismissAlert(e){setTimeout((()=>this.onVbarClose()),0),(0,d.pipe)(this._alertsService.dismissBatch([e],di.U3.Inline),r.fold((e=>this._log.error("error dismissing alert",e)),d.constVoid))}toggleVbarHighlighting(e,t){const i=this.items.get().find((t=>t.alert.id===e));t?i&&this.highlightedVbarAlert.next(m.some(i.alert)):this.highlightedVbarAlert.next(m.none)}onVbarClick(e){var t;this._sendFeedback(e,{kind:di.yp.ACCEPTED,subtype:di.U3.Vbar,alternativeIndex:0}),this._isAssistantMode.get()?((0,d.pipe)(this.items.get(),be.i8((t=>t.alert.id===e)),m.fold((()=>this._log.error("Vbar item not found on click in assistant mode")),(e=>this.alertClickedInAssistantMode.next(m.some({highlightIndex:0,alert:e.alert}))))),this._inlineManager.changeActiveVbar.next(m.none)):this._inlineManager.changeActiveVbar.next(m.some({alertId:e,state:"opened"})),null===(t=this.items.get().find((t=>t.alert.id===e)))||void 0===t||t.hoveringService.reset()}onVbarMount(e){const t=this.items.get().find((t=>t.alert.id===e));t&&!this._mountedFeedbacks.has(e)&&(this._sendFeedback(t.alert.id,{kind:di.yp.RENDERED,subtype:di.U3.Vbar}),this._mountedFeedbacks.add(e))}onInlineCardMount(e){this.items.get().find((t=>t.alert.id===e))&&this._sendFeedback(e,{kind:di.yp.LOOKED,subtype:di.U3.Inline})}onStickerMount(e){this._sendFeedback(e,{kind:di.yp.LOOKED,subtype:di.U3.Vbar})}onVbarMouseEnter(e){const t=this.items.get().find((t=>t.alert.id===e));t&&t.hoveringService.htmlElementHandlers.onMouseEnter()}onVbarMouseLeave(e){const t=this.items.get().find((t=>t.alert.id===e));t&&t.hoveringService.htmlElementHandlers.onMouseLeave()}onVbarClose(){this._inlineManager.changeActiveVbar.next(m.none)}onGiveFeedbackClick(e){const t=m.fromNullable(this.items.get().find((t=>t.alert.id===e)));this.isVisibleFeedbackModal.set((0,d.pipe)(t,m.map((e=>e.alert))))}onCloseFeedbackModal(){this.isVisibleFeedbackModal.set(m.none)}submitFeedback(e,t){return this.isVisibleFeedbackModal.set(m.none),(0,d.pipe)(this._sendFeedback(e,{kind:di.yp.USER_SATISFACTION_FEEDBACK,subtype:di.U3.Vbar,userSatisfactionDescription:t.detailed}),r.fold(d.constFalse,d.constTrue),this._notifyFeedbackSent,T.T(d.constVoid),ke.$()).toPromise()}dispose(){this.highlightedVbarAlert.complete(),this._sub.unsubscribe(),this.items.get().forEach((e=>e.hoveringService.reset()))}_createVbarActivationSub(){return this._inlineManager.activeVbar.subscribe((e=>{(0,d.pipe)(e,m.fold((()=>{this.highlightedVbarAlert.next(m.none),this.items.modify((e=>e.map((e=>(0,a._)((0,o._)({},e),{state:"visible"})))))}),(e=>{const t=this.items.get().findIndex((t=>t.alert.id===e.alertId)),i=this.items.get()[t];t>-1&&(this.highlightedVbarAlert.next(m.some(i.alert)),this.items.modify((i=>i.map(((i,n)=>n===t?(0,a._)((0,o._)({},i),{state:e.state}):(0,a._)((0,o._)({},i),{state:"visible"}))))))})))}))}_updateItems(e,t){(0,d.pipe)(this._denaliEditorModel.contentRect,_.Mi((i=>{const n=function(e,t,i,n){return(0,d.pipe)(e,(0,li.Tj)((e=>(0,d.pipe)(e.highlightTexts,(0,li.rO)((i=>t.getMarkByAlert({alert:e,highlightIndex:i}))),(i=>i.concat(t.getEnclosingMarkByAlert(e))),li.oE,(e=>{const t={left:Number.MAX_SAFE_INTEGER,top:Number.MAX_SAFE_INTEGER,bottom:Number.MIN_SAFE_INTEGER};return(0,d.pipe)(e,(0,li.Tj)((e=>m.fromEither(e.getRect()))),li.oE,(0,li.cy)((e=>e.clientRects)),(0,li.TS)(t,((e,t)=>({left:Math.min(t.left-i.left,e.left),top:Math.min(t.top-i.top,e.top),bottom:Math.max(t.top-i.top+t.height,e.bottom)}))))}),(t=>(0,a._)((0,o._)({},t),{alert:e,state:"visible",mode:"replacement",withSticker:n}))))))}(e,this._marksVM,i,!t);var s,r,l;this.items.modify((s=n,r=this._inlineManager,l=this._activeVbarProxy.view(),e=>{const t=[];return s.forEach((i=>{const n=e.find((e=>e.alert.id===i.alert.id));n?t.push((0,a._)((0,o._)({},i),{state:n.state,hoveringService:n.hoveringService})):t.push((0,a._)((0,o._)({},i),{hoveringService:(0,pi.m)({onHover:()=>{(0,d.pipe)(l.get(),_.Lw((e=>"opened"!==e.state)))&&r.changeActiveVbar.next(m.some({alertId:i.alert.id,state:"hovered"}))},onBlur:()=>{(0,d.pipe)(l.get(),m.fold((()=>r.changeActiveVbar.next(m.none)),(e=>{e.alertId===i.alert.id&&r.changeActiveVbar.next(m.none)})))}},100,300)}))})),t}))})))}_createVbarItemsSub(){return A.z([(e=this._checkingState,t=this._alertVisibleFilter,A.z([e,t]).pipe(T.T((([e,t])=>(0,d.pipe)(e,ci.A.reduce([],((e,{alert:i})=>(0,u.M4)(y.Fc.isVbar,t)(i)?[...e,i]:e)),(e=>e.sort(y.HJ.ord.compare)),(0,li.Tj)(le.A.fromModel)))))),this._isAssistantMode,this._denaliEditorModel.changes.pipe(U.Z(null)),this._denaliEditorModel.viewport]).subscribe((([e,t,i,n])=>this._updateItems(e,t)));var e,t}_createCAPISub(){return this._capiEvents.pipe(F.p((e=>"session_started"===e.kind))).subscribe((()=>{this._mountedFeedbacks.clear()}))}constructor(e,t,i,n,o,a,l,c,p){(0,s._)(this,"_capiEvents",void 0),(0,s._)(this,"_denaliEditorModel",void 0),(0,s._)(this,"_alertsService",void 0),(0,s._)(this,"_checkingState",void 0),(0,s._)(this,"_alertVisibleFilter",void 0),(0,s._)(this,"_marksVM",void 0),(0,s._)(this,"_inlineManager",void 0),(0,s._)(this,"_isAssistantMode",void 0),(0,s._)(this,"_notifyFeedbackSent",void 0),(0,s._)(this,"items",void 0),(0,s._)(this,"highlightedVbarAlert",void 0),(0,s._)(this,"alertClickedInAssistantMode",void 0),(0,s._)(this,"isVisibleFeedbackModal",void 0),(0,s._)(this,"_sub",void 0),(0,s._)(this,"_mountedFeedbacks",void 0),(0,s._)(this,"_sendFeedback",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_activeVbarProxy",void 0),this._capiEvents=e,this._denaliEditorModel=t,this._alertsService=i,this._checkingState=n,this._alertVisibleFilter=o,this._marksVM=a,this._inlineManager=l,this._isAssistantMode=c,this._notifyFeedbackSent=p,this.items=h.s.create([]),this.highlightedVbarAlert=new C.B,this.alertClickedInAssistantMode=new C.B,this.isVisibleFeedbackModal=h.s.create(m.none),this._sub=new at.yU,this._mountedFeedbacks=new Set,this._sendFeedback=(e,t)=>(0,d.pipe)(this._alertsService.applyFeedback(e,t,y.Kz.text),r.mapLeft((e=>(this._log.error("error sending alert feedback",e),e)))),this._log=g.Bx.Logging.getLogger("VbarsViewModelImpl",g.y7.$.DEBUG),this._activeVbarProxy=h.s.create(m.none),this._sub.add(this._inlineManager.activeVbar.subscribe(M.H9(this._activeVbarProxy))),this._sub.add(this._createVbarActivationSub()),this._sub.add(this._createVbarItemsSub()),this._sub.add(this._createCAPISub())}}class ui{dispose(){this._engine.shutdown(),this.searchViewModel.dispose(),this.marksViewModel.dispose(),this.synonymsViewModel.dispose(),this.documentSettingsViewModel.dispose(),this._pageTelemetry.dispose(),this._gbRuleCreatedViewModel.dispose(),this.inlineCardViewModel.dispose(),this.hotkeyManager.dispose(),this.cheetahViewModel.dispose(),this.sduiInlineViewModel.get().dispose(),this._subs.dispose(),this.a11yNotificationManager.dispose(),this.loaderViewModel.dispose()}constructor(e,t,i,ae,le,ce,pe,ue,me,_e,ve,fe,ye,Se,we,Ce,ke,Me,Ee,Te){(0,s._)(this,"_engine",void 0),(0,s._)(this,"_denaliEditorModel",void 0),(0,s._)(this,"_upgradeHook",void 0),(0,s._)(this,"_environment",void 0),(0,s._)(this,"_platformEnvironment",void 0),(0,s._)(this,"_telemetry",void 0),(0,s._)(this,"_remSizeObs",void 0),(0,s._)(this,"_networkState",void 0),(0,s._)(this,"_docId",void 0),(0,s._)(this,"_notificationsManager",void 0),(0,s._)(this,"documentLoader",void 0),(0,s._)(this,"_textResources",void 0),(0,s._)(this,"_config",void 0),(0,s._)(this,"_experimentClient",void 0),(0,s._)(this,"_userAccount",void 0),(0,s._)(this,"_router",void 0),(0,s._)(this,"_downloadViewModel",void 0),(0,s._)(this,"_uploadViewModel",void 0),(0,s._)(this,"logout",void 0),(0,s._)(this,"inlineCardViewModel",void 0),(0,s._)(this,"lensPreviewViewModel",void 0),(0,s._)(this,"marksViewModel",void 0),(0,s._)(this,"alertUserEvents",void 0),(0,s._)(this,"synonymsViewModel",void 0),(0,s._)(this,"onboardingViewModel",void 0),(0,s._)(this,"upgradeViewModel",void 0),(0,s._)(this,"searchViewModel",void 0),(0,s._)(this,"feedbackViewModel",void 0),(0,s._)(this,"navigationViewModel",void 0),(0,s._)(this,"modalManager",void 0),(0,s._)(this,"hotkeyManager",void 0),(0,s._)(this,"formattingViewModel",void 0),(0,s._)(this,"emotionsViewModel",void 0),(0,s._)(this,"documentSettingsViewModel",void 0),(0,s._)(this,"autofocusListener",void 0),(0,s._)(this,"documentPlaceholderViewModel",void 0),(0,s._)(this,"focus",void 0),(0,s._)(this,"cheetahViewModel",void 0),(0,s._)(this,"capiSession",void 0),(0,s._)(this,"notificationsManager",void 0),(0,s._)(this,"vbarsViewModel",void 0),(0,s._)(this,"a11yNotificationManager",void 0),(0,s._)(this,"loaderViewModel",void 0),(0,s._)(this,"sduiInlineViewModel",void 0),(0,s._)(this,"_getAlertClosestToCursor",void 0),(0,s._)(this,"_cheetahInlineAvailabilityProvider",void 0),(0,s._)(this,"_inlineManager",void 0),(0,s._)(this,"_pageTelemetry",void 0),(0,s._)(this,"_gbRuleCreatedViewModel",void 0),(0,s._)(this,"_openInlineAlert",void 0),(0,s._)(this,"_inlineAlertHovered",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_reportViewModel",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"_editorWrapperViewport",void 0),(0,s._)(this,"_remSize",void 0),(0,s._)(this,"_lensesState",void 0),this._engine=e,this._denaliEditorModel=t,this._upgradeHook=i,this._environment=ae,this._platformEnvironment=le,this._telemetry=ce,this._remSizeObs=pe,this._networkState=ue,this._docId=me,this._notificationsManager=_e,this.documentLoader=ve,this._textResources=fe,this._config=ye,this._experimentClient=Se,this._userAccount=we,this._router=ke,this._downloadViewModel=Me,this._uploadViewModel=Ee,this.logout=Te,this.formattingViewModel=m.none,this.emotionsViewModel=m.none,this._openInlineAlert=new C.B,this._inlineAlertHovered=new C.B,this._log=g.Bx.Logging.getLogger("ViewModels"),this._subs=new k.y.Keeper,this._editorWrapperViewport=h.s.create(this._denaliEditorModel.viewport.value.wrapper),this._remSize=h.s.create(16),this._lensesState=h.s.create(w.K.defaultState);const xe=n.create();this.focus=q.B.create({contentFocusChanges:se.r.create(this._denaliEditorModel),eq:se.B.eq,ord:se.B.ord,show:se.B.show,contentSection:m.some(se.B.create(se.B.Id.editor))}),this.notificationsManager=_e;const Ie=this._log.getLogger("Oggy"),Ae=new Z.o.Impl(this._engine.checkingDomain.state,this._engine.positionManager,this._engine.alertsReader,(0,u.M4)(y.Fc.isRegistered,(0,u.AU)(y.Fc.isMuted)));this._getAlertClosestToCursor=(0,Q.h_)((e=>{switch(e){case"cursor":return gi(this._denaliEditorModel)();case"middleOfTheViewport":return(0,d.pipe)(this._denaliEditorModel.getPossibleCursorPosition(r.left(v.Yd.X.middle),r.left(v.Yd.Y.middle)),r.getOrElse(gi(this._denaliEditorModel)));default:return(0,p.xb)(e)}}),Ae);const Fe=(0,d.pipe)(this._userAccount.features.denali.mutedAlerts,m.fromPredicate(d.identity),m.map((()=>this._engine.mutedAlertsModel))),Ve=j.v.create(j.v.defaultLensFilters,j.v.defaultTextFilters);this.lensPreviewViewModel=new Qt(this._lensesState.view("lenses"),Ve),this.upgradeViewModel=new ri.tG(this._engine.checkingDomain,this.lensPreviewViewModel,this._docId,this._platformEnvironment,this._upgradeHook,this._config,this._userAccount.features.denali.uphookFormat,this._userAccount.features.denali.uphookDestination,this._userAccount.features.isSmartPlagiarismUphookEnabled,(()=>this._userAccount.features.freeTrialSpecialOffer.get().isEligible),this._userAccount.features.inProductDiscount),this.feedbackViewModel=new Ut._n(this._notificationsManager,(e=>{var t;return g.Bx.Logging.getLogger("userFeedback").info("Submit form feedback",{detailedFeedback:e.message,mood:e.mood,userType:this._userAccount.profile.get().type}),this._telemetry.gnarSpec.feedbackFormSubmit(null!==(t=e.message)&&void 0!==t?t:"",this._telemetry.pageId,e.mood,"editor")})),this._subs.push(this._engine.checkingDomain.state.pipe((e=>w.K.get(e,this._engine.checkingDomain.lensesScores,Ve))).subscribe(M.H9(this._lensesState))),this.a11yNotificationManager=(()=>{const e=function(){const e=new Map;return{registerStatus:t=>{const i=qe+t,n=Qe(i);return n.setAttribute("role","status"),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),et(n),document.body.appendChild(n),e.set(i,n),{change:e=>function(e,t,i){const n=document.getElementById(t);if(n)return""===e?(n.innerHTML="&nbsp;",void setTimeout((()=>n.innerHTML=""),1e3)):void(n.textContent=e);{const n=document.createElement("div");n.id=t,n.textContent=e,i.appendChild(n)}}(e,i,n),dispose:()=>n.remove()}},dispose:()=>{e.forEach((e=>e.remove()))}}}(),t=function(){const e=Qe(Ze);e.setAttribute("role","alert"),e.setAttribute("aria-live","assertive"),e.setAttribute("aria-relevant","additions"),et(e);const t=Qe(je);return t.setAttribute("role","log"),t.setAttribute("aria-live","polite"),t.setAttribute("aria-relevant","additions"),et(t),{announceMessage:i=>{switch(i.type){case"alert":Xe(i.text,e);break;case"log":Xe(i.text,t);break;default:(0,p.AS)(i.type)}},dispose:()=>{e.remove(),t.remove()}}}();return{announceMessage:t.announceMessage,registerStatus:e.registerStatus,dispose:()=>{e.dispose(),t.dispose()}}})(),this._reportViewModel=Ce(this._lensesState),this.modalManager=new f.jM(new Ge.JG(this._userAccount,this._textResources,this._engine.sessionModel,this.upgradeViewModel,this._config,this._platformEnvironment,this.feedbackViewModel,this._notificationsManager,this._engine.sessionModel,this._reportViewModel,this._telemetry,this._engine.mutedAlertsModel,Te,this.a11yNotificationManager.registerStatus("set-goals-modal")));const Be=h.s.create(!1);this._subs.push(this._engine.cheetah.oggyPlagiarismModel.state.view("isAvailable").pipe(E.J(),T.T((([e,t])=>e&&!t?e:t)),x.M(M.H9(Be))).subscribe()),this.navigationViewModel=new oe.xK(this._telemetry,this.modalManager,this._userAccount.features,this._getAlertClosestToCursor,this._engine.sessionModel,Fe,h.s.create(X.p.CardVisualMode.ContrastLightMode),h.s.create(!0),this._lensesState.view("lenses").view((0,d.flow)(S.x.lookup(b.J.SpecialId.Premium),m.map((e=>e.count)),m.getOrElse((0,d.constant)(0)),(e=>({title:"Premium",count:e})))),this._engine.cheetah.oggyUphookModel.state.view("isAvailable"),Be),this._pageTelemetry=new oi(this.navigationViewModel.state.view("isSidebarOpen"),this._telemetry);const Re=this.navigationViewModel.state.view("isSidebarOpen");this.searchViewModel=new ai.XS(this._denaliEditorModel,this._engine.positionManager,this._editorWrapperViewport),this.documentSettingsViewModel=(0,ii.N1)(this._denaliEditorModel,this._router,this._textResources.denali,this._userAccount,Te,this._userAccount.settings,this._downloadViewModel,this.upgradeViewModel,this.modalManager,this._uploadViewModel,this._environment,this._notificationsManager,this.searchViewModel,this._telemetry,this._engine.sessionModel,this.navigationViewModel.state.pipe(I.i(1))),this._cheetahInlineAvailabilityProvider=it.create(this.navigationViewModel,this.documentSettingsViewModel.viewModel.visualState,this._engine.cheetah.genAiAvailabilityService.availability,this._userAccount.features.denali);const Ue=this._engine.sessionModel.rtfMode===te.jj.l1.FormattingMode.on?m.some((0,Jt.hn)(this._denaliEditorModel.getCursor.bind(this._denaliEditorModel),(e=>{this._denaliEditorModel.setFormatting((0,a._)((0,o._)({},e),{meta:(0,a._)((0,o._)({},e.meta),{formatting:(0,o._)({},e.meta.formatting)})}))}),this._denaliEditorModel.selectedFormatting,this._denaliEditorModel.isEditorFocused,this._textResources.denali,this._telemetry.gnarSpec,this._telemetry.pageId,this._environment)):m.none,Ne=A.z([this._engine.cheetah.oggyManager.alertVisibilityFilter,this.navigationViewModel.state]).pipe(T.T((([e,{isSidebarOpen:t,isGgoOpen:i}])=>this._userAccount.features.denali.oggy===ie.kH.splitSharedAssistants&&i?d.constFalse:t?e:y.Fc.isInline))),Pe=Ne.pipe(T.T((e=>({filter:e,lensId:b.J.SpecialId.AllAlerts}))));this.marksViewModel=new ti.t(this._denaliEditorModel,this._engine.checkingDomain,this._engine.alertsReader,this._engine.alertsService,this._engine.alertsService,this._environment.has(ze.OH.Flag.highHighlights),new ee.a(this._engine.cheetah.oggyManager.alertHighlightChanges),Ve,Pe,this._userAccount.settings.editorPreferences.view("suggestionsVisualMode"),this._engine.cheetah.oggyManager.alertHighlightChanges,this._userAccount.features.isFree,this._userAccount.features.denali.renderedEventsTrackingEnabled,this._userAccount.features.denali.lockedUIHighlightsColor),this.alertUserEvents=new J.Jc(this._denaliEditorModel,this.marksViewModel,this._engine.alertsReader,this._engine.cheetah.oggyManager.alertHighlightChanges,Ne),this._inlineManager=function(e,t,i,n,s,o){const a=h.s.create(Pt.idle),r=h.s.create(new Set([Pt.Type.idle])),l=g.Bx.Logging.getLogger("inlineManager");l.isEnabled(g.y7.$.DEBUG)&&a.subscribe((e=>l.debug("state change to",e)));const c=new C.B,p=new C.B,u=new C.B,_=new C.B,v=new C.B,f=new C.B,b=h.s.create(m.none),S=(0,d.pipe)(n,m.fold((()=>V.w),(e=>Jt.uY.fromToolbar(e.linkEvents))),Wt.u()),w={[Pt.Type.idle]:Pt.Scheme.monoid.empty,[Pt.Type.formattingLink]:Pt.Scheme.forFormattingLink(e,S,u),[Pt.Type.upgradeHook]:Pt.Scheme.forUpgradeHook(t,i,_),[Pt.Type.synonymsCard]:Pt.Scheme.forSynonymsState(s,p),[Pt.Type.inlineCard]:Pt.Scheme.forCardState(t,i,c),[Pt.Type.cheetahInlineButton]:Pt.Scheme.forCheetahInlineButton(e,o,v),[Pt.Type.vbarCard]:Pt.Scheme.forVbarCard(f),[Pt.Type.teaserCard]:Pt.Scheme.forTeaserCard(t,i,c,b)},k=r.view(Array.from).view(be.ue(Pt.Scheme.monoid)((e=>w[e]))),E=A.z([k,a.view("type")]).pipe(K.n((([e,t])=>L.h(...e[t]))),Gt.S(((e,t)=>{const[i,n]=t(e);return l.debug("state change",{prevState:e,changeReason:i,nextState:n}),n}),Pt.idle),x.M(M.H9(a)),U.Z(Pt.idle),Wt.u()),I=e=>re.c.create((()=>(r.modify((t=>new Set(t).add(e))),()=>r.modify((t=>{const i=new Set(t);return i.delete(e),i}))))).pipe(U.Z(M.q6));return{doubleClickedWord:I(Pt.Type.synonymsCard).pipe(he.K(E.pipe(T.T((e=>e.type===Pt.Type.synonymsCard?m.some(e.word):m.none)))),R.F(m.getEq(Oe.h0.ord).equals),Wt.u()),closeSynonyms:p,hoveredMarkAlert:L.h(I(Pt.Type.inlineCard),I(Pt.Type.teaserCard)).pipe(he.K(E.pipe(T.T((e=>e.type===Pt.Type.inlineCard||e.type===Pt.Type.teaserCard?m.some(e.alert):m.none)))),R.F(m.getEq(y.HJ.ord).equals),Wt.u()),closeCards:c,formattingLinkState:I(Pt.Type.formattingLink).pipe(he.K(E.pipe(T.T((e=>e.type===Pt.Type.formattingLink?m.some(e.link):m.none)))),R.F(m.getEq(zt.W.LinkState.eq).equals),Wt.u()),closeLinks:u,upgradeHookState:I(Pt.Type.upgradeHook).pipe(he.K(E.pipe(T.T((e=>e.type===Pt.Type.upgradeHook?m.some(e.alert):m.none)))),R.F(m.getEq(de.z.eq).equals),Wt.u()),closeUpgradeHooks:_,cheetahInlineButtonState:I(Pt.Type.cheetahInlineButton).pipe(he.K(E.pipe(T.T((e=>e.type===Pt.Type.cheetahInlineButton?m.some((0,d.constVoid)()):m.none)),Wt.u()))),closeCheetahInlineButton:v,activeVbar:I(Pt.Type.vbarCard).pipe(he.K(E.pipe(T.T((e=>e.type===Pt.Type.vbarCard?e.vbar:m.none)))),Wt.u()),changeActiveVbar:f,currentTeaser:b,changeTeaserExpanded:e=>b.set(e)}}(this._denaliEditorModel,this.alertUserEvents,this._engine.alertsReader,Ue,xe,this._cheetahInlineAvailabilityProvider);const De=A.z([Re,Ne]).pipe(T.T((([e,t])=>e?t:d.constTrue)));this.vbarsViewModel=this._userAccount.features.denali.writingExpertVbarsEnabled?m.some(new hi(this._engine.obsCapiClient.events,this._denaliEditorModel,this._engine.alertsService,this._engine.checkingDomain.state,De,this.marksViewModel,this._inlineManager,Re,(e=>this.notificationsManager.enqueue(e?"feedbackSend":"error").pipe(F.p((e=>"shown"===e)))))):m.none;const Ke=(0,d.pipe)(this.vbarsViewModel,m.map((e=>e.highlightedVbarAlert.pipe(T.T(m.map((e=>({alert:e,highlightIndex:0,source:y.Kz.text}))))))),m.getOrElse((()=>V.w))),We=this.navigationViewModel.state.view("isSidebarOpen");this._subs.push((0,d.pipe)(this._engine.cheetah.oggyManager,ne.Factory.create(Ie,ne.focusAlertByClickedMark(L.h(L.h(this.alertUserEvents.alertClicked,Ke),(0,d.pipe)(this.vbarsViewModel,m.map((e=>e.alertClickedInAssistantMode)),m.getOrElse((()=>V.w))))),ne.highlightMark(this._engine.alertsReader,this.marksViewModel,this.focus.state,this._denaliEditorModel.contentUpdated.pipe(F.p((e=>"user"===e.source))),this._denaliEditorModel.isEditorFocused,We),ne.updateLoaderStateOnReady(this.documentLoader),ne.unfocusAlertHighlightOnSidebarClose(We),ne.scrollAlertIntoView(this.marksViewModel,We),ne.toggleAutoScroll(this._userAccount.settings.editorPreferences.view("autoScrollToNextAlert").view(O.O.unwrap(!this._userAccount.features.denali.autoJumpSettings.isDisabledByDefault)))))),this.capiSession=new tt(this._engine.cheetah.capiMessages),this.cheetahViewModel=kt.create({engine:this._engine,denaliEditorModel:this._denaliEditorModel,userAccount:this._userAccount,upgradeVM:this.upgradeViewModel,navigationVM:this.navigationViewModel,telemetry:this._telemetry,inlineManager:this._inlineManager,modalManager:this.modalManager,experimentClient:this._experimentClient,environment:this._environment,platformEnvironment:this._platformEnvironment,config:this._config,notificationsManager:this._notificationsManager,capiSessionId:this.capiSession.sessionUuid}),this._subs.push(new ge(this.navigationViewModel,this._openInlineAlert,this._engine.cheetah.oggyManager,this.cheetahViewModel,this._engine.cheetah.oggyUphookModel,this._engine.cheetah.oggyPlagiarismModel)),this._subs.push(B.R(window,"beforeunload").subscribe((()=>this.cheetahViewModel.dispose()))),this.vbarsViewModel=m.none,this._subs.push(this._denaliEditorModel.viewport.pipe(R.F(),T.T((e=>e.wrapper))).subscribe(M.H9(this._editorWrapperViewport)),this._remSizeObs.subscribe(M.H9(this._remSize)),se.B.initTracking(this.focus,this._telemetry),this._denaliEditorModel.dontFreezeWhen(this.focus.state.pipe(T.T(m.exists((e=>e.id!==se.B.Id.editor)))),"focus-manager"),this._denaliEditorModel.contentUpdated.pipe(F.p(v.D_.isTextMaybeWithFormatting),T.T((()=>this._denaliEditorModel.getTextLength())),U.Z(this._denaliEditorModel.getTextLength()),E.J(),F.p((([e,t])=>e-t>500)),N.p((()=>P.O1(1e3).pipe(D.s(1),H.Q(this._denaliEditorModel.shortcutUsed),K.n((()=>this.notificationsManager.enqueue("textRemoved").pipe(H.Q(this._denaliEditorModel.shortcutUsed.pipe(x.M((()=>this._telemetry.gnarSpec.undoTextRemovedHotkeyPress())))),x.M((e=>{"shown"===e?this._telemetry.gnarSpec.undoTextRemovedNotificationShow(this._telemetry.pageId):"undo"===e&&(this._denaliEditorModel.undo(),this._telemetry.gnarSpec.undoTextRemovedButtonClick(this._telemetry.pageId))})),W.v((e=>"undo"!==e))))))))).subscribe(),this._denaliEditorModel.textChangedAfterPaste.subscribe((({len:e,source:t,tags:i,type:n})=>this._telemetry.gnarSpec.pasteEventFire(e,this._telemetry.pageId,t,i,n)))),this._gbRuleCreatedViewModel=new Nt(this._config,this._engine.obsCapiClient,this._notificationsManager,this._telemetry),this._subs.push(this._denaliEditorModel.clickedWord.pipe(T.T(m.filter((e=>2===e.meta.clicks))),G.E(this.alertUserEvents.alertClicked.pipe(U.Z(m.none)),((e,t)=>m.isNone(t)?e:m.none)),$.oE).subscribe(xe.doubleClickedWord));const Je=Ht.k.ViewModel.getInlineHighlightFilter(Re),Ye=(0,d.flow)(this.marksViewModel.getMarkByAlert,r.fromOption((()=>new Error("mark not found"))),r.chain((e=>e.getRect())),l.Mr);this.inlineCardViewModel=new Ht.e(this._inlineManager,Ye,L.h(this._denaliEditorModel.contentUpdated.pipe(z.u(M.q6))),this._engine.checkingDomain,this._engine.alertsReader,this._engine.alertsService,this._telemetry,this._openInlineAlert,this._inlineAlertHovered,Je,this.notificationsManager),(()=>{this._subs.push(this._engine.sduiInlineManager.pipe(x.M((e=>{const t=new Dt.b9(this._engine.sduiService,this._engine.sduiManager.get(),e,this.inlineCardViewModel,this._engine.alertsReader,this._engine.obsCapiClient,this._platformEnvironment,(0,$e.l)(this.notificationsManager,this._environment),this.upgradeViewModel);(0,d.pipe)(m.fromNullable(this.sduiInlineViewModel),_.Mi((e=>{e.get().dispose(),this.sduiInlineViewModel.set(t)})),_.jw((()=>this.sduiInlineViewModel=h.s.create(t))))}))).subscribe())})(),this.synonymsViewModel=new He(this._inlineManager,this._engine.positionManager,this._engine.synonymsModel,this._networkState,this._denaliEditorModel,this._notificationsManager,this._engine.cheetah.oggyManager.alertHighlightChanges,(()=>this._telemetry.gnarSpec.notificationCloseButtonClick("alertUndo",this._telemetry.pageId)),((e,t)=>{this._telemetry.gnarSpec.synonymsPopupShow(t.numberOfMeanings,t.numberOfSynonymsByMeanings,t.numberOfSynonymsTotal,this._telemetry.pageId,e)}),((e,t,i)=>{this._telemetry.gnarSpec.synonymsPopupClose(t.numberOfMeanings,t.numberOfSynonymsByMeanings,t.numberOfSynonymsTotal,i,this._telemetry.pageId,e)}),((e,t,i)=>{this._telemetry.gnarSpec.synonymsAcceptButtonClick(t.meaningIndex,t.synonymIndexInGroup,t.synonymIndexAbs,t.numberOfMeanings,t.numberOfSynonymsByMeanings,t.numberOfSynonymsTotal,i,this._telemetry.pageId,e)})),this.formattingViewModel=(0,d.pipe)(_.CO(Ue,this._engine.formattingModel),m.map((([e,t])=>{const i=zt.W.createManager(this._denaliEditorModel,t,this._inlineManager);return this._subs.push(e,i),{toolbarViewModel:e.viewModel,linksManager:i}}))),this.documentPlaceholderViewModel=new Ot(this._uploadViewModel,this._denaliEditorModel,this._userAccount,this._environment,this._engine.sessionModel.rtfMode,this._textResources.denali),this.emotionsViewModel=(0,d.pipe)(this._engine.emotionsModel,m.map((e=>Rt.H.ViewModel.create(e,this._engine.sessionModel,this._textResources.denali))));const nt=(0,d.pipe)(Ue,m.map((e=>[e.viewModel,this.searchViewModel,this.documentSettingsViewModel.viewModel])),m.getOrElse((()=>[this.searchViewModel,this.documentSettingsViewModel.viewModel])));this.hotkeyManager=new Y.ai(c.t.from(nt),this._environment.has(ze.OH.Flag.isAppleSystem),this._environment.platform===ze.OH.Platform.IPAD),this.onboardingViewModel=new Le(this._userAccount.settings,this._denaliEditorModel,this._engine.sessionModel,this._engine.alertsReader,this._userAccount.features.onboardingMode(),this._telemetry,this._engine.cheetah.oggyManager.alertHighlightChanges,(()=>this.marksViewModel.getFirstMark().pipe($.oE,T.T((e=>m.fromEither(e.getRect()))))),this.cheetahViewModel,this.navigationViewModel,this._userAccount.features),this.loaderViewModel=new ei.C(this.documentLoader.state,this.navigationViewModel,this._engine.sessionModel,(0,d.pipe)(this._uploadViewModel,m.map((e=>e.state)),m.getOrElse((()=>V.w))),this._denaliEditorModel)}}const gi=e=>()=>e.getCursor().index},80949:(e,t,i)=>{var n,s;i.d(t,{f:()=>n,p:()=>s}),function(e){let t;!function(e){e.starting="starting",e.visuallyReady="visuallyReady",e.interactionReady="interactionReady",e.readyToDrag="readyToDrag",e.close="close",e.focusStateChanged="focusStateChanged"}(t=e.Kind||(e.Kind={})),e.isStarting=e=>e.kind===t.starting,e.isVisuallyReady=e=>e.kind===t.visuallyReady;var i=e.isInteractionReady=e=>e.kind===t.interactionReady,n=e.isInteractionReadyRevisionInfo=e=>"revision"===e.kind;e.isRevisionInteractionReady=e=>i(e)&&n(e.interactionReadyInfo),e.isReadyToDrag=e=>e.kind===t.readyToDrag,e.isClose=e=>e.kind===t.close,e.isFocusStateChanged=e=>e.kind===t.focusStateChanged}(n||(n={})),function(e){let t,i;!function(e){e.FocusRequested="focusRequested",e.StatusChanged="statusChanged"}(t=e.Kind||(e.Kind={})),function(e){e.PremiumSuggestionsUphook="PremiumSuggestionsUphook",e.Plagiarism="Plagiarism"}(i=e.Source||(e.Source={}));var n=e.isStatusChanged=e=>e.kind===t.StatusChanged,s=e.isFocusRequested=e=>e.kind===t.FocusRequested;e.isIncoming=e=>n(e),e.isOutgoing=e=>s(e)}(s||(s={}))},70823:(e,t,i)=>{i.d(t,{C:()=>H,F2:()=>R,Fi:()=>B,H4:()=>W,Ip:()=>N,Nc:()=>D,ii:()=>U,n$:()=>O,xs:()=>K});var n=i(83531),s=i(10334),o=i(17171),a=i(65390),r=i(84647),l=i(36573),d=i(38200),c=i(19835),p=i(72297),h=i(24819),u=i(84712),g=i(57836),m=i(34553),_=i(42299),v=i(63687),f=i(10479),y=i(91745),b=i(7149),S=i(1224),w=i(18810),C=i(73328),k=i(94855),M=i(66202),E=i(68801),T=i(63376),x=i(80029),I=i(98719),A=i(40884),F=i(40005),V=i(18286),L=i(80949);const O=(e,t,i,n,s,o)=>{const a=S.Bx.Logging.getLogger("Cheetah.TextInsertion");return{getText:t=>(0,r.pipe)(C.zb((()=>e.getText().substring(t.start,t.end))),k.Mr),flush:()=>k.TX((()=>Promise.resolve(e.flushChanges())),M.toError),insertText:e=>(a.info("Inserting text"),(0,r.pipe)((new p.R).insert(e),(e=>t.replaceCurrentSelectionWith(e)),k.wu((e=>(a.error("Text insertion error",e),e)),(()=>{n(),a.info("Text inserted")})))),copyText:e=>o(e,"somethingCopied").then(r.constVoid),setContextHighlight:(e,t)=>{i.setContextHighlight(e,t)},selectedRange:s,textUpdated:e.contentUpdated.pipe(g.u(void 0))}},B=(e,t,i)=>{const n=new m.B;return e.registerExternalMessageHandler((e=>(n.next(e),(0,l.El)(e)?T.Q.Result.STOP_HANDLING:T.Q.Result.CONTINUE_HANDLING))),{capiService:new d.V({inboundCAPIMessages:_.x(v.v((()=>f.H(Object.values(t.get())))).pipe(y.p(l.Uv)),n),sendCAPIMessage:({action:t,data:n,shouldInjectRev:a,shouldInjectSessionId:r})=>{if("user_action"===t){const{componentId:t,userAction:i}=n;return e.sendUserAction(t,i)}return"toggle_checks"===t&&i?k.kb(new Error("Free user is not allowed to toggle checks")):e.enqueueExternalCommand((({id:e,sessionId:i,currentRevision:l})=>(0,o._)((0,s._)({action:t,id:e},n),{rev:!0===a?l:void 0,sessionId:!0===r?i:void 0})))}}),capiMessages:n}},R=e=>({user:u.s.combine(e.profile,e.settings.dialectOrDefault,((t,i)=>({kind:"signed-in",id:t.id,isPremium:A.DY.isPremium(e.features.denaliUserType),dialect:i,institution:(0,r.pipe)(t.institutionInfo,a.map((e=>({id:e.id,name:e.name,logoUrl:(0,r.pipe)(e.vox,a.chain((e=>e.logoUrl)),a.toUndefined),styleGuideEnabled:a.isSome(e.vox)})))),email:t.email,editorFeatures:{plagiarismDisabled:e.features.plagiarism.get()===A.Fh.disabled}}))),setDialect:t=>(0,r.pipe)(k.TX((()=>e.settings.setDialect(t)),M.toError),k.Tj(r.constVoid))}),U=e=>({deepLinkRequests:e.outgoing.pipe(b.T((e=>{switch(e.source){case L.p.Source.PremiumSuggestionsUphook:return"premiumSuggestionsUphook";case L.p.Source.Plagiarism:return"plagiarismView";default:return(0,h.AS)(e.source)}}))),notifyStatusChanged:(t,i)=>{switch(t){case"plagiarismView":e.push({kind:L.p.Kind.StatusChanged,source:L.p.Source.Plagiarism,available:i.available,focused:i.active});break;case"premiumSuggestionsUphook":e.push({kind:L.p.Kind.StatusChanged,source:L.p.Source.PremiumSuggestionsUphook,available:i.available,focused:i.active});break;case"performanceScoreView":break;default:(0,h.AS)(t)}}}),N=(e,t,i,n,a)=>{const l=V.J.create(e.gnarSpec),d={pageId:e.pageId,upgradeHookVariant:n.upgradeHookVariant};return{trackUphookShown:e=>(0,r.pipe)(k.Gg((()=>{const t=a.get();switch(e.name){case"grammarlyGoPrompts":return l.countShow((0,o._)((0,s._)({},d),{upgradeHookName:e.name,upgradeHookSlot:e.slot,upgradeHookVariant:e.variant})),l.trackShow((0,o._)((0,s._)({},d),{sessionUuid:t,placement:"grammarlyGoPrompts",upgradeHookName:e.name,upgradeHookSlot:e.slot,upgradeHookVariant:e.variant}));case"plagiarism":return l.countShow((0,o._)((0,s._)({},d),{upgradeHookName:e.name,upgradeHookSlot:e.slot,upgradeHookVariant:e.variant})),l.trackShow((0,o._)((0,s._)({},d),{sessionUuid:t,placement:"plagiarismView",upgradeHookName:e.name,upgradeHookSlot:e.slot,upgradeHookVariant:e.variant}));case"toneDetector":return l.countShow((0,o._)((0,s._)({},d),{upgradeHookName:e.name,upgradeHookSlot:e.slot,upgradeHookVariant:e.variant})),l.trackShow((0,o._)((0,s._)({},d),{sessionUuid:t,placement:"toneDetector",upgradeHookName:e.name,upgradeHookSlot:e.slot,upgradeHookVariant:e.variant}));default:(0,h.xb)(e.name)}})),E.hq),trackUphookClicked:t=>(0,r.pipe)(k.Gg((()=>{const i=a.get();switch(t.name){case"grammarlyGoPrompts":return l.countClick((0,o._)((0,s._)({},d),{upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant})),l.trackClick({pageId:e.pageId,sessionUuid:i,placement:"grammarlyGoPrompts",upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant});case"plagiarism":return l.countClick((0,o._)((0,s._)({},d),{upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant})),l.trackClick((0,o._)((0,s._)({},d),{sessionUuid:i,placement:"plagiarismView",upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant}));case"toneDetector":return l.countClick((0,o._)((0,s._)({},d),{upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant})),l.trackClick((0,o._)((0,s._)({},d),{sessionUuid:i,placement:"toneDetector",upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant}));default:(0,h.xb)(t.name)}})),E.hq),trackUphookDismissed:t=>{const i=a.get();return"plagiarism"===t.name?l.trackDismiss({pageId:e.pageId,sessionUuid:i,placement:"plagiarismView",upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant}):(0,h.AS)(t.name)},executeUphook:e=>(0,r.pipe)(k.L9((()=>{switch(e.name){case"grammarlyGoPrompts":return n.fromGrammarlyGO();case"advancedIssues":return n.handleUpgradeClick(I.YT.Place.DenaliDocument.editorDenaliAdvanced,{upgradeHookName:e.name,upgradeHookSlot:e.slot,upgradeHookVariant:e.variant});case"blurredSuggestion":return n.handleUpgradeClick(I.YT.Place.DenaliDocument.oggyBlurredSuggestion,{upgradeHookName:e.name,upgradeHookSlot:e.slot,upgradeHookVariant:e.variant});case"plagiarism":case"toneDetector":return n.handleUpgradeClick(I.YT.Place.DenaliDocument.oggyPlagiarismUphook,{upgradeHookName:e.name,upgradeHookSlot:e.slot,upgradeHookVariant:e.variant});default:(0,h.xb)(e.name)}})),E.hq),isEligibleForFreeTrial:n.isEligibleForFreeTrial,isEligibleForInProductDiscount:n.inProductDiscount.get().isEligible}};var P;const D=e=>({domain:u.s.create(null),submitFeedback:t=>k.Gg((()=>e.gnarSpec.feedbackFormSubmit(null!==(P=t.message)&&void 0!==P?P:"",e.pageId,t.mood,"cheetah-card")))}),H=(e,t,i,s)=>{const{env:o}=(0,x.W)();return{hostInfo:{clientType:i.names.tracking,clientVersion:i.buildVersion.toString(),containerId:t,environment:"fb"===o||"dev"===o?"dev":o},sizeBehavior:F.w.fitContainer,dragBehavior:u.s.create({kind:"notDraggable"}),openUrl:(a=(0,n._)((function*(e){return C.$v(s.actions.openUrl(new w.U(e)))})),function(e){return a.apply(this,arguments)}),visuallyReady:()=>(e.push({kind:L.f.Kind.visuallyReady}),Promise.resolve()),interactionReady:t=>(e.push({kind:L.f.Kind.interactionReady,interactionReadyInfo:t}),Promise.resolve()),readyToDrag:t=>(e.push({kind:L.f.Kind.readyToDrag,readyToDragInfo:t}),Promise.resolve(void 0)),focusStateChanged:t=>(e.push({kind:L.f.Kind.focusStateChanged,focusState:t}),Promise.resolve()),starting:()=>(e.push({kind:L.f.Kind.starting}),Promise.resolve()),close:()=>(e.push({kind:L.f.Kind.close}),Promise.resolve())};var a},K=e=>({gates:c.V,experiments:c.r,getTreatment:(0,r.flow)(e.getTreatment,k.pG),peekTreatment:(0,r.flow)(e.peekTreatment,k.pG),logTreatment:(t,i)=>k.TX((()=>e.logTreatment(t,i)),(e=>String(e))),isGateEnabled:(0,r.flow)(e.isGateEnabled,k.pG)}),W=(e,t,i)=>{const n=t.sendProfuseGnarEvents;return{performanceScoreReportShown:r.constVoid,feedSuccessStateShown:t=>e.gnarSpec.sidebarSuccessStateShow(t,e.pageId,"applied",i.get()),feedFormChanged:(t,n,s)=>{switch(t){case"shortForm":e.gnarSpec.assistantSwitchToShortFormClick(e.pageId,null!=n?n:void 0,null!=s?s:void 0,i.get());break;case"longForm":e.gnarSpec.assistantSwitchToLongFormClick(e.pageId,null!=n?n:void 0,null!=s?s:void 0,i.get());break;default:(0,h.AS)(t)}},feedLensShown:t=>{e.gnarSpec.assistantLensShow(t,e.pageId,i.get())},feedLensButtonClicked:t=>{e.gnarSpec.assistantLensButtonClick(t,e.pageId,i.get())},actionButtonClicked:(t,n,s,o,a)=>{e.gnarSpec.assistantActionButtonClick(n,t,e.pageId,s,o,a,i.get())},moreActionsButtonClicked:(t,n,s)=>{e.gnarSpec.assistantMoreActionsButtonClick(e.pageId,t,n,s,i.get())},actionButtonRendered:(t,s,o,a,r)=>{n&&e.gnarSpec.assistantActionButtonRender(s,t,e.pageId,o,a,r,i.get())},actionButtonShown:(s,o,a,r,l)=>{const d=t.isSmartPlagiarismUphookEnabled&&"plagiarism"===o;(n||d)&&e.gnarSpec.assistantActionButtonImpression(o,s,e.pageId,a,r,l,i.get())},plagiarismCitationsStyleChanged:t=>{e.gnarSpec.assistantPlagiarismCitationsStyleChange(t,e.pageId,i.get())},plagiarismCitationsStyleDropdownOpened:t=>{e.gnarSpec.assistantPlagiarismCitationsStyleDropdownOpen(e.pageId,t,i.get())},toneReportShown:r.constVoid,selectionContextHovered:()=>{e.gnarSpec.assistantSelectionContextHover(e.pageId,i.get())},selectionContextClicked:()=>{e.gnarSpec.assistantSelectionContextClick(e.pageId,i.get())},selectionContextRemoveButtonClicked:()=>{e.gnarSpec.assistantSelectionContextRemoveButtonClick(e.pageId,i.get())},partialPageModeNotificationDismissed:r.constVoid,playbookClicked:t=>{e.gnarSpec.assistantPlaybookClick(e.pageId,t,i.get())}}}},40005:(e,t,i)=>{i.d(t,{w:()=>n});var n,s=i(83694),o=i(31967),a=i(31206),r=i(7149),l=i(82585),d=i(30343);!function(e){e.fitContainer=s.of({heightBehavior:{kind:"fitContainer"},widthBehavior:{kind:"fitContainer"}}),e.fitContent=e=>o.sc(e).pipe(a.E("height"),r.T((e=>e-100)),l.B(100),d.Z(550),r.T((e=>({heightBehavior:{kind:"fitContent",maxHeight:e},widthBehavior:{kind:"fitContainer"}}))))}(n||(n={}))},769:(e,t,i)=>{i.d(t,{X:()=>s});var n,s,o=i(10334),a=i(69384),r=i(84647),l=i(66202),d=i(65390),c=i(7149),p=i(21644);!function(e){e.map=(e,t,i)=>c.T((0,r.flow)(d.map(l.fold(null!=i?i:t,e)),d.getOrElse(t)))}(n||(n={})),function(e){e.create=e=>t=>{var{engineDedStream:i}=t,n=(0,a._)(t,["engineDedStream"]);return i.pipe(c.T(d.map(l.bimap((e=>(n.documentLoader.onEngineError(),e)),(([t,i])=>(0,o._)({ded:t,engine:i,denaliViewModels:e((0,o._)({ded:t,engine:i},n))},n))))),p.u())}}(s||(s={}))},60083:(e,t,i)=>{i.d(t,{J:()=>b,x:()=>n});var n,s=i(23988),o=i(10334),a=i(17171),r=i(44869),l=i(84647),d=i(99002),c=i(84712),p=i(90829),h=i(1224),u=i(65390),g=i(65160),m=i(92832),_=i(7149),v=i(58655),f=i(9079),y=i(3016);!function(e){let t,i,s;!function(e){e.checking="checking",e.checkingIn="checkingIn",e.checkingOut="checkingOut"}(t=e.Type||(e.Type={})),function(e){e.loading="loading",e.processing="processing"}(i=e.TextType||(e.TextType={})),function(e){var t=e.eq=r.OW({text:u.getEq(d.Eq),lens:u.getEq(d.Eq),navigation:u.getEq(d.Eq)}),i=(e.isIdle=e=>t.equals(e,i),e.idle={text:u.none,lens:u.none,navigation:u.none});e.text={text:u.some(n.TextType.loading),lens:u.none,navigation:u.none},e.processing={text:u.some(n.TextType.processing),lens:u.some(n.Type.checking),navigation:u.some(n.Type.checking)},e.navigationProcessing=(0,a._)((0,o._)({},i),{navigation:u.some(n.Type.checking)}),e.loading={text:u.some(n.TextType.loading),lens:u.some(n.Type.checking),navigation:u.some(n.Type.checking)},e.toString=function(e){const t=(0,l.pipe)(e.lens,u.filter((e=>"checkingOut"!==e)),u.fold((()=>"on"),(()=>"off"))),i=(0,l.pipe)(e.navigation,u.filter((e=>"checkingOut"!==e)),u.fold((()=>"on"),(()=>"off")));return`text: ${(0,l.pipe)(e.text,u.getOrElse((()=>"off")))}; lens: ${t}; nav: ${i}`}}(s=e.State||(e.State={}))}(n||(n={}));class b{dispose(){this._subs.dispose()}_listenLoading(){this._subs.push(this.state.subscribe((e=>{this._log.debug(`State is changed to ${n.State.toString(e)}`)})),this._listenTimeseries("text",(e=>(0,l.pipe)(e.text,g.y0)),!0),this._listenTimeseries("lens",(e=>(0,l.pipe)(e.lens,u.filter((e=>"checkingOut"!==e)),u.map((()=>"checking")),g.y0))),this._listenTimeseries("navigation",(e=>(0,l.pipe)(e.navigation,u.filter((e=>"checkingOut"!==e)),u.map((()=>"checking")),g.y0))))}_listenTimeseries(e,t,i=!1){return this.state.pipe(m.i(1),_.T((e=>t(e))),v.F(),_.T((t=>{if(void 0!==t)return i&&this._metric.getCounter(`${e}.${t}.start.counter`).increment(),{time:this._metric.getTimer(`${e}.${t}.time`).start(),counter:i?this._metric.getCounter(`${e}.${t}.stop.counter`):void 0}})),f.J()).subscribe((([e])=>{e&&(e.time.stop(),e.counter&&e.counter.increment())}))}constructor(e,t){(0,s._)(this,"_router",void 0),(0,s._)(this,"_features",void 0),(0,s._)(this,"state",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_metric",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"onEngineError",void 0),this._router=e,this._features=t,this.state=c.s.create(n.State.idle),this._log=h.Bx.Logging.getLogger("denali_loader"),this._metric=h.Bx.TimeSeries.rootFemetrics.getMetric("denali_loader"),this._subs=new y.y.Keeper,this.onEngineError=()=>this.state.set(n.State.idle),this._listenLoading(),(0,l.pipe)(this._router.locationState,u.exists((e=>!0===e.openSidebar)))||this._features.sidebarOpenedByDefault?this.state.set(n.State.processing):this.state.set(n.State.text),(0,p.hJ)("setLoader",(e=>{switch(e){case"idle":return this.state.set(n.State.idle);case"text":return this.state.set(n.State.text);case"navigation":return this.state.set(n.State.navigationProcessing);case"all":return this.state.set(n.State.processing);default:return(0,l.absurd)(e)}}))}}},72404:(e,t,i)=>{i.d(t,{H:()=>n});var n,s=i(65390),o=i(84647),a=i(24819),r=i(84712),l=i(51770),d=i(32102),c=i(14e3);!function(e){let t,i,n,p,h,u;function g(e,{emogenie:{popup:{intensities:i}}}){switch(e){case t.VeryStrong:return i.veryStrong;case t.Strong:return i.strong;case t.Moderate:return i.moderate;case t.Slight:return i.slight;default:return(0,a.xb)(e)}}!function(e){e[e.Low=1]="Low",e[e.Slight=2]="Slight",e[e.Moderate=3]="Moderate",e[e.Strong=4]="Strong",e[e.VeryStrong=5]="VeryStrong"}(t||(t={})),e.intensitiesOrder=(0,l.HP)(t).map((e=>t[e])).filter((e=>"number"==typeof e)).sort(),function(e){e.fromConfidence=function(e,i){const n=d.w.unwrap(e);return n<.25?t.Slight:n<.5?t.Moderate:n/i>.5?t.VeryStrong:t.Strong}}(i||(i={})),function(e){e.fromModel=function({name:e,confidence:t,feedback:n,emoji:a},r,l,d){const p=i.fromConfidence(t,l);return{emoji:a,name:e,intensity:p,intensityCaption:g(p,d),feedback:n,actions:{like:{name:`${e}-like`,tooltip:d.emogenie.popup.actions.like,active:(0,o.pipe)(n,s.exists((e=>e===c.B.FeedbackType.Like))),disabled:s.isSome(n),handler:()=>r(e,c.B.FeedbackType.Like)},dislike:{name:`${e}-dislike`,tooltip:d.emogenie.popup.actions.dislike,active:(0,o.pipe)(n,s.exists((e=>e===c.B.FeedbackType.Dislike))),disabled:s.isSome(n),handler:()=>r(e,c.B.FeedbackType.Dislike)}}}}}(n=e.Item||(e.Item={})),function(e){let t;!function(e){e.Report="Report",e.ZeroState="ZeroState"}(t=e.Type||(e.Type={})),e.isReport=e=>e.type===p.Type.Report}(p=e.View||(e.View={})),function(e){e.fromModel=function(e,t,i){const s=e.reduce(((e,t)=>e+d.w.unwrap(t.confidence)),0),[a,...r]=e.map((e=>n.fromModel(e,t,s,i)));return{type:p.Type.Report,primaryItem:a,secondaryItems:r,onPopupClose:o.constVoid,onPopupOpen:o.constVoid}}}(h||(h={})),function(e){e.create=function(e,t,i){return{visualState:r.s.combine(e.emotions,t.documentLength.view("trimmed").view((e=>e<120)),((t,n)=>n||0===t.length?{type:p.Type.ZeroState,tooltipText:n?s.some(i.emogenie.popup.textIsTooShortMessage):s.none}:h.fromModel(t,e.sendEmotionFeedback,i)))}}}(u=e.ViewModel||(e.ViewModel={})),e.getIntensityTitle=g}(n||(n={}))},80548:(e,t,i)=>{i.d(t,{e:()=>W,k:()=>n});var n,s=i(23988),o=i(10334),a=i(17171),r=i(66202),l=i(84647),d=i(24819),c=i(84712),p=i(90829),h=i(1224),u=i(65390),g=i(65160),m=i(35679),_=i(63967),v=i(62597),f=i(22809),y=i(80159),b=i(75248),S=i(18449),w=i(91745),C=i(99010),k=i(79937),M=i(3016),E=i(33011),T=i(30343),x=i(9079),I=i(60191),A=i(7149),F=i(83694),V=i(4444),L=i(79),O=i(84872),B=i(98324),R=i(5406),U=i(48779),N=i(58655),P=i(21644),D=i(45653),H=i(87275),K=i(93584);!function(e){let t,i;!function(e){e.getInlineHighlightFilter=e=>t=>!e.get()||(0,l.pipe)(t,u.map((e=>_.Fc.State.isBulkApplied(e.state))),u.getOrElse(l.constTrue))}(t=e.ViewModel||(e.ViewModel={})),function(e){e.highlightMarkByInlineAlert=(e,t,i,n)=>({id:n,when:(0,p.Ub)(v.J.isClosedId,v.J.isMainLens),what:H.os.Effect.Applicator.create(K.FA.getHighlightSubscription(e,t,i).pipe(b.K(S.t)))})}(i=e.Effects||(e.Effects={}))}(n||(n={}));class W{_openAlert(e){this._openInlineAlert.next(e)}_listenAlertIgnores(){var e;return this.events.pipe(w.p(y.G.isAlertIgnoreAction)).subscribe((t=>this._sendFeedback(t.alertId,{kind:m.yp.IGNORE,subtype:null!==(e=t.subtype)&&void 0!==e?e:m.U3.Inline})))}_listenAlertAddedToDictionary(){return this.events.pipe(w.p(y.G.isAlertAddToDictionaryAction)).subscribe((e=>this._sendFeedback(e.alertId,{kind:m.yp.ADD_TO_DICTIONARY,subtype:m.U3.Inline})))}_listenAlertOpenings(){return this.events.pipe(w.p(y.G.isAlertOpenAction)).subscribe((e=>{this._openAlert(e.alert)}))}_listenAlertClose(){return this.events.pipe(w.p(y.G.isCardCloseAction)).subscribe((()=>{this._inlineManager.changeTeaserExpanded(u.none)}))}_listenAlertApplies(){return this.events.pipe(w.p(y.G.isAlertApplyAction)).subscribe((e=>{(0,l.pipe)(this._alertsService.apply(e.alertId,{alternativeIndex:e.alternativeIndex,source:_.Kz.text,feedbackSubtype:m.U3.Inline}),r.fold((e=>this._log.error("error applying alert",e)),(()=>{const t=(0,l.pipe)(this._alertsReader.getById(e.alertId),u.chain((e=>e.extraProperties.freePremium)),u.exists((e=>"unlocked"===e)));this._telemetry.gnarSpec.suggestedReplacementButtonClick(t,this._telemetry.pageId,"defaultCard","assistantOff",this._telemetry.pageSessionId)})))}))}_listenCardLooks(){return this.events.pipe(w.p(y.G.isLookedAction),w.p((e=>this._alertsReader.isValidForFeedback(e.alertId)))).subscribe((({alertId:e,kind:t})=>this._sendFeedback(e,{kind:m.yp.LOOKED,subtype:"card"===t?m.U3.Inline:m.U3.UnderlineWithTeaser})))}_listenFeedbackModalStateChanges(){return this.events.pipe(w.p((0,p.Ub)(y.G.isFeedbackOpenAction,y.G.isFeedbackCloseAction)),C.M((e=>this.feedbackModalOpen.set(y.G.isFeedbackOpenAction(e))))).subscribe()}_listenUserFeedbackSubmissions(){return this.events.pipe(w.p(y.G.isFeedbackSubmitAction),k.n((e=>(0,l.pipe)(this._sendFeedback(e.alertId,{kind:m.yp.USER_SATISFACTION_FEEDBACK,subtype:e.source,userSatisfactionDescription:e.feedback}),r.fold((()=>this._notificationsManager.enqueue("error")),(()=>(this.feedbackModalOpen.set(!1),this._notificationsManager.enqueue("feedbackSend")))))))).subscribe()}_listenTeaserExpands(){return this.events.pipe(w.p(y.G.isTeaserExpandAction),C.M((({alertId:e})=>{this._inlineManager.changeTeaserExpanded(u.some(e)),this._sendFeedback(e,{kind:m.yp.ACCEPTED,subtype:m.U3.UnderlineWithTeaser,alternativeIndex:0})}))).subscribe()}dispose(){this._subs.dispose()}constructor(e,t,i,n,p,m,v,b,S,H,K){(0,s._)(this,"_inlineManager",void 0),(0,s._)(this,"_alertMarkRectGetter",void 0),(0,s._)(this,"_closeEvent",void 0),(0,s._)(this,"_checkingDomain",void 0),(0,s._)(this,"_alertsReader",void 0),(0,s._)(this,"_alertsService",void 0),(0,s._)(this,"_telemetry",void 0),(0,s._)(this,"_openInlineAlert",void 0),(0,s._)(this,"_hovered",void 0),(0,s._)(this,"_inlineHighlightFilter",void 0),(0,s._)(this,"_notificationsManager",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"events",void 0),(0,s._)(this,"feedbackModalOpen",void 0),(0,s._)(this,"teaserExpanded",void 0),(0,s._)(this,"_emitCloseWhen",void 0),(0,s._)(this,"_toMarkAndAlert",void 0),(0,s._)(this,"state",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_sendFeedback",void 0),this._inlineManager=e,this._alertMarkRectGetter=t,this._closeEvent=i,this._checkingDomain=n,this._alertsReader=p,this._alertsService=m,this._telemetry=v,this._openInlineAlert=b,this._hovered=S,this._inlineHighlightFilter=H,this._notificationsManager=K,this._subs=new M.y.Keeper,this.events=new E.t({type:y.G.Type.closed}),this.feedbackModalOpen=c.s.create(!1),this.teaserExpanded=this._inlineManager.currentTeaser.pipe(T.Z(u.none),x.J(),k.n((([e,t])=>u.isSome(e)&&u.isNone(t)?I.O1(300).pipe(A.T(l.constFalse),T.Z(!0)):F.of(u.isSome(t)))),I.tl({bufferSize:1,refCount:!0})),this._emitCloseWhen=V.MA((e=>this._checkingDomain.state.pipe(A.T(f.A.get(e.id)),w.p(u.isNone),L.h(this._closeEvent),C.M((()=>this._inlineManager.closeCards.next()))))),this._toMarkAndAlert=(0,l.flow)(u.filter((e=>u.isSome(this._alertsReader.getInteractable(e.id)))),u.map((e=>{(0,d.V1)(!_.Fc.isInPremiumLens(e)||D.A.isLockedUIAlert(e),"Can't hover plagiarism alert");const t={alert:e,highlightIndex:0};return(0,a._)((0,o._)({},t),{getMarkRect:this._alertMarkRectGetter(t)})}))),this.state=O.z(this._inlineManager.hoveredMarkAlert.pipe(w.p(this._inlineHighlightFilter),k.n(this._emitCloseWhen)),this.events.pipe(C.M((e=>{"unhovered"===e.type&&this._telemetry.gnarSpec.alertUnderlineHover(this._telemetry.pageId,"assistantOff",this._telemetry.pageSessionId)})))).pipe(B.s((([e,t])=>I.O1(u.isNone(e)&&"closed"!==t.type?300:0))),k.n((([e,t])=>(0,l.pipe)(e,u.fold((()=>"hovered"===t.type?R.w:(this._hovered.next(g.Ie()),F.of(u.none))),(e=>{switch(this._hovered.next(u.some(e)),t.type){case y.G.Type.closed:return U.cb(u.some(e),300);case y.G.Type.opened:case y.G.Type.unhovered:case y.G.Type.hovered:case y.G.Type.addedToDictionary:case y.G.Type.ignored:case y.G.Type.applied:case y.G.Type.confirmed:case y.G.Type.undone:case y.G.Type.mounted:case y.G.Type.looked:case y.G.Type.feedbackModalOpen:case y.G.Type.feedbackModalClose:case y.G.Type.feedbackModalSubmit:case y.G.Type.teaserExpand:return F.of(u.some(e));default:return(0,d.xb)(t)}}))))),N.F(u.getEq(_.HJ.ordId).equals),A.T(this._toMarkAndAlert),P.u()),this._log=h.Bx.Logging.getLogger("InlineCardViewModelImpl",h.y7.$.DEBUG),this._sendFeedback=(e,t)=>(0,l.pipe)(this._alertsService.applyFeedback(e,t,_.Kz.text),r.mapLeft((e=>(this._log.error("error sending feedback",e),e)))),this._subs.push(this._listenAlertOpenings(),this._listenAlertIgnores(),this._listenAlertAddedToDictionary(),this._listenAlertApplies(),this._listenCardLooks(),this._listenFeedbackModalStateChanges(),this._listenUserFeedbackSubmissions(),this._listenTeaserExpands(),this._listenAlertClose())}}!function(e){var t=e.DATA_NAME="inline-card";e.isInlineCard=e=>!!e&&e.getAttribute("data-name")===t}(n||(n={}))},93959:(e,t,i)=>{i.d(t,{C:()=>k,H:()=>n});var n,s=i(23988),o=i(10334),a=i(17171),r=i(65390),l=i(84647),d=i(24819),c=i(84712),p=i(90829),h=i(41949),u=i(92832),g=i(5692),m=i(79937),_=i(48779),v=i(7149),f=i(93432),y=i(30343),b=i(58655),S=i(99010),w=i(84872),C=i(60083);!function(e){e[e.Checking=0]="Checking",e[e.CheckingOut=1]="CheckingOut",e[e.Idle=2]="Idle"}(n||(n={}));class k{init(){this._isLocked.set(!1)}_listenExternalLoadingState(){return this._externalLoadingState.pipe(u.i(1)).subscribe((e=>{this._state.set(e===g.j.Status.idle?C.x.State.idle:C.x.State.loading)}))}_listenProcessingState(){return this._ded.dontFreezeWhen(this._state.view((({text:e})=>r.isSome(e))),"loader")}_listenFullRecheckingState(){const e=(0,l.flow)(r.filter((e=>e===C.x.Type.checkingIn||e===C.x.Type.checking)),r.map((()=>C.x.Type.checkingOut))),t=e=>e.kind===h.kr.CheckingKind.Plagiarism||"full"!==e.type;return(e=>this._loadingStateLock.pipe(m.n(_.$x(e))))(this._lensCheckingData).pipe(m.n((([e,i])=>{const s=e.get();return e.pipe(u.i(1),v.T((e=>t(e)||!i?n.Idle:n.Checking)),f.c(200),y.Z(t(s)?n.Idle:i?n.Checking:n.CheckingOut))})),b.F(),S.M((e=>this.loaderState.set(r.some(e))))).subscribe((t=>{switch(t){case n.Idle:return this._state.set(C.x.State.idle);case n.Checking:return this._state.modify((e=>(0,a._)((0,o._)({},e),{text:r.none})));case n.CheckingOut:return this._state.modify((t=>(0,a._)((0,o._)({},t),{text:r.none,navigation:e(t.navigation)})));default:(0,d.xb)(t)}}))}dispose(){this._subs.forEach((e=>e.unsubscribe())),this._subs=[]}constructor(e,t,i,n,o){(0,s._)(this,"_state",void 0),(0,s._)(this,"_externalLoadingState",void 0),(0,s._)(this,"_ded",void 0),(0,s._)(this,"loaderState",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"_isLocked",void 0),(0,s._)(this,"_loadingStateLock",void 0),(0,s._)(this,"_lensCheckingData",void 0),this._state=e,this._externalLoadingState=n,this._ded=o,this.loaderState=c.s.create(r.none),this._subs=[],this._isLocked=c.s.create(!0),this._loadingStateLock=w.z([this._isLocked,this._externalLoadingState.pipe(y.Z(g.j.Status.idle))],((e,t)=>e||t!==g.j.Status.idle)).pipe(b.F()),this._lensCheckingData=c.s.combine(t.activeLensId.view(i.getCheckingForState),t.state.view("isSidebarOpen"),l.tuple),this._subs.push(this._listenExternalLoadingState(),this._listenProcessingState(),this._listenFullRecheckingState()),(0,p.hJ)("loader",((e,t,i)=>{this._state.set({text:(0,l.pipe)(r.fromNullable(e),r.filter((e=>e in C.x.TextType))),lens:(0,l.pipe)(r.fromNullable(t),r.filter((e=>e in C.x.Type))),navigation:(0,l.pipe)(r.fromNullable(i),r.filter((e=>e in C.x.Type)))})}))}}},42383:(e,t,i)=>{i.d(t,{u:()=>y});var n=i(10334),s=i(11864),o=i(13607),a=i(62641);const r=s.Ks.keyframes({from:{opacity:0},to:{opacity:1}}),l=(e,t)=>({padding:`0 ${s.Ks.rem(3.5)} ${s.Ks.rem(e)} ${s.Ks.rem(t)}`,maxWidth:s.Ks.rem(46),width:s.Ks.percent(100)}),d={position:"relative",zIndex:o.do,opacity:0,animation:`${r} 100ms ease-in forwards`,$nest:(0,n._)({"@media print":{opacity:1}},(0,a.F)(1.5,0).$nest)},c={display:"flex",flexDirection:"column",margin:`0 auto ${s.Ks.rem(2)}`,padding:0,width:s.Ks.percent(100),height:"auto",alignItems:"center",$nest:{"@media print":{display:"block",visibility:"visible",margin:0}}},p={marginBottom:s.Ks.rem(2),height:s.Ks.percent(100)},h={margin:`${s.Ks.rem(1.7)} 0 ${s.Ks.rem(1.15)}`,$nest:{"@media print":{marginTop:0}}},u={display:"flex",flexDirection:"column",margin:`${s.Ks.rem(3.5)} 0 0`,padding:`${s.Ks.rem(o.xl)} 0 0`,width:s.Ks.percent(100),height:"auto",alignItems:"center",$nest:{"@media print":{display:"block",visibility:"visible",margin:0,paddingTop:0}}},g={margin:0,padding:0,height:s.Ks.percent(100)},m={margin:0,position:"relative",fontFeatureSettings:`${o.UO}, ${o.g9}, ${o.Or}, ${o.B1}`,$nest:{"@media print":{margin:0,padding:0,maxWidth:"none"}}},_={margin:0,paddingTop:0,paddingBottom:0,paddingLeft:s.Ks.rem(5.2),height:s.Ks.percent(100)},v={margin:0,paddingTop:0,paddingBottom:0,paddingLeft:s.Ks.rem(3),height:s.Ks.percent(100)},f={display:"flex",flexDirection:"column",minHeight:"var(--100vh)",width:s.Ks.percent(100),alignSelf:"baseline",$nest:{"@media print":{display:"block",overflow:"visible !important",height:"auto",textAlign:"justify"}}},y=s.Ks.prefixedStylesheet("editor",{container:[{display:"flex",$nest:{"@media print":{display:"block"}}}],editorComponentWrapper:[d],editorTopContentWrap:[c],editorTopContent:[l(0,3.5),p],titleWrap:[h],toEditingEnd:[{transition:"transform .2s linear",transform:"none"}],toEditingStart:[{transform:"translateX(-21%)",$nest:{"@media (--small)":{transform:"translateX(-18%)"}}}],toWritingEnd:[{transition:"transform .2s linear",transform:"none"}],toWritingStart:[{transform:"translateX(35%)"}],scrollWrap:[{position:"relative",display:"flex",overflow:"hidden",height:"var(--100vh)",flex:1,$nest:{"@media print":{display:"block",overflow:"visible !important",height:"auto",textAlign:"justify"}}}],editorContentWrap:[u],editorContentWrapFullWidth:[u,g],editorContentWrapLeftAlign:[u,g,{alignItems:"flex-start"}],editorContent:[l(0,5.2),m],editorContentFullWidth:[l(0,5.2),m,_],editorContentFullWidthPersistentClientExp:[l(0,5.2),m,v],textContent:[{minWidth:250}],overlayClickableEl:[{pointerEvents:"all"}],scrollWrapFixed:[f]})},11526:(e,t,i)=>{i.d(t,{t:()=>Je});var n=i(85886),s=i(65390),o=i(84647),a=i(84712),r=i(56855),l=i(41548),d=i(19772),c=i(7149),p=i(84872),h=i(4444),u=i(80300),g=i(55559),m=i(10334),_=i(17171),v=i(80843),f=i(65160),y=i(86922),b=i(40046),S=i(89011),w=i(48779),C=i(11089),k=i(82315),M=i(61098),E=i(19436),T=i(5731),x=i(36268),I=i(92824),A=i(13490),F=i(76617),V=i(61198),L=i(41949),O=i(44781),B=i(31967);const R=e=>({documentStats:e?{title:"Evaluate your text",message:"Check your Grammarly text score and other document stats."}:{message:"Check your text score and other document statistics."},goals:e?{title:"Set some goals",message:"Specify a writing style and audience for your document to get tailored feedback."}:{title:void 0,message:"Set goals to get tailored feedback based on your type of writing."}}),U=(0,v.yY)((e=>{const{hideOnboarding:t,onboardingStepInfo:i,themes:s,children:o}=e;return Boolean(t)?o:n.createElement(k.M7,(0,_._)((0,m._)({},i),{alignment:"bottom",eventType:"onclick",dotPosition:{kind:"findFirstButton",buttonOrder:0,position:k.p3.center},themes:s}),o)}));var N=i(12175),P=i(11864);const D=P.Ks.rem(.5),H=P.Ks.keyframes({from:{transform:"scale(1)"},to:{transform:"scale(3)"}}),K={position:"absolute",width:D,height:D,borderRadius:P.Ks.percent(100)},W=P.Ks.prefixedStylesheet("green-dot",{outer:[K,{animation:`${H} 1s infinite alternate`,backgroundColor:N.Green20}],inner:[K,{position:"absolute",backgroundColor:N.Green60}]}),G=e=>n.createElement("span",{className:e.className},n.createElement("span",{className:W.outer}),n.createElement("span",{className:W.inner})),$=(0,v.yY)(I.$),z=(0,v.yY)(A.K),J=u.UI.Node.make((({view:e,notify:t})=>{const i=n.useContext(y.S.Context),s={name:"set-goals",variant:"secondary",accessibilityLabel:e("subtitle").pipe(c.T((e=>e(i)))),accessibilityHasPopup:"dialog",accessibilityControls:"setGoalsModal",accessibilityExpanded:e("isActive"),isDisabled:e("isActive"),onClick:t({kind:"open-goals"})};return n.createElement(U,{onboardingStepInfo:e("onboarding")},n.createElement(r.F.Fragment,null,e("isCompactView").pipe(c.T((e=>e?n.createElement(z,(0,_._)((0,m._)({},s),{className:x.O.modalIconButton,icon:F.y,tooltipContentProps:{children:i.goals.button.title},"data-name":"set-goals"})):n.createElement($,(0,_._)((0,m._)({},s),{iconStart:F.y,className:x.O.modalButton,"data-name":"set-goals"}),i.goals.button.title)))),w.wd(e("featureOnboardingSeen"))(null,n.createElement(G,{className:x.O.greenDot}))))})),j=B.cq("(max-width: 1080px)"),Z=(e,t,i,n)=>u.n.fromSideEffect((()=>{n.denali.markFeatureOnboarded(O.k.SidebarRefreshGoals),i.events.next({type:"setGoals"})}),p.z([a.s.combine(e.context,e.contextCompleteness,t.state.view(s.exists((e=>e.instance.type===V.f_.SetGoals))),n.denali.onboardingSeen(O.k.SidebarRefreshGoals),(({domain:e,outcomeContext:t},i,o,a)=>({isActive:o,onboarding:(0,_._)((0,m._)({},R(n.denali.showOnboardingTourA11yUpdates).goals),{stepId:S.E.StepId.Step1}),subtitle:o=>`${o.goals.button.title}: ${n.denali.isStudentsOFE&&f.gR("academic")(e)&&s.isSome(t)?o.goals.button.subtitleAcademic(o.goals.sections.format.formatTitle(f.$v(t).citation)):o.goals.button.subtitle(i,L.AB.TOTAL_GOALS,L.AB.MIN_GOALS)}`,featureOnboardingSeen:a}))),j]).pipe(c.T((([e,t])=>(0,_._)((0,m._)({},e),{isCompactView:t})))));var q,Y=i(26068),Q=i(24819),X=i(99908),ee=i(79937),te=i(83694);!function(e){e.get=(e,t,i)=>"idle"!==e?"calculating":i?"paused":(0,o.pipe)(t,s.fold((()=>"unavailable"),(()=>"idle"))),e.toText=e=>(t,i)=>{switch(t){case"calculating":return e.performance.button.statuses.calculating;case"paused":return e.performance.button.statuses.paused;case"unavailable":return e.performance.button.statuses.unavailable;case"idle":return`${e.performance.button.score}: ${i}%`;default:return(0,Q.xb)(t)}}}(q||(q={}));const ie=(0,v.yY)(I.$),ne=({isIdle:e,score:t})=>n.createElement(r.F.span,{className:x.O.scoreLabel},e.pipe(ee.n((e=>e?t:te.of(n.createElement(Y.a,{accessibilityLabel:"Loading analytics table"},n.createElement(Y.a.Circular,{size:"small"}))))))),se=u.UI.Node.make((({view:e,notify:t})=>{const i=n.useContext(y.S.Context);return n.createElement(U,{onboardingStepInfo:e("onboarding")},n.createElement(n.Fragment,null,n.createElement(ie,{variant:"secondary",isDisabled:e("isDisabled"),onClick:t({kind:"open-score"}),className:x.O.modalButton,accessibilityHasPopup:"dialog",accessibilityExpanded:e("isActive"),accessibilityControls:"performanceModal",accessibilityLabel:p.z([e("checkingState"),e("score")]).pipe(c.T((([e,t])=>q.toText(i)(e,t)))),"data-checking-complete":e("checkingState").pipe(c.T((e=>"calculating"!==e)))},n.createElement(ne,{isIdle:e("isIdle"),score:e("score")})," ",n.createElement(r.F.Fragment,null,e("isCompactView").pipe(c.T((e=>e?i.performance.button.scoreShort:i.performance.button.score))))),n.createElement(r.F.Fragment,null,w.wd(e("featureOnboardingSeen"))(null,n.createElement(G,{className:x.O.greenDot})))))})),oe=B.cq("(max-width: 1080px)"),ae=(e,t,i,n)=>u.n.fromSideEffect((()=>{n.denali.markFeatureOnboarded(O.k.SidebarRefreshScore),i.events.next({type:"performance"})}),p.z([a.s.combine(e.checkingState,e.score,e.scoreStatus,t.state.view(s.exists((e=>e.instance.type===V.f_.Performance))),n.denali.onboardingSeen(O.k.SidebarRefreshScore),((e,t,i,n,a)=>{const r=(0,o.pipe)(i,s.map((e=>e===X.QB.ScoresStatus.SENSITIVE)),s.getOrElse(o.constFalse));return{score:(0,o.pipe)(t,s.map((e=>`${e.rank}`)),s.getOrElse((()=>"--"))),isDisabled:n||r,isIdle:"idle"===e,isActive:n,checkingState:q.get(e,t,r),featureOnboardingSeen:a}})),oe]).pipe(c.T((([e,t])=>(0,_._)((0,m._)({},e),{isCompactView:t,onboarding:(0,_._)((0,m._)({},R(n.denali.showOnboardingTourA11yUpdates).documentStats),{stepId:S.E.StepId.Step8})}))))),re=u.UI.Grid.make((({slots:e})=>{const t=T.B.createComponent({component:r.F.div,section:T.B.create(T.B.Id.documentFeatures)});return n.createElement(t,{className:x.O.documentFeatures},e.features)})),le=u.UI.Group.make({goals:J,score:se}),de=u.UI.Composite.make(re,le),ce=(e,t,i,n)=>u.n.composeKnot({score:ae(e,t,i,n),goals:Z(e,t,i,n)});var pe,he=i(33011),ue=i(58277),ge=i(92832),me=i(30343),_e=i(58655),ve=i(99010),fe=i(30595);!function(e){e.HEADER_TITLE_INPUT_NAME="header-title-input",e.TOOLTIP_DURATION=2e3,e.TITLE_MAX_LENGTH=5e3,e.TITLE_WIDTH_BUFFER=10,e.TITLE_WIDTH_BUFFER_DELAY=500;var t=e.TITLE_VISIBILITY_OFFSET=3.45;e.create=(e,i,n,a,r)=>{const l=new he.t(0),d=new he.t(!1),h=p.z([i.scrollPosition,i.viewport.pipe(c.T((({text:e})=>e))),n]).pipe(c.T((([e,t,i])=>({textTop:t.top-e,remSize:i}))),ue.Z(100),ge.i(1),c.T((({textTop:e,remSize:i})=>e<i*t)),me.Z(!1),_e.F(),ve.M((e=>e||d.next(!1)))),u=t=>e.title.set(t);return{title:e.title,isSidebarOpened:a,isFocused:d,isVisible:h,isSaved:e.saved,inputWidth:l,setInputWidth:e=>l.next(e),setFocus:e=>d.next(e),trackTitleClick:()=>r.gnarSpec.newTitleButtonClick(r.pageId),setTitle:u,setPastedTitle:e=>{var t;const i=(0,fe.aj)(e,{allowedTags:[]}),n=window.getSelection();null!=(null===(t=n)||void 0===t?void 0:t.rangeCount)&&(n.deleteFromDocument(),n.getRangeAt(0).insertNode(document.createTextNode(i)));const a=(0,o.pipe)(n,s.fromNullable,s.chain((e=>s.fromNullable(e.focusNode))),s.map((e=>e.textContent)),s.getOrElse((0,o.constant)(i)));u(a)}}}}(pe||(pe={}));var ye=i(65873),be=i(30184),Se=i(60191),we=i(4885);const Ce=P.Ks.keyframes({"5%":{opacity:1},"95%":{opacity:1},"100%":{opacity:0}}),ke={display:"inline-block",marginTop:P.Ks.rem(1),color:we.aD,verticalAlign:"top",fontSize:P.Ks.rem(.6875),lineHeight:P.Ks.rem(2),opacity:0,pointerEvents:"none",flexShrink:0},Me={animation:`${Ce} 2s linear`},Ee=P.Ks.stylesheet({notSaved:[ke],saved:[ke,Me]}),Te=({isSaved:e,className:t})=>n.createElement(ye.Oc,(0,m._)({key:"saved-wrapper","data-name":"save-status"},(0,v.Ly)(e.pipe(be.s((e=>Se.O1(e?1e3:0))),me.Z(!1),c.T((e=>e?Ee.saved:Ee.notSaved))),t)),n.createElement(r.F.span,{"data-saved":e.pipe(me.Z(!0))}),"Saved");var xe=i(92723);const Ie=e=>(0,o.flow)(s.fromNullable,f.Mi((t=>e({kind:"mount",element:t})()))),Ae=u.UI.Grid.make((({slots:e,state:t,view:i,notify:o})=>{const a=n.useContext(y.S.Context),{withSelectionEffect:l}=n.useContext(M.z.Context),d=T.B.createComponent({component:r.F.div,section:T.B.create(T.B.Id.title),behavior:C.a.FocusBehavior.captureTab}),h=l(M.z.Effect.PlainContainer,M.z.Effect.collapse),u=w.wd(i("isOpened")),g=w.br(e.documentFeatures).pipe(c.T((e=>Boolean(e)))),f=w.wd(i("isFocused")),E=t.pipe(c.T((({persistentClientTreatment:e})=>e)));return n.createElement(r.F.Fragment,null,n.createElement(h,(0,_._)((0,m._)({},(0,v.Ly)(x.O.toolbarTitleContainer)),{onMount:Ie(o)})),n.createElement(r.F.div,{className:E.pipe(c.T(s.fold((()=>x.O.absoluteWrapper),(()=>x.O.absoluteWrapperPersistentClientExp))))},n.createElement(xe.A,{selectionEffect:M.z.Effect.prevent,persistentClientTreatment:E,isSidebarOpen:t.pipe(c.T((({isSidebarOpen:e})=>e)))},n.createElement(r.F.div,(0,v.Ly)(u(x.O.headerWrapperSqueezed,x.O.headerWrapper)),n.createElement("div",{className:x.O.headerContainer},n.createElement(r.F.div,{className:x.O.titleWrapper},n.createElement("div",{className:x.O.titleAndSavedSection},n.createElement(d,(0,v.Ly)(x.O.headerTitleHighlight,p.z([i("isOpened"),g]).pipe(c.T((([e,t])=>e||t?x.O.headerTitleContainer:x.O.headerTitleContainerFull))),f(x.O.headerTitleContainerFocused,void 0)),n.createElement(r.F.Fragment,null,t.pipe(c.T((({showOnboardingTourA11yUpdates:t})=>n.createElement(k.M7,{alignment:"bottom",eventType:"onclick",themes:{containerWrapperClassName:x.O.headerOnboardingWrapper},stepId:S.E.StepId.DocumentTitle,title:t?a.toolbar.title.detailedOnboarding.title:void 0,message:t?a.toolbar.title.detailedOnboarding.message:a.toolbar.title.onboarding.message},n.createElement(b.m_,{title:a.toolbar.title.rename,align:"bottomCenter",duration:pe.TOOLTIP_DURATION},n.createElement(r.F.Fragment,null,e.input)))))))),n.createElement(r.F.Fragment,null,e.savedIndicator)),e.documentFeatures))))),e.measurer)})),Fe=u.UI.Node.make((({view:e})=>n.createElement(r.F.span,{"data-name":"saved-container",className:x.O.savedContainer},n.createElement(Te,{className:x.O.savedIndicator,isSaved:e("saved")})))),Ve=u.UI.Node.make((({view:e,notify:t})=>{const i=n.useContext(y.S.Context);return n.createElement(E.z$,{as:"h1",variant:"heading-xsmall",mount:Ie(t),className:x.O.shadow},e("title").pipe(c.T((e=>Boolean(e)?e:i.toolbar.title.untitledDocument))))})),Le=u.UI.Node.make((({state:e,view:t,notify:i})=>{const s=n.useContext(y.S.Context);return n.createElement(r.F.Fragment,null,t("key").pipe(c.T((o=>n.createElement(E.z$,{as:"h1",variant:"heading-xsmall",key:o,style:t("inputWidth").pipe(c.T((e=>({width:e})))),"data-name":pe.HEADER_TITLE_INPUT_NAME,mount:Ie(i),contentEditable:!0,spellCheck:!1,onClick:i({kind:"click"}),onFocus:i({kind:"focus"}),onBlur:i({kind:"blur"}),onKeyDown:e=>(e.persist(),i({kind:"keydown",event:e})()),onPaste:e=>{e.preventDefault(),i({kind:"paste",value:e.clipboardData.getData("text")})()},onDrop:e=>e.preventDefault(),placeholder:s.toolbar.title.untitledDocument,className:x.O.headerTitle,"aria-label":e.pipe(c.T((({title:e})=>Boolean(e)?s.toolbar.title.renameLabel(e):s.toolbar.title.untitledDocumentLabel))),onInput:e=>i({kind:"input",element:e.currentTarget})()})))))})),Oe=u.UI.Knot.make(Ae,{input:Le,measurer:Ve,savedIndicator:Fe,documentFeatures:de}),Be=u.UI.Knot.make(Ae,{input:Le,measurer:Ve,savedIndicator:Fe,documentFeatures:u.UI.Node.empty});var Re=i(96471),Ue=i(60352),Ne=i(58260),Pe=i(75248);const De=(e,t,i,n)=>u.n.fromSideEffect((e=>t(e.element)),p.z([e.isSidebarOpened,e.isFocused,i.denali.persistentClientEntryPointTreatment(n)]).pipe(c.T((([e,t,n])=>({isOpened:e,isFocused:t,showOnboardingTourA11yUpdates:i.denali.showOnboardingTourA11yUpdates,persistentClientTreatment:n,isSidebarOpen:e}))))),He=e=>(0,o.flow)(ee.n((({element:t})=>e.title.pipe(Ue.S(((e,t)=>[e[1],Boolean(t)?t.length:0]),[0,0]),ee.n((([e,i])=>Se.O1(0,pe.TITLE_WIDTH_BUFFER_DELAY).pipe(c.T((n=>t.offsetWidth+(Boolean(n)||!Boolean(i)||e>i?0:pe.TITLE_WIDTH_BUFFER))),Ne.s(2)))),me.Z(0),_e.F(),ve.M(e.setInputWidth)))),Pe.K(e.title),me.Z(e.title.get()),_e.F(),c.T((e=>({title:e})))),Ke=e=>u.n.fromSideEffect(o.constVoid,e.isSaved.pipe(me.Z(!0),c.T((e=>({saved:e}))))),We=e=>{const t=new he.t((0,fe.G7)(5));return u.n.fromSideEffect((i=>{switch(i.kind){case"mount":var n;return i.element.textContent=null!==(n=e.title.get())&&void 0!==n?n:"";case"input":const s=Boolean(i.element.textContent)?(0,fe.aj)(i.element.textContent,{allowedTags:[]}):"";return Boolean(s)||(i.element.innerHTML=""),s!==i.element.textContent&&(i.element.textContent=s,function(e){var t,i;const n=document.createRange();n.selectNodeContents(e),n.collapse(!1);const s=window.getSelection();null===(t=s)||void 0===t||t.removeAllRanges(),null===(i=s)||void 0===i||i.addRange(n)}(i.element)),e.setTitle(s);case"click":return e.trackTitleClick();case"focus":return e.setFocus(!0);case"blur":return t.next((0,fe.G7)(5)),e.setFocus(!1);case"keydown":return void(i.event.keyCode===Re.D$.ENTER_CODE&&i.event.preventDefault());case"paste":return e.setPastedTitle(i.value);default:return(0,Q.xb)(i)}}),p.z([e.title,e.inputWidth,t]).pipe(c.T((([e,t,i])=>({inputWidth:t,title:e,key:i})))))},Ge=(e,t,i,n)=>u.n.composeKnot({root:De(e,t,i,n),input:We(e),measurer:He(e),savedIndicator:Ke(e),documentFeatures:u.n.emptyFlow}),$e=(e,t,i,n,s,o,a)=>u.n.composeKnot({root:De(e,s,o,a),input:We(e),measurer:He(e),savedIndicator:Ke(e),documentFeatures:ce(t,i,n,o)});var ze;!function(e){e.UI=Be,e.UIWithFeatures=Oe,e.Flow=Ge,e.FlowWithFeatures=$e}(ze||(ze={}));var Je,je=i(82971);!function(e){e.isTitleInput=function(e){return Boolean(e)&&e.dataset.name===pe.HEADER_TITLE_INPUT_NAME},e.Component=({denaliEditor:e,documentModel:t,viewportPadding:i,navigationViewModel:m,features:_,modalManager:v,slots:f,clientsState:y})=>{const b=n.useContext(l.q.Context),S=n.useContext(g.Y.Context),{ref:w,onMount:C}=d.R.useElWatcher(),k=a.s.create(s.none),M=_.denali.persistentClientEntryPointTreatment(y).pipe(c.T(s.isSome)),E=pe.create(t,e,b,m.state.view("isSidebarOpen"),S),T={ui:ze.UIWithFeatures,flow:ze.FlowWithFeatures(E,t,v,m,C,_,y)};return d.R.useSubscriptionTo(p.z([k,w.pipe(h.oE),b]).pipe(c.T((([e,t])=>i.set({top:t.offsetHeight,bottom:(0,o.pipe)(e,s.fold((()=>0),(e=>e.offsetHeight)))}))))),n.createElement(r.F.Fragment,null,M.pipe(c.T((e=>e?n.createElement(r.F.div,{className:x.O.toolbarWrapperTierPersistentClientExp},n.createElement(r.F.div,{className:x.O.persistentClientSidebarPlaceholder},n.createElement(r.F.div,{className:x.O.persistentClientSidebarTitlePlaceholder})),n.createElement(r.F.div,{className:x.O.toolbarWrapperContent},_.isAiStudio?null:u.UI.mount(T.ui,T.flow),n.createElement(r.F.div,{className:x.O.toolbarContainer},f[je.G.Slot.EditorFooter]({footerEl:k})))):n.createElement(r.F.div,{className:x.O.toolbarWrapperTier},_.isAiStudio?null:u.UI.mount(T.ui,T.flow),n.createElement(r.F.div,{className:x.O.toolbarContainer},f[je.G.Slot.EditorFooter]({footerEl:k})))))))}}(Je||(Je={}))},36268:(e,t,i)=>{i.d(t,{O:()=>Z});var n=i(10334),s=i(17171),o=i(98205),a=i(37634),r=i(12175),l=i(21037),d=i(11864),c=i(13607),p=i(57014);const h=o.Ai,u=`linear-gradient(-180deg, ${a.Q.Background.Base.Default} 78%, ${r.Transparent} 100%)`,g={position:"absolute",top:o.vK,right:d.Ks.rem(o.Oh),left:o.vK,zIndex:c.ry,marginLeft:d.Ks.rem(-o.Oj),paddingLeft:d.Ks.rem(o.Oj),height:d.Ks.rem(h+o.v$),background:u,textAlign:"center",lineHeight:d.Ks.rem(h),pointerEvents:"all",$nest:{"@media print":{display:"none"}}},m={display:"flex",alignItems:"center",justifyContent:"space-between",position:"relative",pointerEvents:"all",$nest:{[p.$U.xsLower]:{justifyContent:"flex-start"}}},_={position:"relative",display:"inline-block",marginTop:d.Ks.rem(o.Jj),marginRight:d.Ks.rem(o.v$),maxWidth:`calc(100% - ${d.Ks.rem(o.Oj)})`},v={$nest:{"&:before":{position:"absolute",top:0,left:d.Ks.rem(-.375),zIndex:-1,width:d.Ks.percent(100),height:d.Ks.rem(o.Oh),borderRadius:d.Ks.rem(l.Dk),background:a.Q.Background.Base.Subdued,content:'""',opacity:0,transition:"all .2s"},"&:hover:before":{opacity:1}}},f={$nest:{[p.$U.normal]:{maxWidth:"calc(100% - 5rem)"},[p.$U.small]:{maxWidth:"calc(100% -10rem)"},[p.$U.tiny]:{maxWidth:"calc(100% - 12rem)"},[p.$U.xs]:{maxWidth:"calc(100% - 15rem)"},[p.$U.xsLower]:{maxWidth:"calc(100% - 21rem)"},[p.$U.xssUpper]:{marginRight:d.Ks.rem(o.v$),maxWidth:"calc(100% - 24rem)"}}},y={display:"inline-block",overflow:"hidden",padding:d.Ks.important(".25rem 0 .25rem .125rem"),maxWidth:"calc(100% - .5rem)",outline:"none",border:"none",background:"transparent",verticalAlign:"top",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:d.Ks.important("bold"),cursor:"pointer",transition:"all .2s",pointerEvents:"all",fontSize:d.Ks.important(d.Ks.rem(1)),$nest:{"&[placeholder]:empty:before":{color:a.Q.Text.Base.Subdued,opacity:1,content:"attr(placeholder)"},"&:focus":{textOverflow:"unset"}}},b={opacity:1,transition:"opacity .2s",pointerEvents:"none"},S={opacity:0},w={position:"absolute",left:0,opacity:1},C={fontSize:d.Ks.rem(.75)},k={position:"relative",padding:0,minWidth:d.Ks.px(250),maxWidth:d.Ks.rem(46),width:d.Ks.percent(100),$nest:{[p.$U.xs]:{padding:0}}},M={position:"relative",width:d.Ks.percent(100),height:"var(--100vh)",pointerEvents:"none"},E={width:d.Ks.percent(100),height:"var(--100vh)",pointerEvents:"none",display:"flex"},T={position:"relative",zIndex:c.kf,display:"flex",width:d.Ks.percent(100),justifyContent:"center"},x={width:d.Ks.percent(100)},I={position:"absolute",top:0,zIndex:c.ry,width:d.Ks.percent(100),height:d.Ks.percent(100)},A=(0,s._)((0,n._)({},I),{display:"flex"}),F={flex:`0 0 ${d.Ks.rem(19)}`,position:"relative"},V={position:"absolute",top:o.vK,right:o.Oh,left:o.vK,zIndex:c.ry,marginLeft:d.Ks.rem(-o.Oj),paddingLeft:d.Ks.rem(o.Oj),height:d.Ks.rem(h+o.v$),background:u,lineHeight:d.Ks.rem(h),$nest:{"@media print":{display:"none"}}},L={position:"relative",height:d.Ks.percent(100)},O={marginLeft:d.Ks.rem(-o.CN),$nest:{[p.$U.xs]:{marginLeft:d.Ks.rem(-o.v5)}}},B={marginRight:d.Ks.rem(o.Oh+o.or),padding:`0 ${d.Ks.rem(o.sp)} 0 0`,background:a.Q.Background.Base.Default,$nest:{[p.$U.xs]:{marginRight:d.Ks.rem(o.v5+o.or)},[p.$U.xsLower]:{marginRight:d.Ks.rem(o.v5+o.or)}}},R={left:d.Ks.important(0)},U={right:d.Ks.important(0)},N={display:d.Ks.important("inline-flex"),alignSelf:d.Ks.important("initial"),fontSize:d.Ks.rem(.875),marginTop:d.Ks.rem(o.Jj),$nest:{"&:first-of-type":{marginRight:d.Ks.rem(o.v$)}}},P={justifyContent:d.Ks.important("space-between")},D={fontWeight:600,color:a.Q.Text.Base.Default,minWidth:d.Ks.px(16),textAlign:"left"},H={display:"flex",height:d.Ks.rem(3.125)},K=d.Ks.prefixedStylesheet("toolbar",{toolbarTitleContainer:[g],titleWrapper:[m],headerTitleContainer:[_],headerTitleHighlight:[v],headerTitleContainerFull:[_,f],headerTitleContainerFocused:[v,{$nest:{"&:before":{opacity:1}}}],savedContainer:[b],savedContainerHidden:[b,S],savedContainerAbsolute:[b,w],savedContainerAbsoluteHidden:[S,w],savedIndicator:[C],headerContainer:[k],toolbarWrapperTier:[M],toolbarWrapperTierPersistentClientExp:[E],toolbarWrapperContent:[{position:"relative",height:"var(--100vh)",flex:"1 0 auto"}],headerWrapper:[T],headerWrapperSqueezed:[T,{paddingLeft:0}],headerOnboardingWrapper:[x],absoluteWrapper:[I],absoluteWrapperPersistentClientExp:[A],persistentClientSidebarPlaceholder:[F],persistentClientSidebarTitlePlaceholder:[V],toolbarContainer:[L],formattingShiftedLeft:[O],wordCounter:[B],footerEmotions:[{position:"absolute",right:0}],flex:[{display:"flex"}],dropdownContainer:[{lineHeight:"normal"}],dropdownListRight:[R],dropdownListLeft:[U],modalIconButton:[N],modalButton:[N,P],scoreLabel:[D],documentFeatures:[H]}),W=d.Ks.style((0,s._)((0,n._)({},y),{position:"absolute",visibility:"hidden",paddingLeft:d.Ks.important(d.Ks.rem(o.Jj)),maxWidth:d.Ks.important(`calc(100% - ${d.Ks.rem(o.Oj)})`),width:"auto",height:0,whiteSpace:d.Ks.important("pre")})),G=d.Ks.style({maxWidth:d.Ks.percent(60),flexGrow:1,$nest:{[p.$U.xss]:{maxWidth:d.Ks.percent(40)}}}),$=d.Ks.style({opacity:0,pointerEvents:"none"}),z=d.Ks.style(y),J=d.Ks.joinClasses([z,$]),j=d.Ks.style({position:"absolute",transform:`translate(${d.Ks.rem(-.85)}, ${d.Ks.rem(.85)})`}),Z=(0,s._)((0,n._)({},K),{shadow:W,headerTitle:z,headerTitleHidden:J,titleAndSavedSection:G,greenDot:j})},92723:(e,t,i)=>{i.d(t,{A:()=>h,j:()=>p});var n=i(85886),s=i(65390),o=i(80843),a=i(7149),r=i(30343),l=i(91177),d=i(61098),c=i(42383);const p=({position:e,children:t,className:i})=>{const s="top"===e;return n.createElement("div",(0,o.Ly)(c.u.container,i),n.createElement("div",{className:c.u.scrollWrap},n.createElement("div",{className:s?c.u.editorTopContentWrap:c.u.editorContentWrap},n.createElement("div",{className:s?c.u.editorTopContent:c.u.editorContent},t))))},h=({children:e,selectionEffect:t,persistentClientTreatment:i})=>{const{withSelectionEffect:o}=n.useContext(d.z.Context),p=o(l._,t),h=i.pipe(a.T(s.isSome),a.T((e=>({editorContent:e?c.u.editorContentFullWidthPersistentClientExp:c.u.editorContentFullWidth,editorContentWrap:e?c.u.editorContentWrapLeftAlign:c.u.editorContentWrapFullWidth}))),r.Z({}));return n.createElement(p,{theme:h},e)}},82805:(e,t,i)=>{i.d(t,{TX:()=>nn,aH:()=>tn,Ss:()=>Xi});var n=i(23988),s=i(10334),o=i(17171),a=i(85886),r=i(66202),l=i(65390),d=i(84647),c=i(84712),p=i(80843),h=i(56855),u=i(1224),g=i(26228),m=i(80926),_=i(14973),v=i(62597),f=i(12061),y=i(19772),b=i(30343),S=i(79937),w=i(48779),C=i(4444),k=i(7149),M=i(99339),E=i(93208),T=i(91745),x=i(82315),I=i(61098),A=i(55559),F=i(74056),V=i(19436),L=i(5731),O=i(86780),B=i(99010),R=i(44608),U=i(92832),N=i(41548),P=i(76005),D=i(35098),H=i(76099),K=i(92391),W=i(51707),G=i(89011),$=i(12070),z=i(93712),J=i(83407),j=i(90829),Z=i(83694),q=i(42279),Y=i(58277),Q=i(31967),X=i(57836),ee=i(98814),te=i(21644);class ie{constructor(e,t){(0,n._)(this,"_ded",void 0),(0,n._)(this,"_env",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"state",void 0),this._ded=e,this._env=t,this._log=u.Bx.Logging.root.getLogger("GraySelection"),this.state=this._ded.isEditorFocused.pipe(S.n((0,j.Sw)(Z.of(!1),q.h(this._ded.contentUpdated.pipe(Y.Z(50)),Q.L5.pipe(Y.Z(50))).pipe(b.Z(w.al()),X.u(!0)))),S.n((e=>{return e?Z.of((0,d.pipe)(this._ded.getSelectionRect(),r.chain((t=this._env.has(z.OH.Flag.supportsMixBlendMode),e=>(0,d.pipe)(e.getRect(),r.map((({clientRects:e,rootClientRect:t})=>e.map((e=>(0,J._5)(e,t))))),r.map((e=>e.map((e=>({top:e.top,left:e.left,width:Math.max(e.width,2),height:e.height,zIndex:t?"inherit":"-1",mixBlendMode:t?"darken":"inherit"})))))))),l.fromEither)):Z.of(l.none);var t})),B.M((e=>{l.isSome(e)&&!document.hasFocus()&&(0,d.pipe)(ee.C(),r.mapLeft((e=>{this._log.info("Cannot collapse selection",e)})))})),te.u())}}var ne=i(88195);const se=({ded:e})=>{const t=a.useContext(z.OH.Context);return a.createElement(h.F.Fragment,null,new ie(e,t).state.pipe(k.T((e=>a.createElement(a.Fragment,null,(0,d.pipe)(e,l.fold((()=>null),(e=>e.map(((e,t)=>a.createElement("div",{"data-name":"gray-selection",key:`gray-selection-${t}`,style:e,className:ne.n.graySelection}))))))))),b.Z(null)))};var oe=i(65160),ae=i(58655),re=i(5406),le=i(26660),de=i(84872),ce=i(60191),pe=i(82585),he=i(54610);const ue=(e,t)=>{const i={root:e,rootMargin:"0px",threshold:[0,1]};return Q.ht(t,i).pipe(T.p(j.z2),k.T((e=>1!==e[0].intersectionRatio)),b.Z(t.offsetHeight>e.offsetHeight))};class ge{constructor(){(0,n._)(this,"_log",u.Bx.Logging.getLogger("DocumentView")),(0,n._)(this,"_nativeScrollbarState",(0,d.pipe)(J.Ze.getState(),r.getOrElse((e=>(this._log.error("Cannot get scrollbar width",e),J.Ze.UNKNOWN_SCROLLBAR))))),(0,n._)(this,"detector",c.s.create(l.none)),(0,n._)(this,"target",c.s.create(l.none)),(0,n._)(this,"_xssWindowSize",Q.sc(document.body).pipe(k.T((e=>e.width<=he.v.navigationHideWidthThreshold)),ae.F(),b.Z(!1))),(0,n._)(this,"_visible","visible"===this._nativeScrollbarState.type?c.s.combine(this.target,this.detector,oe.fP(ue)).pipe(S.n(l.fold((()=>re.w),d.identity)),le.g(Z.of(!0))):c.s.create(!0)),(0,n._)(this,"width",de.z([this._visible,this._xssWindowSize]).pipe(k.T((([e,t])=>!t&&e?this._nativeScrollbarState.width:0)),b.Z(0),ce.tl({bufferSize:1,refCount:!0}))),(0,n._)(this,"scrollTop",this.target.pipe(C.oE,S.n((e=>M.R(e,"scroll").pipe(pe.B(50),k.T((e=>e.target.scrollTop))))),b.Z(0))),(0,n._)(this,"fakeWidth",this._xssWindowSize.pipe(k.T((e=>e||"hidden"!==this._nativeScrollbarState.type?0:this._nativeScrollbarState.width))))}}var me=i(96504),_e=i(11526),ve=i(65873),fe=i(37107),ye=i(92444),be=i(11864),Se=i(27199);const we={color:Se.Q1.CoreNeutral50},Ce={borderBottom:`1px solid ${Se.Q1.CoreNeutral30}`,cursor:"pointer",pointerEvents:"auto"},ke=be.Ks.stylesheet({placeholder:[we],hiddenPlaceholder:[{display:"none"}],label:[Ce],input:[{display:"none"}]}),Me=({viewModel:e,className:t})=>a.createElement(h.F.div,(0,p.Ly)(t,ve.iF.paper,e.visible.pipe(k.T((0,j.Sw)(ke.placeholder,ke.hiddenPlaceholder))),e.size.view(fe.Z4.match("",ye.x.bigSize))),e.strings.typeOrPasteText,(0,d.pipe)(e.uploadSection,l.fold((()=>null),(t=>a.createElement(a.Fragment,null,a.createElement("label",{className:ke.label},e.strings.upload,a.createElement("input",{className:ke.input,onChange:({target:e})=>e.files&&t.upload(e.files),type:"file",accept:t.uploadInputAccept})))))),e.strings.ending);var Ee=i(26692),Te=i(36458),xe=i(50112),Ie=i(55548),Ae=i(92802),Fe=i(77205),Ve=i(59893),Le=i(24819),Oe=i(34980),Be=i(97390),Re=i(80159),Ue=i(9079),Ne=i(10479),Pe=i(45653),De=i(55638),He=i(80548),Ke=i(83531),We=i(35679),Ge=i(17772),$e=i(86922),ze=i(19967),Je=i(88105),je=i(92825),Ze=i(13607);const qe={width:be.Ks.rem(31),backgroundColor:Se.Q1.CoreNeutral1},Ye={marginBottom:be.Ks.rem(.8)},Qe={width:be.Ks.percent(100),outline:"none",border:`1px solid ${je.mc}`,borderRadius:be.Ks.rem(Ze.H0),backgroundColor:Se.Q1.CoreNeutral0,$nest:{"&::placeholder":{color:je.aD,opacity:1}}},Xe={marginBottom:be.Ks.rem(1),padding:`${be.Ks.rem(.75)} ${be.Ks.rem(1)} ${be.Ks.rem(.5)}`},et={marginBottom:be.Ks.rem(1),padding:`${be.Ks.rem(.75)} ${be.Ks.rem(1)} ${be.Ks.rem(9.5)}`,height:be.Ks.rem(12)},tt={color:Se.Q1.CoreBlue50,textDecoration:"none",$nest:{"&:hover":{color:Se.Q1.CoreBlue40}}},it={marginTop:be.Ks.rem(1)},nt={paddingTop:0,backgroundColor:Se.Q1.CoreNeutral1},st={paddingBottom:be.Ks.rem(2),backgroundColor:Se.Q1.CoreNeutral1},ot=be.Ks.prefixedStylesheet("vbars-feedback",{wrapper:[qe],description:[Ye],inputField:[Qe],briefDescriptionInput:[Xe],feedbackInput:[et],helpdesk:[tt],buttons:[it],feedbackPopupBody:[nt],feedbackPopupFooter:[st]}),at=()=>{const e=a.useContext(_.aF.TitleIdContext);return a.createElement(ve.H1,{id:e},"Give Feedback")},rt=({submitFeedback:e,close:t,visible:i,ModalsPortal:n})=>{const s=c.s.create(""),{writingExpert:o}=a.useContext($e.S.Context);return a.createElement(n,null,a.createElement(_.hJ,{positionType:"fixed",visible:i,preventClose:!0,animate:!0},a.createElement(_.aF,{className:ot.wrapper},a.createElement(_.aF.Header,null,a.createElement(at,null)),a.createElement(_.aF.Body,{className:ot.feedbackPopupBody,name:"feedbackBody"},a.createElement(ve.P1,{className:ot.description},o.feedback.description),a.createElement(Je.fs,{placeholder:"Type your feedback",className:ot.feedbackInput,value:s}),a.createElement(ve.C6,null,o.feedback.instructions)),a.createElement(_.aF.Footer,{className:ot.feedbackPopupFooter},a.createElement(ze.$n.Ghost,{name:"cancel",onClick:t},o.feedback.cancel),a.createElement(ze.$n.Primary,{name:"send",disabled:s.view((e=>""===e)),onClick:()=>e({detailed:s.get()})},o.feedback.send)))))},lt=(e,t)=>{return{feedbackModalSubmit:(i=(0,Ke._)((function*({detailed:i}){return e.next({type:Re.G.Type.feedbackModalSubmit,feedback:i,alertId:t,source:We.U3.UnderlineWithTeaser})})),function(e){return i.apply(this,arguments)}),feedBackModalClose:()=>e.next({type:Re.G.Type.feedbackModalClose}),teaserMount:()=>e.next({type:Re.G.Type.looked,kind:"teaser",alertId:t}),teaserDismiss:()=>e.next({type:Re.G.Type.ignored,alertId:t,subtype:We.U3.UnderlineWithTeaser}),teaserExpand:()=>e.next({type:Re.G.Type.teaserExpand,alertId:t})};var i},dt=({isExpanded:e,children:t,events:i,ModalsPortal:n,alert:s,feedbackModalVisible:o,placement:r})=>{const l=lt(i,s.id);return a.createElement(a.Fragment,null,a.createElement(h.F.Fragment,null,w.wd(o)(a.createElement(rt,{alert:(0,d.unsafeCoerce)(s),ModalsPortal:n,visible:o,submitFeedback:l.feedbackModalSubmit,close:l.feedBackModalClose}),null)),a.createElement(Ge.f,{text:s.miniCardTitle,onMount:l.teaserMount,onDismiss:l.teaserDismiss,onExpand:l.teaserExpand,placement:r,state:e.pipe(k.T((e=>e?"expanded":"visible")))},t))};var ct=i(56488),pt=i(72763);const ht=8;function ut(e,t,i){const n=a.useRef(null),[r]=a.useState((()=>c.s.create({visibility:"visible",position:{top:0,left:0},direction:"down"}))),p=a.useContext(D.L.Context),[h]=a.useState((()=>de.z([p.pipe(k.T((e=>e.rect))),i,r.pipe(T.p((({visibility:e})=>"visible"===e)))]).pipe(B.M((([e,i])=>((e,i)=>{const a=n.current;a&&function(e,t,i,n,a){(0,d.pipe)(e,l.map((({abs:e,relative:r})=>{const l=t.offsetHeight,d=function(e,t,i,n,s){const o=e.height+e.top+n;switch(s){case"up":return e.top-n>i.top?"up":"down";case"down":return o>i.height+i.top&&t.height<i.height?"up":"down";default:(0,Le.xb)(s)}}(e,r,i,l,a);n.modify((e=>(0,o._)((0,s._)({},e),{direction:d,position:{top:"up"===d?r.top-l-ht:r.top+r.height,left:r.left}})))})))}(t,a,e,r,i)})(e,i))))));return y.R.useSubscriptionTo(h),a.useEffect((()=>{switch(e){case"removed":r.modify((e=>(0,o._)((0,s._)({},e),{visibility:"invisible"})));break;case"added":requestAnimationFrame((()=>r.modify((e=>(0,o._)((0,s._)({},e),{visibility:"visible"})))));break;default:(0,Le.xb)(e)}}),[e,r]),{_el:n,_state:r}}const gt=({card:e,position:t,mode:i,name:n,placement:o,onMouseEnter:r=d.constVoid,onMouseLeave:l=d.constVoid})=>{a.useEffect((()=>{"added"===i&&l()}),[i]);const c={onMouseEnter:r,onMouseLeave:l,"data-name":n},{_el:u,_state:g}=ut(i,t,o);return a.createElement(h.F.div,(0,s._)({tabIndex:-1,mount:e=>u.current=e,style:g.view("position")},(0,p.Ly)(pt.YI.container,g.view((({visibility:e,direction:t})=>((e,t)=>(0,J.Ly)((e=>{switch(e){case"invisible":return pt.YI.invisible;case"visible":return pt.YI.visible;default:return(0,Le.xb)(e)}})(e),"up"===t&&pt.YI.directionUp))(e,t)))),c),g.view("direction").view(e))},mt=(e,t,i)=>{const{key:n,card:s,onMouseEnter:o,onMouseLeave:r,name:c,isExpanded:p}=t(e),h=function(e,t){return"added"===t?(0,d.pipe)(e.rect,Oe.W.relativeAndAbs,l.fromNullable):l.some({abs:J.rw.empty,relative:J.rw.empty})}(i,e),u=p.pipe(k.T((e=>Pe.A.isWritingExpertWithTeaser(i.alert)&&!e?"up":"down")));return a.createElement(gt,{key:n,position:h,mode:e,card:s,name:c,onMouseEnter:o,onMouseLeave:r,placement:u})},_t=(0,j.Bj)(((e,t,i)=>(u.Bx.Logging.getLogger("InlineCardView.inlineCardProps").warn(e,{reason:t,alert:i}),e))),vt=a.memo((({className:e,inlineCardVM:t,sduiInlineCardVM:i,features:n,modalsPortal:c})=>{const p=a.useMemo((()=>Be.e.emptyWithName("inline-card")),[]);return a.createElement(Be.e.Context.Provider,{value:p},a.createElement(h.F.div,{className:e},function(e,t,i,n,a){return(0,d.pipe)(t.state,C.cy((e=>(0,d.pipe)(Ne.H(e.getMarkRect()),B.M(r.mapLeft((t=>console.error("Could not get mark rect",{error:t,entry:e})))),k.T(l.fromEither),k.T(l.map((t=>(0,o._)((0,s._)({},e),{rect:t}))))))),b.Z(l.none),Ue.J(),B.M((([e,t])=>l.isNone(t)&&a&&a())),k.T((([s,o],a)=>[(0,d.pipe)(s,l.map((s=>mt("removed",e({viewModel:t,entry:s,sdui:i,features:n,index:a}),s))),l.toNullable),(0,d.pipe)(o,l.map((s=>mt("added",e({viewModel:t,entry:s,sdui:i,features:n,index:a}),s))),l.toNullable)])),b.Z(null))}((e=>({viewModel:t,entry:i,sdui:n,index:c})=>p=>{const u="added"===p?c+1:c,g=He.k.DATA_NAME,m=(0,d.pipe)(n,S.n((e=>(0,d.pipe)(e.getInlineItemForAlert(i.alert.id),b.Z(r.left(De.Jr.NoSDUIReason.Initial)),Ue.J(),T.p((([e,t])=>{return n=e,s=t,!(r.isLeft(n)&&r.isLeft(s))||(e=>"removed"===e?d.constFalse:(0,Ae.AU)(Pe.A.isLockedUIAlert))(p)(i.alert);var n,s})),k.T((([e,t])=>(0,d.pipe)(t,r.alt((()=>e))))),k.T(r.map((t=>({item:t,vm:e}))))))),k.T((e=>(0,d.pipe)(e,r.chain((e=>l.isNone(Ee.cK.findFirst(e.item.content,"nativeInlineCardContent"))?r.right(e):r.left(De.Jr.NoSDUIReason.NativeInlineCardContent))),r.fold((e=>{switch(e){case De.Jr.NoSDUIReason.Initial:case De.Jr.NoSDUIReason.EmptyStateOnReconnect:return null;case De.Jr.NoSDUIReason.RemovedFromCAPIMapping:case De.Jr.NoSDUIReason.IdNotResolved:case De.Jr.NoSDUIReason.NotFound:case De.Jr.NoSDUIReason.NativeInlineCardContent:return _t(`Cannot render an inline card: ${Pe.A.isWritingExpert(i.alert)?"Writing Expert":i.alert.patternName}`,e,i.alert),null;default:return(0,Le.xb)(e)}}),(({item:e,vm:t})=>a.createElement(ct.GN,{viewModel:t,item:e,highlightIndex:i.highlightIndex,events:t.events,designSystem:(0,o._)((0,s._)({},Te.J),{icon:(0,o._)((0,s._)({},xe.s),{[Ie.yg.GButtonSmall]:e=>a.createElement(Fe.I,{icon:Ve.c,accessibilityLabel:"Open in Grammarly",className:pt.YI.inlineCardUpdatedLogo})})})})))))));return{key:u,card:n=>Pe.A.isWritingExpertWithTeaser(i.alert)?a.createElement(dt,{events:t.events,alert:i.alert,ModalsPortal:e,feedbackModalVisible:t.feedbackModalOpen,placement:n,isExpanded:t.teaserExpanded},m):a.createElement(h.F.Fragment,null,m),onMouseEnter:()=>t.events.next({type:Re.G.Type.hovered}),onMouseLeave:()=>t.events.next({type:Re.G.Type.unhovered}),name:g,isExpanded:t.teaserExpanded}})(c),t,i,n,(()=>t.events.next({type:Re.G.Type.closed})))))}));var ft=i(49470),yt=i(81930),bt=i(60083);class St extends a.Component{componentDidMount(){const{theme:e,state:t}=this.props;this._subs.push(this._state.pipe(Ue.J(),k.T((([t,i])=>(0,d.pipe)(i,l.fold((()=>(0,d.pipe)(t,l.fold((()=>{throw new Le.zU("Cannot animate sidebar loader from None to None")}),(t=>{switch(t){case bt.x.Type.checkingOut:return[e.checkingOutEnd+" "+e.hideEnd];case bt.x.Type.checkingIn:return[e.checkingInEnd+" "+e.hideEnd];case bt.x.Type.checking:return[e.hideStart,e.hideEnd];default:return(0,Le.xb)(t)}})))),(i=>{switch(i){case bt.x.Type.checkingOut:return(0,d.pipe)(t,oe.gR(bt.x.Type.checkingIn))?[e.checkingOutEnd]:l.isNone(t)?[e.hideEnd]:[e.checkingOutStart,e.checkingOutEnd];case bt.x.Type.checkingIn:return(0,d.pipe)(t,oe.gR(bt.x.Type.checkingOut))?[e.checkingInEnd]:(0,d.pipe)(t,oe.gR(bt.x.Type.checking))?[]:[e.checkingInStart,e.checkingInEnd];case bt.x.Type.checking:return[e.checkingStart,e.checkingEnd];default:return(0,Le.xb)(i)}}))))),S.n((e=>yt.X.rafSequence(e,!0)))).subscribe(w.H9(this._classes)),t.subscribe((e=>{this._state.set(e),null===this._content.get()&&l.isSome(e)&&this._content.set(this.props.children)})),t.pipe(S.n((()=>ce.O1(500)))).subscribe(this._onTransitionEnd))}componentWillUnmount(){this._subs.forEach((e=>e.unsubscribe())),this._subs=[]}render(){return a.createElement(h.F.div,{"data-role":"loader-content",key:"content",className:this._classes,mount:e=>e&&(this._el=e),onTransitionEnd:e=>e.target===this._el&&this._onTransitionEnd()},this._content)}constructor(...e){super(...e),(0,n._)(this,"_subs",[]),(0,n._)(this,"_el",void 0),(0,n._)(this,"_classes",c.s.create("")),(0,n._)(this,"_state",c.s.create(l.none)),(0,n._)(this,"_content",c.s.create(null)),(0,n._)(this,"_onTransitionEnd",(()=>{const e=this._state.get();(0,d.pipe)(e,oe.gR(bt.x.Type.checkingOut))&&this._state.set(l.none),l.isNone(e)&&this._content.set(null)}))}}var wt,Ct=i(31486),kt=i(57444);!function(e){const t=(e,t=re.w)=>a.useContext(z.OH.Context).platform===z.OH.Platform.IPAD?Z.of(me.vF.iPadWrapper):t.pipe(k.T((t=>t===v.J.SpecialId.Plagiarism?me.vF.oggyWrapperWithoutHeader:e?me.vF.oggyWrapper:me.vF.oggyWrapperWithoutPlagiarismButton)),b.Z(me.vF.oggyWrapperWithoutHeader),ae.F());e.OggyView=e=>{const i=t(e.features.denali.oggyPlagiarismButtonVisible,e.navigationViewModel.activeLensId),n=L.B.createComponent({section:L.B.create(L.B.Id.checksFeed),component:h.F.div});return a.createElement(h.F.Fragment,null,e.navigationViewModel.state.view("isSidebarOpen").view((t=>t?a.createElement(h.F.div,{className:i},a.createElement(h.F.div,{className:t&&me.vF.refreshedOggyOpen},e.navigationViewModel.state.view("isGgoOpen").view((t=>t?a.createElement(Ct.Gc,{cheetahViewModel:e.cheetahViewModel,navigationViewModel:e.navigationViewModel,features:e.features}):a.createElement(Ct.ss,{cheetahViewModel:e.cheetahViewModel,navigationViewModel:e.navigationViewModel,features:e.features}))))):e.features.isAiStudio?null:a.createElement(n,{"data-name":"toggler",className:me.vF.toggleWrapper},a.createElement(kt.v,{documentModel:e.documentModel,features:e.features,navigationViewModel:e.navigationViewModel})))))},e.TheViewPlaceholder=({isOggyPlagiarismButtonVisible:e})=>{const i=t(e);return a.createElement(h.F.div,{className:i})},e.Grid=({name:e,className:t,opened:i,children:n})=>a.createElement(h.F.div,(0,s._)({key:"sidebar-tier","data-name":"sidebar-tier"},(0,p.Ly)(me.vF.sidebarTier,i.view((e=>!e&&me.vF.hiddenWrapper)),t)),a.createElement("div",{key:"sidebar-wrapper","data-name":e,className:me.vF.sidebarWrapper},n)),e.Section=({opened:e,children:t,className:i})=>{const{landmark:n}=a.useContext($e.S.Context);return a.createElement(h.F.section,(0,s._)({"data-name":"sidebar-tier","arial-label":n.sidebar},(0,p.Ly)(me.vF.sidebarTier,e.view((e=>!e&&me.vF.hiddenWrapper)),i)),a.createElement("div",{key:"sidebar-wrapper","data-name":"sidebar",className:me.vF.sidebarWrapper},t))},e.Loader=({state:e,baseLoaderClass:t})=>a.createElement(wt.Grid,{name:"sidebar-loader",opened:c.s.create(!0)},a.createElement(St,{state:e.view("lens"),theme:me.cX},a.createElement(h.F.div,(0,p.Ly)(me.vF.oggyLoaderWrapper,t),a.createElement(ft.kr.Rechecking,{"data-name":"lensviewRechecking",key:"lensview-rechecking"}))))}(wt||(wt={}));var Mt,Et=i(98831);!function(e){e.GrammarlyGO=({className:e,width:t=23})=>a.createElement(Et.hh,{className:e,width:t,viewBox:"0 0 23 23"},a.createElement("path",{fill:"var(--path-fill-1, #2551DA)",fillRule:"evenodd",stroke:"none",d:"M14.9 17c.1-.8.6-1.5 1.2-2 1.3-1.3 2.1-3 2.1-5 0-3.9-3.2-7-7.2-7s-7.3 3.1-7.3 7c0 2 .9 3.7 2.2 5 .6.5 1 1.2 1.2 2H15Zm-7.6 1.5h7.4v.7c-.1 1-1 1.8-2 1.8H9.3c-1 0-1.9-.8-2-1.8v-.7Z",clipRule:"evenodd"}),a.createElement("mask",{id:"a",width:"16",height:"18",x:"3",y:"3",maskUnits:"userSpaceOnUse",style:{maskType:"alpha"}},a.createElement("path",{fill:"var(--path-fill-2, #018374)",fillRule:"evenodd",stroke:"none",d:"M14.9 17c.1-.8.6-1.5 1.2-2 1.3-1.3 2.1-3 2.1-5 0-3.9-3.2-7-7.2-7s-7.3 3.1-7.3 7c0 2 .9 3.7 2.2 5 .6.5 1 1.2 1.2 2H15Zm-7.6 1.5h7.4v.7c-.1 1-1 1.8-2 1.8H9.3c-1 0-1.9-.8-2-1.8v-.7Z",clipRule:"evenodd"})),a.createElement("g",{filter:"url(#b)",mask:"url(#a)",opacity:".9"},a.createElement("mask",{id:"c",fill:"#fff"},a.createElement("path",{stroke:"none",fillRule:"evenodd",d:"M14.9 17c.1-.8.6-1.5 1.2-2 1.3-1.3 2.1-3 2.1-5 0-3.9-3.2-7-7.2-7s-7.3 3.1-7.3 7c0 2 .9 3.7 2.2 5 .6.5 1 1.2 1.2 2H15Zm-7.6 1.5h7.4v.7c-.1 1-1 1.8-2 1.8H9.3c-1 0-1.9-.8-2-1.8v-.7Z",clipRule:"evenodd"})),a.createElement("path",{fill:"var(--path-fill-3, #34BCFF)",fillRule:"evenodd",stroke:"none",d:"M14.9 17c.1-.8.6-1.5 1.2-2 1.3-1.3 2.1-3 2.1-5 0-3.9-3.2-7-7.2-7s-7.3 3.1-7.3 7c0 2 .9 3.7 2.2 5 .6.5 1 1.2 1.2 2H15Zm-7.6 1.5h7.4v.7c-.1 1-1 1.8-2 1.8H9.3c-1 0-1.9-.8-2-1.8v-.7Z",clipRule:"evenodd"}),a.createElement("path",{fill:"var(--path-fill-4, #2551DA)",stroke:"none",d:"m16.1 15-.7-.8.7.8ZM15 17v1h.8l.1-.8-1-.2Zm-9-2-.7.7.7-.7ZM7 17l-1 .2.2.8h.8v-1Zm7.6 1.5h1l.1-1h-1v1Zm-7.4 0v-1H6.2l.1 1h1Zm7.4.7-1-.1h1Zm-7.4 0h-1 1Zm8.1-5c-.6.7-1.3 1.5-1.5 2.6l2 .4c0-.5.4-1 1-1.5l-1.5-1.5Zm1.8-4.2c0 1.7-.6 3.2-1.8 4.2l1.4 1.5a7.9 7.9 0 0 0 2.4-5.7h-2ZM11 4c3.5 0 6.3 2.7 6.3 6h2c0-4.5-3.8-8-8.3-8v2Zm-6.3 6c0-3.3 2.8-6 6.3-6V2a8.1 8.1 0 0 0-8.3 8h2Zm1.9 4.2A5.9 5.9 0 0 1 4.8 10h-2c0 2.2.9 4.2 2.4 5.7l1.4-1.5ZM8 16.8c-.2-1-.9-2-1.5-2.6l-1.4 1.5c.5.5.8 1 1 1.5l2-.4ZM15 16H7v2H15v-2Zm-.2 1.5H7.3v2h7.4v-2Zm1 1.7v-.6l-2-.2v.7l2 .1Zm-3 2.8a3 3 0 0 0 3-2.8l-2-.1c0 .5-.5.9-1 .9v2Zm-3.4 0h3.4v-2H9.3v2Zm-3-2.8a3 3 0 0 0 3 2.8v-2a1 1 0 0 1-1-1l-2 .2Zm0-.6v.6l2-.1v-.7l-2 .2Z",mask:"url(#c)"})),a.createElement("g",{filter:"url(#d)"},a.createElement("path",{fill:"#fff",stroke:"none",d:"M14.5 10.6a3.8 3.8 0 0 0-2.8 2.8v.1c-.2.7-1.2.7-1.3 0a3.8 3.8 0 0 0-2.9-2.9c-.7-.1-.7-1 0-1.2a3.8 3.8 0 0 0 2.9-2.9c.1-.7 1-.7 1.2 0a3.8 3.8 0 0 0 2.9 2.9c.7.1.7 1 0 1.2Z"})),a.createElement("defs",null,a.createElement("filter",{id:"b",width:"26.5",height:"30",x:"-2.3",y:"-3",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse"},a.createElement("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),a.createElement("feBlend",{in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),a.createElement("feGaussianBlur",{result:"effect1_foregroundBlur_5277_13171",stdDeviation:"3"})),a.createElement("filter",{id:"d",width:"20",height:"20",x:"1",y:"0",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse"},a.createElement("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),a.createElement("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),a.createElement("feOffset",null),a.createElement("feGaussianBlur",{stdDeviation:"3"}),a.createElement("feComposite",{in2:"hardAlpha",operator:"out"}),a.createElement("feColorMatrix",{values:"0 0 0 0 0.00392157 0 0 0 0 0.513726 0 0 0 0 0.454902 0 0 0 1 0"}),a.createElement("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_5277_13171"}),a.createElement("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_5277_13171",result:"shape"})))),e.Rewrite=({className:e,width:t=24})=>a.createElement(Et.hh,{className:e,width:t,viewBox:"0 0 24 24"},a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.866 4.5C12.3877 4.22386 11.7761 4.38773 11.5 4.86603L10.2469 7.03649L14.577 9.53649L15.8301 7.36603C16.1063 6.88773 15.9424 6.27614 15.4641 6L12.866 4.5ZM13.8256 10.8379L9.49549 8.33793L6.2476 13.9634C6.07792 14.2573 5.98582 14.5896 5.97995 14.9289L5.91538 18.6643C5.90859 19.0569 6.33617 19.3038 6.67275 19.1016L9.87546 17.178C10.1664 17.0032 10.408 16.7573 10.5777 16.4634L13.8256 10.8379Z",fill:"#018374"}),a.createElement("mask",{id:"mask0_5345_15767",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"5",y:"4",width:"11",height:"16"},a.createElement("path",{d:"M12.8667 4.50011C12.3885 4.22397 11.7769 4.38784 11.5007 4.86613L10.2476 7.0366L14.5777 9.5366L15.8308 7.36613C16.107 6.88784 15.9431 6.27625 15.4648 6.00011L12.8667 4.50011Z",fill:"#018374"}),a.createElement("path",{d:"M13.8263 10.838L9.49621 8.33804L6.24832 13.9636C6.07864 14.2574 5.98653 14.5897 5.98067 14.929L5.9161 18.6644C5.90931 19.057 6.33689 19.3039 6.67347 19.1017L9.87618 17.1781C10.1671 17.0033 10.4088 16.7574 10.5784 16.4636L13.8263 10.838Z",fill:"#018374"})),a.createElement("g",{mask:"url(#mask0_5345_15767)"},a.createElement("g",{opacity:"0.9",filter:"url(#filter0_f_5345_15767)"},a.createElement("path",{d:"M12.9435 2.36572L17.2737 4.86572L10.676 16.2933L4.49997 22L6.34584 13.7933L12.9435 2.36572Z",fill:"#00FFCE"}),a.createElement("path",{d:"M13.1266 3.04874L16.5907 5.04874L10.2809 15.9775L5.34021 20.5429L6.81694 13.9773L13.1266 3.04874Z",stroke:"#018374"}))),a.createElement("path",{d:"M8.69157 4.88121C7.81024 5.08868 7.12071 5.77187 6.90771 6.64867L6.89649 6.69484C6.79751 7.10228 6.2155 7.1015 6.11762 6.69381L6.10975 6.66104C5.8991 5.78369 5.21143 5.09867 4.3307 4.88884L4.30738 4.88329C3.89754 4.78565 3.89754 4.20481 4.30738 4.10717L4.3307 4.10161C5.21144 3.89178 5.89911 3.20676 6.10975 2.32942L6.11532 2.30619C6.21334 1.89794 6.79643 1.89794 6.89445 2.30619L6.90002 2.32942C7.11067 3.20677 7.79833 3.89179 8.67907 4.10161L8.69262 4.10484C9.10303 4.20262 9.10224 4.78454 8.69157 4.88121Z",fill:"#018374"}),a.createElement("path",{d:"M17.6916 17.8812C16.8102 18.0887 16.1207 18.7719 15.9077 19.6487L15.8965 19.6948C15.7975 20.1023 15.2155 20.1015 15.1176 19.6938L15.1097 19.661C14.8991 18.7837 14.2114 18.0987 13.3307 17.8888L13.3074 17.8833C12.8975 17.7856 12.8975 17.2048 13.3074 17.1072L13.3307 17.1016C14.2114 16.8918 14.8991 16.2068 15.1097 15.3294L15.1153 15.3062C15.2133 14.8979 15.7964 14.8979 15.8944 15.3062L15.9 15.3294C16.1107 16.2068 16.7983 16.8918 17.6791 17.1016L17.6926 17.1048C18.103 17.2026 18.1022 17.7845 17.6916 17.8812Z",fill:"#018374"}),a.createElement("defs",null,a.createElement("filter",{id:"filter0_f_5345_15767",x:"-1.5",y:"-3.63428",width:"24.7737",height:"31.6343",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},a.createElement("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),a.createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),a.createElement("feGaussianBlur",{stdDeviation:"3",result:"effect1_foregroundBlur_5345_15767"}))))}(Mt||(Mt={}));var Tt=i(37634),xt=i(12175);const It=be.Ks.rem(2),At={opacity:0,pointerEvents:"none",position:"absolute",bottom:0,zIndex:Ze.ry},Ft={display:"flex",flexDirection:"row",width:"auto",height:be.Ks.rem(2),borderRadius:It,backgroundColor:Tt.Q.Background.Base.Default,boxShadow:"0 0 .5px rgba(0, 0, 0, .4), 0 1px 3px rgba(0, 0, 0, .09), 0 4px 8px rgba(0, 0, 0, .09)",alignItems:"center"},Vt={position:"relative",boxSizing:"border-box",minWidth:be.Ks.rem(2),height:be.Ks.rem(2),border:"none",background:"none",fontSize:be.Ks.rem(.75),cursor:"pointer",$nest:{svg:(0,o._)((0,s._)({},{"--path-fill-1":"#018374","--path-fill-2":"#018374","--path-fill-3":"#00FFCE","--path-fill-4":"#018374"}),{fill:"none",stroke:"none"}),"&:hover":{backgroundColor:xt.BlueGray10},"&:first-child":{borderTopLeftRadius:It,borderBottomLeftRadius:It,paddingLeft:be.Ks.rem(.25),paddingRight:0},"&:last-child":{borderTopRightRadius:It,borderBottomRightRadius:It,paddingLeft:0}}},Lt=be.Ks.rem(1.5),Ot={width:Lt,height:Lt,backgroundPosition:"center",backgroundSize:Lt},Bt=be.Ks.prefixedStylesheet("cheetah_inline_button",{buttonWrapper:[At],button:[Ft],buttonItem:[Vt],icon:[Ot]}),Rt="Select any text to rewrite it with GrammarlyGO.",Ut="Rewrite your text",Nt="You can also select any text to quickly improve or rewrite it with generative AI.",Pt=({inlineViewModel:e,cheetahNavigation:t})=>a.createElement(h.F.div,{style:e.inlineButtonState.view(Dt),className:Bt.buttonWrapper,"aria-hidden":e.inlineButtonState.view(l.isNone)},a.createElement(x.M7,{message:e.showOnboardingTourA11yUpdates?Nt:Rt,title:e.showOnboardingTourA11yUpdates?Ut:void 0,eventType:"onclick",stepId:G.E.StepId.GrammarlyGORewrite,alignment:"right",dotPosition:{kind:"dotAtPosition",position:x.p3.leftCenter},dismissalTrigger:e.inlineButtonState.pipe(k.T(l.isNone))},a.createElement("div",{className:Bt.button},e.magicRewriteEnabled&&a.createElement(ze.$n,{className:Bt.buttonItem,name:"inline-magic-rewrite","aria-label":"Improve it by Grammarly",onClick:()=>{u.Bx.Logging.getLogger("Cheetah").info("Inline button clicked: magic rewrite"),t.toCheetahLens(!0,!0)},title:"Improve it"},a.createElement(Mt.Rewrite,{className:Bt.icon})),e.inlineRewriteEnabled&&a.createElement(ze.$n,{className:Bt.buttonItem,onClick:()=>{u.Bx.Logging.getLogger("Cheetah").info("Inline button clicked: GrammarlyGO"),t.toCheetahLens(!0,!1)},name:"inline-grammarly-go",title:"Rewrite with Grammarly","aria-label":"Rewrite with Grammarly"},a.createElement(Mt.GrammarlyGO,{className:Bt.icon}))))),Dt=e=>(0,d.pipe)(e,l.fold((0,d.constant)(Kt),Ht)),Ht=({top:e,left:t})=>({top:e+Wt,left:t,bottom:"auto",opacity:1,transition:"opacity .1s linear",pointerEvents:"auto"}),Kt={},Wt=8;var Gt=i(34553),$t=i(94808),zt=i(42383),Jt=i(92723);class jt extends a.Component{shouldComponentUpdate(){return!1}render(){const{denaliEditor:e,scrollbarViewModel:t,children:i,scrollEl:n,navigationViewModel:s}=this.props,o=D.L.withViewportContainer(Qt(Yt,{isSidebarOpen:s.state.view("isSidebarOpen")}),{type:D.L.ContainerType.inherit});return a.createElement(o,{name:"editorComponent",className:zt.u.scrollWrapFixed},a.createElement($t.H,{denaliEditor:e,theme:this._dedTheme,scrollEl:n,editorHeight:this._editorHeight,scrollTop:t.scrollTop},i(new Gt.B,this._editorHeight)))}constructor(...e){super(...e),(0,n._)(this,"_editorHeight",c.s.create(0)),(0,n._)(this,"_isPersistentClientVisible",this.props.persistentClientTreatment.pipe(k.T(l.isSome))),(0,n._)(this,"_dedTheme",this._isPersistentClientVisible.pipe(k.T((e=>({editorContent:zt.u.editorContent,editorContentWrap:e?zt.u.editorContentWrapLeftAlign:zt.u.editorContentWrap,titleWrap:zt.u.titleWrap}))),b.Z({})))}}const Zt=e=>{const{isSidebarOpen:t,children:i,clientsState:n,features:s}=e,o=Qt(qt,{isSidebarOpen:t}),r=s.denali.persistentClientEntryPointTreatment(n);return a.createElement(o,{name:"editorComponent",className:zt.u.scrollWrapFixed},a.createElement(a.Fragment,null,a.createElement(Jt.A,{selectionEffect:I.z.Effect.collapse,persistentClientTreatment:r,isSidebarOpen:t},a.createElement("div",{className:zt.u.textContent})),i))},qt=({className:e,onMount:t,children:i,name:n})=>a.createElement(h.F.div,{"data-name":n,name:"text",key:"denaliEditorWrapper",className:e,mount:t},i),Yt=({className:e,onMount:t,children:i,name:n})=>a.createElement(h.F.section,{"data-name":n,name:"text","aria-label":"Document content",key:"denaliEditorWrapper",className:e,mount:t},i);function Qt(e,t){return class extends a.Component{shouldComponentUpdate(){return!1}render(){const{className:t}=this.props;return a.createElement(e,(0,s._)({},this.props,(0,p.Ly)(t,zt.u.editorComponentWrapper,zt.u.container,this._textTransition)))}constructor(...e){super(...e),(0,n._)(this,"_textTransition",t.isSidebarOpen.pipe(U.i(1),S.n((e=>yt.X.rafSequence(e?[zt.u.toWritingStart,zt.u.toWritingStart,zt.u.toWritingEnd]:[zt.u.toEditingStart,zt.u.toEditingStart,zt.u.toEditingEnd],!0))),b.Z(void 0)))}}}var Xt=i(94855),ei=i(26068),ti=i(35300),ii=i(14553),ni=i(93432),si=i(63687),oi=i(58538),ai=i(70490),ri=i(56548);class li extends a.Component{componentDidMount(){const{synonyms:e,synonymsInfo:t,editorHeight:i}=this.props;this._sub=this.context.pipe(k.T((e=>e.rect)),ii.z(i),ni.c(1),S.n((0,d.flow)(this._getPosition,si.v))).subscribe((i=>{this._rendered||(this._rendered=!0,(0,d.pipe)(i,r.map(l.chain((({markOffset:e})=>e))),r.map(l.map((i=>{e.scrollToMark(t.activeMark.meta.id,i,P.nA.fast).subscribe({error:e=>this._log.error("Cannot scroll to synonym",e)})}))))),(0,d.pipe)(i,r.fold((e=>this._log.error("Cannot get position",e)),(e=>this._state.set((0,d.pipe)(e,l.map((({card:e})=>e)))))))}))}componentWillUnmount(){this._sub&&(this._sub.unsubscribe(),this._sub=null)}render(){const{synonyms:e,synonymsInfo:t}=this.props;return a.createElement(h.F.div,{mount:e=>this._el=e,key:"synonymsPopupWrapper",style:this._state.view((e=>l.getOrElse((()=>({visibility:"hidden",pointerEvents:"none"})))(e))),className:ri.b.popupWrapper},a.createElement(ti.Q,{hide:()=>e.close("closedByUser")},a.createElement(ai.F,{synonymsInfo:t,apply:t=>()=>e.apply(t)})))}constructor(...e){super(...e),(0,n._)(this,"context",void 0),(0,n._)(this,"_log",u.Bx.Logging.getLogger("SynonymsPopup")),(0,n._)(this,"_el",void 0),(0,n._)(this,"_state",c.s.create(l.none)),(0,n._)(this,"_getPosition",(([e,t])=>this._el?(0,d.pipe)(this.props.synonyms.getSynonymMarkRect(this.props.synonymsInfo.activeMark.meta.id),Xt.wu((e=>(this._log.info("Cannot get synonym popup position",e),e)),(i=>{const n=Oe.W.relativeToRoot(i),s=Oe.W.relativeToViewport(i),{width:o,height:a}=this._el.getBoundingClientRect(),r=t<n.bottom+a+32&&a<n.top+150,d=r?n.top-a:n.bottom,c=s.left+o,p=c<e.right?0:c-e.right+32,h=n.left-p,u=(r?s.top-e.top-a:e.bottom-s.bottom-a)<70?l.some(r?Math.min(e.top+a+70,e.bottom-n.height):Math.max(e.bottom-a-70,n.height+70)):l.none;return l.some({card:{top:d,left:h},markOffset:u})}))):Xt.pG(l.none))),(0,n._)(this,"_sub",null),(0,n._)(this,"_rendered",!1)}}(0,n._)(li,"contextType",D.L.Context);class di extends a.Component{render(){const{markRect:e,className:t,children:i}=this.props;return a.createElement(h.F.div,{className:t,style:this.context.pipe(B.M((e=>this._log.debug("Update tooltip position",e.rect))),k.T((()=>(0,d.pipe)(e,r.map((e=>W.Tl(e.left+e.width,e.top))),l.fromEither,l.getOrElse((()=>({visibility:"hidden"})))))))},i)}constructor(...e){super(...e),(0,n._)(this,"context",void 0),(0,n._)(this,"_log",u.Bx.Logging.getLogger("SynonymIconWrapper"))}}(0,n._)(di,"contextType",D.L.Context);class ci extends a.Component{shouldComponentUpdate(){return!1}renderLoader(e){return si.v(this.props.synonyms.getSynonymMarkRect(e.activeMark.meta.id)).pipe(k.T(r.map(Oe.W.relativeToRoot)),k.T((e=>a.createElement(di,{className:ri.b.iconWrapper,markRect:e},a.createElement(ei.a,{accessibilityLabel:"Loading synonyms",className:ri.b.loader},a.createElement(ei.a.Circular,{size:"small"}))))),ni.c(1e3),b.Z(null))}renderPopup(e){return this.props.synonyms.onPopupOpen(),Z.of(a.createElement(li,{synonyms:this.props.synonyms,synonymsInfo:e,editorHeight:this.props.editorHeight,features:this.props.features}))}render(){const{synonyms:e}=this.props;return a.createElement(h.F.div,{className:ri.b.contentWrapper},e.viewState.pipe(B.M((e=>this._log.debug("Synonym state changed",(0,d.pipe)(e,l.fold((()=>null),(e=>({kind:e.synonymsState.kind,popupVisible:e.popupVisible}))))))),S.n(oe.dQ((e=>oi._g.isQuerying(e.synonymsState)?this.renderLoader(e):(oi._g.isReady(e.synonymsState)||oi._g.isEmpty(e.synonymsState))&&e.popupVisible?this.renderPopup(e):Z.of(null)),Z.of(null)))))}constructor(...e){super(...e),(0,n._)(this,"_log",u.Bx.Logging.getLogger("SynonymsView"))}}var pi=i(78246),hi=i(41933),ui=i(57014);const gi={position:"fixed",overflowX:"hidden",overflowY:"auto",width:be.Ks.percent(100),height:"var(--100vh)",boxSizing:"border-box",$nest:{"@media print":{position:"initial",display:"block",overflow:"visible !important",height:"auto",textAlign:"justify"}}},mi={position:"relative",display:"flex",overflow:"hidden",minHeight:be.Ks.percent(100),$nest:{"@media print":{display:"block"}}},_i={position:"relative",width:be.Ks.percent(100)},vi={position:"relative",flex:"auto",margin:`${be.Ks.rem(3.5)} 0 0`,padding:`${be.Ks.rem(Ze.xl)} 0 0`},fi={zIndex:Ze.k2,display:"flex",width:be.Ks.percent(100),height:"var(--100vh)",pointerEvents:"none",$nest:{"@media print":{display:"none"}}},yi={zIndex:Ze.kf,height:"var(--100vh)",backgroundColor:Tt.Q.Background.Base.Default,pointerEvents:"all"},bi={marginTop:be.Ks.rem(.4)},Si={zIndex:Ze.ry,width:be.Ks.percent(100),height:"var(--100vh)",pointerEvents:"none"},wi={width:be.Ks.percent(100),height:be.Ks.percent(100),pointerEvents:"all"},Ci={left:0,zIndex:Ze.yg,width:"100vw",height:"var(--100vh)",pointerEvents:"none"},ki={display:"flex",height:be.Ks.percent(100),pointerEvents:"none"},Mi={position:"absolute",zIndex:Ze.do,maxWidth:be.Ks.percent(100),cursor:"default",pointerEvents:"none",userSelect:"none"},Ei=be.Ks.prefixedStylesheet("document-view",{secondTier:[gi],secondTierLoader:[gi,{position:"relative"}],invisibleSecondTier:[gi,{visibility:"hidden",pointerEvents:"none"}],horizontal:[mi],horizontalEditorWrapper:[_i],horizontalEditorWrapperPersistentClientInstallExp:[vi],fixedHorizontal:[fi],inlineCardWrapper:[{position:"relative"}],baseLoaderClass:[yi],textLoaderWrap:[bi],fixedLoader:[Si],overlayVisible:[(0,ui.YF)(),wi],fixedOverlay:[Ci],withPlaceForScrollbar:[ki],documentContainer:[{position:"relative"}],documentPlaceholder:[Mi]});var Ti=i(97291),xi=i(18728),Ii=i(39812);const Ai={position:"relative",zIndex:Ze.k2,display:"inline-flex",height:be.Ks.rem(Ze.xl),alignItems:"center",$nest:{"@media print":{display:"none"}}},Fi={marginRight:be.Ks.rem(.25),maxWidth:be.Ks.rem(20),color:je.V9,whiteSpace:"nowrap",fontWeight:"normal"},Vi={marginLeft:be.Ks.rem(1)},Li={marginLeft:be.Ks.rem(4)},Oi={overflow:"visible",marginLeft:be.Ks.rem(1.5),alignSelf:"center"},Bi=be.Ks.prefixedStylesheet("toolbar-header",{fakeToolbarWrapper:[Ai],fakeToolbarTitle:[(0,ui.sg)(),Fi,Vi],fakeToolbarTitleMacEditor:[(0,ui.sg)(),Fi,Li],toolbarBtn:[Oi],backIcon:[{transform:"rotate(90deg)"}]}),Ri=({onClick:e,tooltip:t})=>a.createElement(V.ie,{"data-name":"to-home",variant:"tertiary",icon:xi.f,onClick:e,accessibilityLabel:t.view(l.getOrElse((()=>""))),className:Bi.toolbarBtn}),Ui=({logout:e})=>{const t=a.useContext($e.S.Context);return a.createElement(Ri,{tooltip:c.s.create(l.some(t.toolbar.signOut)),onClick:e})},Ni=({type:e,logoutViewModel:t,userAccount:i})=>{const n=a.useContext(Ii.Lz.Context),s=a.useContext($e.S.Context);return a.createElement("div",{className:Bi.fakeToolbarWrapper,"data-name":"document-tools"},i.features.isMacEditor?null:i.features.demoMode?(0,d.pipe)(t,l.map((e=>a.createElement(Ui,{logout:e.logout}))),l.toNullable):a.createElement(Ri,{tooltip:c.s.create(l.some(s.toolbar.backToMyGrammarly)),onClick:()=>n.navigateAndReload(Ii.Lz.routes.documents.href())}),a.createElement(ve.Tc,{className:i.features.isMacEditor?Bi.fakeToolbarTitleMacEditor:Bi.fakeToolbarTitle,"data-name":"toolbar-title"},e===bt.x.TextType.loading?s.toolbar.loading:s.toolbar.processing))};var Pi;!function(e){e.Loader=({logoutViewModel:e,documentLoader:i,className:n,userAccount:o})=>a.createElement(h.F.Fragment,null,i.state.view("text").view(oe.dQ((r=>a.createElement("div",{key:"with-text-loader",className:n},a.createElement("div",(0,s._)({key:"editor"},(0,p.Ly)(Ei.secondTierLoader,Ei.baseLoaderClass)),a.createElement(Ni,{type:r,logoutViewModel:e,userAccount:o}),a.createElement(Jt.j,{position:"top"},a.createElement("div",{className:Ei.textLoaderWrap},a.createElement(Ti.rp,null)))),a.createElement(t,{documentLoader:i}))),null))),e.AssistantOnlyLoader=({documentLoader:e,className:i})=>a.createElement("div",{className:i},a.createElement(t,{documentLoader:e}));const t=({documentLoader:e})=>a.createElement(wt.Loader,{key:"sidebar-loader",state:e.state,baseLoaderClass:Ei.baseLoaderClass})}(Pi||(Pi={}));const Di={position:"relative",overflow:"hidden",width:be.Ks.percent(100),height:be.Ks.percent(100),pointerEvents:"none"},Hi={position:"absolute",top:0,width:be.Ks.px(1),height:be.Ks.percent(100),$nest:{"@media print":{display:"none"}}},Ki=be.Ks.prefixedStylesheet("scrollbar",{invisibleScrollbar:[Di],scrollDetector:[Hi],preventOverscroll:[{overscrollBehavior:"none"}]}),Wi=({width:e,className:t,children:i})=>a.createElement(h.F.div,(0,o._)((0,s._)({},(0,p.Ly)(Ki.invisibleScrollbar,t)),{style:e.pipe(k.T((e=>({width:`calc(100vw - ${e}px)`}))))}),i),Gi=({onMount:e})=>a.createElement("div",{className:Ki.scrollDetector,ref:e}),$i=()=>{const e=a.useContext(z.OH.Context);return y.R.useSubscriptionTo(e.has(z.OH.Flag.preventNavigationByOverscrollWithJS)?M.R(document,"wheel").pipe(B.M((e=>{Math.abs(e.deltaX)>=Math.abs(e.deltaY)&&e.preventDefault()}))):re.w),a.useEffect((()=>(document.body.classList.add(Ki.preventOverscroll),()=>document.body.classList.remove(Ki.preventOverscroll)))),a.createElement(a.Fragment,null)},zi=e=>{const{denaliEditorModel:t,documentModel:i,userAccount:n,denaliViewModels:s,documentLoader:o,loaderClassName:r,clientsState:d,slots:p}=e,u=c.s.create(l.none),g=new ge,m=n.features.denali.persistentClientEntryPointTreatment(d);y.R.useSubscriptionTo(u.pipe(B.M(w.H9(g.target)))),y.R.useSubscriptionTo(s.modalManager.state.pipe(k.T(l.isSome),E.E(u.pipe(C.oE)),k.T((([e,t])=>e?t.setAttribute("inert","true"):t.removeAttribute("inert")))));const{withSelectionEffect:_}=a.useContext(I.z.Context),v=_((({onMouseDown:e,persistentClientTreatment:i,isSidebarOpen:o})=>a.createElement(h.F.div,{className:m.pipe(k.T(l.isSome),k.T((e=>e?Ei.horizontalEditorWrapperPersistentClientInstallExp:Ei.horizontalEditorWrapper))),onMouseDown:e},a.createElement(D.L.InheritVirtualContainer,{name:"withPadding",viewportPadding:b},a.createElement(jt,{denaliEditor:t,settingsModel:n.settings,scrollbarViewModel:g,navigationViewModel:s.navigationViewModel,scrollEl:u,viewportPadding:b,isSidebarOpen:o,persistentClientTreatment:i},((e,i)=>a.createElement(Zi,{denaliViewModels:s,denaliEditorModel:t,editorHeight:i,features:n.features.denali,ModalsPortal:S.Source})))),a.createElement(Gi,{key:"scroll-detector",onMount:e=>g.detector.set(l.fromNullable(e))}))),I.z.Effect.collapse),f=_((()=>a.createElement(wt.OggyView,{cheetahViewModel:s.cheetahViewModel,navigationViewModel:s.navigationViewModel,documentModel:i,features:n.features})),I.z.Effect.collapse),b=c.s.create(P.EN.empty),S=W.ZL.create("modals-portal");return a.createElement(a.Fragment,null,a.createElement($i,null),a.createElement(S.Destination,null),p.ProofitModals(S.Source),a.createElement(h.F.main,{"data-name":"document-content",className:Ei.secondTier,style:g.fakeWidth.pipe(k.T((e=>({paddingRight:e})))),mount:e=>u.set(l.fromNullable(e))},o.state.view("text").view(l.fold((()=>a.createElement(H.D.Top,{className:Ei.fixedLoader,key:"navigation-loader"},a.createElement(Wi,{width:g.width,className:Ei.withPlaceForScrollbar},a.createElement(Pi.AssistantOnlyLoader,{documentLoader:o,className:r})))),(()=>null))),a.createElement(Ji,{scrollbarWidth:g.width,sidebarOpen:s.navigationViewModel.state.view("isSidebarOpen"),editor:a.createElement(Zt,{isSidebarOpen:s.navigationViewModel.state.view("isSidebarOpen"),features:n.features,clientsState:d},a.createElement(_e.t.Component,{denaliEditor:t,documentModel:i,viewportPadding:b,navigationViewModel:s.navigationViewModel,features:n.features,modalManager:s.modalManager,slots:p,clientsState:d})),assistant:a.createElement(a.Fragment,null,a.createElement(wt.TheViewPlaceholder,{isOggyPlagiarismButtonVisible:n.features.denali.oggyPlagiarismButtonVisible}))},a.createElement(p.DocumentToolbar,null)),a.createElement(ji,{opened:s.navigationViewModel.state.view("isSidebarOpen"),editor:a.createElement(v,{persistentClientTreatment:m,isSidebarOpen:s.navigationViewModel.state.view("isSidebarOpen")}),assistant:a.createElement(f,null),slots:p}),a.createElement(Pt,{cheetahNavigation:s.cheetahViewModel.navigation,inlineViewModel:s.cheetahViewModel.inlineViewModel})))},Ji=({sidebarOpen:e,editor:t,assistant:i,scrollbarWidth:n,children:s})=>a.createElement(H.D.Top,{className:Ei.fixedHorizontal},a.createElement(Wi,{width:n,className:Ei.withPlaceForScrollbar},t,a.createElement(wt.Grid,{name:"sidebar-placeholder",opened:e,className:me.vF.sidebarTierOggy},i),s)),ji=({opened:e,editor:t,assistant:i,slots:n})=>a.createElement("div",{className:Ei.horizontal},a.createElement(n.PersistentClientInstallSidebar,null),t,a.createElement(wt.Section,{opened:e,className:me.vF.sidebarTierOggy},i)),Zi=({denaliViewModels:e,denaliEditorModel:t,editorHeight:i,features:n,ModalsPortal:r})=>{const c=n.showOnboardingTourA11yUpdates,p={denaliEditorModel:t,onboardingViewModel:e.onboardingViewModel},u=(0,o._)((0,s._)({},p),{alignment:"bottomCenter",overlay:e=>a.createElement(H.D.Top,{className:Ei.fixedOverlay},a.createElement(h.F.div,{className:e.view((e=>e?Ei.overlayVisible:""))},a.createElement(_.hJ,{positionType:"fixed",visible:e,alignment:"none",overlayType:"transparent"}))),getFirstTargetRect:()=>e.onboardingViewModel.getFirstTargetRect()}),{withSelectionEffect:g}=a.useContext(I.z.Context),v=g(I.z.Effect.PlainContainer,I.z.Effect.prevent),f=a.useContext(N.q.Context),y=R.y(t.viewport,f).pipe(k.T((([e,t])=>e.text.width+K.PA*t)));return a.createElement(h.F.Fragment,null,e.navigationViewModel.state.view("isSidebarOpen").view((t=>t&&a.createElement($.h,(0,o._)((0,s._)({key:"sidebar-opened"},u),{stepId:G.E.StepId.Step11,message:"Click underlined words to see more details about what Grammarly has found.",completionTrigger:e.onboardingViewModel.completionTrigger.pipe(U.i(1)),eventType:"onclick"})))),(0,d.pipe)(e.vbarsViewModel,l.map((t=>a.createElement(K.yz,{model:t,InlineCard:t=>a.createElement(m.$.Context.Consumer,null,(i=>a.createElement(h.F.Fragment,null,e.sduiInlineViewModel.pipe(k.T((e=>(0,hi.M)(y,e,(e=>i(e,"somethingCopied")))(t))))))),suggestionFeedback:e=>a.createElement(rt,(0,s._)({ModalsPortal:r},e))}))),l.toNullable),a.createElement(vt,{className:Ei.inlineCardWrapper,inlineCardVM:e.inlineCardViewModel,features:n,sduiInlineCardVM:e.sduiInlineViewModel,modalsPortal:r}),a.createElement($.h,(0,o._)((0,s._)({},p),{stepId:G.E.StepId.Step9,alignment:"bottomRight",eventType:"onhover",title:c?"Synonyms":void 0,message:"Click on a word twice to see the synonyms.",getFirstTargetRect:()=>e.synonymsViewModel.getFirstSynonymRect(),completionTrigger:e.synonymsViewModel.popupShown.pipe(U.i(1))})),(0,d.pipe)(e.formattingViewModel,l.map((e=>a.createElement(v,null,a.createElement(pi.V4,{vm:e.linksManager})))),l.toNullable),a.createElement(ci,{synonyms:e.synonymsViewModel,editorHeight:i,features:n}),a.createElement("div",{className:Ei.documentContainer},a.createElement(se,{ded:t}),a.createElement(Me,{className:Ei.documentPlaceholder,viewModel:e.documentPlaceholderViewModel})))};var qi=i(24564),Yi=i(11137);const Qi="The changes in your document may be lost if you leave this page.",Xi=e=>{const t=a.useContext(A.Y.Context);return y.R.useEffectOnWillMount((()=>u.Bx.Logging.root.context.add({denali:!0}))),y.R.useEffectOnDidMount((()=>{t.gnarSpec.denaliDocumentPageShow(t.pageId,document.location.toString(),t.isTouchDevice)})),y.R.useEffectOnWillUnmount((()=>{try{e.denaliViewModels.modalManager.hideAll(),e.denaliViewModels.dispose()}catch(e){u.Bx.Logging.getLogger("Main").error("Cannot shutdown the engine",e)}})),y.R.useSubscription(e.selfUpdate.watch(e.documentModel.saved.pipe(b.Z(!0)),"saved"),e.denaliEditorModel.dontFreezeWhen(c.s.combine(_.hJ.activeCount,g.A.activeCount,V.cI.activeCount,((e,t,i)=>e+t+i>0)),"overlay"),e.denaliViewModels.navigationViewModel.state.view("isSidebarOpen").pipe(S.n(w.vh(e.denaliViewModels.alertUserEvents.alertClicked)),C.oE).subscribe((e=>{t.gnarSpec.alertUnderlineClick(t.pageId,"assistantOn",t.pageSessionId,v.J.isPremiumId(e.alert.lensId)?"premiumUphookPreview":e.alert.lensId)}))),a.createElement(a.Fragment,null,a.createElement(x.M7.Context.Provider,{value:e.denaliViewModels.onboardingViewModel},a.createElement(m.$.Context.Provider,{value:(0,O.l)(e.notificationsManager,e.environment)},a.createElement(L.B.Context.Provider,{value:e.denaliViewModels.focus},a.createElement(I.z.Context.Provider,{value:I.z.getSelectionHOCs(e.denaliEditorModel)},a.createElement("div",(0,p.Ly)(qi.A.firstTier),a.createElement(e.slots.StartupManager,null),e.children,a.createElement(Yi.I,{searchViewModel:e.denaliViewModels.searchViewModel,key:"search-bar"}),a.createElement(zi,(0,o._)((0,s._)({},e),{loaderClassName:qi.A.firstTierLoader})),a.createElement(en,{modalManager:e.denaliViewModels.modalManager})))))),a.createElement(e.slots.Dropzone,null))},en=({modalManager:e})=>a.createElement(h.F.Fragment,null,e.state.view((0,d.flow)(l.map((({component:e})=>e)),l.toNullable))),tn=({documentLoader:e,logoutViewModel:t,userAccount:i})=>a.createElement(Pi.Loader,{className:qi.A.firstTierLoader,logoutViewModel:t,userAccount:i,documentLoader:e});class nn extends a.Component{render(){return a.createElement(F.v0,{onMount:this._handleUnsavedChanges},a.createElement(f.a.Block,{when:this.props.documentModel.saved.pipe(b.Z(!0),k.T((e=>!e))),message:()=>(this.props.documentModel.flush().catch((e=>this._log.error("Could not flush document before exit",e))),this._log.warn("unsaved changes prompt before navigate"),"You may have unsaved changes in your document that will be lost if you leave the page.")}))}constructor(...e){super(...e),(0,n._)(this,"_log",u.Bx.Logging.getLogger("block_unsaved_changes")),(0,n._)(this,"_blockNavigationWhenUnsavedChanges",(()=>M.R(window,"beforeunload").pipe(E.E(this.props.documentModel.saved,((e,t)=>t?null:e)),T.p(Boolean)).subscribe((e=>(e.returnValue=Qi,Qi))))),(0,n._)(this,"_notifyAboutDocumentStateChange",(()=>this.props.documentModel.saved.pipe(b.Z(!0)).subscribe((e=>{(0,d.pipe)(this.props.actions.documentStateChanged(e?F.OH.DocumentState.SAVED:F.OH.DocumentState.NOT_SAVED),r.mapLeft((e=>this._log.warn("Could not perform documentStateChanged action.",e))))})))),(0,n._)(this,"_handleUnsavedChanges",(()=>this._blockNavigationWhenUnsavedChanges().add(this._notifyAboutDocumentStateChange())))}}},31486:(e,t,i)=>{i.d(t,{TL:()=>Ae,Gc:()=>Ie,ss:()=>xe});var n,s=i(10334),o=i(17171),a=i(85886),r=i(55548),l=i(38886),d=i(65390),c=i(84647),p=i(56855),h=i(80843),u=i(7149),g=i(4444),m=i(79937),_=i(31967),v=i(91745),f=i(30343),y=i(83694),b=i(19772),S=i(76099),w=i(62597),C=i(89011),k=i(49470),M=i(70751),E=i(82315),T=i(40884),x=i(5731),I=i(83407),A=i(65160),F=i(11089);!function(e){const t=e=>I.h5.isButton(e)&&e.className.startsWith("button_"),i=e=>{var t;return Boolean(null===(t=e.dataset.name)||void 0===t?void 0:t.includes("button:"))},n=e=>(0,c.pipe)(e,d.chain((e=>e.dataset.testid&&/^\d+_F#S_suggestion@Long$/.test(e.dataset.testid)?d.some(e):(0,c.pipe)(e.parentElement,d.fromNullable,n))));e.create=()=>{let e=d.none;return{strategy:s=>(0,c.pipe)(s.querySelector("input"),d.fromNullable,d.fold((()=>(0,c.pipe)(s,F.a.FocusStrategy.focusByPredicate(i),(i=>s=>(0,c.pipe)((e=>(0,c.pipe)(e,n,d.chain((e=>(0,c.pipe)(d.fromNullable(e.parentElement),d.map((t=>Array.from(t.children).indexOf(e))))))))(s),A.Mi((t=>e=d.some(t))),d.chain((0,c.constant)(s)),d.alt((()=>(0,c.pipe)(e,d.fold((()=>F.a.FocusStrategy.focusRootOrFirstFocusable(i)),(e=>(0,c.pipe)(i,F.a.FocusStrategy.focusNthByPredicateOrFirstFocusable(Math.max(0,e-1))(t)))))))))(s))),F.a.FocusStrategy.focusRootOrFirstFocusable)),reset:()=>e=d.none}}}(n||(n={}));var V=i(37634),L=i(98205),O=i(11864),B=i(96504);const R={flex:1,height:"calc(100% - var(--100vh))",$nest:{"& > div":{width:O.Ks.important("inherit"),borderRadius:0,borderRight:"none",borderTop:"none",borderBottom:"none",borderLeft:"none"}}},U=(0,o._)((0,s._)({height:"var(--100vh)",display:"flex",flexDirection:"column"},B.xT.base),{border:`1px solid ${V.Q.Border.Base.Subdued}`,borderTop:"none",borderBottom:"none",$nest:{'& [data-name*="headerClose"]':{display:O.Ks.important("none")}}}),N={outline:`2px solid ${V.Q.Border.Brand.Default}`,outlineOffset:O.Ks.px(-2)},P={flex:1,fontSize:O.Ks.rem(.875),fontWeight:400,lineHeight:O.Ks.rem(1.125),color:V.Q.Text.Base.Subdued,$nest:{"&:focus":N,"&:focus-visible":N,"&:not(:last-of-type)":{borderRight:`1px solid ${V.Q.Border.Base.Subdued}`},"& .gds-tabs-tab":{padding:`${O.Ks.rem(L.v$)} ${O.Ks.rem(L.or)}`,textWrap:"wrap"},'&.gds-tabs-tab-container[aria-selected="true"] .gds-tabs-tab':{color:V.Q.Text.Base.Default,fontWeight:600}}},D={$nest:{"& .gds-flex":{gap:O.Ks.important(0),overflow:O.Ks.important("visible")}}},H={display:"flex",flex:1,flexDirection:"column",gap:O.Ks.rem(L.or),alignItems:"flex-start",textAlign:"left",whiteSpace:"pre-wrap",padding:`${O.Ks.rem(L.or)} ${O.Ks.rem(L.or)} ${O.Ks.rem(L.or)} ${O.Ks.rem(L.CN)}`},K={height:O.Ks.percent(100)},W=O.Ks.prefixedStylesheet("oggy",{oggyWrapper:[U],tabContainer:[D],tabContent:[H],tabButton:[P],fullHeight:[K],tabPanel:[R]});var G=i(80013),$=i(10164),z=i(77205),J=i(78428),j=i(59893),Z=i(34275),q=i(70606),Y=i(13490),Q=i(49611),X=i(84712),ee=i(90829),te=i(84872),ie=i(63967),ne=i(63388),se=i(80300),oe=i(35426),ae=i(54610),re=i(12175),le=i(13607),de=i(57014);const ce=.2,pe={position:"relative",display:"block",zIndex:0,margin:`${O.Ks.rem(0)} ${O.Ks.rem(L.Jj)}`,fontSize:O.Ks.rem(.875),fontWeight:500,border:`${O.Ks.px(1)} solid transparent`,borderRadius:O.Ks.rem(.25),backgroundImage:"linear-gradient(to right, #526DD9 0%, #526DD9 25%, #3E7FFC 75%, #0FCEAF 100%)",backgroundSize:O.Ks.percent(400),backgroundPositionX:O.Ks.percent(99),transition:`background-position-x ${O.Ks.seconds(ce)}`,$nest:{svg:(0,o._)((0,s._)({},{"--path-fill-1":"#018374","--path-fill-2":"#018374","--path-fill-3":"#00FFCE","--path-fill-4":"#018374"}),{flex:"0 0 auto",$nest:{path:{transition:`fill ${O.Ks.seconds(ce)}`}}}),"&[data-active=true]":{fontWeight:600,color:re.NeutralGray60,backgroundPositionX:O.Ks.percent(1),$nest:{path:(0,s._)({},{"--path-fill-1":"#2551DA","--path-fill-2":"#018374","--path-fill-3":"#34BCFF","--path-fill-4":"#2551DA"})}}}},he={position:"relative",zIndex:1,lineHeight:O.Ks.rem(1.5),backgroundColor:re.White,color:re.NeutralGray90,padding:O.Ks.rem(L.CN),display:"flex",alignItems:"center",transition:`\n    color ${O.Ks.seconds(ce)},\n    background-color ${O.Ks.seconds(ce)}\n  `,$nest:{"[data-active='true'] > &":{backgroundColor:re.NeutralGray10,color:re.NeutralGray60},":not([data-disabled='true'])[data-hovered='true'] > &":{backgroundColor:re.NeutralGray10}}},ue={fontSize:O.Ks.rem(.75),fontWeight:400,lineHeight:O.Ks.rem(1.125),color:re.NeutralGray90,$nest:{[de.$U.compactSidebar]:de.sM}},ge={minWidth:O.Ks.rem(1.5),minHeight:O.Ks.rem(1.5)},me={position:"relative",zIndex:le.kf},_e=O.Ks.prefixedStylesheet("cheetah_button",{button:[pe],buttonContent:[he],label:[{flex:"1 1 auto",display:"flex",flexDirection:"column",alignItems:"flex-start"}],subtitle:[ue],icon:[ge],onboardingContainer:[me]}),ve="By the way, you can also access our generative AI assistance here.",fe="Go beyond revision",ye="Generative AI can help you brainstorm ideas and even write a first draft.",be=e=>a.createElement("div",{className:W.tabContent},a.createElement(z.I,{size:"small",accessibilityLabel:"",icon:e.icon}),a.createElement("span",null,e.children)),Se=e=>"available"===e.kind||e.reason===ne.GJ.EmptyDocument,we=({navigationViewModel:e,features:t,cheetahViewModel:i})=>{const n=a.useContext(oe.k.Context),r=ae.v.useCollapsibleNavbarThreshold(),l=t.denali.showOnboardingTourA11yUpdates?{title:fe,message:ye}:{message:ve},h=te.z([r,i.onboardingViewModels]).pipe(u.T((([e,t])=>e?d.none:t))),g=x.B.createComponent({component:p.F.nav,section:x.B.create(x.B.Id.navigation),refocusOnMutation:!1});return a.createElement(E.iR,(0,o._)((0,s._)({hideOnboarding:h.pipe(u.T(d.isNone))},l),{alignment:"bottom",eventType:"onclick",stepId:C.E.StepId.GrammarlyGOIdeationAssistant,dotPosition:{kind:"findFirstButton",position:E.p3.center,selector:"#gds-tab-Cheetah"}}),a.createElement(a.Fragment,null,a.createElement(g,{className:W.tabContainer},X.s.combine(e.activeLensId,e.documentActions,i.isGenAiAvailable,((s,o,r)=>(0,ee.Sw)(a.createElement(J.t,{key:s,size:"auto",defaultSelectedTab:s,onChange:t=>{e.activeLensId.get()!==t&&(w.J.isCheetah(t)?i.navigation.toCheetahLens(!1,!1):e.openOggyLens(t,ie.Kz.sidebar))}},a.createElement(J.t.TabList,{accessibilityLabel:"Assistant features",width:"full"},a.createElement(J.t.Tab,{id:w.J.SpecialId.AllAlerts,className:W.tabButton},a.createElement(be,{icon:j.c},n.assistant.tab.allAlerts)),r&&a.createElement(J.t.Tab,{id:w.J.SpecialId.Cheetah,className:W.tabButton},a.createElement(be,{icon:Z.V},n.assistant.tab.genAI)),Se(o.plagiarism)&&a.createElement(J.t.Tab,{id:w.J.SpecialId.Plagiarism,className:W.tabButton},a.createElement(be,{icon:q.c},t.denali.isAiDetectorEnabled?n.assistant.tab.plagiarismWithAiDetector:n.assistant.tab.plagiarism)))),null)(r||Se(o.plagiarism))))),a.createElement(p.F.Fragment,null,h.pipe(u.T((0,c.flow)(d.map((e=>a.createElement("div",{className:_e.onboardingContainer},se.UI.mount(G.M,(0,$.G)(e))))),d.toNullable))))))},Ce=({navigationViewModel:e})=>{const t=x.B.createComponent({component:p.F.div,section:x.B.create(x.B.Id.hideAssistant)});return a.createElement(t,null,a.createElement(Y.K,{"data-name":"hide-assistant",title:"Hide Assistant","aria-label":"Hide Assistant",className:B.vF.closeButton,onClick:()=>e.closeSidebar(),accessibilityLabel:"Hide Assistant",icon:Q.E,variant:"tertiary",size:"small"}))},ke=e=>a.createElement(a.Fragment,null,a.createElement(we,e),a.createElement(Ce,{navigationViewModel:e.navigationViewModel})),Me="aria-expanded",Ee=u.T((0,c.flow)(d.map((e=>a.createElement(e,null))),d.toNullable)),Te=({cheetahViewModel:e,mode:t,navigationViewModel:i,features:r})=>{const{ref:d,onMount:y}=b.R.useElWatcher();b.R.useSubscription((0,c.pipe)(d.pipe(g.oE,m.n((e=>_.vB(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:[Me]}).pipe(u.T(l.pb((e=>e.attributeName===Me))),v.p(l.J_),u.T((e=>e.some((e=>"true"===e.target.getAttribute(Me)))))))),f.Z(!1)),e.acquireFocusWhen));const S=W.oggyWrapper,w=W.oggyWrapper,C=n.create(),k=e=>t=>{t.target instanceof HTMLButtonElement&&"button:accept"===t.target.dataset.name&&(t.target.dataset.disabled=e?"true":"false",t.target.disabled=e)},M=x.B.createComponent({section:x.B.create(x.B.Id.checksFeed),component:p.F.div,focusStrategy:C.strategy,onActive:C.reset});return a.createElement("div",(0,o._)((0,s._)({"data-name":"cheetah-view"},(0,h.Ly)("oggy"===t?S:w)),{ref:y}),a.createElement(ke,{navigationViewModel:i,cheetahViewModel:e,features:r}),a.createElement(M,{role:"tabpanel",id:i.activeLensId.view((e=>`gds-tab-panel-${e}`)),"aria-labelledby":i.activeLensId.view((e=>`gds-tab-${e}`)),onFocus:e.blockApply.view(k),onMouseOver:e.blockApply.view(k),className:W.tabPanel},Ee("oggy"===t?e.assistantUI:e.ggoUI)))},xe=e=>{const t=e.transition?e.transition.pipe(u.T((e=>e.base))):y.of("");return a.createElement(p.F.div,(0,o._)((0,s._)({},(0,h.Ly)(t)),{onTransitionEnd:e.onTransitionEnd}),t.pipe(u.T((t=>null!=t?a.createElement(E.M7,{alignment:"bottom",eventType:"onclick",stepId:C.E.StepId.Step4,title:"Review suggestions",message:"Grammarly checks for mistakes and suggests ways to improve your text.",dotPosition:{kind:"findFirstButton",position:E.p3.center,selector:`[data-name*="${r.A7.ButtonAccept}"]`,buttonOrder:0}},a.createElement(Te,{mode:"oggy",cheetahViewModel:e.cheetahViewModel,navigationViewModel:e.navigationViewModel,features:e.features})):null))))},Ie=({onTransitionEnd:e,transition:t,cheetahViewModel:i,navigationViewModel:n,features:o})=>a.createElement(p.F.div,(0,s._)({key:w.J.SpecialId.Cheetah},(0,h.Ly)(t?t.pipe(u.T((e=>e.base))):y.of(""))),a.createElement(S.D.Content,{where:"top",className:(0,c.pipe)(o.denali.oggy,d.fromPredicate((e=>e===T.kH.splitSharedAssistants)),d.map((()=>M.j.splitSharedAssistantsLensContent)),d.getOrElse((()=>M.j.fixedLensContent))),"aria-label":"Grammarly GO",role:"region",onTransitionEnd:e},a.createElement(k.uF.Consumer,null,(()=>a.createElement(Te,{mode:"ggo",cheetahViewModel:i,navigationViewModel:n,features:o})))));var Ae;!function(e){const t="cheetah-view";e.isCheetahView=e=>!!e&&e.getAttribute("data-name")===t,e.isInsideCheetahView=e=>{var i;return Boolean(null===(i=e)||void 0===i?void 0:i.closest(`[data-name='${t}']`))}}(Ae||(Ae={}))},82937:(e,t,i)=>{i.d(t,{H:()=>V,h:()=>F});var n=i(10334),s=i(17171),o=i(69384),a=i(85886),r=i(84647),l=i(65390),d=i(94855),c=i(24819),p=i(56855),h=i(63687),u=i(25093),g=i(60191),m=i(99010),_=i(7149),v=i(30343),f=i(91745),y=i(58260),b=i(19772),S=i(5692);const w=e=>{const{isEligible:t,children:i}=e;return a.useEffect((()=>{if(t){var e;const t=document.createElement("script");t.type="text/javascript",t.innerHTML="(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-NPLPZQ89');",null===(e=document.querySelector("head"))||void 0===e||e.appendChild(t)}}),[t]),a.createElement(a.Fragment,null,i)};var C,k=i(11213),M=i(70932),E=i(55559),T=i(1224);!function(e){e.measure=function(){const e=T.Bx.Logging.getLogger("web_vitals"),t=T.Bx.TimeSeries.rootFemetrics;i.e(4233).then(i.bind(i,91849)).then((({onFCP:e,onFID:t,onLCP:i,onTTFB:n})=>{const s=new Promise((t=>e(t))),o=new Promise((e=>i(e))),a=new Promise((e=>t(e))),r=new Promise((e=>n(e)));return Promise.all([s,o,a,r])})).then((([i,n,s,o])=>{const a=window.location.href.includes("grammarly.com/ddocs/")?"editor":"myGrammarly";e.info("Web vitals",{fcp:i,lcp:n,fid:s,ttfb:o,page:a}),t.getTimer("webVitals_fcp").setContext({page:a}).recordTime(i.value),t.getTimer("webVitals_lcp").setContext({page:a}).recordTime(n.value),t.getTimer("webVitals_fid").setContext({page:a}).recordTime(s.value),t.getTimer("webVitals_ttfb").setContext({page:a}).recordTime(o.value)})).catch((t=>e.error("Couldn't measure web-vitals",t)))}}(C||(C={}));var x=i(74056),I=i(95008),A=i(22409);function F(e,t,i,o,r){return(l,d,c)=>(0,s._)((0,n._)({},d.route),{component:n=>a.createElement(L,{type:l,isPrivate:!0===d.route.private,modelFactory:e,telemetryContext:i,config:o,router:t,globalExperiment:r},(e=>c(e)(n)))})}function V(e){var{telemetryContext:t,config:i,children:s,globalExperiment:d=(0,r.constant)(l.none),model:c}=e,p=(0,o._)(e,["telemetryContext","config","children","globalExperiment","model"]);return a.createElement(E.Y.ContextProvider,(0,n._)({gnarSpec:c.telemetry.gnarSpec},t),!0===p.isPrivate?a.createElement("div",null,a.createElement(B,{authentication:c.authentication,onUserReady:()=>(0,r.pipe)(d(),R(c),l.getOrElse((()=>a.createElement(w,{isEligible:"prod"===i.env&&c.userAccount.features.denali.isEligibleForGtm},s())))),config:i,model:c})):s())}function L(e){return a.createElement(O,e,(t=>a.createElement(V,(0,s._)((0,n._)({},e),{globalExperiment:()=>(0,r.pipe)(e.globalExperiment,l.fromNullable,l.chain((i=>i(t,e.router)))),model:t}),(()=>e.children(t)))))}function O({type:e,modelFactory:t,children:n}){const s=h.v((()=>(0,r.pipe)(O.models.get(e),l.fromNullable,l.fold((()=>{switch(e){case"my-grammarly":return Promise.all([i.e(8928),i.e(1622),i.e(7861),i.e(6352),i.e(5504),i.e(271)]).then(i.bind(i,68945)).then((({createMyGrammarlyAppModel:e})=>t(e)));case"editor":return Promise.all([i.e(8928),i.e(1622),i.e(7861),i.e(6352),i.e(9467),i.e(5504),i.e(6669)]).then(i.bind(i,51394)).then((({createEditorAppModel:e})=>t(e)));case"anonymous-editor":return Promise.all([i.e(8928),i.e(9467),i.e(5504),i.e(4643)]).then(i.bind(i,8491)).then((({createAnonymousEditorAppModel:e})=>t(e)));default:return(0,c.xb)(e)}}),(e=>Promise.resolve(e)))))).pipe(u.$(),g.tl({refCount:!0,bufferSize:1}));return b.R.useSubscriptionTo(s.pipe(m.M((t=>O.models.set(e,t))))),a.createElement(p.F.Fragment,null,s.pipe(_.T(n),v.Z(a.createElement(A.y,{className:k.A.spinner}))))}function B({authentication:e,onUserReady:t,model:i}){const n=a.useContext(x.OH.Context),s=e.status.get();if(S.j.isIdle(s))throw(0,r.pipe)(e.ensureAuthenticated(),d.qE((e=>{e===I.lR.UnauthorizedError&&n.actions.showSigninView()})))();if(S.j.isTerminated(s)){if(S.j.isFatal(s))return a.createElement(M.l,null);if(S.j.isOk(s)){if(i.isReady.get())return t();throw i.isReady.pipe(f.p(Boolean),y.s(1)).toPromise()}return(0,c.xb)(s)}throw e.status.pipe(f.p(S.j.isTerminated),u.$()).toPromise()}O.models=new Map;const R=e=>(e.userAccount.features.trackWebVitals&&C.measure(),r.identity)},95008:(e,t,i)=>{i.d(t,{bb:()=>L,lR:()=>n,n6:()=>V,pJ:()=>R,u7:()=>O});var n,s=i(23988),o=i(10334),a=i(17171),r=i(45819),l=i(66202),d=i(65390),c=i(46238),p=i(69779),h=i(95934),u=i(58508),g=i(24819),m=i(70238),_=i(1224),v=i(94855),f=i(68801),y=i(93498),b=i(5692),S=i(28243),w=i(79937),C=i(18449),k=i(83694),M=i(25093),E=i(8094),T=i(98969),x=i(39781),I=i(92622),A=i(37107),F=i(40464);!function(e){e.CannotUseEditorError="CannotUseEditorError",e.UnknownNetworkError="UnknownNetworkError",e.UnauthorizedError="UserUnauthorizedError",e.UnknownClientError="UnknownClientError",e.UnknownServerError="UnknownServerError"}(n||(n={})),(n||(n={})).fromAjaxErr=function(e){return e instanceof m.GI?n.UnknownNetworkError:401===e.code||403===e.code?n.UnauthorizedError:e.code>=400||e.code<500?n.UnknownClientError:n.UnknownServerError};const V=b.j.defaultValue();var L;function O(e,t,i,n,s,r,l){var c;const h=new Set(e.groups.filter(Boolean)),u="Free"===e.type?x.ut.free:"Premium"===e.type?x.ut.premium:(()=>{throw new Error(`Unknown user type ${e.type}`)})();var g;return{userProfile:{isPaymentSandbox:Boolean(Boolean(e.customFields)&&e.customFields["sandbox.payments"]),id:e.id,anonymous:e.anonymous,confirmed:e.confirmed,email:e.email,newEmail:e.newEmail,fullName:e.name,isTest:e.isTest||!1,canUseEditor:"Premium"===e.type||e.freemium||!1,groups:h,type:u,role:(0,p.pipe)(e.customFields.frontend_role,d.fromNullable),roles:(0,p.pipe)(null!==(g=null===(c=e)||void 0===c?void 0:c.roles)&&void 0!==g?g:[]),loginType:e.loginType,registrationDate:(0,p.pipe)(e.registrationDate,d.fromNullable,d.map((e=>new Date(e)))),editorFeatures:e.editorFeatures,institutionInfo:(0,p.pipe)(d.fromNullable(e.institutionInfo),d.map((e=>(0,a._)((0,o._)({},e),{trueUpSchedule:s}))))},subscription:F.n6,specialOffersEligibilityWithPlans:E.nm,specialOffersEligibility:(0,p.pipe)(l,d.getOrElse((()=>E.Jd))),settings:t,experiments:i,clientControls:n,entitlements:(0,p.pipe)(r,d.map(T.b.fromPassport))}}!function(e){e.sharedCodec=h.E$([I.x.sharedCodec,h.NW({clientControls:I.kz.codec})])}(L||(L={}));class B extends m.Hl{constructor(){super({code:0,status:"error",message:"User cannot use editor"})}}class R{ensureAuthenticated(){return b.j.isIdle(this._state.get())?(this._state.modify(b.j.begin),(0,p.pipe)(this._getUserSession(),f.qI((e=>(setTimeout((()=>{this._onUserAvailable(e),this._state.modify(b.j.success(e))}),0),e.userProfile.canUseEditor?v.pG(void 0):v.kb(new B)))),v.qE(this._handleAuthError))):v.pG(void 0)}_getUserSession(){let e=1;const t=S.l(this._authApi.orAnonymous("sandbox.payments","frontend_role"),[u.Oh(5),u.Ed(5e3)],(t=>{this._log.error("authError: getUser failed",t,{attempt:e++});const i=n.fromAjaxErr(t);switch(i){case n.CannotUseEditorError:case n.UnauthorizedError:return!1;case n.UnknownNetworkError:case n.UnknownClientError:case n.UnknownServerError:return!0;default:return(0,g.xb)(i)}}));return(0,p.pipe)(t,w.n(y.AU({onInProgress:()=>C.t,onSuccess:e=>k.of(l.right(e)),onError:()=>C.t,onFatal:e=>k.of(l.left(e))})),M.$(),(e=>()=>e.toPromise().then(l.chain(l.fromNullable(new m.GI("User is null",""))))),v.cy((e=>(0,p.pipe)(r.CO(c.ApplicativePar)(this._getTreatments),v.M1,v.Tj((()=>({authData:e})))))),v.Tj((({authData:e})=>O(e,A.tl.empty,new Set,d.none,d.none,d.none,d.none))))}constructor(e,t,i,o,a){(0,s._)(this,"_state",void 0),(0,s._)(this,"_authApi",void 0),(0,s._)(this,"_experimentClient",void 0),(0,s._)(this,"_onUserAvailable",void 0),(0,s._)(this,"_onAuthError",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"status",void 0),(0,s._)(this,"_handleAuthError",void 0),(0,s._)(this,"_getTreatments",void 0),this._state=e,this._authApi=t,this._experimentClient=i,this._onUserAvailable=o,this._onAuthError=a,this._log=_.Bx.Logging.getLogger("model.authentication"),this.status=this._state.view((e=>b.j.map(e,(e=>e)))),this._handleAuthError=e=>{this._onAuthError();const t=e instanceof B?n.CannotUseEditorError:n.fromAjaxErr(e);switch(t){case n.CannotUseEditorError:this._log.info("authError: Cannot use editor",e,t),this._state.modify(b.j.error(t));break;case n.UnauthorizedError:this._log.warn("authError: Bad user session",e,t),this._state.modify(b.j.error(t));break;case n.UnknownNetworkError:case n.UnknownClientError:case n.UnknownServerError:this._log.fatal("authError: Failed to get user session",e,t),this._state.modify(b.j.fatal(t));break;default:return(0,g.xb)(t)}return t},this._getTreatments=()=>this._experimentClient.fetchTreatments().catch((e=>{this._log.warn("Failed to fetch treatments",e)}))}}},11213:(e,t,i)=>{i.d(t,{A:()=>o});var n=i(11864);const s={position:"absolute",top:n.Ks.percent(40),width:n.Ks.percent(100)},o=n.Ks.prefixedStylesheet("main",{spinner:[s]})}}]);